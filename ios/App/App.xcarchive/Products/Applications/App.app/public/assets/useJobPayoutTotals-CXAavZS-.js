import{u as y}from"./useQuery-kdg2pmgf.js";import{m as c}from"./index-NZ6jJLfQ.js";function w(r,a,o){return y({queryKey:["job-tech-payout",r,a],queryFn:async()=>{let s=c.from("v_job_tech_payout_2025").select("*").eq("job_id",r);a&&(s=s.eq("technician_id",a));const{data:i,error:p}=await s;if(p)throw p;let _=c.from("timesheets").select("technician_id, approved_by_manager").eq("job_id",r);a&&(_=_.eq("technician_id",a));const{data:b,error:u}=await _;if(u)throw u;const l=new Map,n=new Map;return(b||[]).forEach(e=>{if(!e.technician_id)return;const t=n.get(e.technician_id)||[];t.push(e.approved_by_manager||!1),n.set(e.technician_id,t)}),n.forEach((e,t)=>{const d=e.length>0&&e.every(f=>f===!0);l.set(t,d)}),(i||[]).map(e=>({...e,extras_total_eur:Number(e.extras_total_eur??0),expenses_total_eur:Number(e.expenses_total_eur??0),total_eur:Number(e.total_eur??0),extras_breakdown:e.extras_breakdown??{},expenses_breakdown:e.expenses_breakdown??[],payout_approved:l.get(e.technician_id)??!1}))},enabled:!!r&&((o==null?void 0:o.enabled)??!0),staleTime:30*1e3})}export{w as u};
