import{r as d,j as e,X as J,B as X,s as $,a9 as Y,u as Z,f as G,b as ee}from"./index-NZ6jJLfQ.js";import{u as te}from"./useRealtimeQuery-DRd58t-I.js";import{u as oe}from"./useMobileRealtimeSubscriptions-CkyUxSWV.js";import{u as se}from"./useQuery-kdg2pmgf.js";import{g as ae}from"./roleCategory-BtQgWHfO.js";import{D as ie,J as re,A as le,P as de,T as ne,a as ce,S as me,O as pe,b as be,M as he,c as ue}from"./TechnicianTourRates-B53gy6bo.js";import{B as fe}from"./badge-vNTKF5RD.js";import{I as xe}from"./info-CpCfiYD2.js";import{C as ge}from"./clock-BXPvTWvY.js";import{L as je}from"./layout-dashboard-Bpl_gmRx.js";import{B as ve}from"./briefcase-BrpPecAy.js";import{C as _e}from"./calendar-_Cj_Sgy-.js";import{U as we}from"./user-E3OATBQk.js";import{E as ye}from"./euro-DgRTeGAz.js";import{a as E}from"./addMonths-j-Bb577B.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./useTableSubscription-Cu79jct8.js";import"./useSubscription-C3wu6ko-.js";import"./logoUtils-D2o1jUVg.js";import"./logo-url-cache-eY6nfvu7.js";import"./ellipsis-vertical-zRAfIP3L.js";import"./file-text-igU140SQ.js";import"./chevron-right-Bn7Eu0F7.js";import"./camera-DACJL5j2.js";import"./es-CSiFCUGj.js";import"./receipt-CWKVL4Rh.js";import"./map-BKqH24gv.js";import"./message-square-a2K2ewo9.js";import"./TechnicianIncidentReportDialog-Bb0qWmts.js";import"./index-vfKqQWY5.js";import"./pdf-libs-BqoGqu1a.js";import"./logo-service-SlbhM6-i.js";import"./jobDocumentsUpload-BaycvzFe.js";import"./clipboard-list-wtFE30Ps.js";import"./triangle-alert-D6qN0F8g.js";import"./save-z_re-Mcq.js";import"./lightbulb-BU2ctenD.js";import"./endOfWeek-BYLwoWuZ.js";import"./startOfMonth-B5dVCv8B.js";import"./useMutation-DluhVBs1.js";import"./sheet-DFFfLazF.js";import"./scroll-area-BHjMXddA.js";import"./plus-C3JQqq7t.js";import"./chevron-left-rq2ui83a.js";import"./tree-palm-s3dDhxOJ.js";import"./endOfMonth-Byhxb84j.js";import"./eachDayOfInterval-CPmiA2bk.js";import"./isSameDay-m1OvdnsV.js";import"./avatar-QSp4LpEt.js";import"./usePushNotifications-DXTVLUyg.js";import"./phone-BlFwiuho.js";import"./bell-eCP3MIu-.js";import"./lock-Cr7oPkPT.js";import"./shield-DTqNciIb.js";import"./external-link-QJoXZ6ES.js";import"./user-x-CkJG0NMy.js";import"./log-out-ByMqfvmj.js";import"./alert-BqA-5jRM.js";import"./useTimesheets-C6aFxEBN.js";import"./ratesQueryKeys-DgMsgg6U.js";import"./useJobPayoutTotals-CXAavZS-.js";import"./useJobRatesApproval-DsfA8V9C.js";import"./circle-alert-LZYNzZ7F.js";import"./moon-Bp9lP4EQ.js";import"./circle-check-C0N48OpO.js";import"./useWeatherData-d0TEdKFc.js";import"./weatherApi-BatwQpQy.js";import"./places-restaurant-service-CakuSyx6.js";import"./eye-BE_DouVP.js";import"./download-C1rVE0-J.js";import"./utensils-Dv9wAVOh.js";import"./sparkles-BZkmCd_8.js";import"./DirectMessagesList-C-bJnXYG.js";import"./circle-check-big-CilmNGCn.js";import"./user-check-CYYJtyVp.js";import"./useTabVisibility-TU5j192j.js";import"./subscription-indicator-DAcdH7Ud.js";import"./formatDistanceToNow-Bbdi_GlK.js";import"./constructNow-u0VlpghF.js";import"./differenceInCalendarMonths-6exvViir.js";import"./wifi-C3_7SFyW.js";import"./send-Uvkx0r_O.js";import"./arrow-left-VpQwT4cv.js";import"./users-DMnpVLUq.js";import"./SoundVisionInteractiveMap-BcnXjj1l.js";import"./star-icpn3ybK.js";import"./filter-D0HnK7Nz.js";import"./search-D-OiWg8h.js";import"./useTourRatesApproval-CR_t91JW.js";import"./tourRateMath-BOmIkfWO.js";const R="2026-01-09T10:30:18.965Z",k=[{src:"/lovable-uploads/7bd0c1d7-3226-470d-bea4-5cd7222e3248.png",width:972,height:835},{src:"/lovable-uploads/77dcfa7b-e05a-48e3-b662-03242aa8e853.png",width:512,height:512},{src:"/lovable-uploads/642b8d57-4a23-490e-b7c6-fe8de9eafc63.png",width:512,height:512},{src:"/lovable-uploads/5624e847-e131-4bdf-b4a9-2058fe294ead.png",width:512,height:512},{src:"/lovable-uploads/44b5a76b-8a09-4270-b439-9e7976926b18.png",width:512,height:512},{src:"/lovable-uploads/3c5cf97c-840a-48fd-b781-098c27729d90.png",width:512,height:512},{src:"/lovable-uploads/39daae92-fbe9-4d38-ae04-8e929d2b1e6f.png",width:512,height:512},{src:"/lovable-uploads/14f2fcca-4286-46dc-8d87-4aad90d42e27.png",width:512,height:512}],Ne=t=>{const f=new Date,x=new Date(f.getFullYear(),f.getMonth()-1,f.getDate());return t.filter(m=>{const s=m.date.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!s)return!0;const[,v,h,_]=s;return new Date(parseInt(v),parseInt(h)-1,parseInt(_))>=x})},Me=({theme:t,isDark:f,onClose:x})=>{const[m,s]=d.useState([]),[v,h]=d.useState(R),[_,i]=d.useState(!1),[w]=d.useState(()=>k[Math.floor(Math.random()*k.length)]);d.useEffect(()=>{(async()=>{try{const{data:u,error:g}=await $.from("app_changelog").select("id, version, entry_date, content, last_updated").order("entry_date",{ascending:!1}).order("last_updated",{ascending:!1});if(g)throw g;const N=(u||[]).map(b=>({id:b.id,version:b.version,date:b.entry_date,content:b.content,lastUpdated:b.last_updated}));s(Ne(N))}catch{}})()},[]),d.useEffect(()=>{m.length>0?h(m[0].version):h(R)},[m]),d.useEffect(()=>{const l=new Date,u=m.some(g=>{const N=new Date(g.lastUpdated);return l.getTime()-N.getTime()<1440*60*1e3});i(u)},[m]);const y=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return e.jsx("div",{className:`fixed inset-0 z-[70] flex items-center justify-center ${t.modalOverlay} p-4 animate-in fade-in duration-200`,children:e.jsxs("div",{className:`w-full max-w-md max-h-[90vh] ${f?"bg-[#0f1219]":"bg-white"} rounded-2xl border ${t.divider} shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col`,children:[e.jsxs("div",{className:`p-4 border-b ${t.divider} flex justify-between items-center shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500 text-white",children:e.jsx(xe,{size:18})}),e.jsxs("div",{children:[e.jsx("h2",{className:`text-lg font-bold ${t.textMain}`,children:"Acerca de"}),e.jsxs("p",{className:`text-xs ${t.textMuted}`,children:["v",v]})]})]}),e.jsx("button",{onClick:x,className:`p-2 ${t.textMuted} hover:${t.textMain} rounded-full transition-colors`,children:e.jsx(J,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:w.src,alt:"About",width:w.width,height:w.height,loading:"lazy",decoding:"async",className:"rounded-lg w-full h-auto max-h-40 object-contain"})}),e.jsx("p",{className:`text-sm text-center mb-4 ${t.textMuted}`,children:"Created by JVH"}),e.jsxs("div",{className:`border-t pt-4 ${t.divider}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:`text-sm font-semibold ${t.textMain}`,children:"Changelog"}),_&&e.jsxs(fe,{variant:"outline",className:"text-xs flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),"Actualizado"]})]}),e.jsx("div",{className:"space-y-3",children:m.length===0?e.jsx("p",{className:`text-xs ${t.textMuted}`,children:"No hay entradas recientes."}):m.map(l=>e.jsxs("div",{className:`border-l-2 pl-3 pb-2 ${f?"border-blue-500/30":"border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:`text-xs font-medium ${t.textMain}`,children:["v",l.version]}),e.jsx("span",{className:`text-xs ${t.textMuted}`,children:y(l.date)})]}),e.jsx("p",{className:`text-xs ${t.textMuted} leading-relaxed whitespace-pre-wrap`,children:l.content})]},l.id))})]})]}),e.jsx("div",{className:`p-4 border-t ${t.divider} shrink-0`,children:e.jsx(X,{variant:"outline",className:"w-full",onClick:x,children:"Cerrar"})})]})})},Se=t=>({bg:t?"bg-[#05070a]":"bg-slate-50",nav:t?"bg-[#0f1219] border-t border-[#1f232e]":"bg-white border-t border-slate-200",card:t?"bg-[#0f1219] border-[#1f232e]":"bg-white border-slate-200 shadow-sm",textMain:t?"text-white":"text-slate-900",textMuted:t?"text-[#94a3b8]":"text-slate-500",accent:"bg-blue-600 hover:bg-blue-500 text-white",input:t?"bg-[#0a0c10] border-[#2a2e3b] text-white focus:border-blue-500":"bg-white border-slate-300 text-slate-900 focus:border-blue-500",modalOverlay:t?"bg-black/90 backdrop-blur-md":"bg-slate-900/40 backdrop-blur-md",divider:t?"border-[#1f232e]":"border-slate-100",danger:t?"text-red-400 bg-red-500/10 border-red-500/20":"text-red-700 bg-red-50 border-red-200",success:t?"text-emerald-400 bg-emerald-500/10 border-emerald-500/20":"text-emerald-700 bg-emerald-50 border-emerald-200",warning:t?"text-amber-400 bg-amber-500/10 border-amber-500/20":"text-amber-700 bg-amber-50 border-amber-200",cluster:t?"bg-white text-black":"bg-slate-900 text-white"});function po(){const[t,f]=d.useState("dashboard"),{theme:x,setTheme:m}=Y(),{user:s,hasSoundVisionAccess:v}=Z();G();const[h,_]=ee(),i=x==="dark"||x==="system"&&typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").matches,w=()=>{m(i?"light":"dark")},[y,l]=d.useState(null),[u,g]=d.useState(null),[N,b]=d.useState(!1),[T,A]=d.useState(null),[B,C]=d.useState(!1),[U,D]=d.useState(!1),[F,z]=d.useState(!1);d.useEffect(()=>{h.get("showAbout")==="1"&&(z(!0),h.delete("showAbout"),_(h,{replace:!0}))},[h,_]),oe();const{data:c}=se({queryKey:["user-profile",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const{data:r,error:p}=await $.from("profiles").select("first_name, last_name, nickname, phone, residencia, dni, bg_color, profile_picture_url, role, department, calendar_ics_token").eq("id",s.id).single();if(p)throw p;return r},enabled:!!(s!=null&&s.id)}),{data:O=[],isLoading:I}=te(["assignments-superapp"],async()=>{if(!(s!=null&&s.id))return[];const r=E(new Date,-3),p=E(new Date,3),{data:j,error:M}=await $.from("job_assignments").select("job_id, sound_role, lights_role, video_role, status, assigned_at").eq("technician_id",s.id).eq("status","confirmed");if(M)return[];if(!j||j.length===0)return[];const Q=j.map(n=>n.job_id),{data:H,error:P}=await $.from("timesheets").select(`
          job_id,
          technician_id,
          date,
          jobs!inner (
            id,
            title,
            description,
            start_time,
            end_time,
            timezone,
            location_id,
            job_type,
            color,
            status,
            location:locations(name),
            job_documents(
              id,
              file_name,
              file_path,
              visible_to_tech,
              uploaded_at,
              read_only,
              template_type
            )
          )
        `).eq("technician_id",s.id).eq("is_active",!0).in("job_id",Q).gte("jobs.start_time",r.toISOString()).lte("jobs.start_time",p.toISOString()).order("start_time",{referencedTable:"jobs"});if(P)return[];const W=new Map(j.map(n=>[n.job_id,n])),V=new Set;return(H||[]).filter(n=>V.has(n.job_id)?!1:(V.add(n.job_id),!0)).filter(n=>n.jobs).map(n=>{let S="unknown";const o=W.get(n.job_id);o!=null&&o.sound_role?S="sound":o!=null&&o.lights_role?S="lights":o!=null&&o.video_role&&(S="video");const K=ae({sound_role:o==null?void 0:o.sound_role,lights_role:o==null?void 0:o.lights_role,video_role:o==null?void 0:o.video_role});return{id:`job-${n.job_id}`,job_id:n.job_id,technician_id:n.technician_id,department:S,role:(o==null?void 0:o.sound_role)||(o==null?void 0:o.lights_role)||(o==null?void 0:o.video_role)||"Assigned",category:K,sound_role:o==null?void 0:o.sound_role,lights_role:o==null?void 0:o.lights_role,video_role:o==null?void 0:o.video_role,jobs:n.jobs}})},"timesheets",{refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:1e3*60*2,gcTime:1e3*60*5}),a=Se(i),q=(r,p)=>{g(p||null),l(r)},L=c!=null&&c.first_name&&(c!=null&&c.last_name)?`${c.first_name} ${c.last_name}`:(s==null?void 0:s.email)||"TÃ©cnico";return e.jsxs("div",{className:`min-h-screen flex flex-col ${a.bg} transition-colors duration-300 font-sans`,children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pb-[calc(6rem+var(--safe-area-bottom))]",children:[t==="dashboard"&&e.jsx(ie,{theme:a,isDark:i,user:s,userProfile:c,assignments:O,isLoading:I,onOpenAction:q,onOpenSV:()=>l("soundvision"),onOpenObliqueStrategy:()=>b(!0),onOpenTour:r=>A(r),onOpenRates:()=>C(!0),onOpenMessages:()=>D(!0),hasSoundVisionAccess:v}),t==="jobs"&&e.jsx(re,{theme:a,isDark:i,assignments:O,isLoading:I,onOpenAction:q,techName:L,onOpenObliqueStrategy:()=>b(!0)}),t==="availability"&&e.jsx(le,{theme:a,isDark:i}),t==="profile"&&e.jsx(de,{theme:a,isDark:i,user:s,userProfile:c,toggleTheme:w})]}),e.jsx("div",{className:`min-h-20 ${a.nav} fixed bottom-0 w-full grid grid-cols-4 px-2 z-40 pb-safe-3`,children:[{id:"dashboard",icon:je,label:"Panel"},{id:"jobs",icon:ve,label:"Trabajos"},{id:"availability",icon:_e,label:"Disponib."},{id:"profile",icon:we,label:"Perfil"}].map(r=>e.jsxs("button",{onClick:()=>f(r.id),className:`flex flex-col items-center justify-center gap-1 ${t===r.id?"text-blue-500":i?"text-gray-500":"text-slate-400"}`,children:[e.jsx(r.icon,{size:22,strokeWidth:t===r.id?2.5:2}),e.jsx("span",{className:"text-[10px] font-medium",children:r.label})]},r.id))}),y==="timesheet"&&u&&e.jsx(ne,{theme:a,isDark:i,job:u,onClose:()=>l(null),userRole:(c==null?void 0:c.role)||null,userId:(s==null?void 0:s.id)||null}),y==="details"&&u&&e.jsx(ce,{theme:a,isDark:i,job:u,onClose:()=>l(null)}),y==="soundvision"&&v&&e.jsx(me,{theme:a,isDark:i,onClose:()=>l(null)}),N&&e.jsx(pe,{theme:a,isDark:i,onClose:()=>b(!1)}),B&&e.jsx("div",{className:`fixed inset-0 z-[70] flex items-center justify-center ${a.modalOverlay} p-4 animate-in fade-in duration-200`,children:e.jsxs("div",{className:`w-full max-w-2xl max-h-[90vh] ${i?"bg-[#0f1219]":"bg-white"} rounded-2xl border ${a.divider} shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col`,children:[e.jsxs("div",{className:`p-4 border-b ${a.divider} flex justify-between items-center shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500 text-white",children:e.jsx(ye,{size:18})}),e.jsx("h2",{className:`text-lg font-bold ${a.textMain}`,children:"Mis tarifas"})]}),e.jsx("button",{onClick:()=>C(!1),className:`p-2 ${a.textMuted} hover:${a.textMain} rounded-full transition-colors`,children:e.jsx(J,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(be,{theme:a,isDark:i})})]})}),U&&e.jsx(he,{theme:a,isDark:i,userProfile:c,onClose:()=>D(!1)}),T&&e.jsx(ue,{tourId:T,theme:a,isDark:i,onClose:()=>A(null),onOpenJob:r=>{const p=O.find(j=>{var M;return j.job_id===r||((M=j.jobs)==null?void 0:M.id)===r});p!=null&&p.jobs&&(g(p.jobs),l("details"))}}),F&&e.jsx(Me,{theme:a,isDark:i,onClose:()=>z(!1)})]})}export{po as default};
