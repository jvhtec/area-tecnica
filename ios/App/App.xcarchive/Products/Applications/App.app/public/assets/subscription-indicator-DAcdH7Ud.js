import{a8 as k,r,c7 as O,c8 as U,j as s,T as C,J as v,K as R,Q as t,O as T,B as _,R as E,a as W}from"./index-NZ6jJLfQ.js";import{f as z}from"./formatDistanceToNow-Bbdi_GlK.js";import{a as A,W as B}from"./wifi-C3_7SFyW.js";import{T as L}from"./triangle-alert-D6qN0F8g.js";function F(i){const{connectionStatus:e,activeSubscriptions:f,lastRefreshTime:c,refreshSubscriptions:p,subscriptionsByTable:l}=k(),[u,b]=r.useState([]),[j,n]=r.useState([]),[o,m]=r.useState(!1),[w,d]=r.useState(!1),[S,g]=r.useState(!0);r.useEffect(()=>{const a=[],y=[];i.forEach(h=>{(l[h]||[]).length>0?a.push(h):y.push(h)}),b(a),n(y),m(y.length===0&&e==="connected");const D=Date.now(),I=300*1e3;d(D-c>I);const P=i.every(h=>["jobs","job_assignments","job_date_types","job_departments","profiles","festival_artists","festival_shifts","festival_shift_assignments","messages","direct_messages"].includes(h));g(P)},[i,f,e,c,l]);const x=z(c,{addSuffix:!0});return{isSubscribed:o,tablesSubscribed:u,tablesUnsubscribed:j,connectionStatus:e,lastRefreshTime:c,lastRefreshFormatted:x,isStale:w,supportsRealtime:S,refreshSubscription:async()=>{try{return O()!=="CONNECTED"&&await U(i),p(),!0}catch{return!1}}}}function G({tables:i,variant:e="default",showRefreshButton:f=!1,showLabel:c=!1,onRefresh:p,className:l}){const{isSubscribed:u,tablesSubscribed:b,tablesUnsubscribed:j,connectionStatus:n,lastRefreshFormatted:o,isStale:m,refreshSubscription:w}=F(i),[d,S]=r.useState(!1),g=async()=>{S(!0);try{p?await p():w()}finally{S(!1)}},x=()=>n==="connecting"?s.jsx(W,{className:t("animate-spin",e==="icon-only"?"h-5 w-5":"h-4 w-4")}):n!=="connected"?s.jsx(A,{className:t("text-red-500",e==="icon-only"?"h-5 w-5":"h-4 w-4")}):m?s.jsx(L,{className:t("text-amber-500",e==="icon-only"?"h-5 w-5":"h-4 w-4")}):u?s.jsx(B,{className:t("text-green-500",e==="icon-only"?"h-5 w-5":"h-4 w-4")}):s.jsx(L,{className:t("text-amber-500",e==="icon-only"?"h-5 w-5":"h-4 w-4")}),N=()=>n==="connecting"?s.jsxs("div",{className:"text-xs max-w-xs",children:[s.jsx("p",{className:"font-semibold",children:"Establishing connection"}),s.jsx("p",{children:"Setting up real-time connection..."})]}):n!=="connected"?s.jsxs("div",{className:"text-xs max-w-xs",children:[s.jsx("p",{className:"font-semibold",children:"Connection lost"}),s.jsx("p",{children:"Attempting to reconnect..."}),s.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last data refresh: ",o]})]}):m?s.jsxs("div",{className:"text-xs max-w-xs",children:[s.jsx("p",{className:"font-semibold",children:"Data may be stale"}),s.jsxs("p",{children:["Last updated: ",o]}),s.jsx("p",{children:"Click to refresh data"})]}):u?s.jsxs("div",{className:"text-xs max-w-xs",children:[s.jsx("p",{className:"font-semibold",children:"Real-time updates active"}),s.jsxs("p",{children:["Subscribed tables: ",i.join(", ")]}),s.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last updated: ",o]})]}):s.jsxs("div",{className:"text-xs max-w-xs",children:[s.jsx("p",{className:"font-semibold",children:"Partial real-time updates"}),b.length>0&&s.jsxs("p",{children:["Subscribed: ",b.join(", ")]}),j.length>0&&s.jsxs("p",{children:["Missing: ",j.join(", ")]}),s.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last updated: ",o]})]});return e==="icon-only"?s.jsx(C,{children:s.jsxs(v,{children:[s.jsx(R,{asChild:!0,children:s.jsx("div",{className:t("cursor-help",l),children:x()})}),s.jsx(T,{children:N()})]})}):e==="compact"?s.jsx(C,{children:s.jsxs(v,{children:[s.jsx(R,{asChild:!0,children:s.jsxs("div",{className:t("flex items-center gap-1.5",l),children:[x(),f&&s.jsxs(_,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:a=>{a.preventDefault(),a.stopPropagation(),g()},disabled:d||n==="connecting",children:[s.jsx(E,{className:t("h-3.5 w-3.5",d&&"animate-spin")}),s.jsx("span",{className:"sr-only",children:"Refresh"})]})]})}),s.jsx(T,{children:N()})]})}):s.jsx(C,{children:s.jsxs(v,{children:[s.jsx(R,{asChild:!0,children:s.jsxs("div",{className:t("flex items-center gap-2",l),children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[x(),c&&s.jsx("span",{className:"text-sm font-medium",children:n==="connecting"?"Connecting...":u?m?"Stale":"Live":"Partial"})]}),f&&s.jsxs(_,{variant:"outline",size:"sm",className:"h-7 px-2 py-1",onClick:g,disabled:d||n==="connecting",children:[s.jsx(E,{className:t("h-3.5 w-3.5 mr-1",d&&"animate-spin")}),"Refresh"]})]})}),s.jsx(T,{children:N()})]})})}export{G as S};
