import{u as q,f as b,e as w,c as E,s as p,j as t,B as d}from"./index-NZ6jJLfQ.js";import{a as C}from"./equipment-B5qd5N3O.js";import{u as A}from"./useQuery-kdg2pmgf.js";import{u as _}from"./useMutation-DluhVBs1.js";import{S}from"./StockCreationManager-CpCpy-Lb.js";import{A as x,b as h,a as f}from"./alert-BqA-5jRM.js";import{A as v}from"./arrow-left-VpQwT4cv.js";import{C as j}from"./circle-alert-LZYNzZ7F.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./scroll-area-BHjMXddA.js";import"./collapsible-DWBtmsfD.js";import"./index-Bf_BVWwW.js";import"./search-D-OiWg8h.js";import"./plus-C3JQqq7t.js";import"./link-z6ku9ZYO.js";import"./clipboard-paste-CkPncGV3.js";import"./download-C1rVE0-J.js";import"./chevron-right-Bn7Eu0F7.js";import"./pencil-BxZTvEYh.js";function Y(){var u;const n=q(),{session:e}=n,r=n.userDepartment,c=b(),{toast:m}=w(),l=E(),{data:y=[],error:g}=A({queryKey:["stock-entries",r],queryFn:async()=>{var s;if(!((s=e==null?void 0:e.user)!=null&&s.id)||!r)return[];const a=C(r),{data:i,error:o}=await p.from("global_stock_entries").select("*, equipment!inner(category)").in("equipment.category",a);if(o)throw o;return i},enabled:!!((u=e==null?void 0:e.user)!=null&&u.id)&&!!r}),k=_({mutationFn:async a=>{var i;if(!((i=e==null?void 0:e.user)!=null&&i.id))throw new Error("No user session");for(const o of a){const{error:s}=await p.from("global_stock_entries").upsert({id:o.id,equipment_id:o.equipment_id,base_quantity:o.base_quantity});if(s)throw s}},onSuccess:()=>{c.invalidateQueries({queryKey:["stock-entries"]}),c.invalidateQueries({queryKey:["current-stock-levels"]}),m({title:"Éxito",description:"Inventario actualizado correctamente"})},onError:a=>{m({variant:"destructive",title:"Error",description:"Error al actualizar el inventario"})}}),N=a=>{k.mutate(a)};return r?t.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-6",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(d,{variant:"ghost",size:"icon",onClick:()=>l(-1),children:t.jsx(v,{className:"h-4 w-4"})}),t.jsx("h1",{className:"text-2xl font-bold",children:"Gestionar Inventario"})]}),g?t.jsxs(x,{variant:"destructive",children:[t.jsx(j,{className:"h-4 w-4"}),t.jsx(h,{children:"Error"}),t.jsx(f,{children:"Error al cargar el inventario. Por favor, inténtelo de nuevo más tarde."})]}):t.jsx(S,{stock:y,onStockUpdate:N,department:r})]}):t.jsxs("div",{className:"container mx-auto px-4 sm:px-6 py-6",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsx(d,{variant:"ghost",size:"icon",onClick:()=>l(-1),children:t.jsx(v,{className:"h-4 w-4"})}),t.jsx("h1",{className:"text-2xl font-bold",children:"Gestionar Inventario"})]}),t.jsxs(x,{children:[t.jsx(j,{className:"h-4 w-4"}),t.jsx(h,{children:"Departamento no asignado"}),t.jsx(f,{children:"No tienes un departamento asignado. Contacta con administración."})]})]})}export{Y as EquipmentManagement};
