import{c as G,d as V,r as e,u as W,e as Y,f as $,i as M,j as t,B as l,E as tt}from"./index-NZ6jJLfQ.js";import{u as et}from"./useOptimizedJobs-BQ4L7-2d.js";import{J as ot}from"./folders-Scoqgw4s.js";import{E as it}from"./EditJobDialog-DRKRzgWP.js";import{D as rt,L as st}from"./DepartmentMobileHub-CFFDzrQc.js";import{CalendarSection as at}from"./CalendarSection-DRcHiGMy.js";import{TodaySchedule as mt}from"./TodaySchedule-xMAV31Nm.js";import{d as nt}from"./optimisticJobDeletionService-Bq-53fU4.js";import{S as O}from"./FlexFolderPicker-DHVHrWa7.js";import{C as lt}from"./calculator-jIsLl-gd.js";import{F as S}from"./file-text-igU140SQ.js";import{L as pt}from"./lightbulb-BU2ctenD.js";import{C as ct}from"./calendar-_Cj_Sgy-.js";import{Z as dt}from"./zap-QKspq41J.js";import{P as ut}from"./plus-C3JQqq7t.js";import{s as bt}from"./subDays-D4REtaCB.js";import{s as gt,a as ht}from"./startOfMonth-B5dVCv8B.js";import{e as ft}from"./endOfMonth-Byhxb84j.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./useQuery-kdg2pmgf.js";import"./useSubscription-C3wu6ko-.js";import"./alert-dialog-CtyYUxwH.js";import"./useJobAssignmentsRealtime-7FZn5naq.js";import"./useRealtimeQuery-DRd58t-I.js";import"./useTableSubscription-Cu79jct8.js";import"./technicianAvailability-gbYgVBKV.js";import"./useJobRequiredRoles-Bz0ibKHS.js";import"./useMutation-DluhVBs1.js";import"./roleCategory-BtQgWHfO.js";import"./external-link-QJoXZ6ES.js";import"./api-C9EDenHJ.js";import"./config-DVV3VxR4.js";import"./constants-DoXhG9KB.js";import"./dryhireFolderService-Bb-tDpoa.js";import"./checkbox-BsRNEGV1.js";import"./dropdown-menu-Dn1SMjj1.js";import"./index-D9TsP8oP.js";import"./index-hC3MxXep.js";import"./chevron-right-Bn7Eu0F7.js";import"./circle-CWxDyDxx.js";import"./popover-Dl-b1R8L.js";import"./calendar--BDVgnXu.js";import"./isSameDay-m1OvdnsV.js";import"./isSameMonth-BQ4F6s8O.js";import"./addMonths-j-Bb577B.js";import"./differenceInCalendarMonths-6exvViir.js";import"./endOfWeek-BYLwoWuZ.js";import"./chevron-left-rq2ui83a.js";import"./badge-vNTKF5RD.js";import"./isWithinInterval-CV3kanO0.js";import"./filter-D0HnK7Nz.js";import"./ellipsis-vertical-zRAfIP3L.js";import"./square-pen-BMpSgZGa.js";import"./clock-BXPvTWvY.js";import"./users-DMnpVLUq.js";import"./truck-Br5sduv3.js";import"./isToday-BbpdYtC3.js";import"./constructNow-u0VlpghF.js";import"./DateTypeContextMenu-D-zx4rHd.js";import"./context-menu-DYP7Nyzl.js";import"./flexUuidService-C9yZjzP-.js";import"./plane-NSG-_bNT.js";import"./wrench-DzMvZxmF.js";import"./star-icpn3ybK.js";import"./mic-l4q2dREA.js";import"./moon-Bp9lP4EQ.js";import"./VideoTaskDialog-jFo9WRqF.js";import"./useWeatherData-d0TEdKFc.js";import"./weatherApi-BatwQpQy.js";import"./icon-D8sTZPYx.js";import"./progress-C8XsV-Me.js";import"./table-DnQAmABX.js";import"./lazyXlsx-BrFBF17_.js";import"./download-C1rVE0-J.js";import"./upload-DF4rjO7T.js";import"./folderNameSanitizer-DNdk00QU.js";import"./JobDetailsDialog-Cah6wZTf.js";import"./tabs-BdaywI_b.js";import"./useTourRateSubscriptions-Dd0aSU9f.js";import"./JobExtrasEditor-gQe73Sd8.js";import"./separator-E-JdTFOv.js";import"./ratesQueryKeys-DgMsgg6U.js";import"./euro-DgRTeGAz.js";import"./minus-InO4I9Ks.js";import"./circle-alert-LZYNzZ7F.js";import"./useJobRatesApproval-DsfA8V9C.js";import"./switch-DUBpZhIC.js";import"./alert-BqA-5jRM.js";import"./JobPayoutTotalsPanel-BSlgp62i.js";import"./useJobPayoutTotals-CXAavZS-.js";import"./useManagerJobQuotes-BrI1iNRY.js";import"./tourRateMath-BOmIkfWO.js";import"./logoUtils-D2o1jUVg.js";import"./logo-url-cache-eY6nfvu7.js";import"./lazyPdf-xVUlxKNu.js";import"./es-CSiFCUGj.js";import"./pen-D_H3YLSb.js";import"./file-down-Buu6FgvW.js";import"./send-Uvkx0r_O.js";import"./circle-check-big-CilmNGCn.js";import"./triangle-alert-D6qN0F8g.js";import"./JobExtrasManagement-CpH8R_KL.js";import"./receipt-CWKVL4Rh.js";import"./circle-check-C0N48OpO.js";import"./circle-x-DDzV-xk_.js";import"./eye-BE_DouVP.js";import"./pdfMerge-DXtLP7Xx.js";import"./pdf-libs-BqoGqu1a.js";import"./timesheet-pdf-82e1LStH.js";import"./avatar-QSp4LpEt.js";import"./places-restaurant-service-CakuSyx6.js";import"./utensils-crossed-CZeagqP3.js";import"./phone-BlFwiuho.js";import"./folder-plus-DTUhlRcm.js";import"./hard-drive-DZn0Cm3i.js";import"./printer-De77t3j8.js";import"./useMobileRealtimeSubscriptions-CkyUxSWV.js";import"./target-kNjpphh3.js";import"./video-BcyQPYgx.js";import"./music-2-DRJ2zGwb.js";import"./eachDayOfInterval-CPmiA2bk.js";import"./endOfYear-D08D-xBX.js";import"./endOfQuarter-BH4-YKz9.js";import"./JobCardNew-ZLL_Hd_i.js";import"./ModernHojaDeRuta-DrMmS05m.js";import"./useJobSelection-B9iLNF5-.js";import"./MultiDayScheduleBuilder-DmGkt0fN.js";import"./building-BdT03Y2e.js";import"./arrow-up-BTt-lBKB.js";import"./copy-Dez5r9kU.js";import"./calendar-days-DcwEz6pd.js";import"./building-2-nIk8XRuA.js";import"./sparkles-BZkmCd_8.js";import"./image--Pql38nK.js";import"./settings-egXcSQW9.js";import"./user-E3OATBQk.js";import"./briefcase-BrpPecAy.js";import"./search-D-OiWg8h.js";import"./id-card-oCs3SPbN.js";import"./car-vrO_NvCk.js";import"./package-Oxfj-CNq.js";import"./activity-BNQuCEmB.js";import"./save-z_re-Mcq.js";import"./LogisticsEventDialog-WK7mGk6y.js";import"./transportOptions-CtHnG2xX.js";import"./transportProviders-CPS1W6Xy.js";import"./TaskManagerDialog-WHCTXr5s.js";import"./taskCompletion-NTcmWFA_.js";import"./TechnicianIncidentReportDialog-Bb0qWmts.js";import"./index-vfKqQWY5.js";import"./logo-service-SlbhM6-i.js";import"./jobDocumentsUpload-BaycvzFe.js";import"./clipboard-list-wtFE30Ps.js";import"./useFlexUuid-C0fmwl_8.js";import"./command-D3uMBT-Z.js";import"./message-circle-Bh9rUoQO.js";import"./info-CpCfiYD2.js";import"./userName-BCcvOtN-.js";import"./scroll-area-BHjMXddA.js";const Ci=()=>{const r=G(),g=V(),[h,d]=e.useState(!1),[A,f]=e.useState(void 0),[x,u]=e.useState(!1),[C,j]=e.useState(!1),[D,y]=e.useState(null),[w,v]=e.useState(null),[s,k]=e.useState(new Date),a="lights",{userRole:n}=W(),I=e.useMemo(()=>[{label:"Pesos",to:"/lights-pesos-tool",icon:O},{label:"Consumos",to:"/lights-consumos-tool",icon:lt},{label:"Memoria técnica",to:"/lights-memoria-tecnica",icon:S}],[]),N=s??new Date,L=bt(gt(N),7),P=ht(ft(N),14),{data:b,isLoading:xt}=et(a,L,P),{toast:p}=Y(),E=$();e.useEffect(()=>{const o=i=>{const m=document.activeElement;if(!!m&&(m.tagName==="INPUT"||m.tagName==="TEXTAREA"||m.isContentEditable))return;i.key.toLowerCase()==="n"&&(i.metaKey||i.ctrlKey)&&(i.preventDefault(),f(void 0),d(!0))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[]);const c=e.useMemo(()=>b?b.filter(o=>{var m;return(m=o.job_departments)==null?void 0:m.some(J=>J.department===a)}):[],[b,a]),R=e.useMemo(()=>{if(!s)return[];const o=M(s,"yyyy-MM-dd");return c.filter(i=>M(new Date(i.start_time),"yyyy-MM-dd")===o)},[s,c]),q=e.useCallback(()=>{},[]),z=e.useCallback(o=>{y(o),u(!0)},[]),F=e.useCallback(o=>{v(o),j(!0)},[]),K=e.useCallback(async o=>{if(!["admin","management"].includes(n||"")){p({title:"Permission denied",description:"Only admin and management users can delete jobs",variant:"destructive"});return}if(window.confirm("¿Está seguro de que desea eliminar este trabajo?"))try{const i=await nt(o);if(i.success)p({title:"Trabajo eliminado",description:i.details||"El trabajo se ha eliminado con éxito."}),await E.invalidateQueries({queryKey:["optimized-jobs"]});else throw new Error(i.error||"Unknown deletion error")}catch(i){p({title:"Error al eliminar el trabajo",description:i.message,variant:"destructive"})}},[E,p,n]),B=e.useCallback(()=>{u(!1)},[]),H=e.useCallback(()=>{},[]),Q=e.useCallback(o=>{j(o),o||v(null)},[]),T=e.useCallback(o=>{f(o),d(!0)},[]),U=e.useCallback(()=>r("/lights-disponibilidad"),[r]),Z=e.useCallback(()=>r("/lights-pesos-tool"),[r]),_=e.useCallback(()=>r("/lights-consumos-tool"),[r]),X=e.useCallback(()=>r("/lights-memoria-tecnica"),[r]);return t.jsxs("div",{className:"min-h-screen bg-background text-foreground p-4 md:p-8",children:[t.jsxs("div",{className:"mx-auto w-full max-w-full space-y-6",children:[g&&t.jsx(rt,{department:a,title:"Departamento de iluminación",icon:pt,tools:I,jobs:c,date:s??new Date,onDateSelect:o=>k(o)}),!g&&t.jsxs(t.Fragment,{children:[t.jsx(st,{onCreateJob:T,department:"Luces",canCreate:n?["admin","management"].includes(n):!0}),t.jsx("div",{className:"bg-card border border-border rounded-xl p-3 sm:p-4 shadow-sm",children:t.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 items-center justify-end",children:[t.jsxs(l,{variant:"outline",onClick:U,className:"flex items-center gap-2",children:[t.jsx(ct,{className:"h-4 w-4"}),"Disponibilidad"]}),t.jsxs(l,{variant:"outline",onClick:Z,className:"flex items-center gap-2",children:[t.jsx(O,{className:"h-4 w-4"}),"Calculadora de Peso"]}),t.jsxs(l,{variant:"outline",onClick:_,className:"flex items-center gap-2",children:[t.jsx(dt,{className:"h-4 w-4"}),"Calculadora de Potencia"]}),t.jsxs(l,{variant:"outline",onClick:X,className:"flex items-center gap-2",children:[t.jsx(S,{className:"h-4 w-4"}),"Memoria Técnica"]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-6",children:[t.jsx("div",{className:"xl:col-span-8 2xl:col-span-9",children:t.jsx("div",{className:"bg-card rounded-xl border border-border shadow-sm",children:t.jsx(at,{date:s,onDateSelect:k,jobs:c,department:a,onDateTypeChange:q})})}),t.jsx("div",{className:"xl:col-span-4 2xl:col-span-3 hidden md:block",children:t.jsx("div",{className:"bg-card rounded-xl border border-border shadow-sm",children:t.jsx(mt,{jobs:R,onEditClick:F,onDeleteClick:K,onJobClick:z,userRole:n,selectedDate:s,detailsOnlyMode:!0,department:a,viewMode:"sidebar"})})})]})]}),h?t.jsx(tt,{open:h,onOpenChange:d,currentDepartment:a,initialDate:s,initialJobType:A,onCreated:o=>{y(o.id),u(!0)}}):null,D&&x?t.jsx(ot,{isOpen:x,onClose:B,onAssignmentChange:H,jobId:D,department:a}):null,w&&C?t.jsx(it,{open:C,onOpenChange:Q,job:w}):null,t.jsx(l,{className:"sm:hidden fixed bottom-6 right-6 rounded-full h-12 w-12 p-0 shadow-lg",onClick:()=>T(void 0),children:t.jsx(ut,{className:"h-6 w-6"})})]})};export{Ci as default};
