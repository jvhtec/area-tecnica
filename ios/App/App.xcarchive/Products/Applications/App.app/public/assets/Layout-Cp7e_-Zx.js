import{l as B,r as l,j as e,B as T,Q as v,c as Y,s as R,e as ye,V as Be,X as Mt,aN as X,H as Ne,M as Lt,d as Xe,T as Se,I as Pt,bl as Z,b0 as At,J as ke,K as Te,O as Ce,a8 as Ze,R as Et,a as ge,n as qe,f as oe,m as Fe,a4 as It,D as et,q as tt,F as st,G as at,aK as it,aL as Rt,u as nt,b as Ot,N as zt,g as Dt,bm as Vt}from"./index-NZ6jJLfQ.js";import{S as pe}from"./separator-E-JdTFOv.js";import{S as rt,a as Bt,b as ot}from"./sheet-DFFfLazF.js";import{S as E}from"./skeleton-DFbEI1RA.js";import{u as lt,R as qt}from"./useEnhancedRouteSubscriptions-B8NTEQXv.js";import{a as Ft,W as Ut}from"./wifi-C3_7SFyW.js";import{C as dt}from"./clock-BXPvTWvY.js";import{C as re}from"./circle-alert-LZYNzZ7F.js";import{f as _e}from"./formatDistanceToNow-Bbdi_GlK.js";import{R as $t}from"./reload-button-B1d3KJMk.js";import{a as Ht,g as Kt}from"./api-Caml4zFF.js";import{u as Gt}from"./useQuery-kdg2pmgf.js";import{B as O}from"./badge-vNTKF5RD.js";import{P as ct}from"./progress-C8XsV-Me.js";import{T as Wt,a as Jt,b as Ue,c as H,d as Qt,e as K}from"./table-DnQAmABX.js";import{u as Yt}from"./useMutation-DluhVBs1.js";import{c as Xt}from"./taskCompletion-NTcmWFA_.js";import{C as Me}from"./calendar-_Cj_Sgy-.js";import{E as ut}from"./external-link-QJoXZ6ES.js";import{C as Zt}from"./circle-check-big-CilmNGCn.js";import{H as es,a as ts,b as ss}from"./hover-card-BMjtHitm.js";import{C as as}from"./checkbox-BsRNEGV1.js";import{I as is}from"./info-CpCfiYD2.js";import{P as ns}from"./plus-C3JQqq7t.js";import{B as mt}from"./bell-eCP3MIu-.js";import{S as rs}from"./save-z_re-Mcq.js";import{u as os}from"./useUserPreferences-D4k5KjWa.js";import{M as ls}from"./moon-Bp9lP4EQ.js";import{S as ds}from"./sun-DEWOIVS5.js";import{u as cs}from"./useAppBadgeSource-megIXC92.js";import{L as bt}from"./log-out-ByMqfvmj.js";import{L as $e}from"./layout-dashboard-Bpl_gmRx.js";import{C as He}from"./clipboard-list-wtFE30Ps.js";import{C as Ke}from"./circle-user-DWpyZYlg.js";import{G as us}from"./grid-3x3-D3Em47ud.js";import{E as ms}from"./euro-DgRTeGAz.js";import{R as bs}from"./receipt-CWKVL4Rh.js";import{L as xe}from"./lightbulb-BU2ctenD.js";import{V as ve}from"./video-BcyQPYgx.js";import{M as je}from"./music-2-DRJ2zGwb.js";import{T as hs}from"./tent-G6tzA2Go.js";import{T as fs}from"./truck-Br5sduv3.js";import{F as gs}from"./file-text-igU140SQ.js";import{A as ps}from"./activity-BNQuCEmB.js";import{M as xs}from"./message-square-a2K2ewo9.js";import{S as vs}from"./settings-egXcSQW9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=B("BellDot",[["path",{d:"M19.4 14.9C20.2 16.4 21 17 21 17H3s3-2 3-9c0-3.3 2.7-6 6-6 .7 0 1.3.1 1.9.3",key:"xcehk"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["circle",{cx:"18",cy:"8",r:"3",key:"1g0gzu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=B("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=B("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=B("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=B("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=B("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=B("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=B("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=B("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),we=({display:t="sidebar",className:s,ariaLabel:a}={})=>{const[o,i]=l.useState(!1),{preferences:n,updatePreferences:c}=os();l.useEffect(()=>{if((n==null?void 0:n.dark_mode)!==void 0){const f=n.dark_mode;i(f),f?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}},[n]);const r=()=>{const f=!o;i(f),f?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),c({dark_mode:f})};l.useEffect(()=>{const f=u=>{(u.ctrlKey||u.metaKey)&&u.shiftKey&&u.key==="D"&&(u.preventDefault(),r())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[r]);const d=t==="icon",b=d?"h-5 w-5":"h-4 w-4",h=d?a??(o?"Cambiar a modo claro":"Cambiar a modo oscuro"):void 0;return e.jsxs(T,{type:"button",variant:"ghost",size:d?"icon":"default",className:v(d?"h-9 w-9 rounded-full border border-border/60 bg-background/70 text-muted-foreground shadow-sm hover:bg-accent/30 hover:text-foreground focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background":"w-full justify-start gap-2",s),onClick:r,"aria-label":h,children:[o?e.jsx(ls,{className:b,"aria-hidden":"true"}):e.jsx(ds,{className:b,"aria-hidden":"true"}),!d&&e.jsx("span",{children:o?"Dark Mode":"Light Mode"})]})},ht=({userId:t,userRole:s,userDepartment:a,display:o="sidebar",className:i})=>{const[n,c]=l.useState(!1),[r,d]=l.useState(0),[b,h]=l.useState(!1),f=l.useRef(!1),u=l.useRef(null),p=Y(),w=l.useCallback(async()=>{if(b){f.current=!0;return}try{h(!0);let g=R.from("messages").select("id",{count:"exact",head:!0}).eq("status","unread");s==="management"?g=g.eq("department",a):s==="technician"&&(g=g.eq("sender_id",t));const m=R.from("direct_messages").select("id",{count:"exact",head:!0}).eq("recipient_id",t).eq("status","unread"),[j,S]=await Promise.all([g,m]);if(j.error||S.error)return;const z=j.count??0,I=S.count??0,F=z+I;d(F),c(F>0)}catch{}finally{h(!1),f.current&&(f.current=!1,Promise.resolve().then(()=>w()))}},[t,s,a,b]);l.useEffect(()=>{const g=window.setTimeout(()=>{w()},500),m=()=>{u.current&&window.clearTimeout(u.current),u.current=window.setTimeout(()=>{w()},50)};window.addEventListener("messages_invalidated",m),window.addEventListener("direct_messages_invalidated",m);const j=R.channel("realtime-notifications").on("postgres_changes",{event:"*",schema:"public",table:"messages"},()=>{u.current&&window.clearTimeout(u.current),u.current=window.setTimeout(()=>{w()},200)}).on("postgres_changes",{event:"*",schema:"public",table:"direct_messages"},()=>{u.current&&window.clearTimeout(u.current),u.current=window.setTimeout(()=>{w()},200)}).subscribe();return()=>{window.clearTimeout(g),u.current&&(window.clearTimeout(u.current),u.current=null),R.removeChannel(j),window.removeEventListener("messages_invalidated",m),window.removeEventListener("direct_messages_invalidated",m)}},[w]);const y=()=>{s==="management"?p("/dashboard?showMessages=true"):s==="technician"&&p("/technician-dashboard?showMessages=true")};if(cs("messages",n?{count:r}:null),o==="sidebar"&&!n)return null;if(o==="icon"){const g=n?Ge:mt,m=r>9?"9+":r.toString();return e.jsxs(T,{type:"button",variant:"ghost",size:"icon",onClick:y,disabled:b,className:v("relative h-9 w-9 rounded-full border border-border/60 bg-background/70 text-muted-foreground shadow-sm transition-colors hover:bg-accent/30 hover:text-foreground focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",n&&"text-amber-500",i),"aria-label":n?`${r} mensajes nuevos`:"Abrir mensajes",children:[e.jsx(g,{className:"h-5 w-5","aria-hidden":"true"}),n&&e.jsx("span",{className:"pointer-events-none absolute -top-1 -right-1 inline-flex min-h-[1.25rem] min-w-[1.25rem] items-center justify-center rounded-full bg-amber-500 px-1 text-[0.7rem] font-semibold text-white shadow",children:m})]})}return e.jsxs(T,{type:"button",variant:"ghost",className:v("w-full justify-start gap-2 text-yellow-500",i),onClick:y,disabled:b,children:[e.jsx(Ge,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"New Messages"})]})},J="2026-01-09T10:30:18.965Z",he=[{src:"/lovable-uploads/7bd0c1d7-3226-470d-bea4-5cd7222e3248.png",width:972,height:835},{src:"/lovable-uploads/77dcfa7b-e05a-48e3-b662-03242aa8e853.png",width:512,height:512},{src:"/lovable-uploads/642b8d57-4a23-490e-b7c6-fe8de9eafc63.png",width:512,height:512},{src:"/lovable-uploads/5624e847-e131-4bdf-b4a9-2058fe294ead.png",width:512,height:512},{src:"/lovable-uploads/44b5a76b-8a09-4270-b439-9e7976926b18.png",width:512,height:512},{src:"/lovable-uploads/3c5cf97c-840a-48fd-b781-098c27729d90.png",width:512,height:512},{src:"/lovable-uploads/39daae92-fbe9-4d38-ae04-8e929d2b1e6f.png",width:512,height:512},{src:"/lovable-uploads/14f2fcca-4286-46dc-8d87-4aad90d42e27.png",width:512,height:512},{src:"/lovable-uploads/8466df54-7094-4c62-b9b7-0fef374409f4.png",width:512,height:512},{src:"/lovable-uploads/d6d934d3-85f4-4e22-8c5e-bb25acfae3a3.png",width:512,height:512},{src:"/lovable-uploads/f795edb1-b35c-4b89-9d0a-be90d35833ec.png",width:512,height:512},{src:"/lovable-uploads/fb2052e9-73ee-4e18-bc9e-933669280d89.png",width:512,height:512},{src:"/lovable-uploads/044c8ba4-6679-4cee-8382-05a73a7c8d63.png",width:512,height:512},{src:"/lovable-uploads/14ea7bcf-97c7-4625-bc03-d096da7250ca.png",width:512,height:512},{src:"/lovable-uploads/ad11634a-0d49-487b-830f-f78c308989aa.png",width:512,height:512},{src:"/lovable-uploads/b2a0dcfd-7da0-43e8-a27f-25db4c89c8e2.png",width:512,height:512},{src:"/lovable-uploads/be8e98ed-c0bb-49d3-bed1-9cb76f19c3b1.png",width:512,height:512},{src:"/lovable-uploads/c582372d-4e74-45db-833e-29b8f557a4ba.png",width:512,height:512}],ie=t=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth()-1,s.getDate());return t.filter(o=>{const i=o.date.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!i)return!0;const[,n,c,r]=i;return new Date(parseInt(n),parseInt(c)-1,parseInt(r))>=a})},ft=({userRole:t,userEmail:s,autoOpen:a,onAutoOpenHandled:o})=>{const[i,n]=l.useState(!1);l.useEffect(()=>{a&&!i&&(n(!0),o==null||o())},[a,i,o]);const[c,r]=l.useState(he[0]),[d,b]=l.useState([]),[h,f]=l.useState(J),[u,p]=l.useState(null),[w,y]=l.useState(""),[g,m]=l.useState(""),[j,S]=l.useState(""),[z,I]=l.useState(!1),[F,G]=l.useState(!1),{toast:D}=ye(),A=t==="management"||t==="admin"||(s==null?void 0:s.toLowerCase())==="sonido@sector-pro.com";l.useEffect(()=>{const x=new Date,N=d.some(_=>{const C=new Date(_.lastUpdated);return x.getTime()-C.getTime()<1440*60*1e3});G(N)},[d]),l.useEffect(()=>{i&&(async()=>{try{const{data:N,error:_}=await R.from("app_changelog").select("id, version, entry_date, content, last_updated").order("entry_date",{ascending:!1}).order("last_updated",{ascending:!1});if(_)throw _;const C=(N||[]).map(M=>({id:M.id,version:M.version,date:M.entry_date,content:M.content,lastUpdated:M.last_updated}));b(ie(C))}catch{}})()},[i]),l.useEffect(()=>{d.length>0?f(d[0].version):f(J)},[d,J]);const q=()=>{const x=Math.floor(Math.random()*he.length);return he[x]},ee=x=>{n(x),x&&r(q())},de=(x,N,_,C)=>{p(x),y(N),m(_);const M=/\d{4}-\d{2}-\d{2}/.test(C)?C:new Date(C).toISOString().slice(0,10);S(M),I(!1)},te=async()=>{if(u)try{const x=(j||"").trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(x)){D({title:"Invalid date",description:"Use format YYYY-MM-DD",variant:"destructive"});return}const{data:N,error:_}=await R.from("app_changelog").update({content:w,version:g||J,entry_date:x}).eq("id",u).select("id, version, entry_date, content, last_updated").maybeSingle();if(_)throw _;N&&(b(C=>ie(C.map(M=>M.id===u?{id:N.id,version:N.version,date:N.entry_date,content:N.content,lastUpdated:N.last_updated}:M))),z&&R.functions.invoke("push",{body:{action:"broadcast",type:"changelog.updated",version:N.version,content:N.content}})),p(null),y(""),m(""),S(""),I(!1),D({title:z?"Changelog updated & broadcast sent":"Changelog updated"})}catch(x){D({title:"Failed to save",description:(x==null?void 0:x.message)||String(x),variant:"destructive"})}},W=async x=>{if(!(!x||!window.confirm("Delete this changelog entry?")))try{const{error:_}=await R.from("app_changelog").delete().eq("id",x);if(_)throw _;b(C=>ie(C.filter(M=>M.id!==x))),u===x&&(p(null),y(""),m(""),S("")),D({title:"Entry deleted"})}catch(_){D({title:"Failed to delete",description:(_==null?void 0:_.message)||String(_),variant:"destructive"})}},P=async()=>{try{const N=new Date().toISOString().slice(0,10),_=String(J),{data:C,error:M}=await R.from("app_changelog").insert({version:_,entry_date:N,content:""}).select("id, version, entry_date, content, last_updated").maybeSingle();if(M)throw M;if(C){const V={id:C.id,version:C.version,date:C.entry_date,content:C.content,lastUpdated:C.last_updated};b($=>ie([V,...$])),p(V.id),y(""),m(V.version),S(V.date),D({title:"Entry created"})}}catch(x){D({title:"Failed to add entry",description:(x==null?void 0:x.message)||String(x),variant:"destructive"})}},se=()=>{p(null),y(""),I(!1)},ce=x=>new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs(es,{open:i,onOpenChange:ee,children:[e.jsx(ts,{asChild:!0,children:e.jsxs(T,{variant:"ghost",className:"w-full justify-start gap-2 relative",onClick:()=>n(!0),children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{children:"About"}),F&&e.jsx(O,{variant:"secondary",className:"ml-auto h-5 w-5 p-0 flex items-center justify-center",children:e.jsx(dt,{className:"h-3 w-3"})})]})}),e.jsx(ss,{className:"w-96",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("img",{src:c.src,alt:"About Image",width:c.width,height:c.height,loading:"lazy",decoding:"async",className:"rounded-lg w-full h-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-center text-muted-foreground",children:"Created by JVH"}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["v",h]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Changelog"}),A&&e.jsxs(T,{variant:"outline",size:"sm",className:"h-6 px-2 ml-auto",onClick:P,children:[e.jsx(ns,{className:"h-3 w-3 mr-1"})," Add"]}),F&&e.jsx(O,{variant:"outline",className:"text-xs",children:"Updated"})]}),e.jsx("div",{className:"space-y-3",children:d.map(x=>e.jsxs("div",{className:"border-l-2 border-muted pl-3 pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-medium",children:["v",x.version]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:ce(x.date)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[A&&u!==x.id&&e.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>de(x.id,x.content,x.version,x.date),children:e.jsx(ks,{className:"h-3 w-3"})}),t==="admin"&&u!==x.id&&e.jsx(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-600",onClick:()=>W(x.id),title:"Delete entry",children:e.jsx(Be,{className:"h-3 w-3"})})]})]}),u===x.id?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-muted-foreground mb-1",children:"Version"}),e.jsx("input",{value:g,onChange:N=>m(N.target.value),className:"w-full text-xs p-2 border rounded",placeholder:"e.g., 1.2.3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-muted-foreground mb-1",children:"Date"}),e.jsx("input",{type:"date",value:j,onChange:N=>S(N.target.value),className:"w-full text-xs p-2 border rounded"})]})]}),e.jsx("textarea",{value:w,onChange:N=>y(N.target.value),className:"w-full text-xs p-2 border rounded resize-none",rows:3,placeholder:"Enter changelog content..."}),e.jsxs("div",{className:"flex items-center gap-2 py-1 border-t border-dashed",children:[e.jsx(as,{id:`broadcast-${x.id}`,checked:z,onCheckedChange:N=>I(N===!0)}),e.jsxs("label",{htmlFor:`broadcast-${x.id}`,className:"text-[10px] text-muted-foreground cursor-pointer flex items-center gap-1",children:[e.jsx(mt,{className:"h-3 w-3"}),"Broadcast push notification"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(T,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:te,children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),"Save"]}),e.jsxs(T,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:se,children:[e.jsx(Mt,{className:"h-3 w-3 mr-1"}),"Cancel"]}),t==="admin"&&e.jsxs(T,{variant:"destructive",size:"sm",className:"h-6 px-2 ml-auto",onClick:()=>W(x.id),children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]}):e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:x.content})]},x.id))})]})]})})]})},Cs=({trayItems:t,renderTrigger:s,onSignOut:a,isLoggingOut:o,notificationProps:i,userRole:n,userEmail:c})=>{const[r,d]=l.useState(!1),{pathname:b}=X(),h=()=>{d(!1)},f=async()=>{await a(),d(!1)};return e.jsxs(rt,{open:r,onOpenChange:d,children:[e.jsx(Bt,{asChild:!0,children:s(r)}),e.jsxs(ot,{side:"bottom",className:"flex h-[75vh] flex-col overflow-hidden rounded-t-3xl border-none bg-background px-0 pb-0 shadow-2xl [&>[data-radix-dialog-close]]:hidden",children:[e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx("span",{className:"mb-2 h-1.5 w-16 rounded-full bg-muted","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4",children:e.jsxs("div",{className:"space-y-4 pb-[max(1.5rem,env(safe-area-inset-bottom))]",children:[e.jsx(we,{className:"w-full"}),i&&e.jsx(ht,{...i,display:"sidebar",className:"w-full justify-start"}),e.jsx("div",{className:"rounded-2xl border border-border/60 bg-muted/40 p-1",children:e.jsx(ft,{userRole:n,userEmail:c})}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"bg-border/60"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.map(u=>{const p=u.icon,w=u.isActive(b);return e.jsx(T,{variant:"ghost",className:v("h-full justify-center gap-2 rounded-2xl border border-border/60 bg-muted/40 px-3 py-3 text-xs font-semibold text-muted-foreground transition-colors hover:border-border hover:bg-muted/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",w&&"border-primary/60 bg-primary/10 text-primary"),"data-active":w,asChild:!0,children:e.jsxs(Ne,{to:u.to,onClick:h,"aria-label":u.label,"aria-current":w?"page":void 0,className:"flex h-full flex-col items-center justify-center gap-2",children:[e.jsx(p,{className:"h-5 w-5","aria-hidden":"true"}),e.jsx("span",{className:"text-center leading-tight",children:u.mobileLabel}),u.badge&&e.jsx(O,{variant:"secondary",className:"rounded-full px-2 py-0 text-[10px] font-semibold",children:u.badge})]})},u.id)})})]}),e.jsx(pe,{className:"bg-border/60"}),e.jsxs(T,{type:"button",variant:"ghost",className:"w-full justify-center gap-2 py-4 text-base font-semibold",onClick:f,disabled:o,children:[e.jsx(bt,{className:"h-5 w-5"}),e.jsx("span",{children:o?"Cerrando sesión...":"Cerrar sesión"})]})]})})]})]})},_s=({primaryItems:t,trayItems:s,onSignOut:a,isLoggingOut:o,notificationProps:i,userRole:n,userEmail:c})=>{const{pathname:r}=X();if(!(t.length>0||s.length>0))return null;const b=s.some(h=>h.isActive(r));return e.jsx("nav",{role:"navigation","aria-label":"Navegación principal",className:"fixed inset-x-0 bottom-0 z-40 bg-[#05070a]/95 backdrop-blur-xl border-t border-[#1f232e] px-2 pb-[max(0.75rem,env(safe-area-inset-bottom))] pt-2 shadow-[0_-12px_32px_rgba(0,0,0,0.5)] md:hidden",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-3xl items-stretch justify-evenly gap-1",children:[t.map(h=>{const f=h.icon,u=h.isActive(r);return e.jsxs(Ne,{to:h.to,"aria-label":h.label,"aria-current":u?"page":void 0,className:v("flex min-w-0 flex-1 flex-col items-center justify-center gap-1 rounded-2xl px-3 py-2 text-[11px] font-semibold tracking-tight transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-[#05070a]",u?"bg-blue-600/20 text-blue-400":"text-[#94a3b8] hover:text-white hover:bg-[#151820]"),children:[e.jsx(f,{className:v("h-5 w-5",u&&"text-blue-400"),"aria-hidden":"true"}),e.jsx("span",{className:"max-w-[5rem] truncate",children:h.mobileLabel})]},h.id)}),e.jsx(Cs,{trayItems:s,onSignOut:a,isLoggingOut:o,notificationProps:i,userRole:n,userEmail:c,renderTrigger:h=>e.jsxs("button",{type:"button","aria-label":"Más opciones",className:v("flex min-w-0 flex-1 flex-col items-center justify-center gap-1 rounded-2xl px-3 py-2 text-[11px] font-semibold text-[#94a3b8] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-[#05070a] hover:text-white hover:bg-[#151820]",(h||b)&&"bg-blue-600/20 text-blue-400"),children:[e.jsx(ws,{className:"h-5 w-5","aria-hidden":"true"}),e.jsx("span",{className:"max-w-[5rem] truncate",children:"Más"})]})})]})})},Ms=()=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-24"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-20"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-16"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-18"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(E,{className:"h-4 w-20"})]})]}),ne={sound:"Sonido",lights:"Luces",video:"Vídeo"},fe={sound:je,lights:xe,video:ve},Ls=[{id:"management-dashboard",label:"Panel principal",mobileLabel:"Panel",icon:$e,mobilePriority:1,mobileSlot:"primary",getPath:()=>"/dashboard",isVisible:({userRole:t})=>t==="management"},{id:"technician-dashboard",label:"Panel técnico",mobileLabel:"Panel",icon:$e,mobilePriority:1,mobileSlot:"primary",getPath:()=>"/technician-dashboard",isVisible:({userRole:t,assignableAsTech:s})=>t==="technician"||t==="house_tech"||t==="admin"&&s===!0||t==="management"&&s===!0},{id:"technician-jobs",label:"Trabajos",mobileLabel:"Trabajos",icon:He,mobilePriority:2,mobileSlot:"primary",getPath:()=>"/technician-dashboard?tab=jobs",isVisible:({userRole:t})=>t==="house_tech",match:(t,s,a)=>t==="/technician-dashboard"&&a.includes("tab=jobs")&&window.location.search.includes("tab=jobs")},{id:"technician-availability",label:"Disponibilidad",mobileLabel:"Disponib.",icon:We,mobilePriority:3,mobileSlot:"primary",getPath:()=>"/technician-dashboard?tab=availability",isVisible:({userRole:t})=>t==="house_tech",match:(t,s,a)=>t==="/technician-dashboard"&&a.includes("tab=availability")&&window.location.search.includes("tab=availability")},{id:"technician-profile",label:"Perfil",mobileLabel:"Perfil",icon:Ke,mobilePriority:5,mobileSlot:"primary",getPath:()=>"/technician-dashboard?tab=profile",isVisible:({userRole:t})=>t==="house_tech",match:(t,s,a)=>t==="/technician-dashboard"&&a.includes("tab=profile")&&window.location.search.includes("tab=profile")},{id:"personal",label:"Agenda personal",mobileLabel:"Agenda",icon:Me,mobilePriority:2,mobileSlot:"secondary",getPath:()=>"/personal",isVisible:({userRole:t})=>t!=="technician"},{id:"job-assignment-matrix",label:"Matriz de asignaciones",mobileLabel:"Matriz",icon:us,mobilePriority:11,mobileSlot:"secondary",getPath:()=>"/job-assignment-matrix",isVisible:({userRole:t})=>t==="management"},{id:"management-rates",label:"Tarifas y extras",mobileLabel:"Tarifas",icon:ms,mobilePriority:10,mobileSlot:"secondary",getPath:()=>"/management/rates",isVisible:({userRole:t})=>t==="management"},{id:"expenses",label:"Gastos",mobileLabel:"Gastos",icon:bs,mobilePriority:9,mobileSlot:"secondary",getPath:()=>"/gastos",isVisible:({userRole:t})=>t==="admin"||t==="management"||t==="logistics"},{id:"management-department",label:({userDepartment:t})=>{const s=(t==null?void 0:t.toLowerCase())??"";return ne[s]||t||null},mobileLabel:({userDepartment:t})=>{const s=(t==null?void 0:t.toLowerCase())??"";return ne[s]||"Departamento"},icon:(({userDepartment:t})=>{const s=(t==null?void 0:t.toLowerCase())??"";return fe[s]??null}),mobilePriority:6,mobileSlot:"secondary",getPath:({userDepartment:t})=>{const s=(t==null?void 0:t.toLowerCase())??"";return fe[s]?`/${s}`:null},isVisible:({userRole:t,userDepartment:s})=>{if(t!=="management"||!s)return!1;const a=s.toLowerCase();return!!fe[a]}},{id:"admin-lights",label:"Luces",mobileLabel:"Luces",icon:xe,mobilePriority:6,mobileSlot:"secondary",getPath:()=>"/lights",isVisible:({userRole:t})=>t==="admin"},{id:"admin-video",label:"Vídeo",mobileLabel:"Vídeo",icon:ve,mobilePriority:6,mobileSlot:"secondary",getPath:()=>"/video",isVisible:({userRole:t})=>t==="admin"},{id:"admin-sound",label:"Sonido",mobileLabel:"Sonido",icon:je,mobilePriority:6,mobileSlot:"secondary",getPath:()=>"/sound",isVisible:({userRole:t})=>t==="admin"},{id:"house-department",label:({userDepartment:t})=>ne[(t==null?void 0:t.toLowerCase())??""]||t||null,mobileLabel:({userDepartment:t})=>ne[(t==null?void 0:t.toLowerCase())??""]||"Departamento",icon:(({userDepartment:t})=>{const s=t==null?void 0:t.toLowerCase();return s==="sound"?je:s==="lights"?xe:s==="video"?ve:null}),mobilePriority:2,mobileSlot:"primary",getPath:({userDepartment:t})=>t?`/${t.toLowerCase()}`:null,isVisible:({userRole:t,userDepartment:s})=>t==="house_tech"&&!!s},{id:"tours",label:"Giras",mobileLabel:"Giras",icon:Lt,mobilePriority:4,mobileSlot:"primary",getPath:()=>"/tours",isVisible:({userRole:t})=>t==="management"||t==="house_tech"},{id:"festivals",label:"Festivales",mobileLabel:"Festivales",icon:hs,mobilePriority:6,mobileSlot:"secondary",getPath:()=>"/festivals",isVisible:({userDepartment:t})=>(t==null?void 0:t.toLowerCase())==="sound"},{id:"disponibilidad",label:"Disponibilidad",mobileLabel:"Disponibilidad",icon:We,mobilePriority:7,mobileSlot:"secondary",getPath:()=>"/disponibilidad",isVisible:({userRole:t,userDepartment:s})=>{if(t==="admin")return!0;if(t!=="management")return!1;const a=s==null?void 0:s.toLowerCase();return a==="sound"||a==="lights"}},{id:"project-management",label:"Gestión de proyectos",mobileLabel:"Proyectos",icon:He,mobilePriority:8,mobileSlot:"secondary",getPath:()=>"/project-management",isVisible:({userRole:t})=>t==="admin"||t==="management"||t==="logistics"},{id:"logistics",label:"Logística",mobileLabel:"Logística",icon:fs,mobilePriority:3,mobileSlot:"primary",getPath:()=>"/logistics",isVisible:({userRole:t})=>t==="admin"||t==="management"||t==="logistics"||t==="house_tech"},{id:"profile",label:"Perfil",mobileLabel:"Perfil",icon:Ke,mobilePriority:5,mobileSlot:"primary",getPath:()=>"/profile",isVisible:({userRole:t})=>!!t&&t!=="house_tech"},{id:"wallboard-presets",label:"Wallboard",mobileLabel:"Wallboard",icon:Ts,mobilePriority:12,mobileSlot:"secondary",getPath:()=>"/management/wallboard-presets",isVisible:({userRole:t})=>t==="admin"},{id:"announcements",label:"Anuncios",mobileLabel:"Anuncios",icon:Ns,mobilePriority:12,mobileSlot:"secondary",getPath:()=>"/announcements",isVisible:({userRole:t})=>t==="admin"},{id:"incident-reports",label:"Partes de incidencias",mobileLabel:"Incidencias",icon:gs,mobilePriority:13,mobileSlot:"secondary",getPath:()=>"/incident-reports",isVisible:({userRole:t})=>t==="admin"||t==="management"},{id:"activity",label:"Actividad",mobileLabel:"Actividad",icon:ps,mobilePriority:14,mobileSlot:"secondary",getPath:()=>"/activity",isVisible:({userRole:t})=>t==="admin"},{id:"feedback",label:"Comentarios y soporte",mobileLabel:"Soporte",icon:xs,mobilePriority:16,mobileSlot:"secondary",getPath:()=>"/feedback",isVisible:({userRole:t})=>t!=="technician"},{id:"settings",label:"Ajustes",mobileLabel:"Ajustes",icon:vs,mobilePriority:15,mobileSlot:"secondary",getPath:()=>"/settings",isVisible:({userRole:t})=>t==="admin"||t==="management"}],Je=(t,s)=>typeof t=="function"?t(s):t,Ps=(t,s)=>typeof t=="function"?t(s):t,As=new Set(["technician-dashboard","technician-jobs","technician-availability","technician-profile","technician-unavailability","management-department","house-department"]),gt=(t,s=Ls)=>{if(!t.userRole)return[];const a=t.userRole==="admin",o=i=>{const n=i.getPath(t);if(!n)return null;const c=Je(i.label,t),r=Ps(i.icon,t);if(!c||!r)return null;const d=Je(i.mobileLabel??i.label,t)??c,b=i.mobileSlot??"secondary",h=i.match?f=>{var u;return((u=i.match)==null?void 0:u.call(i,f,t,n))??!1}:f=>f===n;return{id:i.id,label:c,mobileLabel:d,to:n,icon:r,mobilePriority:i.mobilePriority,mobileSlot:b,isActive:h}};return a?s.map(i=>i.id==="technician-dashboard"&&t.assignableAsTech?o(i):As.has(i.id)?null:o(i)).filter(Boolean):s.map(i=>i.isVisible(t)?o(i):null).filter(Boolean)},Es=({userRole:t,userDepartment:s,hasSoundVisionAccess:a,onNavigate:o})=>{const i=X();if(!t)return e.jsx(Ms,{});const n=l.useMemo(()=>gt({userRole:t,userDepartment:s,hasSoundVisionAccess:a}),[t,s,a]);return n.length?e.jsx("div",{className:"space-y-2",children:e.jsx("nav",{className:"flex flex-col gap-1",children:n.map(c=>{const r=c.icon,d=c.isActive(i.pathname);return e.jsx(Ne,{to:c.to,onClick:o,"aria-current":d?"page":void 0,className:"block",children:e.jsxs(T,{type:"button",variant:"ghost",className:v("w-full justify-start gap-3 rounded-lg px-3 py-2 text-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-sidebar",d?"bg-accent text-accent-foreground":"text-sidebar-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground"),"data-active":d,children:[e.jsx(r,{className:"h-4 w-4 shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:c.label})]})},c.id)})})}):null},Is="sidebar:state",Rs=3600*24*7,Os="16rem",zs="18rem",Ds="3rem",Vs="b",pt=l.createContext(null);function le(){const t=l.useContext(pt);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}const xt=l.forwardRef(({defaultOpen:t=!0,open:s,onOpenChange:a,className:o,style:i,children:n,...c},r)=>{const d=Xe(),[b,h]=l.useState(!1),[f,u]=l.useState(t),p=s??f,w=l.useCallback(j=>{const S=typeof j=="function"?j(p):j;a?a(S):u(S),document.cookie=`${Is}=${S}; path=/; max-age=${Rs}`},[a,p]),y=l.useCallback(()=>d?h(j=>!j):w(j=>!j),[d,w,h]);l.useEffect(()=>{const j=S=>{S.key===Vs&&(S.metaKey||S.ctrlKey)&&(S.preventDefault(),y())};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[y]);const g=p?"expanded":"collapsed",m=l.useMemo(()=>({state:g,open:p,setOpen:w,isMobile:d,openMobile:b,setOpenMobile:h,toggleSidebar:y}),[g,p,w,d,b,h,y]);return e.jsx(pt.Provider,{value:m,children:e.jsx(Se,{delayDuration:0,children:e.jsx("div",{style:{"--sidebar-width":Os,"--sidebar-width-icon":Ds,...i},className:v("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",o),ref:r,...c,children:n})})})});xt.displayName="SidebarProvider";const vt=l.forwardRef(({side:t="left",variant:s="sidebar",collapsible:a="offcanvas",className:o,children:i,...n},c)=>{const{isMobile:r,state:d,openMobile:b,setOpenMobile:h}=le();return a==="none"?e.jsx("div",{className:v("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",o),ref:c,...n,children:i}):r?e.jsx(rt,{open:b,onOpenChange:h,...n,children:e.jsx(ot,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":zs},side:t,children:e.jsx("div",{className:"flex h-full w-full flex-col pt-[max(0.5rem,env(safe-area-inset-top))] pb-[max(0.5rem,env(safe-area-inset-bottom))]",children:i})})}):e.jsxs("div",{ref:c,className:"group peer hidden md:block text-sidebar-foreground","data-state":d,"data-collapsible":d==="collapsed"?a:"","data-variant":s,"data-side":t,children:[e.jsx("div",{className:v("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),e.jsx("div",{className:v("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",o),...n,children:e.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:i})})]})});vt.displayName="Sidebar";const jt=l.forwardRef(({className:t,onClick:s,...a},o)=>{const{toggleSidebar:i}=le();return e.jsxs(T,{ref:o,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:v("h-7 w-7",t),onClick:n=>{s==null||s(n),i()},...a,children:[e.jsx(Ss,{}),e.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});jt.displayName="SidebarTrigger";const Bs=l.forwardRef(({className:t,...s},a)=>{const{toggleSidebar:o}=le();return e.jsx("button",{ref:a,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:o,title:"Toggle Sidebar",className:v("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...s})});Bs.displayName="SidebarRail";const qs=l.forwardRef(({className:t,...s},a)=>e.jsx("main",{ref:a,className:v("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...s}));qs.displayName="SidebarInset";const Fs=l.forwardRef(({className:t,...s},a)=>e.jsx(Pt,{ref:a,"data-sidebar":"input",className:v("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...s}));Fs.displayName="SidebarInput";const Us=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"header",className:v("flex flex-col gap-2 p-2","pt-[max(0.5rem,env(safe-area-inset-top))]",t),...s}));Us.displayName="SidebarHeader";const wt=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"footer",className:v("flex flex-col gap-2 p-2","pb-[max(0.5rem,env(safe-area-inset-bottom))]",t),...s}));wt.displayName="SidebarFooter";const yt=l.forwardRef(({className:t,...s},a)=>e.jsx(pe,{ref:a,"data-sidebar":"separator",className:v("mx-2 w-auto bg-sidebar-border",t),...s}));yt.displayName="SidebarSeparator";const Nt=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"content",className:v("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden","pt-[max(0.5rem,env(safe-area-inset-top))] pb-[max(0.5rem,env(safe-area-inset-bottom))]",t),...s}));Nt.displayName="SidebarContent";const St=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"group",className:v("relative flex w-full min-w-0 flex-col p-2",t),...s}));St.displayName="SidebarGroup";const $s=l.forwardRef(({className:t,asChild:s=!1,...a},o)=>{const i=s?Z:"div";return e.jsx(i,{ref:o,"data-sidebar":"group-label",className:v("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...a})});$s.displayName="SidebarGroupLabel";const Hs=l.forwardRef(({className:t,asChild:s=!1,...a},o)=>{const i=s?Z:"button";return e.jsx(i,{ref:o,"data-sidebar":"group-action",className:v("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...a})});Hs.displayName="SidebarGroupAction";const kt=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"group-content",className:v("w-full text-sm",t),...s}));kt.displayName="SidebarGroupContent";const Ks=l.forwardRef(({className:t,...s},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu",className:v("flex w-full min-w-0 flex-col gap-1",t),...s}));Ks.displayName="SidebarMenu";const Gs=l.forwardRef(({className:t,...s},a)=>e.jsx("li",{ref:a,"data-sidebar":"menu-item",className:v("group/menu-item relative",t),...s}));Gs.displayName="SidebarMenuItem";const Ws=At("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),Js=l.forwardRef(({asChild:t=!1,isActive:s=!1,variant:a="default",size:o="default",tooltip:i,className:n,...c},r)=>{const d=t?Z:"button",{isMobile:b,state:h}=le(),f=e.jsx(d,{ref:r,"data-sidebar":"menu-button","data-size":o,"data-active":s,className:v(Ws({variant:a,size:o}),n),...c});return i?(typeof i=="string"&&(i={children:i}),e.jsxs(ke,{children:[e.jsx(Te,{asChild:!0,children:f}),e.jsx(Ce,{side:"right",align:"center",hidden:h!=="collapsed"||b,...i})]})):f});Js.displayName="SidebarMenuButton";const Qs=l.forwardRef(({className:t,asChild:s=!1,showOnHover:a=!1,...o},i)=>{const n=s?Z:"button";return e.jsx(n,{ref:i,"data-sidebar":"menu-action",className:v("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",a&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...o})});Qs.displayName="SidebarMenuAction";const Ys=l.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,"data-sidebar":"menu-badge",className:v("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...s}));Ys.displayName="SidebarMenuBadge";const Xs=l.forwardRef(({className:t,showIcon:s=!1,...a},o)=>{const i=l.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return e.jsxs("div",{ref:o,"data-sidebar":"menu-skeleton",className:v("rounded-md h-8 flex gap-2 px-2 items-center",t),...a,children:[s&&e.jsx(E,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),e.jsx(E,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":i}})]})});Xs.displayName="SidebarMenuSkeleton";const Zs=l.forwardRef(({className:t,...s},a)=>e.jsx("ul",{ref:a,"data-sidebar":"menu-sub",className:v("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...s}));Zs.displayName="SidebarMenuSub";const ea=l.forwardRef(({...t},s)=>e.jsx("li",{ref:s,...t}));ea.displayName="SidebarMenuSubItem";const ta=l.forwardRef(({asChild:t=!1,size:s="md",isActive:a,className:o,...i},n)=>{const c=t?Z:"a";return e.jsx(c,{ref:n,"data-sidebar":"menu-sub-button","data-size":s,"data-active":a,className:v("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",s==="sm"&&"text-xs",s==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",o),...i})});ta.displayName="SidebarMenuSubButton";function sa({className:t}){const{refreshSubscriptions:s}=Ze(),{connectionStatus:a,lastRefreshTime:o,isFullySubscribed:i,isStale:n,requiredTables:c,subscribedTables:r,unsubscribedTables:d,routeKey:b}=lt(),[h,f]=l.useState(!1);let u="Unknown";try{u=_e(o)+" ago"}catch{}const p=async()=>{f(!0);try{s(),qe.success("Real-time connections refreshed")}catch{qe.error("Failed to refresh connections")}finally{f(!1)}},w=()=>a==="connecting"?e.jsx(ge,{className:"h-3 w-3 text-blue-500 animate-spin"}):a!=="connected"?e.jsx(Ft,{className:"h-3 w-3 text-red-500"}):n?e.jsx(dt,{className:"h-3 w-3 text-amber-500"}):i?e.jsx(Ut,{className:"h-3 w-3 text-green-500"}):e.jsx(re,{className:"h-3 w-3 text-amber-500"}),y=()=>a==="connecting"?"Connecting...":a!=="connected"?"Offline":n?"Stale data":i?"Live":"Partial",g=j=>(j.startsWith("/")?j.substring(1):j).split("-").map(z=>z.charAt(0).toUpperCase()+z.slice(1)).join(" "),m=()=>{if(a==="connecting")return e.jsxs("div",{className:"text-xs max-w-xs",children:[e.jsx("p",{className:"font-semibold",children:"Establishing connection"}),e.jsx("p",{children:"Setting up real-time connection..."})]});if(a!=="connected")return e.jsxs("div",{className:"text-xs max-w-xs",children:[e.jsx("p",{className:"font-semibold",children:"Connection lost"}),e.jsx("p",{children:"Attempting to reconnect..."}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last data refresh: ",u]})]});if(n)return e.jsxs("div",{className:"text-xs max-w-xs",children:[e.jsx("p",{className:"font-semibold",children:"Data may be stale"}),e.jsxs("p",{children:["Last updated: ",u]}),e.jsx("p",{children:"Click to refresh data"})]});const j=g(b),S=Object.keys(qt).includes(b);return i?e.jsxs("div",{className:"text-xs max-w-xs",children:[e.jsx("p",{className:"font-semibold",children:"Real-time updates active"}),e.jsxs("p",{children:["Current page: ",j]}),c.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"All required tables are subscribed:"}),e.jsx("p",{className:"mt-1",children:c.join(", ")})]}):e.jsx("p",{children:"No specific tables required for this route"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last updated: ",u]})]}):e.jsxs("div",{className:"text-xs max-w-xs",children:[e.jsx("p",{className:"font-semibold",children:"Partial real-time updates"}),e.jsxs("p",{className:"mt-1",children:["Current page: ",j]}),e.jsxs("div",{className:"mt-1",children:[r.length>0&&e.jsxs("p",{children:["Subscribed: ",r.join(", ")]}),d.length>0&&e.jsxs("p",{children:["Missing: ",d.join(", ")]}),!S&&e.jsx("p",{className:"text-amber-500 mt-1",children:"This route has no specific subscriptions defined"})]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last updated: ",u]})]})};return e.jsx(Se,{children:e.jsxs(ke,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs("div",{className:v("flex items-center gap-1.5 text-xs cursor-pointer",n||!i?"text-amber-500":a==="connected"?"text-muted-foreground":"text-red-500",t),onClick:n?p:void 0,children:[w(),e.jsx("span",{className:"hidden sm:inline",children:y()}),e.jsxs(T,{variant:"ghost",size:"icon",className:"h-5 w-5 ml-0.5 hidden sm:flex",onClick:j=>{j.stopPropagation(),p()},disabled:h||a==="connecting",children:[e.jsx(Et,{className:`h-2.5 w-2.5 ${h?"animate-spin":""}`}),e.jsx("span",{className:"sr-only",children:"Refresh"})]})]})}),e.jsx(Ce,{children:m()})]})})}const aa={info:"info",success:"success",warn:"warning",error:"destructive"};function ia(t,s){const a=t.payload??{};switch(t.code){case"job.created":return{title:(s==null?void 0:s.label)??"Job created",description:String(a.title??"")||void 0};case"job.updated":return{title:(s==null?void 0:s.label)??"Job updated",description:a.diff?Object.keys(a.diff).join(", "):void 0};case"document.uploaded":return{title:(s==null?void 0:s.label)??"Document uploaded",description:String(a.file_name??"")||void 0};case"document.deleted":return{title:(s==null?void 0:s.label)??"Document deleted",description:String(a.file_name??"")||void 0};case"flex.folders.created":return{title:(s==null?void 0:s.label)??"Flex folders created",description:String(a.folder??"")||void 0};case"flex.crew.updated":return{title:(s==null?void 0:s.label)??"Flex crew updated",description:void 0};case"assignment.created":return{title:(s==null?void 0:s.label)??"Assignment created"};case"assignment.updated":return{title:(s==null?void 0:s.label)??"Assignment updated"};case"assignment.removed":return{title:(s==null?void 0:s.label)??"Assignment removed"};case"staffing.offer.confirmed":return{title:(s==null?void 0:s.label)??"Offer accepted"};case"staffing.offer.declined":return{title:(s==null?void 0:s.label)??"Offer declined"};case"staffing.availability.confirmed":return{title:(s==null?void 0:s.label)??"Availability confirmed"};case"staffing.availability.declined":return{title:(s==null?void 0:s.label)??"Availability declined"};case"timesheet.submitted":return{title:(s==null?void 0:s.label)??"Timesheet submitted"};case"timesheet.approved":return{title:(s==null?void 0:s.label)??"Timesheet approved"};case"timesheet.rejected":return{title:(s==null?void 0:s.label)??"Timesheet rejected"};case"hoja.updated":return{title:(s==null?void 0:s.label)??"Hoja de ruta updated"};case"announcement.posted":return{title:(s==null?void 0:s.label)??"Announcement posted",description:String(a.title??a.message??"")||void 0};default:return s?{title:s.label}:{title:t.code.replace(/\./g," ")}}}async function na(t,s){return t.current||(t.current=await s()),t.current}function ra(t={}){const{jobId:s,userId:a,autoToasts:o=!0}=t,{toast:i}=ye(),n=oe(),c=l.useRef(new Set),r=l.useRef(null),d=l.useCallback(async()=>{if(!a)return null;const b=await Ht(a);return r.current=b,b},[a]);l.useEffect(()=>{if(!a)return;let b=!1;d().catch(u=>{});const h=s?{event:"INSERT",schema:"public",table:"activity_log",filter:`job_id=eq.${s}`}:{event:"INSERT",schema:"public",table:"activity_log"},f=Fe.channel(`activity${s?`-${s}`:""}`).on("postgres_changes",h,async u=>{if(b)return;const p=u.new;if(!p||!p.id||c.current.has(p.id)||(c.current.add(p.id),n.invalidateQueries({queryKey:["activity",s??"all"]}),!o))return;const w=Kt(p.code);if(w&&w.toast_enabled===!1)return;const y=await na(r,d);if(y!=null&&y.mute_toasts||y!=null&&y.muted_codes&&y.muted_codes.includes(p.code))return;const g=ia(p,w);if(!g)return;const m=aa[(w==null?void 0:w.severity)??"info"];i({title:g.title,description:g.description,variant:m})}).subscribe();return()=>{b=!0,Fe.removeChannel(f)}},[o,d,s,n,i,a])}const oa=["sound_job_tasks","lights_job_tasks","video_job_tasks"];function Le(t,s){const a=!!s&&["management","admin","logistics"].includes(s),o=oe();return l.useEffect(()=>{if(!t||!a)return;const i=R.channel(`pending-tasks-${t}-${Math.random().toString(36).slice(2,10)}`),n=()=>{o.invalidateQueries({queryKey:["pending-tasks",t]})};return oa.forEach(c=>{i.on("postgres_changes",{event:"*",schema:"public",table:c,filter:`assigned_to=eq.${t}`},n),i.on("postgres_changes",{event:"UPDATE",schema:"public",table:c},r=>{var h,f;const d=((h=r.old)==null?void 0:h.assigned_to)??null,b=((f=r.new)==null?void 0:f.assigned_to)??null;d===t&&b!==t&&n()})}),i.subscribe(),()=>{R.removeChannel(i)}},[t,a,o]),Gt({queryKey:["pending-tasks",t],enabled:!!t&&a,queryFn:async()=>{const{data:i,error:n}=await R.from("pending_tasks_view").select("*").eq("assigned_to",t).order("due_at",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!0});if(n)throw n;const c=new Map;return(i||[]).forEach(r=>{const d=!!r.job_id,b=d?`job-${r.job_id}`:`tour-${r.tour_id}`,h=d?r.job_name||"Unknown Job":r.tour_name||"Unknown Tour",f=d?`/festival-management/${r.job_id}`:`/tour-management/${r.tour_id}`;c.has(b)||c.set(b,{id:b,type:d?"job":"tour",name:h,client:r.client||void 0,tasks:[]}),c.get(b).tasks.push({id:r.id,department:r.department,taskType:r.task_type||"Task",status:r.status,progress:r.progress||0,dueDate:r.due_at,priority:r.priority,detailLink:f,jobId:r.job_id,tourId:r.tour_id,assignedTo:r.assigned_to,assigneeRole:r.assignee_role})}),Array.from(c.values())},refetchOnWindowFocus:!0,staleTime:3e4})}function la(t,s){const{data:a,isLoading:o,error:i}=Le(t,s);return{data:l.useMemo(()=>{if(!a)return[];const c=[];return a.forEach(r=>{r.tasks.forEach(d=>{c.push({...d,jobOrTourName:r.name,jobOrTourType:r.type,client:r.client})})}),c},[a]),isLoading:o,error:i}}const Q="acknowledged_pending_tasks";function da(t){const[s,a]=l.useState(new Set);l.useEffect(()=>{if(t)try{const c=localStorage.getItem(Q);if(c){const d=JSON.parse(c)[t]||[];a(new Set(d))}}catch{}},[t]);const o=l.useCallback(c=>{t&&a(r=>{const d=new Set(r);d.add(c);try{const b=localStorage.getItem(Q),h=b?JSON.parse(b):{};h[t]=Array.from(d),localStorage.setItem(Q,JSON.stringify(h))}catch{}return d})},[t]),i=l.useCallback(c=>{t&&a(r=>{const d=new Set(r);c.forEach(b=>d.delete(b));try{const b=localStorage.getItem(Q),h=b?JSON.parse(b):{};h[t]=Array.from(d),localStorage.setItem(Q,JSON.stringify(h))}catch{}return d})},[t]),n=l.useCallback(c=>s.has(c),[s]);return{acknowledgedTaskIds:s,acknowledgeTask:o,clearAcknowledgedTasks:i,isTaskAcknowledged:n}}function ca(){const t=oe(),{toast:s}=ye();return Yt({mutationFn:async({taskId:a,department:o,userId:i})=>{const n=await Xt({taskId:a,department:o,actorId:i,source:"manual"});if(!n.success)throw new Error(n.error||"Failed to complete task");return{success:!0}},onSuccess:(a,o)=>{s({title:"Task completed",description:"The task has been marked as complete."}),t.invalidateQueries({queryKey:["pending-tasks"]})},onError:a=>{s({title:"Failed to complete task",description:a.message||"An error occurred while completing the task.",variant:"destructive"})}})}const ua={sound:"bg-blue-500/10 text-blue-700 border-blue-500/20 dark:text-blue-400",lights:"bg-amber-500/10 text-amber-700 border-amber-500/20 dark:text-amber-400",video:"bg-purple-500/10 text-purple-700 border-purple-500/20 dark:text-purple-400"},ma={not_started:"Not Started",in_progress:"In Progress"},ba={not_started:"bg-slate-500/10 text-slate-700 border-slate-500/20 dark:text-slate-400",in_progress:"bg-orange-500/10 text-orange-700 border-orange-500/20 dark:text-orange-400"},ha=({open:t,onOpenChange:s,userId:a,userRole:o})=>{const i=Y(),{data:n,isLoading:c,error:r}=Le(a,o),{mutate:d,isPending:b}=ca(),[h,f]=It.useState(null),u=g=>{i(g),s(!1)},p=(g,m)=>{a&&(f(g),d({taskId:g,department:m,userId:a},{onSettled:()=>{f(null)}}))},w=o&&["management","admin","logistics"].includes(o),y=(n==null?void 0:n.reduce((g,m)=>g+m.tasks.length,0))||0;return e.jsx(et,{open:t,onOpenChange:s,children:e.jsxs(tt,{className:"max-w-5xl w-[96vw] max-h-[90vh] overflow-hidden",children:[e.jsxs(st,{children:[e.jsxs(at,{className:"flex items-center gap-2",children:["Pending Tasks",y>0&&e.jsxs(O,{variant:"secondary",className:"ml-2",children:[y," ",y===1?"task":"tasks"]})]}),e.jsx(it,{children:"Tasks assigned to you that are not yet completed"})]}),e.jsxs("div",{className:"mt-2 overflow-y-auto",children:[c&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"h-8 w-8 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading pending tasks..."})]}),r&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-destructive/50 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:"Failed to load pending tasks. Please try again later."})]}),!c&&!r&&(!n||n.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"rounded-full bg-muted p-3 mb-4",children:e.jsx(re,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"text-lg font-medium",children:"No pending tasks"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"You're all caught up! No incomplete tasks assigned to you."})]}),!c&&!r&&n&&n.length>0&&e.jsx("div",{className:"space-y-6",children:n.map(g=>e.jsxs("div",{className:"rounded-lg border bg-card",children:[e.jsx("div",{className:"border-b bg-muted/40 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",className:"text-xs font-mono",children:g.type.toUpperCase()}),e.jsx("h3",{className:"font-semibold",children:g.name})]}),g.client&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:g.client})]}),e.jsxs(O,{variant:"secondary",children:[g.tasks.length," ",g.tasks.length===1?"task":"tasks"]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs(Wt,{children:[e.jsx(Jt,{children:e.jsxs(Ue,{children:[e.jsx(H,{className:"w-[120px]",children:"Department"}),e.jsx(H,{children:"Task Type"}),e.jsx(H,{className:"w-[140px]",children:"Status"}),e.jsx(H,{className:"w-[160px]",children:"Progress"}),e.jsx(H,{className:"w-[140px]",children:"Due Date"}),e.jsx(H,{className:"w-[200px]",children:"Actions"})]})}),e.jsx(Qt,{children:g.tasks.map(m=>e.jsxs(Ue,{children:[e.jsx(K,{children:e.jsx(O,{variant:"outline",className:v("text-xs font-medium",ua[m.department]||""),children:m.department})}),e.jsx(K,{className:"font-medium",children:m.taskType}),e.jsx(K,{children:e.jsx(O,{variant:"outline",className:v("text-xs",ba[m.status]||""),children:ma[m.status]||m.status})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{value:m.progress,className:"h-2 flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground w-10 text-right",children:[m.progress,"%"]})]})}),e.jsx(K,{children:m.dueDate?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Me,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:v("text-xs",new Date(m.dueDate)<new Date?"text-destructive font-medium":"text-muted-foreground"),children:_e(new Date(m.dueDate),{addSuffix:!0})})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{size:"sm",variant:"outline",onClick:()=>u(m.detailLink),className:"h-8","aria-label":`View details for ${m.taskType} task`,children:[e.jsx(ut,{className:"h-3 w-3 mr-1"}),"View"]}),w&&e.jsx(T,{size:"sm",variant:"default",onClick:()=>p(m.id,m.department),disabled:h===m.id,className:"h-8","aria-label":`Mark ${m.taskType} task as complete`,children:h===m.id?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-3 w-3 mr-1 animate-spin"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{className:"h-3 w-3 mr-1"}),"Complete"]})})]})})]},m.id))})]})})]},g.id))})]})]})})},fa={sound:"bg-blue-500/10 text-blue-700 border-blue-500/20 dark:text-blue-400",lights:"bg-amber-500/10 text-amber-700 border-amber-500/20 dark:text-amber-400",video:"bg-purple-500/10 text-purple-700 border-purple-500/20 dark:text-purple-400"},ga={not_started:"Not Started",in_progress:"In Progress"},pa={not_started:"bg-slate-500/10 text-slate-700 border-slate-500/20 dark:text-slate-400",in_progress:"bg-orange-500/10 text-orange-700 border-orange-500/20 dark:text-orange-400"},xa=({open:t,onOpenChange:s,task:a,jobOrTourName:o,jobOrTourType:i,client:n,onDismiss:c,onViewAll:r,totalPendingCount:d,currentIndex:b})=>{const h=Y();if(!a)return null;const f=()=>{h(a.detailLink),s(!1)};return e.jsx(et,{open:t,onOpenChange:s,children:e.jsxs(tt,{className:"max-w-2xl",children:[e.jsxs(st,{children:[e.jsxs(at,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-orange-500"}),"Pending Task",d>1&&e.jsxs(O,{variant:"secondary",className:"ml-2",children:[b+1," of ",d]})]}),e.jsx(it,{children:"You have a task assigned to you that needs attention"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",className:"text-xs font-mono",children:i.toUpperCase()}),e.jsx("h3",{className:"font-semibold",children:o})]}),n&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Department"}),e.jsx(O,{variant:"outline",className:v("text-xs font-medium",fa[a.department]||""),children:a.department})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Task Type"}),e.jsx("span",{className:"text-sm font-medium",children:a.taskType})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(O,{variant:"outline",className:v("text-xs",pa[a.status]||""),children:ga[a.status]||a.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.progress,"%"]})]}),e.jsx(ct,{value:a.progress,className:"h-2"})]}),a.dueDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Due Date"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:v("text-sm",new Date(a.dueDate)<new Date?"text-destructive font-medium":"text-muted-foreground"),children:_e(new Date(a.dueDate),{addSuffix:!0})})]})]})]})]}),e.jsxs(Rt,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(T,{variant:"outline",onClick:c,className:"w-full sm:w-auto",children:"Dismiss for Now"}),d>1&&e.jsxs(T,{variant:"outline",onClick:r,className:"w-full sm:w-auto",children:["View All Tasks (",d,")"]}),e.jsxs(T,{onClick:f,className:"w-full sm:w-auto",children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),"View Task Details"]})]})]})})},va=({userId:t,userRole:s,onClick:a,className:o})=>{const{data:i,isLoading:n}=Le(t,s),c=l.useMemo(()=>(i==null?void 0:i.reduce((b,h)=>b+h.tasks.length,0))||0,[i]),r=c>9?"9+":c.toString(),d=c>0;return e.jsxs(T,{type:"button",variant:"ghost",size:"icon",onClick:a,disabled:n,className:v("relative h-9 w-9 rounded-full border border-border/60 bg-background/70 text-muted-foreground shadow-sm transition-colors hover:bg-accent/30 hover:text-foreground focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",d&&"text-blue-500",o),"aria-label":d?`${c} pending ${c===1?"task":"tasks"}`:"No pending tasks",children:[e.jsx(ys,{className:"h-5 w-5","aria-hidden":"true"}),d&&e.jsx("span",{className:"pointer-events-none absolute -top-1 -right-1 inline-flex min-h-[1.25rem] min-w-[1.25rem] items-center justify-center rounded-full bg-blue-500 px-1 text-[0.7rem] font-semibold text-white shadow",children:r})]})},Qe={"/dashboard":"#dashboard","/technician-dashboard":"#techniciandashboard","/personal":"#personal","/sound":"#sound","/lights":"#lights","/video":"#video","/logistics":"#logistics","/profile":"#profile","/settings":"#settings","/project-management":"#projectmanagement","/equipment-management":"#equipmentmanagement","/job-assignment-matrix":"#jobassignmentmatrix","/timesheets":"#timesheets","/tours":"#tours","/festivals":"#festivals","/pesos-tool":"#pesostool","/lights-pesos-tool":"#lightspesostool","/video-pesos-tool":"#videopesostool","/consumos-tool":"#consumostool","/lights-consumos-tool":"#lightsconsumostool","/video-consumos-tool":"#videoconsumostool","/lights-memoria-tecnica":"#lightsmemoratecnica","/video-memoria-tecnica":"#videomemoratecnica","/excel-tool":"#exceltool","/hoja-de-ruta":"#hojaderuta","/labor-po-form":"#laborpoform","/disponibilidad":"#lightsdisponibilidad","/festival-management":"#festivalmanagement","/auth":"#auth"},ja=t=>{if(t.includes("/festival-management/"))return t.includes("/artists")?"Festival Artist Management":t.includes("/gear")?"Festival Gear Management":"Festival Management";if(t.includes("/tour-management/"))return"Tour Management";if(t.includes("/tours/")&&(t.includes("/pesos")||t.includes("/consumos"))){const a=t.split("/"),o=a[a.length-1],i=a[a.length-2];return`${i.charAt(0).toUpperCase()+i.slice(1)} ${o.charAt(0).toUpperCase()+o.slice(1)} Tool`}return{"/dashboard":"Dashboard","/technician-dashboard":"Technician Dashboard","/personal":"Personal Management","/sound":"Sound Management","/lights":"Lights Management","/video":"Video Management","/logistics":"Logistics","/profile":"Profile","/settings":"Settings","/project-management":"Project Management","/equipment-management":"Equipment Management","/job-assignment-matrix":"Job Assignment Matrix","/timesheets":"Timesheets","/tours":"Tours","/festivals":"Festivals","/pesos-tool":"Weights Tool","/lights-pesos-tool":"Lights Weights Tool","/video-pesos-tool":"Video Weights Tool","/consumos-tool":"Consumption Tool","/lights-consumos-tool":"Lights Consumption Tool","/video-consumos-tool":"Video Consumption Tool","/lights-memoria-tecnica":"Lights Technical Memory","/video-memoria-tecnica":"Video Technical Memory","/excel-tool":"Excel Tool","/hoja-de-ruta":"Hoja de Ruta","/labor-po-form":"Labor PO Form","/lights-disponibilidad":"Lights Availability","/manual":"User Manual","/auth":"Authentication"}[t]||"Help"},wa=()=>{const t=X(),s=Y(),a=()=>{const i=t.pathname;if(i==="/manual")return;let n="#introduction";Qe[i]?n=Qe[i]:i.includes("/festival-management/")?i.includes("/artists")?n="#festivalartistmanagement":i.includes("/gear")?n="#festivalgearmanagement":n="#festivalmanagement":i.includes("/tour-management/")?n="#tourmanagement":i.includes("/tours/")&&(i.includes("/pesos")||i.includes("/consumos"))&&(i.includes("/pesos")?i.includes("/lights/")?n="#lightspesostool":i.includes("/video/")?n="#videopesostool":n="#pesostool":i.includes("/consumos")&&(i.includes("/lights/")?n="#lightsconsumostool":i.includes("/video/")?n="#videoconsumostool":n="#consumostool")),s(`/manual${n}`)},o=ja(t.pathname);return e.jsx(Se,{children:e.jsxs(ke,{children:[e.jsx(Te,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"icon",onClick:a,className:"h-9 w-9",children:e.jsx(js,{className:"h-4 w-4"})})}),e.jsx(Ce,{children:e.jsxs("p",{children:["Help: ",o]})})]})})},ya=()=>{const{user:t}=nt();return t?e.jsxs("div",{className:"px-2 py-2 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Signed in as:"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate text-left",children:t.email})]}):null},Ye={sound:["management-department","project-management","tours","festivals"],lights:["project-management","management-department","disponibilidad","logistics"],production:["management-dashboard","project-management","logistics","job-assignment-matrix"]},Tt=({items:t,userDepartment:s,userRole:a,maxPrimary:o=4})=>{if(!t.length||o<=0)return[];const i=(s==null?void 0:s.toLowerCase())??null,n=(a==null?void 0:a.toLowerCase())??null,c=i&&Ye[i]||n&&Ye[n]||null,r=[],d=new Set,b=p=>{p&&(r.length>=o||d.has(p.id)||(r.push(p),d.add(p.id)))};if(c)for(const p of c){if(r.length>=o)break;const w=t.find(y=>y.id===p);w&&b(w)}if(r.length<o)for(const p of t){if(r.length>=o)break;p.mobileSlot==="primary"&&b(p)}const h=Math.min(o,t.length);if(r.length<h)for(const p of t){if(r.length>=h)break;b(p)}const f=t.find(p=>p.id==="profile"),u=!c||r.length<o;if(f&&u&&!d.has(f.id)){if(r.length<o)r.push(f),d.add(f.id);else if(r.length>0){const p=r[r.length-1];d.delete(p.id),r[r.length-1]=f,d.add(f.id)}}return r},Na=()=>{var Ae,Ee,Ie,Re,Oe,ze,De;const t=Y(),s=X(),a=oe(),o=Xe(),[i,n]=Ot(),[c,r]=l.useState(!1),[d,b]=l.useState(!1),[h,f]=l.useState(!1),[u,p]=l.useState(0),[w,y]=l.useState(!1);l.useEffect(()=>{i.get("showAbout")==="1"&&(y(!0),i.delete("showAbout"),n(i,{replace:!0}))},[i,n]);const{session:g,userRole:m,userDepartment:j,hasSoundVisionAccess:S,assignableAsTech:z,isLoading:I,logout:F}=nt();if(!I&&m==="technician"){const k=i.get("showAbout"),L=k?`/tech-app?showAbout=${k}`:"/tech-app";return e.jsx(zt,{to:L,replace:!0})}const{requiredTables:G}=lt(),{forceSubscribe:D}=Ze(),A=((Ae=g==null?void 0:g.user)==null?void 0:Ae.id)??null,{data:q}=la(A,m),{acknowledgedTaskIds:ee,acknowledgeTask:de,clearAcknowledgedTasks:te,isTaskAcknowledged:W}=da(A),P=l.useMemo(()=>q?q.filter(k=>!W(k.id)):[],[q,W]);ra({userId:(Ee=g==null?void 0:g.user)==null?void 0:Ee.id}),l.useEffect(()=>{if(G.length>0){const k=G.map(L=>({table:L,queryKey:L}));D(k)}},[G,D]),l.useEffect(()=>{if(!(I||!g)&&(s.pathname==="/"||s.pathname==="/dashboard")){const k=Dt(m??null);k&&k!==s.pathname&&t(k,{replace:!0})}},[I,g,m,s.pathname,t]),l.useEffect(()=>{if(!q||!A)return;const k=new Set(q.map(U=>U.id)),L=[];ee.forEach(U=>{k.has(U)||L.push(U)}),L.length>0&&te(L)},[q,ee,te,A]),l.useEffect(()=>{if(!(!A||!m||I||!["management","admin","logistics"].includes(m))&&P&&P.length>0){const L=setTimeout(()=>{p(0),f(!0)},800);return()=>clearTimeout(L)}},[A,m,P,I]);const se=async()=>{if(!c){r(!0);try{await F()}catch{}finally{r(!1)}}},ce=async()=>{await a.refetchQueries()},x=()=>{if(!P||P.length===0)return;const k=P[u];k&&de(k.id),u+1<P.length?p(u+1):(f(!1),p(0))},N=()=>{f(!1),b(!0)},_=()=>{b(!0)};if(I)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-gray-900 dark:border-white"})});if(!g)return t("/auth",{replace:!0}),null;const C=l.useMemo(()=>({userRole:m,userDepartment:j,hasSoundVisionAccess:S,assignableAsTech:z}),[m,j,S,z]),M=l.useMemo(()=>gt(C),[C]),V=l.useMemo(()=>M.length<=1?M:[...M].sort((k,L)=>(k.mobilePriority??99)-(L.mobilePriority??99)),[M]),$=l.useMemo(()=>Tt({items:V,userDepartment:j,userRole:m}),[V,j,m]),Pe=l.useMemo(()=>{if(!V.length)return[];const k=new Set($.map(L=>L.id));return V.filter(L=>!k.has(L.id))},[V,$]),ue=l.useMemo(()=>{if(!(!A||!m))return{userId:A,userRole:m,userDepartment:j??null}},[A,m,j]),ae=l.useMemo(()=>{var Ve;if(["/wallboard"].some(_t=>s.pathname.startsWith(_t)))return!0;if(!s.search)return!1;const U=(Ve=new URLSearchParams(s.search).get("fullscreen"))==null?void 0:Ve.toLowerCase();return U==="1"||U==="true"},[s.pathname,s.search]),me=l.useMemo(()=>o&&["/sound"].some(L=>s.pathname.startsWith(L)),[o,s.pathname]),be=!o||ae,Ct=o&&!ae&&!me&&!!m&&($.length>0||Pe.length>0);return e.jsxs(xt,{defaultOpen:be,children:[e.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[be&&e.jsxs(vt,{className:"border-r border-border/50 bg-sidebar text-sidebar-foreground",children:[e.jsx(Nt,{children:e.jsx(St,{children:e.jsx(kt,{children:e.jsx(Es,{...C})})})}),e.jsxs(wt,{className:"border-t border-sidebar-border",children:[e.jsx(we,{className:"w-full"}),e.jsx(ya,{}),e.jsxs(T,{type:"button",variant:"ghost",className:"w-full justify-start gap-2",onClick:se,disabled:c,children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{children:c?"Cerrando sesión...":"Cerrar sesión"})]}),e.jsx(ft,{userRole:m??void 0,userEmail:((Ie=g.user)==null?void 0:Ie.email)??void 0,autoOpen:w,onAutoOpenHandled:()=>y(!1)}),e.jsx(yt,{}),e.jsx("div",{className:"px-2 py-4",children:e.jsx("img",{src:"/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png",alt:"Sector Pro Logo",width:794,height:100,decoding:"async",className:"h-6 w-auto max-w-[190px] dark:invert",draggable:"false"})})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[!ae&&!me&&e.jsx("header",{className:"sticky top-0 z-30 border-b border-border/60 bg-background/95 px-3 pb-2 pt-[max(0.75rem,calc(env(safe-area-inset-top)+0.75rem))] shadow-sm backdrop-blur supports-[backdrop-filter]:backdrop-blur sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[be&&e.jsx(jt,{className:"h-9 w-9"}),e.jsx(sa,{className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[ue&&e.jsx(ht,{...ue,display:"icon"}),A&&m&&["management","admin","logistics"].includes(m)&&e.jsx(va,{userId:A,userRole:m,onClick:_}),e.jsx(we,{display:"icon"}),e.jsx($t,{onReload:ce,variant:"ghost",className:"h-9 w-9 text-muted-foreground hover:text-foreground",ariaLabel:"Recargar datos"}),e.jsx(wa,{})]})]})}),e.jsx("main",{className:v("flex-1 overflow-y-auto px-3 pt-4 sm:px-6 sm:pt-6",ae||me?"pb-6":o?"pb-[calc(4.5rem+env(safe-area-inset-bottom))]":"pb-10"),children:e.jsx(Vt,{})})]})]}),Ct&&e.jsx(_s,{primaryItems:$,trayItems:Pe,onSignOut:se,isLoggingOut:c,notificationProps:ue,userRole:m??void 0,userEmail:((Re=g.user)==null?void 0:Re.email)??void 0}),e.jsx(ha,{open:d,onOpenChange:b,userId:A,userRole:m}),P&&P.length>0&&e.jsx(xa,{open:h,onOpenChange:f,task:P[u]||null,jobOrTourName:((Oe=P[u])==null?void 0:Oe.jobOrTourName)||"",jobOrTourType:((ze=P[u])==null?void 0:ze.jobOrTourType)||"job",client:(De=P[u])==null?void 0:De.client,onDismiss:x,onViewAll:N,totalPendingCount:P.length,currentIndex:u})]})},gi=Object.freeze(Object.defineProperty({__proto__:null,default:Na,selectPrimaryNavigationItems:Tt},Symbol.toStringTag,{value:"Module"}));export{gi as L,_s as M,gt as b,Tt as s};
