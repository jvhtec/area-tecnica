const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReportGenerator-DPElJEEl.js","assets/index-NZ6jJLfQ.js","assets/vite-preload-helper-ckwbz45p.js","assets/commonjs-helpers-Cpj98o6Y.js","assets/index-DFO7exW2.css","assets/checkbox-BsRNEGV1.js","assets/useJobSelection-B9iLNF5-.js","assets/useQuery-kdg2pmgf.js","assets/scroll-area-BHjMXddA.js","assets/logoUtils-D2o1jUVg.js","assets/logo-url-cache-eY6nfvu7.js","assets/radio-group-DzKNHD24.js","assets/index-hC3MxXep.js","assets/circle-CWxDyDxx.js","assets/lazyPdf-xVUlxKNu.js","assets/AmplifierTool-B8XV4xmK.js","assets/tabs-BdaywI_b.js","assets/plus-C3JQqq7t.js","assets/save-z_re-Mcq.js","assets/file-text-igU140SQ.js","assets/MemoriaTecnica-DjPWBBU7.js","assets/progress-C8XsV-Me.js","assets/useLogoOptions-BfwIlBcK.js","assets/image--Pql38nK.js","assets/file-B1WzkXfC.js","assets/download-C1rVE0-J.js","assets/upload-DF4rjO7T.js","assets/IncidentReport-dhJRF0MZ.js","assets/index-vfKqQWY5.js","assets/pdf-libs-BqoGqu1a.js","assets/TechnicianIncidentReportDialog-Bb0qWmts.js","assets/logo-service-SlbhM6-i.js","assets/jobDocumentsUpload-BaycvzFe.js","assets/clipboard-list-wtFE30Ps.js","assets/triangle-alert-D6qN0F8g.js"])))=>i.map(i=>d[i]);
import{_ as Fe}from"./vite-preload-helper-ckwbz45p.js";import{l as ps,r as n,f as xs,i as z,j as e,X as us,B as v,a as $,M as Ye,R as Ze,m as U,n as ne,o as hs,e as fs,p as bs,D as we,q as ye,S as Ge,t as Be,v as Qe,w as We,x as me,c as ws,d as ys,u as Ns,y as es,z as js,C as Ms,A as Cs,E as _s,F as Ee,G as Je}from"./index-NZ6jJLfQ.js";import{u as Ss}from"./useOptimizedJobs-BQ4L7-2d.js";import{u as $s,J as ks}from"./folders-Scoqgw4s.js";import{E as Ts}from"./EditJobDialog-DRKRzgWP.js";import{D as As,L as Rs}from"./DepartmentMobileHub-CFFDzrQc.js";import{TodaySchedule as zs}from"./TodaySchedule-xMAV31Nm.js";import{CalendarSection as Es}from"./CalendarSection-DRcHiGMy.js";import{d as Js}from"./optimisticJobDeletionService-Bq-53fU4.js";import{S as Is}from"./SoundVisionAccessRequestDialog-COaRnH3m.js";import{b as Ls,s as Os,M as Ps}from"./Layout-Cp7e_-Zx.js";import{u as Fs,T as qs,J as Vs}from"./JobDetailsDialog-Cah6wZTf.js";import{u as Le}from"./useQuery-kdg2pmgf.js";import{B as Oe}from"./badge-vNTKF5RD.js";import{S as Ds}from"./scroll-area-BHjMXddA.js";import{u as Us,c as ss}from"./useWeatherData-d0TEdKFc.js";import{G as ts,P as Hs}from"./places-restaurant-service-CakuSyx6.js";import{J as Ks}from"./JobExtrasManagement-CpH8R_KL.js";import{u as Gs}from"./JobExtrasEditor-gQe73Sd8.js";import{u as Bs}from"./useJobRatesApproval-DsfA8V9C.js";import{J as Qs}from"./JobPayoutTotalsPanel-BSlgp62i.js";import{C as gs}from"./calendar-_Cj_Sgy-.js";import{M as Ws}from"./map-BKqH24gv.js";import{U as as}from"./user-E3OATBQk.js";import{F as Pe}from"./file-text-igU140SQ.js";import{E as Zs}from"./eye-BE_DouVP.js";import{D as Xs}from"./download-C1rVE0-J.js";import{U as is,C as ns}from"./utensils-Dv9wAVOh.js";import{P as Ys}from"./phone-BlFwiuho.js";import{T as Ne}from"./triangle-alert-D6qN0F8g.js";import{E as rs}from"./euro-DgRTeGAz.js";import{e as pe}from"./es-CSiFCUGj.js";import{S as et}from"./switch-DUBpZhIC.js";import{u as st}from"./useJobAssignmentsRealtime-7FZn5naq.js";import{U as tt}from"./users-DMnpVLUq.js";import{P as vs}from"./plus-C3JQqq7t.js";import{e as at}from"./eachDayOfInterval-CPmiA2bk.js";import{B as it}from"./box-C0bB0Qui.js";import{C as ls}from"./calculator-jIsLl-gd.js";import{Z as os}from"./zap-QKspq41J.js";import{D as ds}from"./ModernHojaDeRuta-DrMmS05m.js";import{L as cs}from"./lock-Cr7oPkPT.js";import{M as nt}from"./music-Dlz2JBJr.js";import{s as rt}from"./subDays-D4REtaCB.js";import{s as lt,a as ot}from"./startOfMonth-B5dVCv8B.js";import{e as dt}from"./endOfMonth-Byhxb84j.js";import{i as ct}from"./isWithinInterval-CV3kanO0.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./useSubscription-C3wu6ko-.js";import"./alert-dialog-CtyYUxwH.js";import"./technicianAvailability-gbYgVBKV.js";import"./useJobRequiredRoles-Bz0ibKHS.js";import"./useMutation-DluhVBs1.js";import"./roleCategory-BtQgWHfO.js";import"./external-link-QJoXZ6ES.js";import"./api-C9EDenHJ.js";import"./config-DVV3VxR4.js";import"./constants-DoXhG9KB.js";import"./dryhireFolderService-Bb-tDpoa.js";import"./checkbox-BsRNEGV1.js";import"./dropdown-menu-Dn1SMjj1.js";import"./index-D9TsP8oP.js";import"./index-hC3MxXep.js";import"./chevron-right-Bn7Eu0F7.js";import"./circle-CWxDyDxx.js";import"./popover-Dl-b1R8L.js";import"./calendar--BDVgnXu.js";import"./isSameDay-m1OvdnsV.js";import"./isSameMonth-BQ4F6s8O.js";import"./addMonths-j-Bb577B.js";import"./differenceInCalendarMonths-6exvViir.js";import"./endOfWeek-BYLwoWuZ.js";import"./chevron-left-rq2ui83a.js";import"./filter-D0HnK7Nz.js";import"./ellipsis-vertical-zRAfIP3L.js";import"./square-pen-BMpSgZGa.js";import"./clock-BXPvTWvY.js";import"./truck-Br5sduv3.js";import"./isToday-BbpdYtC3.js";import"./constructNow-u0VlpghF.js";import"./JobCardNew-ZLL_Hd_i.js";import"./VideoTaskDialog-jFo9WRqF.js";import"./icon-D8sTZPYx.js";import"./progress-C8XsV-Me.js";import"./table-DnQAmABX.js";import"./lazyXlsx-BrFBF17_.js";import"./upload-DF4rjO7T.js";import"./folderNameSanitizer-DNdk00QU.js";import"./FlexFolderPicker-DHVHrWa7.js";import"./LogisticsEventDialog-WK7mGk6y.js";import"./transportOptions-CtHnG2xX.js";import"./transportProviders-CPS1W6Xy.js";import"./TaskManagerDialog-WHCTXr5s.js";import"./tabs-BdaywI_b.js";import"./taskCompletion-NTcmWFA_.js";import"./TechnicianIncidentReportDialog-Bb0qWmts.js";import"./index-vfKqQWY5.js";import"./pdf-libs-BqoGqu1a.js";import"./logo-service-SlbhM6-i.js";import"./jobDocumentsUpload-BaycvzFe.js";import"./clipboard-list-wtFE30Ps.js";import"./save-z_re-Mcq.js";import"./useFlexUuid-C0fmwl_8.js";import"./flexUuidService-C9yZjzP-.js";import"./command-D3uMBT-Z.js";import"./search-D-OiWg8h.js";import"./message-circle-Bh9rUoQO.js";import"./info-CpCfiYD2.js";import"./settings-egXcSQW9.js";import"./folder-plus-DTUhlRcm.js";import"./userName-BCcvOtN-.js";import"./mic-l4q2dREA.js";import"./moon-Bp9lP4EQ.js";import"./star-icpn3ybK.js";import"./wrench-DzMvZxmF.js";import"./plane-NSG-_bNT.js";import"./DateTypeContextMenu-D-zx4rHd.js";import"./context-menu-DYP7Nyzl.js";import"./useTableSubscription-Cu79jct8.js";import"./hard-drive-DZn0Cm3i.js";import"./printer-De77t3j8.js";import"./useMobileRealtimeSubscriptions-CkyUxSWV.js";import"./target-kNjpphh3.js";import"./video-BcyQPYgx.js";import"./lightbulb-BU2ctenD.js";import"./music-2-DRJ2zGwb.js";import"./lazyPdf-xVUlxKNu.js";import"./endOfYear-D08D-xBX.js";import"./endOfQuarter-BH4-YKz9.js";import"./form-DwbSQQJ0.js";import"./alert-BqA-5jRM.js";import"./circle-check-big-CilmNGCn.js";import"./circle-x-DDzV-xk_.js";import"./separator-E-JdTFOv.js";import"./sheet-DFFfLazF.js";import"./skeleton-DFbEI1RA.js";import"./useEnhancedRouteSubscriptions-B8NTEQXv.js";import"./formatDistanceToNow-Bbdi_GlK.js";import"./wifi-C3_7SFyW.js";import"./circle-alert-LZYNzZ7F.js";import"./reload-button-B1d3KJMk.js";import"./api-Caml4zFF.js";import"./hover-card-BMjtHitm.js";import"./bell-eCP3MIu-.js";import"./useUserPreferences-D4k5KjWa.js";import"./sun-DEWOIVS5.js";import"./useAppBadgeSource-megIXC92.js";import"./log-out-ByMqfvmj.js";import"./layout-dashboard-Bpl_gmRx.js";import"./circle-user-DWpyZYlg.js";import"./grid-3x3-D3Em47ud.js";import"./receipt-CWKVL4Rh.js";import"./tent-G6tzA2Go.js";import"./activity-BNQuCEmB.js";import"./message-square-a2K2ewo9.js";import"./useTourRateSubscriptions-Dd0aSU9f.js";import"./tourRateMath-BOmIkfWO.js";import"./useManagerJobQuotes-BrI1iNRY.js";import"./logoUtils-D2o1jUVg.js";import"./logo-url-cache-eY6nfvu7.js";import"./send-Uvkx0r_O.js";import"./circle-check-C0N48OpO.js";import"./pdfMerge-DXtLP7Xx.js";import"./timesheet-pdf-82e1LStH.js";import"./avatar-QSp4LpEt.js";import"./utensils-crossed-CZeagqP3.js";import"./weatherApi-BatwQpQy.js";import"./useJobPayoutTotals-CXAavZS-.js";import"./ratesQueryKeys-DgMsgg6U.js";import"./minus-InO4I9Ks.js";import"./pen-D_H3YLSb.js";import"./file-down-Buu6FgvW.js";import"./useRealtimeQuery-DRd58t-I.js";import"./useJobSelection-B9iLNF5-.js";import"./MultiDayScheduleBuilder-DmGkt0fN.js";import"./building-BdT03Y2e.js";import"./arrow-up-BTt-lBKB.js";import"./copy-Dez5r9kU.js";import"./calendar-days-DcwEz6pd.js";import"./building-2-nIk8XRuA.js";import"./sparkles-BZkmCd_8.js";import"./image--Pql38nK.js";import"./briefcase-BrpPecAy.js";import"./id-card-oCs3SPbN.js";import"./car-vrO_NvCk.js";import"./package-Oxfj-CNq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ps("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=ps("FileStack",[["path",{d:"M21 7h-3a2 2 0 0 1-2-2V2",key:"9rb54x"}],["path",{d:"M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17Z",key:"1059l0"}],["path",{d:"M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15",key:"16874u"}],["path",{d:"M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11",key:"k2ox98"}]]),pt=({theme:a,isDark:m,job:t,onClose:k,userRole:se,department:E="sound"})=>{var _e,Se,$e,ke,ce,ve,Te,Ae,Y,Re,be;const[j,P]=n.useState("Info"),[F,C]=n.useState(new Set),[H,_]=n.useState(void 0),[W,w]=n.useState(null),[q,K]=n.useState(!1),[N,J]=n.useState(!1),M=xs(),T=["admin","management"].includes(se||""),G=se==="house_tech",{data:s,isLoading:B}=Le({queryKey:["job-details-modal",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return null;const{data:i,error:r}=await U.from("jobs").select(`
          *,
          locations(id, name, formatted_address, latitude, longitude)
        `).eq("id",t.id).single();if(r)throw r;return i},enabled:!!(t!=null&&t.id)}),h=(s==null?void 0:s.id)||(t==null?void 0:t.id),{data:re=[]}=Gs(h),{data:Q}=Bs(h),{data:f,isLoading:I}=Fs(h),S=(Q==null?void 0:Q.rates_approved)??(s==null?void 0:s.rates_approved)??(t==null?void 0:t.rates_approved)??!1,{data:L=[],isLoading:Z}=Le({queryKey:["job-staff",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];const{data:i,error:r}=await U.from("job_assignments").select(`
          sound_role,
          lights_role,
          video_role,
          technician:profiles(id, first_name, last_name, email)
        `).eq("job_id",t.id).eq("status","confirmed");if(r)throw r;return i||[]},enabled:!!(t!=null&&t.id)}),{data:V=[],isLoading:o}=Le({queryKey:["job-restaurants-modal",t==null?void 0:t.id,(_e=s==null?void 0:s.locations)==null?void 0:_e.formatted_address],queryFn:async()=>{const i=s==null?void 0:s.locations,r=(i==null?void 0:i.formatted_address)||(i==null?void 0:i.name);if(!r&&!(i!=null&&i.latitude))return[];const l=i!=null&&i.latitude&&(i!=null&&i.longitude)?{lat:Number(i.latitude),lng:Number(i.longitude)}:void 0;return await Hs.searchRestaurantsNearVenue(r||`${l==null?void 0:l.lat},${l==null?void 0:l.lng}`,2e3,10,l)},enabled:!!(s!=null&&s.locations)&&(!!((Se=s==null?void 0:s.locations)!=null&&Se.formatted_address)||!!(($e=s==null?void 0:s.locations)!=null&&$e.name)||!!((ke=s==null?void 0:s.locations)!=null&&ke.latitude)&&!!((ce=s==null?void 0:s.locations)!=null&&ce.longitude))}),c=(s!=null&&s.start_time||t!=null&&t.start_time)&&(s!=null&&s.end_time||t!=null&&t.end_time)?new Date((s==null?void 0:s.start_time)||(t==null?void 0:t.start_time)).toLocaleDateString("en-GB").split("/").join("/")+(new Date((s==null?void 0:s.start_time)||(t==null?void 0:t.start_time)).toDateString()!==new Date((s==null?void 0:s.end_time)||(t==null?void 0:t.end_time)).toDateString()?" - "+new Date((s==null?void 0:s.end_time)||(t==null?void 0:t.end_time)).toLocaleDateString("en-GB").split("/").join("/"):""):"",g={address:((ve=s==null?void 0:s.locations)==null?void 0:ve.formatted_address)||((Te=s==null?void 0:s.locations)==null?void 0:Te.name),coordinates:(Ae=s==null?void 0:s.locations)!=null&&Ae.latitude&&((Y=s==null?void 0:s.locations)!=null&&Y.longitude)?{lat:typeof s.locations.latitude=="number"?s.locations.latitude:parseFloat(s.locations.latitude),lng:typeof s.locations.longitude=="number"?s.locations.longitude:parseFloat(s.locations.longitude)}:void 0},{isLoading:A,error:y,fetchWeather:X}=Us({venue:g,eventDates:c,onWeatherUpdate:_});n.useEffect(()=>{h&&P("Info")},[h]);const te=()=>{h&&(M.invalidateQueries({queryKey:["job-details-modal",h]}),M.invalidateQueries({queryKey:["job-approval-status",h]}),M.invalidateQueries({queryKey:["job-rates-approval",h]}),M.invalidateQueries({queryKey:["job-rates-approval-map"]}),M.invalidateQueries({queryKey:["optimized-jobs"]}),M.invalidateQueries({queryKey:["jobs"]}))},qe=async()=>{var i;if(!(!h||N)){if(f&&!f.canApprove){const r=f.blockingReasons.join(", ");ne.error(r?`No se puede aprobar: ${r}`:"No se puede aprobar mientras haya pendientes");return}J(!0);try{const{data:r}=await U.auth.getUser(),{error:l}=await U.from("jobs").update({rates_approved:!0,rates_approved_at:new Date().toISOString(),rates_approved_by:((i=r==null?void 0:r.user)==null?void 0:i.id)||null}).eq("id",h);if(l)throw l;ne.success("Tarifas aprobadas")}catch{ne.error("No se pudieron aprobar las tarifas del trabajo")}finally{J(!1),te()}}},xe=async()=>{if(!(!h||N)){J(!0);try{const{error:i}=await U.from("jobs").update({rates_approved:!1,rates_approved_at:null,rates_approved_by:null}).eq("id",h);if(i)throw i;ne.success("AprobaciÃ³n revocada")}catch{ne.error("No se pudo revocar la aprobaciÃ³n")}finally{J(!1),te()}}};n.useEffect(()=>{const i=async()=>{try{const r=s==null?void 0:s.locations;if(!r){w(null);return}const l=typeof r.latitude=="number"?r.latitude:typeof r.latitude=="string"?parseFloat(r.latitude):void 0,p=typeof r.longitude=="number"?r.longitude:typeof r.longitude=="string"?parseFloat(r.longitude):void 0,D=r.formatted_address||r.name||"";K(!0);const{data:ee,error:De}=await U.functions.invoke("get-google-maps-key");if(De||!(ee!=null&&ee.apiKey)){w(null),K(!1);return}const Ue=ee.apiKey,He=15,Ke=600,d=300,u=2,R=Number.isFinite(l)&&Number.isFinite(p)?`${l},${p}`:encodeURIComponent(D),ze=Number.isFinite(l)&&Number.isFinite(p)?`&markers=color:red|label:A|${l},${p}`:D?`&markers=color:red|label:A|${encodeURIComponent(D)}`:"",Xe=`https://maps.googleapis.com/maps/api/staticmap?center=${R}&zoom=${He}&size=${Ke}x${d}&scale=${u}${ze}&key=${encodeURIComponent(Ue)}`;w(Xe)}catch(r){r instanceof Error?r.message:String(r),w(null)}finally{K(!1)}};s!=null&&s.locations&&i()},[s==null?void 0:s.locations]);const le=async i=>{const r=i.id;C(l=>new Set(l).add(r));try{const l=await ss(U,i.file_path,60);window.open(l,"_blank")}catch(l){const p=l instanceof Error?l.message:"Error desconocido";ne.error(`No se pudo abrir el documento: ${p}`)}finally{C(l=>{const p=new Set(l);return p.delete(r),p})}},je=async i=>{const r=i.id;C(l=>new Set(l).add(r));try{const l=await ss(U,i.file_path,60),p=document.createElement("a");p.href=l,p.download=i.file_name,document.body.appendChild(p),p.click(),document.body.removeChild(p)}catch(l){const p=l instanceof Error?l.message:"Error desconocido";ne.error(`No se pudo descargar el documento: ${p}`)}finally{C(l=>{const p=new Set(l);return p.delete(r),p})}},b=()=>{var l,p,D;const i=((l=s==null?void 0:s.locations)==null?void 0:l.formatted_address)||((p=s==null?void 0:s.locations)==null?void 0:p.name)||((D=t==null?void 0:t.location)==null?void 0:D.name)||"",r=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i)}`;window.open(r,"_blank")},x=(s==null?void 0:s.locations)||(t==null?void 0:t.location),oe=s!=null&&s.start_time||t!=null&&t.start_time?z(new Date((s==null?void 0:s.start_time)||(t==null?void 0:t.start_time)),"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:pe}):"Fecha no disponible",de=s!=null&&s.end_time||t!=null&&t.end_time?z(new Date((s==null?void 0:s.end_time)||(t==null?void 0:t.end_time)),"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:pe}):"Fecha no disponible",O=(s==null?void 0:s.job_type)||(t==null?void 0:t.job_type),ae=O==="dryhire",Me=!ae&&O==="tourdate"&&(T||S)&&!G,Ce=!ae&&(T||G||S&&re.length>0),Ve=T||G,ie=[{id:"Info",label:"Info"},{id:"UbicaciÃ³n",label:"UbicaciÃ³n"},{id:"Personal",label:"Personal"},{id:"Docs",label:"Docs"},{id:"Restau.",label:"Restau."},{id:"Clima",label:"Clima"}];Me&&ie.push({id:"Tarifas",label:"Tarifas"}),Ce&&ie.push({id:"Extras",label:"Extras"});const ue=i=>i.sound_role?"sound":i.lights_role?"lights":i.video_role?"video":"unknown",he=i=>{const r=i.sound_role||i.lights_role||i.video_role;return r?hs(r)||r:"TÃ©cnico"},fe=i=>i.toLowerCase().includes("sun")?"â˜€ï¸":i.toLowerCase().includes("cloud")?"â˜ï¸":i.toLowerCase().includes("rain")?"ðŸŒ§ï¸":i.toLowerCase().includes("snow")?"â„ï¸":i.toLowerCase().includes("storm")?"â›ˆï¸":"ðŸŒ¤ï¸",ge=i=>{try{return new Date(i).toLocaleDateString("es-ES",{month:"long",day:"numeric"})}catch{return i}};return e.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center ${a.modalOverlay} p-4 animate-in fade-in duration-200`,children:e.jsxs("div",{className:`w-[98vw] sm:w-[96vw] max-w-[1200px] xl:max-w-[1400px] h-[90vh] ${m?"bg-[#0f1219]":"bg-white"} rounded-2xl border ${a.divider} shadow-2xl flex flex-col overflow-hidden overflow-x-hidden animate-in zoom-in-95 duration-200`,children:[e.jsxs("div",{className:`p-4 border-b ${a.divider} flex justify-between items-center shrink-0`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{size:18,className:a.textMuted}),e.jsx("h2",{className:`text-lg font-bold ${a.textMain}`,children:(t==null?void 0:t.title)||"Sin tÃ­tulo"})]}),e.jsx("button",{onClick:k,className:`p-2 ${a.textMuted} hover:${a.textMain} rounded-full transition-colors`,children:e.jsx(us,{size:20})})]}),e.jsx("div",{className:`flex border-b ${a.divider} ${m?"bg-[#0a0c10]":"bg-slate-50"} overflow-x-auto shrink-0`,children:ie.map(i=>e.jsx("button",{onClick:()=>P(i.id),className:`
                flex-1 py-3 px-4 text-xs font-bold uppercase tracking-wide whitespace-nowrap transition-colors
                ${j===i.id?`${m?"bg-[#151820]":"bg-white"} ${a.textMain} border-b-2 border-blue-500`:`${a.textMuted} hover:${a.textMain}`}
              `,children:i.label},i.id))}),e.jsxs(Ds,{className:"flex-1 p-5 overflow-x-hidden min-w-0",children:[j==="Info"&&e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold ${a.textMain} mb-4 break-words`,children:t==null?void 0:t.title}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`text-xs ${a.textMuted} font-bold uppercase`,children:"Hora de inicio"}),e.jsx("div",{className:`text-sm ${a.textMain} mt-1 leading-relaxed`,children:oe})]}),e.jsxs("div",{children:[e.jsx("label",{className:`text-xs ${a.textMuted} font-bold uppercase`,children:"Hora de finalizaciÃ³n"}),e.jsx("div",{className:`text-sm ${a.textMain} mt-1 leading-relaxed`,children:de})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`text-xs ${a.textMuted} font-bold uppercase`,children:"Tipo de trabajo"}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full ${m?"bg-[#1a1d26] border-[#2a2e3b]":"bg-slate-100 border-slate-200"} border text-xs ${a.textMain} font-medium`,children:O==="multi_day"?"Varios dÃ­as":O==="single"?"Un solo dÃ­a":O||"Un solo dÃ­a"})})]})]}),(t==null?void 0:t.description)&&e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:`text-xs ${a.textMuted} font-bold uppercase`,children:"DescripciÃ³n"}),e.jsx("p",{className:`text-sm ${a.textMain} mt-2 leading-relaxed break-words`,children:t.description})]}),x&&e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:`text-xs ${a.textMuted} font-bold uppercase`,children:"Recinto"}),e.jsx("div",{className:`text-sm ${a.textMain} mt-1 leading-relaxed break-words`,children:(x==null?void 0:x.name)||"Sin ubicaciÃ³n"}),(x==null?void 0:x.formatted_address)&&e.jsx("div",{className:`text-xs ${a.textMuted} break-words`,children:x.formatted_address})]}),!ae&&T&&e.jsxs("div",{className:`flex items-start justify-between gap-3 p-4 rounded-xl border ${m?"bg-[#151820] border-[#2a2e3b]":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{variant:S?"default":"secondary",children:S?"Tarifas aprobadas":"AprobaciÃ³n necesaria"}),e.jsx("span",{className:`text-xs ${a.textMuted}`,children:"Controla la visibilidad de los pagos por trabajo para los tÃ©cnicos"})]}),f&&f.blockingReasons.length>0&&e.jsxs("div",{className:`text-xs ${a.textMuted}`,children:["Pendiente: ",f.blockingReasons.join(", ")]})]}),e.jsx(v,{size:"sm",disabled:N||I,onClick:S?xe:qe,children:N?e.jsx($,{className:"h-4 w-4 animate-spin"}):S?"Revocar":"Aprobar"})]}),T&&h&&e.jsxs("div",{className:`${m?"bg-[#151820] border-[#2a2e3b]":"bg-slate-50 border-slate-200"} border rounded-xl p-3 w-full min-w-0 overflow-hidden`,children:[e.jsx("h3",{className:`text-sm font-semibold mb-3 ${a.textMain}`,children:"Job Payout Totals"}),e.jsx(Qs,{jobId:h})]})]}),j==="UbicaciÃ³n"&&e.jsx("div",{className:"space-y-4 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-8 w-8 animate-spin text-blue-500"})}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-lg font-bold ${a.textMain}`,children:(x==null?void 0:x.name)||"Sin ubicaciÃ³n"}),e.jsx("p",{className:`text-sm ${a.textMuted} mt-1 max-w-xs leading-relaxed`,children:(x==null?void 0:x.formatted_address)||(x==null?void 0:x.address)||"DirecciÃ³n no disponible"})]}),e.jsxs(v,{onClick:b,size:"sm",className:"whitespace-nowrap",children:[e.jsx(Ws,{size:14,className:"mr-2"})," Abrir mapas"]})]}),q&&e.jsx("div",{className:`rounded-xl overflow-hidden border ${a.divider} h-48 ${m?"bg-[#0a0c10]":"bg-slate-100"} flex items-center justify-center`,children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{className:"h-8 w-8 animate-spin text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:`text-sm ${a.textMuted}`,children:"Cargando vista previa del mapa..."})]})}),!q&&W&&e.jsxs("div",{className:`rounded-xl overflow-hidden border ${a.divider}`,children:[e.jsx("img",{src:W,alt:"Mapa del recinto",width:600,height:300,loading:"lazy",decoding:"async",className:"w-full h-auto"}),e.jsx("div",{className:"p-3 flex justify-end",children:e.jsx(v,{size:"sm",onClick:b,children:"Ver indicaciones"})})]}),!q&&!W&&e.jsx("div",{className:`rounded-xl overflow-hidden border ${a.divider} relative h-48 ${m?"bg-[#0a0c10]":"bg-slate-100"}`,children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ye,{size:32,className:a.textMuted}),e.jsx("p",{className:`text-xs ${a.textMuted} mt-2`,children:"Vista previa del mapa no disponible"}),e.jsx(v,{size:"sm",onClick:b,className:"mt-3",children:"Abrir Google Maps"})]})})})]}):e.jsxs("div",{className:`h-48 border border-dashed ${a.divider} rounded-xl flex flex-col items-center justify-center ${a.textMuted}`,children:[e.jsx(Ye,{size:32,className:"mb-2 opacity-50"}),e.jsx("span",{className:"text-sm",children:"No hay informaciÃ³n de ubicaciÃ³n disponible"})]})}),j==="Personal"&&e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(as,{size:18,className:a.textMuted}),e.jsx("h3",{className:`text-lg font-bold ${a.textMain}`,children:"Personal asignado"})]}),Z?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{className:"h-6 w-6 animate-spin text-blue-500"})}):L.length===0?e.jsxs("div",{className:`h-32 border border-dashed ${a.divider} rounded-xl flex flex-col items-center justify-center ${a.textMuted}`,children:[e.jsx(as,{size:24,className:"mb-2 opacity-50"}),e.jsx("span",{className:"text-xs",children:"No hay personal asignado"})]}):e.jsx("div",{className:"space-y-2",children:L.map((i,r)=>{const l=i.technician,p=ue(i),D=he(i),ee={sound:"text-blue-400 bg-blue-900/30 border-blue-900/50",lights:"text-amber-400 bg-amber-900/30 border-amber-900/50",video:"text-purple-400 bg-purple-900/30 border-purple-900/50"};return e.jsxs("div",{className:`${m?"bg-[#0f1219] border-[#1f232e]":"bg-slate-50 border-slate-200"} border rounded-lg p-4 min-w-0 overflow-hidden`,children:[e.jsxs("div",{className:`font-bold text-sm ${a.textMain} mb-1 break-words`,children:[l==null?void 0:l.first_name," ",l==null?void 0:l.last_name]}),e.jsx("div",{className:`text-xs ${a.textMuted} break-words`,children:D}),e.jsx("div",{className:`mt-2 inline-block px-2 py-0.5 rounded text-[10px] font-bold uppercase border ${ee[p]||a.textMuted}`,children:p})]},r)})})]}),j==="Docs"&&e.jsx("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pe,{size:18,className:a.textMuted}),e.jsx("h3",{className:`text-lg font-bold ${a.textMain}`,children:"Documentos del trabajo"})]}),(()=>{const i=((t==null?void 0:t.job_documents)||[]).filter(r=>Ve?!0:r.visible_to_tech);return i.length>0?e.jsx("div",{className:"space-y-2",children:i.map(r=>e.jsxs("div",{className:`${m?"bg-[#0f1219] border-[#1f232e]":"bg-slate-50 border-slate-200"} border rounded-lg p-4 flex items-center justify-between min-w-0`,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:`text-sm font-bold ${a.textMain} break-words mb-1`,children:r.file_name}),e.jsx("div",{className:`text-xs ${a.textMuted} break-words`,children:r.uploaded_at&&`Subido el ${z(new Date(r.uploaded_at),"d 'de' MMMM 'de' yyyy",{locale:pe})}`}),e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[r.template_type==="soundvision"&&e.jsx(Oe,{variant:"outline",className:"text-[10px]",children:"SoundVision"}),r.read_only&&e.jsx(Oe,{variant:"outline",className:"text-[10px] text-amber-500 border-amber-500/50",children:"Solo lectura"})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>le(r),disabled:F.has(r.id),children:F.has(r.id)?e.jsx($,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Zs,{size:14,className:"mr-1"})," Ver"]})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>je(r),disabled:F.has(r.id),children:F.has(r.id)?e.jsx($,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{size:14,className:"mr-1"})," Descargar"]})})]})]},r.id))}):e.jsxs("div",{className:`h-32 border border-dashed ${a.divider} rounded-xl flex flex-col items-center justify-center ${a.textMuted}`,children:[e.jsx(Pe,{size:24,className:"mb-2 opacity-50"}),e.jsx("span",{className:"text-xs",children:"No hay documentos disponibles"})]})})()]})}),j==="Restau."&&e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(is,{size:18,className:a.textMuted}),e.jsx("h3",{className:`text-lg font-bold ${a.textMain}`,children:"Restaurantes cercanos"})]}),B||o?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx($,{className:"h-8 w-8 animate-spin text-blue-500 mb-2"}),e.jsx("p",{className:`text-sm ${a.textMuted}`,children:"Buscando restaurantes cercanos..."})]}):V&&V.length>0?e.jsx("div",{className:"space-y-3",children:V.map(i=>e.jsx("div",{className:`p-4 rounded-xl border ${m?"bg-[#0f1219] border-[#1f232e]":"bg-slate-50 border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-bold text-sm ${a.textMain} break-words`,children:i.name}),e.jsx("p",{className:`text-xs ${a.textMuted} mt-1 break-words`,children:i.address}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 flex-wrap",children:[i.rating&&e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${m?"bg-amber-500/20 text-amber-400":"bg-amber-100 text-amber-700"}`,children:["â­ ",i.rating]}),i.priceLevel!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${m?"bg-emerald-500/20 text-emerald-400":"bg-emerald-100 text-emerald-700"}`,children:"â‚¬".repeat(i.priceLevel+1)}),i.distance&&e.jsxs("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold ${m?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:["A ",Math.round(i.distance)," m"]})]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[i.phone&&e.jsx("a",{href:`tel:${i.phone}`,className:`p-2 rounded-lg border ${a.divider} hover:bg-white/5`,children:e.jsx(Ys,{size:14,className:a.textMuted})}),i.website&&e.jsx("a",{href:i.website,target:"_blank",rel:"noopener noreferrer",className:`p-2 rounded-lg border ${a.divider} hover:bg-white/5`,children:e.jsx(ts,{size:14,className:a.textMuted})})]})]})},i.id))}):e.jsxs("div",{className:`h-48 border border-dashed ${a.divider} rounded-xl flex flex-col items-center justify-center ${a.textMuted}`,children:[e.jsx(is,{size:32,className:"mb-2 opacity-50"}),e.jsx("span",{className:"text-sm",children:(Re=s==null?void 0:s.locations)!=null&&Re.formatted_address||(be=s==null?void 0:s.locations)!=null&&be.name?"No se encontraron restaurantes cercanos":"No hay direcciÃ³n del recinto para buscar restaurantes"}),e.jsxs(v,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>{var r,l,p;const i=((r=s==null?void 0:s.locations)==null?void 0:r.formatted_address)||((l=s==null?void 0:s.locations)==null?void 0:l.name)||((p=t==null?void 0:t.location)==null?void 0:p.name)||"";window.open(`https://www.google.com/maps/search/restaurants+near+${encodeURIComponent(i)}`,"_blank")},children:[e.jsx(ts,{size:14,className:"mr-2"})," Buscar en Google Maps"]})]})]}),j==="Clima"&&e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{size:18,className:a.textMuted}),e.jsx("h3",{className:`text-lg font-bold ${a.textMain}`,children:"PronÃ³stico del Tiempo"})]}),!B&&g.address&&c&&e.jsxs(v,{variant:"outline",size:"sm",onClick:X,disabled:A,children:[A?e.jsx($,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(Ze,{size:14,className:"mr-1"}),A?"Cargando...":"Actualizar"]})]}),B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{className:"h-8 w-8 animate-spin text-blue-500"})}):!g.address&&!g.coordinates?e.jsxs("div",{className:`flex items-center gap-2 text-sm ${a.textMuted} py-4`,children:[e.jsx(Ne,{size:16}),"El pronÃ³stico del tiempo requiere ubicaciÃ³n del lugar"]}):c?y?e.jsxs("div",{className:`flex items-center gap-2 text-sm py-4 ${m?"text-red-400":"text-red-600"}`,children:[e.jsx(Ne,{size:16}),y]}):A?e.jsxs("div",{className:`flex items-center gap-2 text-sm ${a.textMuted} py-4`,children:[e.jsx($,{className:"h-4 w-4 animate-spin"}),"Obteniendo pronÃ³stico del tiempo..."]}):H&&H.length>0?e.jsxs("div",{className:"space-y-2",children:[H.map((i,r)=>e.jsx("div",{className:`flex items-center justify-between p-4 rounded-xl ${m?"bg-white/5":"bg-slate-100"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:fe(i.condition)}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-bold text-sm ${a.textMain}`,children:[ge(i.date)," â€“ ",i.condition]}),e.jsxs("div",{className:`text-xs ${a.textMuted}`,children:[Math.round(i.maxTemp),"Â°C / ",Math.round(i.minTemp),"Â°C",i.precipitationProbability>0&&e.jsxs("span",{children:[", ",i.precipitationProbability,"% lluvia"]})]})]})]})},r)),e.jsxs("div",{className:`text-xs ${a.textMuted} mt-4`,children:[e.jsx("strong",{children:"Fuente:"})," Los datos del tiempo se obtienen de Open-Meteo y se actualizan automÃ¡ticamente."]})]}):e.jsxs("div",{className:`h-48 border border-dashed ${a.divider} rounded-xl flex flex-col items-center justify-center ${a.textMuted}`,children:[e.jsx(ns,{size:32,className:"mb-2 opacity-50"}),e.jsx("span",{className:"text-sm text-center",children:"Datos del tiempo no disponibles para las fechas y ubicaciÃ³n seleccionadas."}),e.jsxs(v,{variant:"outline",size:"sm",className:"mt-4",onClick:X,disabled:A,children:[e.jsx(Ze,{size:14,className:"mr-2"})," Obtener pronÃ³stico"]})]}):e.jsxs("div",{className:`flex items-center gap-2 text-sm ${a.textMuted} py-4`,children:[e.jsx(Ne,{size:16}),"El pronÃ³stico del tiempo requiere fechas del evento"]})]}),j==="Tarifas"&&Me&&h&&e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(rs,{size:18,className:a.textMuted}),e.jsx("h3",{className:`text-lg font-bold ${a.textMain}`,children:"Tarifas del Tour"})]}),e.jsx("div",{className:`${m?"bg-[#0f1219] border-[#1f232e]":"bg-slate-50 border-slate-200"} border rounded-lg p-4 w-full min-w-0 overflow-hidden`,children:e.jsx(qs,{jobId:h})})]}),j==="Extras"&&Ce&&h&&e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-right-4 duration-300 min-w-0 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(rs,{size:18,className:a.textMuted}),e.jsx("h3",{className:`text-lg font-bold ${a.textMain}`,children:"Extras y Pagos"})]}),e.jsx("div",{className:`${m?"bg-[#0f1219] border-[#1f232e]":"bg-slate-50 border-slate-200"} border rounded-lg p-4 w-full min-w-0 overflow-hidden`,children:e.jsx(Ks,{jobId:h})})]})]})]})})},xt=({open:a,onOpenChange:m,job:t,department:k,userRole:se})=>{const E=t==null?void 0:t.id,{toast:j}=fs(),[P,F]=n.useState(null),[C,H]=n.useState(""),[_,W]=n.useState(!1),[w,q]=n.useState(null),[K,N]=n.useState(!1),J=["admin","management","house_tech"].includes(se||""),M=n.useMemo(()=>bs(k)||[],[k]);n.useEffect(()=>{M.length>0&&H(M[0].code)},[M]);const{assignments:T,isLoading:G,isRefreshing:s,refetch:B,addAssignment:h,removeAssignment:re,isRemoving:Q}=st(E),{data:f}=Le({queryKey:["mobile-job-meta",E],enabled:a&&!!E,queryFn:async()=>{const{data:o,error:c}=await U.from("jobs").select("id, start_time, end_time, job_date_types(date, type)").eq("id",E).single();if(c)throw c;return o}}),I=n.useMemo(()=>{if(!f)return[];const o=Array.isArray(f.job_date_types)?f.job_date_types.filter(c=>c==null?void 0:c.date).filter(c=>{const g=((c==null?void 0:c.type)||"").toLowerCase();return g!=="off"&&g!=="travel"}).map(c=>{const g=new Date(`${c.date}T00:00:00`);return g.setHours(0,0,0,0),g}):[];if(o.length>0)return o.sort((c,g)=>c.getTime()-g.getTime());if(f.start_time){const c=new Date(f.start_time);if(c.setHours(0,0,0,0),f.end_time){const g=new Date(f.end_time);return g.setHours(0,0,0,0),at({start:c,end:g})}return[c]}return[]},[f]);n.useEffect(()=>{if(!_){q(null);return}_&&I.length>0&&(!w||!I.some(o=>o.getTime()===w.getTime()))&&q(I[0])},[_,I,w]);const{technicians:S=[],isLoading:L}=$s({department:k,jobId:E||"",jobStartTime:(f==null?void 0:f.start_time)||(t==null?void 0:t.start_time)||"",jobEndTime:(f==null?void 0:f.end_time)||(t==null?void 0:t.end_time)||"",assignmentDate:_&&w?z(w,"yyyy-MM-dd"):null,enabled:a&&!!E}),Z=async()=>{if(J){if(!P){j({title:"Selecciona un tÃ©cnico",description:"Elige un tÃ©cnico disponible antes de asignar",variant:"destructive"});return}if(!C){j({title:"Selecciona un rol",description:"Elige un rol para la asignaciÃ³n",variant:"destructive"});return}N(!0);try{await h(P,k==="sound"?C:"none",k==="lights"?C:"none",{singleDay:_,singleDayDate:_&&w?z(w,"yyyy-MM-dd"):null}),F(null)}finally{N(!1)}}},V=n.useMemo(()=>{if(!(t!=null&&t.start_time))return"";const o=z(new Date(t.start_time),"HH:mm"),c=t.end_time?z(new Date(t.end_time),"HH:mm"):null;return c?`${o} - ${c}`:o},[t]);return e.jsx(we,{open:a,onOpenChange:m,children:e.jsx(ye,{className:"p-0 border-none bg-transparent shadow-none",children:e.jsxs("div",{className:"bg-[#05070a] text-white rounded-2xl border border-[#1f232e] w-[95vw] max-w-xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#1f232e]",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-[0.08em]",children:"Asignaciones"}),e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:t==null?void 0:t.title}),e.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-1 mt-1",children:[e.jsx(gs,{className:"h-3 w-3"}),t!=null&&t.start_time?z(new Date(t.start_time),"d 'de' MMMM yyyy",{locale:pe}):"Fecha sin definir",V&&` â€¢ ${V}`]})]}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 rounded-full bg-white/5 hover:bg-white/10 text-slate-300",children:e.jsx(us,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Departamento: ",k]}),e.jsxs(v,{variant:"ghost",size:"sm",className:"text-slate-200 hover:bg-white/10",onClick:B,disabled:s||G,children:[e.jsx(Ze,{className:`h-4 w-4 mr-1 ${s?"animate-spin":""}`}),"Actualizar"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(tt,{className:"h-4 w-4 text-slate-300"}),e.jsx("h4",{className:"text-sm font-semibold",children:"Asignaciones actuales"}),e.jsx(Oe,{variant:"outline",className:"text-[10px] bg-white/5 border-white/10 text-slate-200",children:T.length})]}),G?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx($,{className:"h-5 w-5 animate-spin text-blue-400"})}):T.length===0?e.jsx("div",{className:"text-xs text-slate-500 border border-dashed border-white/10 rounded-lg p-4 text-center",children:"No hay asignaciones para este trabajo."}):e.jsx("div",{className:"space-y-2",children:T.map(o=>{var X,te;const c=`${((X=o.profiles)==null?void 0:X.first_name)??""} ${((te=o.profiles)==null?void 0:te.last_name)??""}`.trim()||"TÃ©cnico",g=k==="sound"?o.sound_role:o.lights_role||o.video_role,A=hs(g)||"Asignado",y=o.single_day&&o.assignment_date?z(new Date(`${o.assignment_date}T00:00:00`),"d 'de' MMM",{locale:pe}):null;return e.jsxs("div",{className:"border border-white/10 rounded-lg p-3 bg-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold",children:c}),e.jsx("p",{className:"text-xs text-slate-400",children:A}),y&&e.jsxs("p",{className:"text-[11px] text-amber-400 mt-1",children:["Solo ",y]})]}),J&&e.jsx(v,{variant:"ghost",size:"sm",className:"text-red-300 hover:bg-red-500/10",onClick:()=>re(o.technician_id),disabled:Q[o.technician_id],children:Q[o.technician_id]?e.jsx($,{className:"h-4 w-4 animate-spin"}):"Eliminar"})]},o.technician_id)})})]}),J&&e.jsxs("div",{className:"space-y-3 border-t border-white/10 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-slate-300"}),e.jsx("h4",{className:"text-sm font-semibold",children:"Agregar tÃ©cnico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-400",children:"TÃ©cnico disponible"}),e.jsxs(Ge,{value:P||void 0,onValueChange:o=>F(o),children:[e.jsx(Be,{className:"bg-white/5 border-white/10 text-white",children:e.jsx(Qe,{placeholder:L?"Cargando...":"Selecciona un tÃ©cnico"})}),e.jsxs(We,{className:"max-h-60",children:[L&&e.jsx(me,{value:"loading",disabled:!0,children:"Cargando..."}),!L&&S.length===0&&e.jsx(me,{value:"none",disabled:!0,children:"No hay tÃ©cnicos disponibles"}),S.map(o=>e.jsxs(me,{value:o.id,children:[o.first_name," ",o.last_name," ",o.role==="house_tech"?"(House)":""]},o.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-400",children:"Rol"}),e.jsxs(Ge,{value:C,onValueChange:H,children:[e.jsx(Be,{className:"bg-white/5 border-white/10 text-white",children:e.jsx(Qe,{placeholder:"Selecciona un rol"})}),e.jsx(We,{className:"max-h-60",children:M.map(o=>e.jsx(me,{value:o.code,children:o.label},o.code))})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-white/10 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Asignar un solo dÃ­a"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Elige una fecha especÃ­fica si aplica"})]}),e.jsx(et,{checked:_,onCheckedChange:W})]}),_&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-400",children:"Fecha de asignaciÃ³n"}),e.jsxs(Ge,{value:w?z(w,"yyyy-MM-dd"):void 0,onValueChange:o=>q(new Date(`${o}T00:00:00`)),children:[e.jsx(Be,{className:"bg-white/5 border-white/10 text-white",children:e.jsx(Qe,{placeholder:"Selecciona una fecha"})}),e.jsxs(We,{className:"max-h-60",children:[I.length===0&&e.jsx(me,{value:"none",disabled:!0,children:"No hay fechas disponibles"}),I.map(o=>{const c=z(o,"yyyy-MM-dd"),g=z(o,"d 'de' MMMM",{locale:pe});return e.jsx(me,{value:c,children:g},c)})]})]})]}),e.jsx(v,{className:"w-full bg-blue-600 hover:bg-blue-500 text-white",onClick:Z,disabled:K||L||!P,children:K?e.jsx($,{className:"h-4 w-4 animate-spin"}):"Asignar tÃ©cnico"})]})]})]})})})},ut=n.lazy(()=>Fe(()=>import("./ReportGenerator-DPElJEEl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(a=>({default:a.ReportGenerator}))),ht=n.lazy(()=>Fe(()=>import("./AmplifierTool-B8XV4xmK.js"),__vite__mapDeps([15,1,2,3,4,16,12,8,14,5,17,18,19])).then(a=>({default:a.AmplifierTool}))),ft=n.lazy(()=>Fe(()=>import("./MemoriaTecnica-DjPWBBU7.js"),__vite__mapDeps([20,1,2,3,4,21,11,12,13,22,10,23,24,25,26])).then(a=>({default:a.MemoriaTecnica}))),gt=n.lazy(()=>Fe(()=>import("./IncidentReport-dhJRF0MZ.js"),__vite__mapDeps([27,1,2,3,4,28,29,6,7,30,31,32,33,34,18,19,25])).then(a=>({default:a.IncidentReport}))),Ie=e.jsx("div",{className:"flex items-center justify-center py-6 text-sm text-muted-foreground",children:"Cargandoâ€¦"}),Dn=()=>{const a=ws(),m=ys(),[t,k]=n.useState(!1),[se,E]=n.useState(!1),[j,P]=n.useState(void 0),[F,C]=n.useState(!1),[H,_]=n.useState(!1),[W,w]=n.useState(null),[q,K]=n.useState(null),[N,J]=n.useState(new Date),[M,T]=n.useState(!1),[G,s]=n.useState(!1),[B,h]=n.useState(!1),[re,Q]=n.useState(!1),[f,I]=n.useState(!1),[S,L]=n.useState(!1),[Z,V]=n.useState(null),[o,c]=n.useState(null),[g,A]=n.useState(!1),y="sound",X=N??new Date,te=rt(lt(X),7),qe=ot(dt(X),14),{data:xe=[]}=Ss(y,te,qe),{toast:le}=fs(),je=xs(),{userRole:b,hasSoundVisionAccess:x,userDepartment:oe}=Ns(),de=n.useMemo(()=>Ls({userRole:b,userDepartment:oe,hasSoundVisionAccess:x}),[b,oe,x]),O=n.useMemo(()=>de.length<=1?de:[...de].sort((d,u)=>(d.mobilePriority??99)-(u.mobilePriority??99)),[de]),ae=n.useMemo(()=>Os({items:O,userDepartment:oe,userRole:b}),[O,oe,b]),Me=n.useMemo(()=>{if(!O.length)return[];const d=new Set(ae.map(u=>u.id));return O.filter(u=>!d.has(u.id))},[O,ae]),Ce=n.useMemo(()=>({bg:"bg-[#05070a]",card:"bg-[#0f1219] border-[#1f232e]",textMain:"text-white",textMuted:"text-[#94a3b8]",divider:"border-[#1f232e]",toolBg:"bg-[#151820] border-[#2a2e3b]",accent:"bg-blue-600 text-white",modalOverlay:"bg-black/90 backdrop-blur-md"}),[]),Ve=async()=>{if(!t){k(!0);try{await U.auth.signOut(),a("/auth")}catch{}finally{k(!1)}}},ie=n.useCallback(()=>T(!0),[]),ue=n.useCallback(()=>s(!0),[]),he=n.useCallback(()=>h(!0),[]),fe=n.useCallback(()=>Q(!0),[]),ge=n.useCallback(()=>I(!0),[]),_e=n.useCallback(()=>a("/pesos-tool"),[a]),Se=n.useCallback(()=>a("/consumos-tool"),[a]),$e=n.useCallback(()=>a("/soundvision-files"),[a]),ke=n.useCallback(()=>{},[]),ce=n.useCallback(d=>{P(d),E(!0)},[]),ve=n.useCallback(()=>{ce(void 0)},[ce]),Te=n.useCallback(()=>a("/personal"),[a]),Ae=n.useMemo(()=>[{label:"Pesos",to:"/pesos-tool",icon:it,color:"text-pink-500"},{label:"Consumos",to:"/consumos-tool",icon:ls,color:"text-purple-500"},{label:"SV Report",onClick:ie,icon:Pe,color:"text-blue-500"},{label:"Amplifier",onClick:ue,icon:os,color:"text-orange-500"},{label:"Memoria",onClick:he,icon:ms,color:"text-cyan-500"},{label:"Incident",onClick:fe,icon:Ne,color:"text-red-500"},{label:x?"SoundVision":"Request Access",to:x?"/soundvision-files":void 0,onClick:x?void 0:ge,icon:x?ds:cs,color:"text-indigo-500"}],[x,ue,fe,he,ie,ge]);n.useEffect(()=>{const d=u=>{const R=document.activeElement;if(!!R&&(R.tagName==="INPUT"||R.tagName==="TEXTAREA"||R.isContentEditable))return;u.key.toLowerCase()==="n"&&(u.metaKey||u.ctrlKey)&&(u.preventDefault(),P(void 0),E(!0))};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[]);const Y=n.useMemo(()=>xe.filter(d=>{var u;return d.job_type==="tour"?!1:(u=d.job_departments)==null?void 0:u.some(R=>R.department===y)}),[xe,y]),Re=n.useMemo(()=>{if(!N)return[];const d=es(N);return Y.filter(u=>{const R=es(new Date(u.start_time)),ze=js(new Date(u.end_time));return ct(d,{start:R,end:ze})})},[N,Y]),be=n.useCallback(d=>{if(m){const u=Y.find(R=>R.id===d)||null;c(u),A(!0),w(d);return}w(d),C(!0)},[Y,m]),i=n.useCallback(d=>{K(d),_(!0)},[]),r=n.useCallback(async d=>{if(!["admin","management"].includes(b||"")){le({title:"Permission denied",description:"Only admin and management users can delete jobs",variant:"destructive"});return}if(window.confirm("Are you sure you want to delete this job? This action cannot be undone and will remove all related data."))try{const u=await Js(d);if(u.success)le({title:"Job deleted",description:u.details||"The job has been removed and cleanup is running in background."}),await je.invalidateQueries({queryKey:["optimized-jobs"]});else throw new Error(u.error||"Unknown deletion error")}catch(u){le({title:"Error deleting job",description:u.message,variant:"destructive"})}},[je,le,b]),l=n.useCallback(d=>{V(d),L(!0)},[]),p=n.useCallback(d=>{c(d),w((d==null?void 0:d.id)||null),A(!0)},[]),D=n.useCallback(d=>{w(d.id),m?(c(d),A(!0)):C(!0)},[m]),ee=n.useCallback(d=>{L(d),d||V(null)},[]),De=n.useCallback(()=>{L(!1),V(null)},[]),Ue=n.useCallback(()=>{C(!1)},[]),He=n.useCallback(()=>{},[]),Ke=n.useCallback(d=>{_(d),d||K(null)},[]);return e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[m&&e.jsxs("div",{className:"p-4 pb-24 space-y-4",children:[e.jsx(As,{department:y,title:"Departamento de sonido",icon:nt,tools:Ae,jobs:xe,date:N??new Date,onDateSelect:d=>J(d),canCreateJob:b?["admin","management"].includes(b):!1,onCreateJob:ve,userRole:b,onEditJob:i,onDeleteJob:r,onJobClick:be,onViewDetails:l,onManageAssignments:p,onStaffClick:Te}),e.jsx(Ps,{primaryItems:ae,trayItems:Me,onSignOut:Ve,isLoggingOut:t})]}),!m&&e.jsx("div",{className:"p-4 md:p-8",children:e.jsxs("div",{className:"mx-auto w-full max-w-full space-y-6",children:[e.jsx(Rs,{onCreateJob:ce,department:"Sound",canCreate:b?["admin","management"].includes(b):!0}),e.jsx("div",{className:"bg-card border border-border rounded-xl p-3 sm:p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 items-center justify-end",children:[e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:_e,children:[e.jsx(ls,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Weight Calculator"]}),e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:Se,children:[e.jsx(mt,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Power Calculator"]}),e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:ie,children:[e.jsx(Pe,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"SV Report"]}),e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:ue,children:[e.jsx(os,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Amplifier"]}),e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:he,children:[e.jsx(ms,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Memoria TÃ©cnica"]}),e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:fe,children:[e.jsx(Ne,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Incident Report"]}),x?e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:$e,children:[e.jsx(ds,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"SoundVision"]}):e.jsxs(v,{variant:"outline",size:"lg",className:"h-auto py-2 sm:py-3",onClick:ge,children:[e.jsx(cs,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Request Access"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-6",children:[e.jsx("div",{className:"xl:col-span-8 2xl:col-span-9",children:e.jsx(Ms,{className:"bg-card border-border text-foreground",children:e.jsx(Cs,{className:"p-0",children:e.jsx(Es,{date:N,onDateSelect:J,jobs:Y,department:y,onDateTypeChange:ke})})})}),e.jsx("div",{className:"xl:col-span-4 2xl:col-span-3",children:e.jsx("div",{className:"bg-card rounded-xl border border-border shadow-sm",children:e.jsx(zs,{jobs:Re,onEditClick:i,onDeleteClick:r,onJobClick:be,userRole:b,selectedDate:N,detailsOnlyMode:b?["admin","management","house_tech"].includes(b):!1,department:y,viewMode:"sidebar"})})})]}),e.jsx(v,{className:"sm:hidden fixed bottom-6 right-6 rounded-full h-12 w-12 p-0 shadow-lg",onClick:ve,children:e.jsx(vs,{className:"h-6 w-6"})})]})}),se&&e.jsx(_s,{open:se,onOpenChange:E,currentDepartment:y,initialDate:N,initialJobType:j,onCreated:D}),!m&&W&&F?e.jsx(ks,{isOpen:F,onClose:Ue,onAssignmentChange:He,jobId:W,department:y}):null,q&&H?e.jsx(Ts,{open:H,onOpenChange:Ke,job:q}):null,M?e.jsx(we,{open:M,onOpenChange:T,children:e.jsxs(ye,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ee,{children:e.jsx(Je,{children:"Generador de Reportes"})}),e.jsx(n.Suspense,{fallback:Ie,children:e.jsx(ut,{})})]})}):null,G?e.jsx(we,{open:G,onOpenChange:s,children:e.jsxs(ye,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ee,{children:e.jsx(Je,{children:"Calculadora de Amplificadores"})}),e.jsx(n.Suspense,{fallback:Ie,children:e.jsx(ht,{})})]})}):null,B?e.jsx(we,{open:B,onOpenChange:h,children:e.jsxs(ye,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ee,{children:e.jsx(Je,{children:"Memoria TÃ©cnica"})}),e.jsx(n.Suspense,{fallback:Ie,children:e.jsx(ft,{})})]})}):null,re?e.jsx(we,{open:re,onOpenChange:Q,children:e.jsxs(ye,{className:"w-[95vw] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ee,{children:e.jsx(Je,{children:"Reporte de Incidencia"})}),e.jsx(n.Suspense,{fallback:Ie,children:e.jsx(gt,{})})]})}):null,f?e.jsx(Is,{open:f,onOpenChange:I}):null,m&&Z&&S&&e.jsx(pt,{theme:Ce,isDark:!0,job:Z,onClose:De,userRole:b,department:y}),!m&&Z&&S?e.jsx(Vs,{open:S,onOpenChange:ee,job:Z,department:y}):null,m&&o&&e.jsx(xt,{open:g,onOpenChange:d=>{A(d),d||c(null)},job:o,department:y,userRole:b})]})};export{Dn as default};
