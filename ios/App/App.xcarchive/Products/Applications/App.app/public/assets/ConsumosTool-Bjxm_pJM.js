const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/logoUtils-D2o1jUVg.js","assets/index-NZ6jJLfQ.js","assets/vite-preload-helper-ckwbz45p.js","assets/commonjs-helpers-Cpj98o6Y.js","assets/index-DFO7exW2.css","assets/logo-url-cache-eY6nfvu7.js","assets/jobDocumentsUpload-BaycvzFe.js","assets/taskAutoCompletion-DInRlPJM.js","assets/taskCompletion-NTcmWFA_.js"])))=>i.map(i=>d[i]);
import{_ as Y}from"./vite-preload-helper-ckwbz45p.js";import{j as e,B as y,L as P,S as U,t as q,v as M,w as H,x as C,I,c as Ke,e as Ze,b as et,r as h,C as tt,A as st,V as we,s as ae}from"./index-NZ6jJLfQ.js";import{C as Te}from"./checkbox-BsRNEGV1.js";import{B as J}from"./badge-vNTKF5RD.js";import{e as at}from"./pdfExport-DjZPdCcG.js";import{u as rt}from"./useJobSelection-B9iLNF5-.js";import{u as nt}from"./useTourPowerDefaults-COrAOuj-.js";import{u as ot}from"./useTourDateOverrides-CHDvO8ks.js";import{u as lt}from"./useTourDefaultSets-CKjECdAO.js";import{A as dt}from"./arrow-left-VpQwT4cv.js";import{F as it}from"./file-text-igU140SQ.js";import{S as ct}from"./square-pen-BMpSgZGa.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./lazyPdf-xVUlxKNu.js";import"./useQuery-kdg2pmgf.js";import"./useMutation-DluhVBs1.js";const Ne=({table:d,pduTypes:i,safetyMargin:g,phaseMode:F,onRemove:b,onUpdateSettings:x})=>{var l,j,A;const W=d.id??d.name;return e.jsxs("div",{className:"border rounded-lg overflow-hidden mt-6",children:[e.jsxs("div",{className:"bg-muted px-4 py-3 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsx(y,{variant:"destructive",size:"sm",onClick:b,children:"Remove Table"})]}),e.jsx("div",{className:"p-4 bg-muted/50 space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{id:`hoist-${W}`,checked:d.includesHoist,onCheckedChange:r=>x({includesHoist:!!r})}),e.jsx(P,{htmlFor:`hoist-${W}`,className:"text-sm",children:"Requires additional hoist power (CEE32A 3P+N+G)"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx(P,{className:"text-sm whitespace-nowrap",children:"PDU Type Override:"}),e.jsxs(U,{value:d.customPduType?i.includes(d.customPduType)?d.customPduType:"custom":"default",onValueChange:r=>{x(r==="default"?{customPduType:void 0}:r==="custom"?{customPduType:""}:{customPduType:r})},children:[e.jsx(q,{className:"w-full sm:w-[220px]",children:e.jsx(M,{placeholder:"Use recommended PDU type"})}),e.jsxs(H,{children:[e.jsxs(C,{value:"default",children:["Use recommended (",d.pduType,")"]}),i.map(r=>e.jsx(C,{value:r,children:r},r)),e.jsx(C,{value:"custom",children:"Custom PDU Type"})]})]}),d.customPduType!==void 0&&!i.includes(d.customPduType||"")&&e.jsx(I,{placeholder:"Enter custom PDU type",value:d.customPduType||"",onChange:r=>x({customPduType:r.target.value}),className:"w-full sm:w-[220px]"})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Component"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Watts (per unit)"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Total Watts"})]})}),e.jsxs("tbody",{children:[d.rows.map((r,O)=>{var D;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:r.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.componentName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.watts}),e.jsx("td",{className:"px-4 py-3 text-sm",children:(D=r.totalWatts)==null?void 0:D.toFixed(2)})]},O)}),e.jsxs("tr",{className:"border-t bg-muted/50 font-medium",children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right text-sm",children:"Total Watts:"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[(l=d.totalWatts)==null?void 0:l.toFixed(2)," W"]})]}),g>0&&e.jsxs("tr",{className:"border-t bg-muted/50 font-medium",children:[e.jsxs("td",{colSpan:3,className:"px-4 py-3 text-right text-sm",children:["Adjusted Watts (",g,"% safety margin):"]}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[(j=d.adjustedWatts)==null?void 0:j.toFixed(2)," W"]})]}),e.jsxs("tr",{className:"border-t bg-muted/50 font-medium",children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right text-sm",children:F==="three"?"Current per Phase:":"Current:"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[(A=d.currentPerPhase)==null?void 0:A.toFixed(2)," A"]})]}),e.jsxs("tr",{className:"border-t bg-muted/50 font-medium",children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right text-sm",children:"PDU Type:"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:d.customPduType||d.pduType})]}),d.includesHoist&&e.jsx("tr",{className:"border-t bg-muted/50 font-medium",children:e.jsx("td",{colSpan:4,className:"px-4 py-3 text-sm",children:"Additional Hoist Power Required: CEE32A 3P+N+G"})})]})]})})]})},re=[{id:1,name:"LA12X",watts:2e3},{id:2,name:"LA8",watts:1500},{id:3,name:"LA4X",watts:750},{id:4,name:"PLM20000D",watts:2900},{id:5,name:"Control FoH (L)",watts:3500},{id:6,name:"Control FoH (S)",watts:1500},{id:7,name:"Control Mon (L)",watts:3500},{id:8,name:"Control Mon (S)",watts:1500},{id:9,name:"RF Rack",watts:2500},{id:10,name:"Backline",watts:2500},{id:11,name:"Varios",watts:1500}],Ct=()=>{const d=Ke(),{toast:i}=Ze(),{data:g}=rt(),[F]=et(),b=F.get("jobId"),x=F.get("tourId"),W=F.get("mode"),l=W==="tour-defaults"||W==="defaults",[j,A]=h.useState(""),[r,O]=h.useState(null),[D,X]=h.useState(""),[v,V]=h.useState([]),[ne,_e]=h.useState(!0),[f,Pe]=h.useState(20),[K,oe]=h.useState(null),[u,be]=h.useState("three"),[w,Se]=h.useState(.95),[N,le]=h.useState(400);h.useEffect(()=>{le(u==="single"?230:400)},[u]);const T=!!(r!=null&&r.tour_date_id),Z=r==null?void 0:r.tour_date_id,[$,Ce]=h.useState(""),{defaultSets:De,defaultTables:Ee,createSet:Ie,createTable:Fe,updateTable:de}=lt(x||""),{powerDefaults:We=[]}=nt(x||""),{powerOverrides:Ae=[],createPowerOverride:Oe,updatePowerOverride:ie,deleteOverride:ke,isCreatingOverride:Re}=ot(Z||"","power"),[ee,E]=h.useState({name:"",rows:[{quantity:"",componentId:"",watts:""}]});h.useEffect(()=>{(async()=>{if(b)try{A(b);const s=(g||[]).find(n=>n.id===b)||null;if(s){O(s);return}const{data:a}=await ae.from("jobs").select("id, title, start_time, end_time, tour_date_id, date, location").eq("id",b).single();a&&O(a)}catch{}})()},[b,g]);const Le=async()=>{const t=De.find(a=>a.department==="sound");return t?t.id:(await Ie({tour_id:x,name:`${$} Sound Defaults`,department:"sound",description:"Sound department power defaults"})).id},Ue=()=>{E(t=>({...t,rows:[...t.rows,{quantity:"",componentId:"",watts:""}]}))},qe=t=>{E(s=>{const a=s.rows.filter((n,o)=>o!==t);return{...s,rows:a.length>0?a:[{quantity:"",componentId:"",watts:""}]}})},ce=(t,s,a)=>{const n=[...ee.rows];if(s==="componentId"&&a){const o=re.find(p=>p.id.toString()===a);n[t]={...n[t],[s]:a,watts:o?o.watts.toString():""}}else n[t]={...n[t],[s]:a};E(o=>({...o,rows:n}))},Me=t=>{A(t);const s=(g==null?void 0:g.find(a=>a.id===t))||null;O(s)},He=Math.sqrt(3),Ve=t=>{const s=t*(1+f/100),a=u==="single"?s/(N*w):s/(He*N*w);return{adjustedWatts:s,currentLine:a}},k=["CEE16A 3P+N+G","CEE32A 3P+N+G","CEE63A 3P+N+G","CEE125A 3P+N+G"],G=["Schuko 16A","CEE32A 1P+N+G","CEE63A 1P+N+G"],ue=u==="single"?G:k,R=t=>t*.8,$e=t=>u==="single"?t<=R(16)?G[0]:t<=R(32)?G[1]:G[2]:t<=R(16)?k[0]:t<=R(32)?k[1]:t<=R(63)?k[2]:k[3],me=async t=>{try{const{error:s}=await ae.from("power_requirement_tables").insert({job_id:j,department:"sound",table_name:t.name,total_watts:t.totalWatts||0,current_per_phase:t.currentPerPhase||0,pdu_type:t.customPduType||t.pduType||"",custom_pdu_type:t.customPduType,includes_hoist:t.includesHoist||!1});if(s)throw s;i({title:"Success",description:"Power requirement table saved successfully"})}catch{i({title:"Error",description:"Failed to save power requirement table",variant:"destructive"})}},Ge=async t=>{if(Z)try{await Oe({tour_date_id:Z,table_name:t.name,total_watts:t.totalWatts||0,current_per_phase:t.currentPerPhase||0,pdu_type:t.customPduType||t.pduType||"",custom_pdu_type:t.customPduType,includes_hoist:t.includesHoist||!1,department:"sound",override_data:{rows:t.rows,safetyMargin:f,pf:w,phaseMode:u,voltage:N}}),i({title:"Success",description:"Tour override saved successfully"})}catch{i({title:"Error",description:"Failed to save tour override",variant:"destructive"})}},Be=async t=>{try{await ke({id:t,table:"power"}),i({title:"Success",description:"Override deleted successfully"})}catch{i({title:"Error",description:"Failed to delete override",variant:"destructive"})}},ze=t=>{var s;X(t.table_name),oe(t.id),(s=t.override_data)!=null&&s.rows?E({name:t.table_name,rows:t.override_data.rows}):E({name:t.table_name,rows:[{quantity:"1",componentId:"",watts:t.total_watts.toString()}]})},Qe=async()=>{if(!D){i({title:"Missing table name",description:"Please enter a name for the table",variant:"destructive"});return}const t=ee.rows.map(c=>{const S=re.find(Q=>Q.id.toString()===c.componentId),z=parseFloat(c.quantity||"0")&&parseFloat(c.watts||"0")?parseFloat(c.quantity)*parseFloat(c.watts):0;return{...c,componentName:(S==null?void 0:S.name)||"",totalWatts:z}}),s=t.reduce((c,S)=>c+(S.totalWatts||0),0),{currentLine:a,adjustedWatts:n}=Ve(s),o=$e(a),p={name:D,rows:t,totalWatts:s,adjustedWatts:n,currentPerPhase:a,pduType:o,customPduType:"",includesHoist:!1,id:Date.now(),isDefault:!1,defaultTableId:void 0};V(c=>[...c,p]),l||(T?await Ge(p):j&&await me(p)),pe()},pe=()=>{E({name:"",rows:[{quantity:"",componentId:"",watts:""}]}),X(""),oe(null)},he=t=>{V(s=>s.filter(a=>a.id!==t))},Ye=async()=>{const t=v.filter(s=>!s.isDefault&&!s.defaultTableId);if(t.length===0){i({title:"No unsaved tables",description:"All tables have already been saved as defaults"});return}try{const s=await Le();for(let a=0;a<t.length;a++){const n=t[a];a>0&&await new Promise(p=>setTimeout(p,100));const o=await Fe({set_id:s,table_name:n.name,table_data:{rows:n.rows,safetyMargin:f,pf:w,phaseMode:u,voltage:N},table_type:"power",total_value:n.totalWatts||0,metadata:{current_per_phase:n.currentPerPhase,pdu_type:n.customPduType||n.pduType,custom_pdu_type:n.customPduType,includes_hoist:n.includesHoist||!1,safetyMargin:f,pf:w,phaseMode:u,voltage:N,order_index:a}});V(p=>p.map(c=>c.id===n.id?{...c,isDefault:!0,defaultTableId:o.id}:c))}i({title:"Success",description:`${t.length} default table(s) saved successfully`})}catch(s){i({title:"Error",description:`Failed to save some default tables: ${(s==null?void 0:s.message)||"unknown error"}`,variant:"destructive"})}},xe=async(t,s)=>{V(a=>a.map(n=>{if(n.id===t){const o={...n,...s};return l&&n.isDefault&&n.defaultTableId&&de?de({tableId:n.defaultTableId,updates:{table_data:{rows:o.rows,safetyMargin:f,pf:w,phaseMode:u,voltage:N},total_value:o.totalWatts||0,metadata:{current_per_phase:o.currentPerPhase,pdu_type:o.customPduType||o.pduType,custom_pdu_type:o.customPduType,includes_hoist:o.includesHoist||!1,safetyMargin:f,pf:w,phaseMode:u,voltage:N}}}):T&&n.isOverride&&n.overrideId&&ie?ie({id:n.overrideId,data:{total_watts:o.totalWatts||0,current_per_phase:o.currentPerPhase||0,pdu_type:o.customPduType||o.pduType||"",custom_pdu_type:o.customPduType,includes_hoist:o.includesHoist||!1,override_data:{rows:o.rows,safetyMargin:f,pf:w,phaseMode:u,voltage:N}}}):j&&me(o),o}return n}))},Je=async()=>{var t;if(!j&&!l){i({title:"No job selected",description:"Please select a job before exporting.",variant:"destructive"});return}try{const s=v.reduce((m,_)=>m+(_.totalWatts||0),0),a=v.reduce((m,_)=>m+(_.currentPerPhase||0),0),n={totalSystemWatts:s,totalSystemAmps:a};let o;try{if(l&&x){const{fetchTourLogo:m}=await Y(async()=>{const{fetchTourLogo:_}=await import("./logoUtils-D2o1jUVg.js");return{fetchTourLogo:_}},__vite__mapDeps([0,1,2,3,4,5]));o=await m(x)}else if(j){const{fetchJobLogo:m}=await Y(async()=>{const{fetchJobLogo:_}=await import("./logoUtils-D2o1jUVg.js");return{fetchJobLogo:_}},__vite__mapDeps([0,1,2,3,4,5]));o=await m(j)}}catch{}const p=l?`${$} - Sound Power Defaults`:(r==null?void 0:r.title)||"Power Report",c=((t=r==null?void 0:r.location)==null?void 0:t.name)||"",S=c?`${p} - ${c}`:p,z=await at(S,v.map(m=>({...m,toolType:"consumos"})),"power",S,l?new Date().toISOString():(r==null?void 0:r.date)||new Date().toISOString(),void 0,n,f,o,ne),Q=l?`${$} - Sound Power Defaults.pdf`:`Sound Power Report - ${(r==null?void 0:r.title)||"Report"}.pdf`;let te=0;if(j)try{const{uploadJobPdfWithCleanup:m}=await Y(async()=>{const{uploadJobPdfWithCleanup:se}=await import("./jobDocumentsUpload-BaycvzFe.js");return{uploadJobPdfWithCleanup:se}},__vite__mapDeps([6,1,2,3,4]));await m(j,z,Q,"calculators/consumos");const{autoCompleteConsumosTasks:_}=await Y(async()=>{const{autoCompleteConsumosTasks:se}=await import("./taskAutoCompletion-DInRlPJM.js");return{autoCompleteConsumosTasks:se}},__vite__mapDeps([7,8,1,2,3,4])),ye=await _(j,"sound");te=ye.completedCount,ye.completedCount>0}catch(m){if(m instanceof Error&&m.message.includes("uploadJobPdfWithCleanup"))throw m}i({title:"Success",description:l?"PDF has been generated and downloaded successfully.":te>0?`PDF uploaded successfully. ${te} Consumos task(s) auto-completed.`:"PDF has been generated and uploaded successfully."});const ve=window.URL.createObjectURL(z),L=document.createElement("a");L.href=ve,L.download=Q,document.body.appendChild(L),L.click(),window.URL.revokeObjectURL(ve),document.body.removeChild(L)}catch{i({title:"Error",description:"Failed to generate or upload the PDF.",variant:"destructive"})}};h.useEffect(()=>{(async()=>{if(x){const{data:s}=await ae.from("tours").select("name").eq("id",x).single();s&&Ce(s.name)}})()},[x]);const fe=(Ee||[]).filter(t=>t.table_type==="power").map(t=>{var s,a,n,o,p;return{id:`new-default-${t.id}`,name:t.table_name,rows:((s=t.table_data)==null?void 0:s.rows)||[],totalWatts:t.total_value,adjustedWatts:(t.total_value||0)*(1+f/100),currentPerPhase:((a=t.metadata)==null?void 0:a.current_per_phase)||0,pduType:((n=t.metadata)==null?void 0:n.pdu_type)||"",customPduType:((o=t.metadata)==null?void 0:o.custom_pdu_type)||"",includesHoist:((p=t.metadata)==null?void 0:p.includes_hoist)||!1,isDefault:!0,defaultTableId:t.id}}),Xe=We.map(t=>({id:`legacy-default-${t.id}`,name:t.table_name,rows:[],totalWatts:t.total_watts,adjustedWatts:(t.total_watts||0)*(1+f/100),currentPerPhase:t.current_per_phase,pduType:t.pdu_type,customPduType:t.custom_pdu_type,includesHoist:t.includes_hoist,isDefault:!0})),je=fe.length>0?fe:Xe,ge=Ae.map(t=>{var s;return{id:`override-${t.id}`,name:t.table_name,rows:((s=t.override_data)==null?void 0:s.rows)||[],totalWatts:t.total_watts,adjustedWatts:(t.total_watts||0)*(1+f/100),currentPerPhase:t.current_per_phase,pduType:t.pdu_type,customPduType:t.custom_pdu_type,includesHoist:t.includes_hoist,isOverride:!0,overrideId:t.id}}),B=(()=>{var t,s,a;return r!=null&&r.tour_date?{tourName:((t=r.tour_date.tour)==null?void 0:t.name)||"Unknown Tour",tourDate:r.tour_date.date||r.start_time,locationName:((s=r.tour_date.location)==null?void 0:s.name)||((a=r.location)==null?void 0:a.name)||"Unknown Location"}:null})();return e.jsxs("div",{className:"w-full p-4 lg:p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>d("/sound"),children:e.jsx(dt,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Power Calculator"}),l&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(J,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Tour Defaults Mode"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Creating defaults for: ",e.jsx("span",{className:"font-medium",children:$})]})]}),T&&B&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-2",children:[e.jsx(J,{variant:"secondary",children:"Override Mode"}),e.jsxs("p",{children:["Tour: ",B.tourName," • ",B.tourDate," - ",B.locationName]})]})]})]}),v.length>0&&e.jsxs(y,{onClick:Je,variant:"outline",className:"gap-2",children:[e.jsx(it,{className:"h-4 w-4"}),l?"Export PDF":"Export & Upload PDF"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:"lg:col-span-4",children:e.jsx(tt,{children:e.jsx(st,{className:"pt-6",children:e.jsxs("div",{className:"space-y-6",children:[T&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Job Override Mode Active"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This job is part of a tour. Any tables you create will be saved as overrides for the specific tour date."})]}),l&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Tour Defaults Mode Active"})]}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Any tables you create will be saved as global defaults for this tour. These defaults will apply to all tour dates unless specifically overridden."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{id:"foh-schuko",checked:ne,onCheckedChange:t=>_e(!!t)}),e.jsx(P,{htmlFor:"foh-schuko",children:"Se requiere potencia de 16A en formato schuko hembra en posicion FoH"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Supply"}),e.jsxs(U,{value:u,onValueChange:t=>be(t),children:[e.jsx(q,{children:e.jsx(M,{placeholder:"Select supply"})}),e.jsxs(H,{children:[e.jsx(C,{value:"single",children:"Monofásico (230 V)"}),e.jsx(C,{value:"three",children:"Trifásico (400 V LL)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Voltage"}),e.jsx(I,{type:"number",value:N,onChange:t=>le(Number(t.target.value)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"230 V (1φ) o 400 V LL (3φ) por defecto en ES"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Power Factor (PF)"}),e.jsx(I,{type:"number",step:"0.01",min:"0.1",max:"1",value:w,onChange:t=>Se(Math.max(.1,Math.min(1,Number(t.target.value)||.83)))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Usa 0.9 si la PDU mezcla amplificadores nuevos y viejos (p.ej LA8)."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"safetyMargin",children:"Safety Margin"}),e.jsxs(U,{value:f.toString(),onValueChange:t=>Pe(Number(t)),children:[e.jsx(q,{children:e.jsx(M,{placeholder:"Select Safety Margin"})}),e.jsx(H,{children:[0,10,20,30,40,50].map(t=>e.jsxs(C,{value:t.toString(),children:[t,"%"]},t))})]})]}),!T&&!l&&!b&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"jobSelect",children:"Select Job"}),e.jsxs(U,{value:j,onValueChange:Me,children:[e.jsx(q,{children:e.jsx(M,{placeholder:"Select a job"})}),e.jsx(H,{children:g==null?void 0:g.map(t=>e.jsx(C,{value:t.id,children:t.title},t.id))})]})]}),(T||l)&&je.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:l?"Existing Tour Defaults":"Tour Default Tables"}),je.map(t=>{var s,a;return e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-blue-50/30",children:[e.jsx("div",{className:"bg-blue-100 px-4 py-3 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:t.name}),e.jsx(J,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Default"})]})}),e.jsx("div",{className:"p-4 space-y-2 text-sm",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:["Total Watts: ",e.jsxs("span",{className:"font-medium",children:[(s=t.totalWatts)==null?void 0:s.toFixed(2)," W"]})]}),e.jsxs("div",{children:[u==="three"?"Current per Phase":"Current",": ",e.jsxs("span",{className:"font-medium",children:[(a=t.currentPerPhase)==null?void 0:a.toFixed(2)," A"]})]}),e.jsxs("div",{children:["PDU Type: ",e.jsx("span",{className:"font-medium",children:t.customPduType||t.pduType})]}),t.includesHoist&&e.jsx("div",{className:"col-span-1 sm:col-span-2 text-green-700",children:"✓ Includes additional hoist power (CEE32A 3P+N+G)"})]})})]},t.id)})]}),T&&ge.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Existing Overrides"}),ge.map(t=>{var s,a;return e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-orange-50/30",children:[e.jsxs("div",{className:"bg-orange-100 px-4 py-3 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold text-orange-900",children:t.name}),e.jsx(J,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:"Override"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>ze({id:t.overrideId,table_name:t.name,total_watts:t.totalWatts,override_data:{rows:t.rows}}),className:"gap-2",children:[e.jsx(ct,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>t.overrideId&&Be(t.overrideId),className:"gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Delete"]})]})]}),e.jsx("div",{className:"p-4 space-y-2 text-sm",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:["Total Watts: ",e.jsxs("span",{className:"font-medium",children:[(s=t.totalWatts)==null?void 0:s.toFixed(2)," W"]})]}),e.jsxs("div",{children:[u==="three"?"Current per Phase":"Current",": ",e.jsxs("span",{className:"font-medium",children:[(a=t.currentPerPhase)==null?void 0:a.toFixed(2)," A"]})]}),e.jsxs("div",{children:["PDU Type: ",e.jsx("span",{className:"font-medium",children:t.customPduType||t.pduType})]}),t.includesHoist&&e.jsx("div",{className:"col-span-1 sm:col-span-2 text-orange-700",children:"✓ Includes additional hoist power (CEE32A 3P+N+G)"})]})})]},t.id)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"tableName",children:[l?"Default Name":"Table Name"," ",K&&e.jsx("span",{className:"text-orange-600",children:"(Editing Override)"})]}),e.jsx(I,{id:"tableName",value:D,onChange:t=>X(t.target.value),placeholder:l?"Enter default name":"Enter table name"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Component"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-sm",children:"Watts (per unit)"}),e.jsx("th",{className:"w-12 px-4 py-3 text-left font-medium text-sm",children:" "})]})}),e.jsx("tbody",{children:ee.rows.map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-4",children:e.jsx(I,{type:"number",value:t.quantity,onChange:a=>ce(s,"quantity",a.target.value),min:"0",className:"w-full min-w-[100px]"})}),e.jsx("td",{className:"p-4",children:e.jsxs(U,{value:t.componentId,onValueChange:a=>a&&ce(s,"componentId",a),children:[e.jsx(q,{className:"w-full min-w-[150px]",children:e.jsx(M,{placeholder:"Select component"})}),e.jsx(H,{children:re.map(a=>e.jsx(C,{value:a.id.toString(),children:a.name},a.id))})]})}),e.jsx("td",{className:"p-4",children:e.jsx(I,{type:"number",value:t.watts,readOnly:!0,className:"w-full min-w-[120px] bg-muted"})}),e.jsx("td",{className:"p-4",children:e.jsx(y,{type:"button",variant:"ghost",size:"icon",onClick:()=>qe(s),className:"text-destructive hover:text-destructive","aria-label":"Delete row",children:e.jsx(we,{className:"h-4 w-4"})})})]},s))})]})})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(y,{onClick:Ue,children:"Add Row"}),e.jsx(y,{onClick:Qe,variant:"secondary",disabled:!T&&!l&&Re,children:K?"Update Override":l?"Generate Table":T?"Create Override":"Generate Table"}),e.jsx(y,{onClick:pe,variant:"destructive",children:K?"Cancel Edit":"Reset"}),l&&v.some(t=>!t.isDefault&&!t.defaultTableId)&&e.jsx(y,{onClick:Ye,variant:"default",className:"bg-green-600 hover:bg-green-700",children:"Save Default Tables"})]})]})})})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx("div",{className:"space-y-6",children:v.slice(0,Math.ceil(v.length/2)).map(t=>e.jsx(Ne,{table:t,pduTypes:ue,safetyMargin:f,phaseMode:u,onRemove:()=>he(t.id),onUpdateSettings:s=>xe(t.id,s)},t.id))})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx("div",{className:"space-y-6",children:v.slice(Math.ceil(v.length/2)).map(t=>e.jsx(Ne,{table:t,pduTypes:ue,safetyMargin:f,phaseMode:u,onRemove:()=>he(t.id),onUpdateSettings:s=>xe(t.id,s)},t.id))})})]})]})};export{Ct as default};
