import{c3 as Ba,ck as $a,r as w,j as f,e as za,m as Br,C as Wa,W as Qa,Y as Va,$ as Ja,A as Ya,L as $,X as te,B as $r,I as Xa}from"./index-NZ6jJLfQ.js";import{B as ae}from"./badge-vNTKF5RD.js";import{C as Za,e as en,b as rn,c as ne,d as ie}from"./command-D3uMBT-Z.js";import{P as tn,a as an,b as nn}from"./popover-Dl-b1R8L.js";import{u as sn}from"./useQuery-kdg2pmgf.js";import{u as on}from"./useMutation-DluhVBs1.js";import se from"./purify.es-8cgQ8pEC.js";import{c as Q,g as un}from"./commonjs-helpers-Cpj98o6Y.js";import{r as ln}from"./editor-lib-fUHf8ZJG.js";import{S as zr}from"./send-Uvkx0r_O.js";import{U as cn}from"./users-DMnpVLUq.js";import{I as Wr}from"./image--Pql38nK.js";import{F as Qr}from"./file-text-igU140SQ.js";import"./vite-preload-helper-ckwbz45p.js";import"./search-D-OiWg8h.js";var oe,Vr;function dn(){if(Vr)return oe;Vr=1;function e(){this.__data__=[],this.size=0}return oe=e,oe}var ue,Jr;function Ia(){if(Jr)return ue;Jr=1;function e(r,t){return r===t||r!==r&&t!==t}return ue=e,ue}var le,Yr;function V(){if(Yr)return le;Yr=1;var e=Ia();function r(t,a){for(var n=t.length;n--;)if(e(t[n][0],a))return n;return-1}return le=r,le}var ce,Xr;function fn(){if(Xr)return ce;Xr=1;var e=V(),r=Array.prototype,t=r.splice;function a(n){var s=this.__data__,i=e(s,n);if(i<0)return!1;var c=s.length-1;return i==c?s.pop():t.call(s,i,1),--this.size,!0}return ce=a,ce}var de,Zr;function hn(){if(Zr)return de;Zr=1;var e=V();function r(t){var a=this.__data__,n=e(a,t);return n<0?void 0:a[n][1]}return de=r,de}var fe,et;function pn(){if(et)return fe;et=1;var e=V();function r(t){return e(this.__data__,t)>-1}return fe=r,fe}var he,rt;function vn(){if(rt)return he;rt=1;var e=V();function r(t,a){var n=this.__data__,s=e(n,t);return s<0?(++this.size,n.push([t,a])):n[s][1]=a,this}return he=r,he}var pe,tt;function J(){if(tt)return pe;tt=1;var e=dn(),r=fn(),t=hn(),a=pn(),n=vn();function s(i){var c=-1,_=i==null?0:i.length;for(this.clear();++c<_;){var y=i[c];this.set(y[0],y[1])}}return s.prototype.clear=e,s.prototype.delete=r,s.prototype.get=t,s.prototype.has=a,s.prototype.set=n,pe=s,pe}var ve,at;function gn(){if(at)return ve;at=1;var e=J();function r(){this.__data__=new e,this.size=0}return ve=r,ve}var ge,nt;function _n(){if(nt)return ge;nt=1;function e(r){var t=this.__data__,a=t.delete(r);return this.size=t.size,a}return ge=e,ge}var _e,it;function mn(){if(it)return _e;it=1;function e(r){return this.__data__.get(r)}return _e=e,_e}var me,st;function yn(){if(st)return me;st=1;function e(r){return this.__data__.has(r)}return me=e,me}var ye,ot;function Oa(){if(ot)return ye;ot=1;var e=typeof Q=="object"&&Q&&Q.Object===Object&&Q;return ye=e,ye}var be,ut;function k(){if(ut)return be;ut=1;var e=Oa(),r=typeof self=="object"&&self&&self.Object===Object&&self,t=e||r||Function("return this")();return be=t,be}var qe,lt;function Gr(){if(lt)return qe;lt=1;var e=k(),r=e.Symbol;return qe=r,qe}var Ce,ct;function bn(){if(ct)return Ce;ct=1;var e=Gr(),r=Object.prototype,t=r.hasOwnProperty,a=r.toString,n=e?e.toStringTag:void 0;function s(i){var c=t.call(i,n),_=i[n];try{i[n]=void 0;var y=!0}catch{}var g=a.call(i);return y&&(c?i[n]=_:delete i[n]),g}return Ce=s,Ce}var xe,dt;function qn(){if(dt)return xe;dt=1;var e=Object.prototype,r=e.toString;function t(a){return r.call(a)}return xe=t,xe}var Ae,ft;function Y(){if(ft)return Ae;ft=1;var e=Gr(),r=bn(),t=qn(),a="[object Null]",n="[object Undefined]",s=e?e.toStringTag:void 0;function i(c){return c==null?c===void 0?n:a:s&&s in Object(c)?r(c):t(c)}return Ae=i,Ae}var je,ht;function Pa(){if(ht)return je;ht=1;function e(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}return je=e,je}var Se,pt;function Da(){if(pt)return Se;pt=1;var e=Y(),r=Pa(),t="[object AsyncFunction]",a="[object Function]",n="[object GeneratorFunction]",s="[object Proxy]";function i(c){if(!r(c))return!1;var _=e(c);return _==a||_==n||_==t||_==s}return Se=i,Se}var Te,vt;function Cn(){if(vt)return Te;vt=1;var e=k(),r=e["__core-js_shared__"];return Te=r,Te}var Re,gt;function xn(){if(gt)return Re;gt=1;var e=Cn(),r=(function(){var a=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""})();function t(a){return!!r&&r in a}return Re=t,Re}var Ee,_t;function Na(){if(_t)return Ee;_t=1;var e=Function.prototype,r=e.toString;function t(a){if(a!=null){try{return r.call(a)}catch{}try{return a+""}catch{}}return""}return Ee=t,Ee}var we,mt;function An(){if(mt)return we;mt=1;var e=Da(),r=xn(),t=Pa(),a=Na(),n=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,i=Function.prototype,c=Object.prototype,_=i.toString,y=c.hasOwnProperty,g=RegExp("^"+_.call(y).replace(n,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function l(o){if(!t(o)||r(o))return!1;var u=e(o)?g:s;return u.test(a(o))}return we=l,we}var Ie,yt;function jn(){if(yt)return Ie;yt=1;function e(r,t){return r==null?void 0:r[t]}return Ie=e,Ie}var Oe,bt;function K(){if(bt)return Oe;bt=1;var e=An(),r=jn();function t(a,n){var s=r(a,n);return e(s)?s:void 0}return Oe=t,Oe}var Pe,qt;function Hr(){if(qt)return Pe;qt=1;var e=K(),r=k(),t=e(r,"Map");return Pe=t,Pe}var De,Ct;function X(){if(Ct)return De;Ct=1;var e=K(),r=e(Object,"create");return De=r,De}var Ne,xt;function Sn(){if(xt)return Ne;xt=1;var e=X();function r(){this.__data__=e?e(null):{},this.size=0}return Ne=r,Ne}var Le,At;function Tn(){if(At)return Le;At=1;function e(r){var t=this.has(r)&&delete this.__data__[r];return this.size-=t?1:0,t}return Le=e,Le}var Me,jt;function Rn(){if(jt)return Me;jt=1;var e=X(),r="__lodash_hash_undefined__",t=Object.prototype,a=t.hasOwnProperty;function n(s){var i=this.__data__;if(e){var c=i[s];return c===r?void 0:c}return a.call(i,s)?i[s]:void 0}return Me=n,Me}var Fe,St;function En(){if(St)return Fe;St=1;var e=X(),r=Object.prototype,t=r.hasOwnProperty;function a(n){var s=this.__data__;return e?s[n]!==void 0:t.call(s,n)}return Fe=a,Fe}var ke,Tt;function wn(){if(Tt)return ke;Tt=1;var e=X(),r="__lodash_hash_undefined__";function t(a,n){var s=this.__data__;return this.size+=this.has(a)?0:1,s[a]=e&&n===void 0?r:n,this}return ke=t,ke}var Ge,Rt;function In(){if(Rt)return Ge;Rt=1;var e=Sn(),r=Tn(),t=Rn(),a=En(),n=wn();function s(i){var c=-1,_=i==null?0:i.length;for(this.clear();++c<_;){var y=i[c];this.set(y[0],y[1])}}return s.prototype.clear=e,s.prototype.delete=r,s.prototype.get=t,s.prototype.has=a,s.prototype.set=n,Ge=s,Ge}var He,Et;function On(){if(Et)return He;Et=1;var e=In(),r=J(),t=Hr();function a(){this.size=0,this.__data__={hash:new e,map:new(t||r),string:new e}}return He=a,He}var Ke,wt;function Pn(){if(wt)return Ke;wt=1;function e(r){var t=typeof r;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?r!=="__proto__":r===null}return Ke=e,Ke}var Ue,It;function Z(){if(It)return Ue;It=1;var e=Pn();function r(t,a){var n=t.__data__;return e(a)?n[typeof a=="string"?"string":"hash"]:n.map}return Ue=r,Ue}var Be,Ot;function Dn(){if(Ot)return Be;Ot=1;var e=Z();function r(t){var a=e(this,t).delete(t);return this.size-=a?1:0,a}return Be=r,Be}var $e,Pt;function Nn(){if(Pt)return $e;Pt=1;var e=Z();function r(t){return e(this,t).get(t)}return $e=r,$e}var ze,Dt;function Ln(){if(Dt)return ze;Dt=1;var e=Z();function r(t){return e(this,t).has(t)}return ze=r,ze}var We,Nt;function Mn(){if(Nt)return We;Nt=1;var e=Z();function r(t,a){var n=e(this,t),s=n.size;return n.set(t,a),this.size+=n.size==s?0:1,this}return We=r,We}var Qe,Lt;function La(){if(Lt)return Qe;Lt=1;var e=On(),r=Dn(),t=Nn(),a=Ln(),n=Mn();function s(i){var c=-1,_=i==null?0:i.length;for(this.clear();++c<_;){var y=i[c];this.set(y[0],y[1])}}return s.prototype.clear=e,s.prototype.delete=r,s.prototype.get=t,s.prototype.has=a,s.prototype.set=n,Qe=s,Qe}var Ve,Mt;function Fn(){if(Mt)return Ve;Mt=1;var e=J(),r=Hr(),t=La(),a=200;function n(s,i){var c=this.__data__;if(c instanceof e){var _=c.__data__;if(!r||_.length<a-1)return _.push([s,i]),this.size=++c.size,this;c=this.__data__=new t(_)}return c.set(s,i),this.size=c.size,this}return Ve=n,Ve}var Je,Ft;function kn(){if(Ft)return Je;Ft=1;var e=J(),r=gn(),t=_n(),a=mn(),n=yn(),s=Fn();function i(c){var _=this.__data__=new e(c);this.size=_.size}return i.prototype.clear=r,i.prototype.delete=t,i.prototype.get=a,i.prototype.has=n,i.prototype.set=s,Je=i,Je}var Ye,kt;function Gn(){if(kt)return Ye;kt=1;var e="__lodash_hash_undefined__";function r(t){return this.__data__.set(t,e),this}return Ye=r,Ye}var Xe,Gt;function Hn(){if(Gt)return Xe;Gt=1;function e(r){return this.__data__.has(r)}return Xe=e,Xe}var Ze,Ht;function Kn(){if(Ht)return Ze;Ht=1;var e=La(),r=Gn(),t=Hn();function a(n){var s=-1,i=n==null?0:n.length;for(this.__data__=new e;++s<i;)this.add(n[s])}return a.prototype.add=a.prototype.push=r,a.prototype.has=t,Ze=a,Ze}var er,Kt;function Un(){if(Kt)return er;Kt=1;function e(r,t){for(var a=-1,n=r==null?0:r.length;++a<n;)if(t(r[a],a,r))return!0;return!1}return er=e,er}var rr,Ut;function Bn(){if(Ut)return rr;Ut=1;function e(r,t){return r.has(t)}return rr=e,rr}var tr,Bt;function Ma(){if(Bt)return tr;Bt=1;var e=Kn(),r=Un(),t=Bn(),a=1,n=2;function s(i,c,_,y,g,l){var o=_&a,u=i.length,h=c.length;if(u!=h&&!(o&&h>u))return!1;var p=l.get(i),m=l.get(c);if(p&&m)return p==c&&m==i;var b=-1,v=!0,T=_&n?new e:void 0;for(l.set(i,c),l.set(c,i);++b<u;){var q=i[b],j=c[b];if(y)var C=o?y(j,q,b,c,i,l):y(q,j,b,i,c,l);if(C!==void 0){if(C)continue;v=!1;break}if(T){if(!r(c,function(x,O){if(!t(T,O)&&(q===x||g(q,x,_,y,l)))return T.push(O)})){v=!1;break}}else if(!(q===j||g(q,j,_,y,l))){v=!1;break}}return l.delete(i),l.delete(c),v}return tr=s,tr}var ar,$t;function $n(){if($t)return ar;$t=1;var e=k(),r=e.Uint8Array;return ar=r,ar}var nr,zt;function zn(){if(zt)return nr;zt=1;function e(r){var t=-1,a=Array(r.size);return r.forEach(function(n,s){a[++t]=[s,n]}),a}return nr=e,nr}var ir,Wt;function Wn(){if(Wt)return ir;Wt=1;function e(r){var t=-1,a=Array(r.size);return r.forEach(function(n){a[++t]=n}),a}return ir=e,ir}var sr,Qt;function Qn(){if(Qt)return sr;Qt=1;var e=Gr(),r=$n(),t=Ia(),a=Ma(),n=zn(),s=Wn(),i=1,c=2,_="[object Boolean]",y="[object Date]",g="[object Error]",l="[object Map]",o="[object Number]",u="[object RegExp]",h="[object Set]",p="[object String]",m="[object Symbol]",b="[object ArrayBuffer]",v="[object DataView]",T=e?e.prototype:void 0,q=T?T.valueOf:void 0;function j(C,x,O,I,D,A,L){switch(O){case v:if(C.byteLength!=x.byteLength||C.byteOffset!=x.byteOffset)return!1;C=C.buffer,x=x.buffer;case b:return!(C.byteLength!=x.byteLength||!A(new r(C),new r(x)));case _:case y:case o:return t(+C,+x);case g:return C.name==x.name&&C.message==x.message;case u:case p:return C==x+"";case l:var N=n;case h:var U=I&i;if(N||(N=s),C.size!=x.size&&!U)return!1;var G=L.get(C);if(G)return G==x;I|=c,L.set(C,x);var re=a(N(C),N(x),I,D,A,L);return L.delete(C),re;case m:if(q)return q.call(C)==q.call(x)}return!1}return sr=j,sr}var or,Vt;function Vn(){if(Vt)return or;Vt=1;function e(r,t){for(var a=-1,n=t.length,s=r.length;++a<n;)r[s+a]=t[a];return r}return or=e,or}var ur,Jt;function Kr(){if(Jt)return ur;Jt=1;var e=Array.isArray;return ur=e,ur}var lr,Yt;function Jn(){if(Yt)return lr;Yt=1;var e=Vn(),r=Kr();function t(a,n,s){var i=n(a);return r(a)?i:e(i,s(a))}return lr=t,lr}var cr,Xt;function Yn(){if(Xt)return cr;Xt=1;function e(r,t){for(var a=-1,n=r==null?0:r.length,s=0,i=[];++a<n;){var c=r[a];t(c,a,r)&&(i[s++]=c)}return i}return cr=e,cr}var dr,Zt;function Xn(){if(Zt)return dr;Zt=1;function e(){return[]}return dr=e,dr}var fr,ea;function Zn(){if(ea)return fr;ea=1;var e=Yn(),r=Xn(),t=Object.prototype,a=t.propertyIsEnumerable,n=Object.getOwnPropertySymbols,s=n?function(i){return i==null?[]:(i=Object(i),e(n(i),function(c){return a.call(i,c)}))}:r;return fr=s,fr}var hr,ra;function ei(){if(ra)return hr;ra=1;function e(r,t){for(var a=-1,n=Array(r);++a<r;)n[a]=t(a);return n}return hr=e,hr}var pr,ta;function ee(){if(ta)return pr;ta=1;function e(r){return r!=null&&typeof r=="object"}return pr=e,pr}var vr,aa;function ri(){if(aa)return vr;aa=1;var e=Y(),r=ee(),t="[object Arguments]";function a(n){return r(n)&&e(n)==t}return vr=a,vr}var gr,na;function ti(){if(na)return gr;na=1;var e=ri(),r=ee(),t=Object.prototype,a=t.hasOwnProperty,n=t.propertyIsEnumerable,s=e((function(){return arguments})())?e:function(i){return r(i)&&a.call(i,"callee")&&!n.call(i,"callee")};return gr=s,gr}var z={exports:{}},_r,ia;function ai(){if(ia)return _r;ia=1;function e(){return!1}return _r=e,_r}z.exports;var sa;function Fa(){return sa||(sa=1,(function(e,r){var t=k(),a=ai(),n=r&&!r.nodeType&&r,s=n&&!0&&e&&!e.nodeType&&e,i=s&&s.exports===n,c=i?t.Buffer:void 0,_=c?c.isBuffer:void 0,y=_||a;e.exports=y})(z,z.exports)),z.exports}var mr,oa;function ni(){if(oa)return mr;oa=1;var e=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function t(a,n){var s=typeof a;return n=n??e,!!n&&(s=="number"||s!="symbol"&&r.test(a))&&a>-1&&a%1==0&&a<n}return mr=t,mr}var yr,ua;function ka(){if(ua)return yr;ua=1;var e=9007199254740991;function r(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=e}return yr=r,yr}var br,la;function ii(){if(la)return br;la=1;var e=Y(),r=ka(),t=ee(),a="[object Arguments]",n="[object Array]",s="[object Boolean]",i="[object Date]",c="[object Error]",_="[object Function]",y="[object Map]",g="[object Number]",l="[object Object]",o="[object RegExp]",u="[object Set]",h="[object String]",p="[object WeakMap]",m="[object ArrayBuffer]",b="[object DataView]",v="[object Float32Array]",T="[object Float64Array]",q="[object Int8Array]",j="[object Int16Array]",C="[object Int32Array]",x="[object Uint8Array]",O="[object Uint8ClampedArray]",I="[object Uint16Array]",D="[object Uint32Array]",A={};A[v]=A[T]=A[q]=A[j]=A[C]=A[x]=A[O]=A[I]=A[D]=!0,A[a]=A[n]=A[m]=A[s]=A[b]=A[i]=A[c]=A[_]=A[y]=A[g]=A[l]=A[o]=A[u]=A[h]=A[p]=!1;function L(N){return t(N)&&r(N.length)&&!!A[e(N)]}return br=L,br}var qr,ca;function si(){if(ca)return qr;ca=1;function e(r){return function(t){return r(t)}}return qr=e,qr}var W={exports:{}};W.exports;var da;function oi(){return da||(da=1,(function(e,r){var t=Oa(),a=r&&!r.nodeType&&r,n=a&&!0&&e&&!e.nodeType&&e,s=n&&n.exports===a,i=s&&t.process,c=(function(){try{var _=n&&n.require&&n.require("util").types;return _||i&&i.binding&&i.binding("util")}catch{}})();e.exports=c})(W,W.exports)),W.exports}var Cr,fa;function Ga(){if(fa)return Cr;fa=1;var e=ii(),r=si(),t=oi(),a=t&&t.isTypedArray,n=a?r(a):e;return Cr=n,Cr}var xr,ha;function ui(){if(ha)return xr;ha=1;var e=ei(),r=ti(),t=Kr(),a=Fa(),n=ni(),s=Ga(),i=Object.prototype,c=i.hasOwnProperty;function _(y,g){var l=t(y),o=!l&&r(y),u=!l&&!o&&a(y),h=!l&&!o&&!u&&s(y),p=l||o||u||h,m=p?e(y.length,String):[],b=m.length;for(var v in y)(g||c.call(y,v))&&!(p&&(v=="length"||u&&(v=="offset"||v=="parent")||h&&(v=="buffer"||v=="byteLength"||v=="byteOffset")||n(v,b)))&&m.push(v);return m}return xr=_,xr}var Ar,pa;function li(){if(pa)return Ar;pa=1;var e=Object.prototype;function r(t){var a=t&&t.constructor,n=typeof a=="function"&&a.prototype||e;return t===n}return Ar=r,Ar}var jr,va;function ci(){if(va)return jr;va=1;function e(r,t){return function(a){return r(t(a))}}return jr=e,jr}var Sr,ga;function di(){if(ga)return Sr;ga=1;var e=ci(),r=e(Object.keys,Object);return Sr=r,Sr}var Tr,_a;function fi(){if(_a)return Tr;_a=1;var e=li(),r=di(),t=Object.prototype,a=t.hasOwnProperty;function n(s){if(!e(s))return r(s);var i=[];for(var c in Object(s))a.call(s,c)&&c!="constructor"&&i.push(c);return i}return Tr=n,Tr}var Rr,ma;function hi(){if(ma)return Rr;ma=1;var e=Da(),r=ka();function t(a){return a!=null&&r(a.length)&&!e(a)}return Rr=t,Rr}var Er,ya;function pi(){if(ya)return Er;ya=1;var e=ui(),r=fi(),t=hi();function a(n){return t(n)?e(n):r(n)}return Er=a,Er}var wr,ba;function vi(){if(ba)return wr;ba=1;var e=Jn(),r=Zn(),t=pi();function a(n){return e(n,t,r)}return wr=a,wr}var Ir,qa;function gi(){if(qa)return Ir;qa=1;var e=vi(),r=1,t=Object.prototype,a=t.hasOwnProperty;function n(s,i,c,_,y,g){var l=c&r,o=e(s),u=o.length,h=e(i),p=h.length;if(u!=p&&!l)return!1;for(var m=u;m--;){var b=o[m];if(!(l?b in i:a.call(i,b)))return!1}var v=g.get(s),T=g.get(i);if(v&&T)return v==i&&T==s;var q=!0;g.set(s,i),g.set(i,s);for(var j=l;++m<u;){b=o[m];var C=s[b],x=i[b];if(_)var O=l?_(x,C,b,i,s,g):_(C,x,b,s,i,g);if(!(O===void 0?C===x||y(C,x,c,_,g):O)){q=!1;break}j||(j=b=="constructor")}if(q&&!j){var I=s.constructor,D=i.constructor;I!=D&&"constructor"in s&&"constructor"in i&&!(typeof I=="function"&&I instanceof I&&typeof D=="function"&&D instanceof D)&&(q=!1)}return g.delete(s),g.delete(i),q}return Ir=n,Ir}var Or,Ca;function _i(){if(Ca)return Or;Ca=1;var e=K(),r=k(),t=e(r,"DataView");return Or=t,Or}var Pr,xa;function mi(){if(xa)return Pr;xa=1;var e=K(),r=k(),t=e(r,"Promise");return Pr=t,Pr}var Dr,Aa;function yi(){if(Aa)return Dr;Aa=1;var e=K(),r=k(),t=e(r,"Set");return Dr=t,Dr}var Nr,ja;function bi(){if(ja)return Nr;ja=1;var e=K(),r=k(),t=e(r,"WeakMap");return Nr=t,Nr}var Lr,Sa;function qi(){if(Sa)return Lr;Sa=1;var e=_i(),r=Hr(),t=mi(),a=yi(),n=bi(),s=Y(),i=Na(),c="[object Map]",_="[object Object]",y="[object Promise]",g="[object Set]",l="[object WeakMap]",o="[object DataView]",u=i(e),h=i(r),p=i(t),m=i(a),b=i(n),v=s;return(e&&v(new e(new ArrayBuffer(1)))!=o||r&&v(new r)!=c||t&&v(t.resolve())!=y||a&&v(new a)!=g||n&&v(new n)!=l)&&(v=function(T){var q=s(T),j=q==_?T.constructor:void 0,C=j?i(j):"";if(C)switch(C){case u:return o;case h:return c;case p:return y;case m:return g;case b:return l}return q}),Lr=v,Lr}var Mr,Ta;function Ci(){if(Ta)return Mr;Ta=1;var e=kn(),r=Ma(),t=Qn(),a=gi(),n=qi(),s=Kr(),i=Fa(),c=Ga(),_=1,y="[object Arguments]",g="[object Array]",l="[object Object]",o=Object.prototype,u=o.hasOwnProperty;function h(p,m,b,v,T,q){var j=s(p),C=s(m),x=j?g:n(p),O=C?g:n(m);x=x==y?l:x,O=O==y?l:O;var I=x==l,D=O==l,A=x==O;if(A&&i(p)){if(!i(m))return!1;j=!0,I=!1}if(A&&!I)return q||(q=new e),j||c(p)?r(p,m,b,v,T,q):t(p,m,x,b,v,T,q);if(!(b&_)){var L=I&&u.call(p,"__wrapped__"),N=D&&u.call(m,"__wrapped__");if(L||N){var U=L?p.value():p,G=N?m.value():m;return q||(q=new e),T(U,G,b,v,q)}}return A?(q||(q=new e),a(p,m,b,v,T,q)):!1}return Mr=h,Mr}var Fr,Ra;function xi(){if(Ra)return Fr;Ra=1;var e=Ci(),r=ee();function t(a,n,s,i,c){return a===n?!0:a==null||n==null||!r(a)&&!r(n)?a!==a&&n!==n:e(a,n,s,i,t,c)}return Fr=t,Fr}var kr,Ea;function Ai(){if(Ea)return kr;Ea=1;var e=xi();function r(t,a){return e(t,a)}return kr=r,kr}var M,wa;function ji(){if(wa)return M;wa=1;var e=M&&M.__extends||(function(){var g=function(l,o){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,h){u.__proto__=h}||function(u,h){for(var p in h)h.hasOwnProperty(p)&&(u[p]=h[p])},g(l,o)};return function(l,o){g(l,o);function u(){this.constructor=l}l.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}})(),r=M&&M.__assign||function(){return r=Object.assign||function(g){for(var l,o=1,u=arguments.length;o<u;o++){l=arguments[o];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(g[h]=l[h])}return g},r.apply(this,arguments)},t=M&&M.__spreadArrays||function(){for(var g=0,l=0,o=arguments.length;l<o;l++)g+=arguments[l].length;for(var u=Array(g),h=0,l=0;l<o;l++)for(var p=arguments[l],m=0,b=p.length;m<b;m++,h++)u[h]=p[m];return u},a=M&&M.__importDefault||function(g){return g&&g.__esModule?g:{default:g}},n=a(Ba()),s=a($a()),i=a(Ai()),c=a(ln()),_=(function(g){e(l,g);function l(o){var u=g.call(this,o)||this;u.dirtyProps=["modules","formats","bounds","theme","children"],u.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],u.state={generation:0},u.selection=null,u.onEditorChange=function(p,m,b,v){var T,q,j,C;p==="text-change"?(q=(T=u).onEditorChangeText)===null||q===void 0||q.call(T,u.editor.root.innerHTML,m,v,u.unprivilegedEditor):p==="selection-change"&&((C=(j=u).onEditorChangeSelection)===null||C===void 0||C.call(j,m,v,u.unprivilegedEditor))};var h=u.isControlled()?o.value:o.defaultValue;return u.value=h??"",u}return l.prototype.validateProps=function(o){var u;if(n.default.Children.count(o.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(n.default.Children.count(o.children)){var h=n.default.Children.only(o.children);if(((u=h)===null||u===void 0?void 0:u.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&o.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},l.prototype.shouldComponentUpdate=function(o,u){var h=this,p;if(this.validateProps(o),!this.editor||this.state.generation!==u.generation)return!0;if("value"in o){var m=this.getEditorContents(),b=(p=o.value,p??"");this.isEqualValue(b,m)||this.setEditorContents(this.editor,b)}return o.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,o.readOnly),t(this.cleanProps,this.dirtyProps).some(function(v){return!i.default(o[v],h.props[v])})},l.prototype.shouldComponentRegenerate=function(o){var u=this;return this.dirtyProps.some(function(h){return!i.default(o[h],u.props[h])})},l.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},l.prototype.componentWillUnmount=function(){this.destroyEditor()},l.prototype.componentDidUpdate=function(o,u){var h=this;if(this.editor&&this.shouldComponentRegenerate(o)){var p=this.editor.getContents(),m=this.editor.getSelection();this.regenerationSnapshot={delta:p,selection:m},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==u.generation){var b=this.regenerationSnapshot,p=b.delta,v=b.selection;delete this.regenerationSnapshot,this.instantiateEditor();var T=this.editor;T.setContents(p),y(function(){return h.setEditorSelection(T,v)})}},l.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},l.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},l.prototype.isControlled=function(){return"value"in this.props},l.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},l.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},l.prototype.createEditor=function(o,u){var h=new c.default(o,u);return u.tabIndex!=null&&this.setEditorTabIndex(h,u.tabIndex),this.hookEditor(h),h},l.prototype.hookEditor=function(o){this.unprivilegedEditor=this.makeUnprivilegedEditor(o),o.on("editor-change",this.onEditorChange)},l.prototype.unhookEditor=function(o){o.off("editor-change",this.onEditorChange)},l.prototype.getEditorContents=function(){return this.value},l.prototype.getEditorSelection=function(){return this.selection},l.prototype.isDelta=function(o){return o&&o.ops},l.prototype.isEqualValue=function(o,u){return this.isDelta(o)&&this.isDelta(u)?i.default(o.ops,u.ops):i.default(o,u)},l.prototype.setEditorContents=function(o,u){var h=this;this.value=u;var p=this.getEditorSelection();typeof u=="string"?o.setContents(o.clipboard.convert(u)):o.setContents(u),y(function(){return h.setEditorSelection(o,p)})},l.prototype.setEditorSelection=function(o,u){if(this.selection=u,u){var h=o.getLength();u.index=Math.max(0,Math.min(u.index,h-1)),u.length=Math.max(0,Math.min(u.length,h-1-u.index)),o.setSelection(u)}},l.prototype.setEditorTabIndex=function(o,u){var h,p;!((p=(h=o)===null||h===void 0?void 0:h.scroll)===null||p===void 0)&&p.domNode&&(o.scroll.domNode.tabIndex=u)},l.prototype.setEditorReadOnly=function(o,u){u?o.disable():o.enable()},l.prototype.makeUnprivilegedEditor=function(o){var u=o;return{getHTML:function(){return u.root.innerHTML},getLength:u.getLength.bind(u),getText:u.getText.bind(u),getContents:u.getContents.bind(u),getSelection:u.getSelection.bind(u),getBounds:u.getBounds.bind(u)}},l.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var o=s.default.findDOMNode(this.editingArea);if(!o)throw new Error("Cannot find element for editing area");if(o.nodeType===3)throw new Error("Editing area cannot be a text node");return o},l.prototype.renderEditingArea=function(){var o=this,u=this.props,h=u.children,p=u.preserveWhitespace,m=this.state.generation,b={key:m,ref:function(v){o.editingArea=v}};return n.default.Children.count(h)?n.default.cloneElement(n.default.Children.only(h),b):p?n.default.createElement("pre",r({},b)):n.default.createElement("div",r({},b))},l.prototype.render=function(){var o;return n.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(o=this.props.className,o??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},l.prototype.onEditorChangeText=function(o,u,h,p){var m,b;if(this.editor){var v=this.isDelta(this.value)?p.getContents():p.getHTML();v!==this.getEditorContents()&&(this.lastDeltaChangeSet=u,this.value=v,(b=(m=this.props).onChange)===null||b===void 0||b.call(m,o,u,h,p))}},l.prototype.onEditorChangeSelection=function(o,u,h){var p,m,b,v,T,q;if(this.editor){var j=this.getEditorSelection(),C=!j&&o,x=j&&!o;i.default(o,j)||(this.selection=o,(m=(p=this.props).onChangeSelection)===null||m===void 0||m.call(p,o,u,h),C?(v=(b=this.props).onFocus)===null||v===void 0||v.call(b,o,u,h):x&&((q=(T=this.props).onBlur)===null||q===void 0||q.call(T,j,u,h)))}},l.prototype.focus=function(){this.editor&&this.editor.focus()},l.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},l.displayName="React Quill",l.Quill=c.default,l.defaultProps={theme:"snow",modules:{},readOnly:!1},l})(n.default.Component);function y(g){Promise.resolve().then(g)}return M=_,M}var Si=ji();const Ti=un(Si);function Ri({value:e,onChange:r,placeholder:t="Escribe tu mensaje aquí...",minHeight:a="250px"}){const n=w.useRef(null),s=w.useMemo(()=>({toolbar:[[{header:[1,2,3,!1]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["clean"]],clipboard:{matchVisual:!1}}),[]),i=["header","size","bold","italic","underline","strike","color","background","list","bullet","align","link"],c=w.useRef(null);return w.useEffect(()=>{c.current&&c.current.style.setProperty("--editor-min-height",a)},[a]),f.jsx("div",{className:"rich-text-editor-wrapper",ref:c,children:f.jsx(Ti,{ref:n,theme:"snow",value:e,onChange:r,modules:s,formats:i,placeholder:t})})}function Bi(){const{toast:e}=za(),[r,t]=w.useState(""),[a,n]=w.useState(""),[s,i]=w.useState([]),[c,_]=w.useState([]),[y,g]=w.useState([]),[l,o]=w.useState(""),[u,h]=w.useState(!1),[p,m]=w.useState(!1),[b,v]=w.useState(!1),T=w.useRef(null),q=w.useRef(null),{data:j=[]}=sn({queryKey:["profiles",l],queryFn:async()=>{let d=Br.from("profiles").select("id, first_name, last_name, email, department, role").not("email","is",null).order("first_name");l&&(d=d.or(`first_name.ilike.%${l}%,last_name.ilike.%${l}%,email.ilike.%${l}%,department.ilike.%${l}%`));const{data:R,error:S}=await d.limit(50);if(S)throw S;return R},enabled:u}),C=on({mutationFn:async d=>{const{data:R,error:S}=await Br.functions.invoke("send-corporate-email",{body:d});if(S)throw S;if(!R)throw new Error("No response from server");if(!R.success)throw new Error(R.error||"Failed to send email");return R},onSuccess:d=>{e({title:"Email sent successfully",description:`Sent to ${d.sentCount} recipient${d.sentCount!==1?"s":""}`}),t(""),n(""),i([]),_([]),g([])},onError:d=>{e({title:"Failed to send email",description:d.message,variant:"destructive"})}}),x=w.useCallback(d=>{i(R=>R.some(S=>S.id===d.id)?R:[...R,d]),h(!1)},[]),O=w.useCallback(d=>{i(R=>R.filter(S=>S.id!==d))},[]),I=w.useCallback(async d=>{if(!d||d.length===0)return;const R=[];for(let S=0;S<d.length;S++){const E=d[S];if(!E.type.startsWith("image/")){e({title:"Invalid file type",description:`${E.name} is not an image`,variant:"destructive"});continue}if(E.size>5*1024*1024){e({title:"File too large",description:`${E.name} exceeds 5MB limit`,variant:"destructive"});continue}try{const F=await A(E),H=`img_${Date.now()}_${S}`;R.push({cid:H,content:F,mimeType:E.type,filename:E.name});const P=`<img src="cid:${H}" alt="${E.name}" style="max-width: 100%; height: auto;" />`;n(B=>B+P)}catch{e({title:"Failed to process image",description:E.name,variant:"destructive"})}}_(S=>[...S,...R]),m(!1)},[e]),D=w.useCallback(async d=>{if(!d||d.length===0)return;const R=[];for(let S=0;S<d.length;S++){const E=d[S];if(E.type!=="application/pdf"){e({title:"Invalid file type",description:`${E.name} is not a PDF`,variant:"destructive"});continue}if(E.size>10*1024*1024){e({title:"File too large",description:`${E.name} exceeds 10MB limit`,variant:"destructive"});continue}try{const F=await A(E);R.push({content:F,filename:E.name,size:E.size})}catch{e({title:"Failed to process PDF",description:E.name,variant:"destructive"})}}g(S=>[...S,...R]),v(!1)},[e]),A=d=>new Promise((R,S)=>{const E=new FileReader;E.onload=()=>{const H=E.result.split(",")[1];R(H)},E.onerror=S,E.readAsDataURL(d)}),L=w.useCallback(d=>{d.preventDefault(),m(!0)},[]),N=w.useCallback(()=>{m(!1)},[]),U=w.useCallback(d=>{d.preventDefault(),I(d.dataTransfer.files)},[I]),G=w.useCallback(d=>{d.preventDefault(),v(!0)},[]),re=w.useCallback(()=>{v(!1)},[]),Ha=w.useCallback(d=>{d.preventDefault(),D(d.dataTransfer.files)},[D]),Ka=w.useCallback(()=>{if(!r.trim()){e({title:"Missing subject",description:"Please enter an email subject",variant:"destructive"});return}if(!a.replace(/<[^>]*>/g,"").trim()){e({title:"Missing body",description:"Please enter email content",variant:"destructive"});return}if(s.length===0){e({title:"No recipients",description:"Please select at least one recipient",variant:"destructive"});return}se.addHook("afterSanitizeAttributes",P=>{if(P.tagName==="A"){const B=P.getAttribute("target");if(B&&!["_blank","_self","_parent","_top"].includes(B)){P.removeAttribute("target");return}B==="_blank"&&P.setAttribute("rel","noopener noreferrer")}});const R=se.sanitize(a,{ALLOWED_TAGS:["p","br","strong","b","em","i","u","s","strike","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","span","div"],ALLOWED_ATTR:["href","src","alt","style","class","target"],ALLOWED_STYLES:{"*":{color:[/^#[0-9a-fA-F]{3,6}$/,/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/],"background-color":[/^#[0-9a-fA-F]{3,6}$/,/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/],"font-size":[/^\d+(?:px|em|rem|%)$/],"text-align":[/^(?:left|right|center|justify)$/],"max-width":[/^\d+(?:px|em|rem|%)$|^auto$/],height:[/^\d+(?:px|em|rem|%)$|^auto$/]}},SAFE_FOR_TEMPLATES:!1});se.removeHook("afterSanitizeAttributes");const S=[],E=[],F=[];s.forEach(P=>{P.type==="individual"&&P.profileId?S.push(P.profileId):P.type==="department"&&P.department?E.push(P.department):P.type==="role"&&P.role&&F.push(P.role)});const H={subject:r,bodyHtml:R,recipients:{profileIds:S.length>0?S:void 0,departments:E.length>0?E:void 0,roles:F.length>0?F:void 0},pdfAttachments:y.length>0?y:void 0,inlineImages:c.length>0?c:void 0};C.mutate(H)},[r,a,s,y,c,e,C]),Ur=Array.from(new Set(j.map(d=>d.department).filter(Boolean))),Ua=[{value:"admin",label:"Administradores"},{value:"management",label:"Gestión"},{value:"staff",label:"Personal"},{value:"freelance",label:"Freelance"}];return f.jsxs(Wa,{className:"w-full",children:[f.jsxs(Qa,{children:[f.jsxs(Va,{className:"flex items-center gap-2",children:[f.jsx(zr,{className:"h-5 w-5"}),"Redactar Email Corporativo"]}),f.jsx(Ja,{children:'Los correos se enviarán desde tu departamento (ej: "Sonido - Sector-Pro")'})]}),f.jsxs(Ya,{className:"space-y-4",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx($,{htmlFor:"recipients",children:"Destinatarios"}),f.jsx("p",{className:"text-xs text-muted-foreground",children:'Múltiples filtros se combinan con lógica AND (ej: "Sonido" + "Personal" = solo personal de sonido)'}),f.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:s.map(d=>f.jsxs(ae,{variant:"secondary",className:"gap-1",children:[d.label,f.jsx("button",{type:"button",onClick:()=>O(d.id),className:"ml-1 hover:bg-secondary-foreground/20 rounded-full",children:f.jsx(te,{className:"h-3 w-3"})})]},d.id))}),f.jsxs(tn,{open:u,onOpenChange:h,children:[f.jsx(an,{asChild:!0,children:f.jsxs($r,{variant:"outline",className:"w-full justify-start",children:[f.jsx(cn,{className:"mr-2 h-4 w-4"}),"Seleccionar destinatarios..."]})}),f.jsx(nn,{className:"w-[400px] p-0 max-h-[400px] overflow-hidden",align:"start",children:u&&f.jsxs(Za,{shouldFilter:!1,className:"h-full",children:[f.jsx(en,{placeholder:"Buscar por nombre, email o departamento...",value:l,onValueChange:o}),f.jsx(rn,{children:"No se encontraron resultados"}),f.jsxs("div",{className:"max-h-[320px] overflow-y-auto",children:[f.jsx(ne,{heading:"Por rol",children:Ua.map(d=>f.jsx(ie,{onSelect:()=>{x({id:`role_${d.value}`,label:d.label,type:"role",role:d.value})},children:d.label},d.value))}),Ur.length>0&&f.jsx(ne,{heading:"Por departamento",children:Ur.slice(0,5).map(d=>f.jsx(ie,{onSelect:()=>{x({id:`dept_${d}`,label:`Departamento: ${d}`,type:"department",department:d})},children:d},d))}),f.jsxs(ne,{heading:"Individuales",children:[j.slice(0,20).map(d=>{const R=`${d.first_name||""} ${d.last_name||""}`.trim();return f.jsx(ie,{onSelect:()=>{x({id:`profile_${d.id}`,label:R||d.email||"Sin nombre",type:"individual",profileId:d.id})},children:f.jsxs("div",{className:"flex flex-col",children:[f.jsx("span",{children:R||"Sin nombre"}),f.jsx("span",{className:"text-xs text-muted-foreground",children:d.email})]})},d.id)}),j.length>20&&f.jsxs("div",{className:"px-2 py-3 text-xs text-muted-foreground text-center border-t",children:["Mostrando 20 de ",j.length," resultados. Usa la búsqueda para filtrar."]})]})]})]})})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx($,{htmlFor:"subject",children:"Asunto"}),f.jsx(Xa,{id:"subject",placeholder:"Asunto del correo...",value:r,onChange:d=>t(d.target.value)})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx($,{htmlFor:"body",children:"Mensaje"}),f.jsx(Ri,{value:a,onChange:n,placeholder:"Escribe tu mensaje aquí... Usa la barra de herramientas para darle formato.",minHeight:"300px"}),f.jsx("p",{className:"text-xs text-muted-foreground",children:"Tu mensaje será envuelto en la plantilla corporativa con logos de Sector Pro y Área Técnica. Usa la barra de herramientas para aplicar negrita, cambiar tamaño de fuente, colores, alineación, etc."})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx($,{children:"Imágenes (para insertar en el mensaje)"}),f.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${p?"border-primary bg-primary/10":"border-muted-foreground/25 hover:border-primary/50"}`,onDragOver:L,onDragLeave:N,onDrop:U,onClick:()=>{var d;return(d=T.current)==null?void 0:d.click()},children:[f.jsx(Wr,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"Arrastra imágenes aquí o haz clic para seleccionar"}),f.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPEG, GIF (máx. 5MB cada una) · Las imágenes se eliminan automáticamente después del envío"})]}),f.jsx("input",{ref:T,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:d=>I(d.target.files)}),c.length>0&&f.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:c.map(d=>f.jsxs(ae,{variant:"outline",className:"gap-1",children:[f.jsx(Wr,{className:"h-3 w-3"}),d.filename,f.jsx("button",{type:"button",onClick:()=>_(R=>R.filter(S=>S.cid!==d.cid)),className:"ml-1 hover:bg-secondary-foreground/20 rounded-full",children:f.jsx(te,{className:"h-3 w-3"})})]},d.cid))})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx($,{children:"Archivos adjuntos (PDF)"}),f.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${b?"border-primary bg-primary/10":"border-muted-foreground/25 hover:border-primary/50"}`,onDragOver:G,onDragLeave:re,onDrop:Ha,onClick:()=>{var d;return(d=q.current)==null?void 0:d.click()},children:[f.jsx(Qr,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),f.jsx("p",{className:"text-sm text-muted-foreground",children:"Arrastra PDFs aquí o haz clic para seleccionar"}),f.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PDF (máx. 10MB cada uno)"})]}),f.jsx("input",{ref:q,type:"file",accept:"application/pdf",multiple:!0,className:"hidden",onChange:d=>D(d.target.files)}),y.length>0&&f.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:y.map((d,R)=>f.jsxs(ae,{variant:"outline",className:"gap-1",children:[f.jsx(Qr,{className:"h-3 w-3"}),d.filename,f.jsx("button",{type:"button",onClick:()=>g(S=>S.filter(E=>E.filename!==d.filename)),className:"ml-1 hover:bg-secondary-foreground/20 rounded-full",children:f.jsx(te,{className:"h-3 w-3"})})]},R))})]}),f.jsxs($r,{onClick:Ka,disabled:C.isPending,className:"w-full",size:"lg",children:[f.jsx(zr,{className:"mr-2 h-4 w-4"}),C.isPending?"Enviando...":"Enviar Email"]})]})]})}export{Bi as CorporateEmailComposer};
