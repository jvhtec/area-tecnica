import{l as ve,r as k,j as e,Q,i as a,af as I,D as we,q as De,F as Me,G as be,B as _,e as Z,C as re,W as oe,Y as ne,A as le,J as Ce,K as Ne,O as _e,aE as Y,s as ee,a4 as ke,d as Se}from"./index-NZ6jJLfQ.js";import{u as te}from"./useQuery-kdg2pmgf.js";import{L as se}from"./LogisticsEventDialog-WK7mGk6y.js";import{B as U}from"./badge-vNTKF5RD.js";import{T as q}from"./transportProviders-CPS1W6Xy.js";import{P as Ee}from"./package-Oxfj-CNq.js";import{T as Te}from"./truck-Br5sduv3.js";import{M as Fe}from"./message-square-a2K2ewo9.js";import{P as z}from"./printer-De77t3j8.js";import{T as K,l as Le}from"./lazyXlsx-BrFBF17_.js";import{e as $,a as R}from"./endOfWeek-BYLwoWuZ.js";import{e as x}from"./es-CSiFCUGj.js";import{a as Pe}from"./lazyPdf-xVUlxKNu.js";import{s as V,a as Oe}from"./startOfMonth-B5dVCv8B.js";import{e as B}from"./endOfMonth-Byhxb84j.js";import{C as ce}from"./chevron-left-rq2ui83a.js";import{C as J}from"./calendar-_Cj_Sgy-.js";import{C as ie}from"./chevron-right-Bn7Eu0F7.js";import{P as de}from"./plus-C3JQqq7t.js";import{e as Ae}from"./eachDayOfInterval-CPmiA2bk.js";import{i as ze}from"./isSameMonth-BQ4F6s8O.js";import{a as ae}from"./addMonths-j-Bb577B.js";import{i as Ie}from"./isToday-BbpdYtC3.js";import{s as $e}from"./subDays-D4REtaCB.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./checkbox-BsRNEGV1.js";import"./alert-dialog-CtyYUxwH.js";import"./transportOptions-CtHnG2xX.js";import"./constructNow-u0VlpghF.js";import"./isSameDay-m1OvdnsV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=ve("PackageCheck",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),G=k.memo(function({event:t,onClick:C,variant:o="detailed",compact:u=!1,className:p}){var c;const i=t.event_type==="load"?"rgb(191, 219, 254)":"rgb(187, 247, 208)",d=t.color||i,j=()=>{if(!t.color)return"";try{if(t.color.startsWith("#")){const m=parseInt(t.color.slice(1,3),16),g=parseInt(t.color.slice(3,5),16),r=parseInt(t.color.slice(5,7),16);return`rgba(${m}, ${g}, ${r}, 0.1)`}return t.color.replace("rgb","rgba").replace(")",", 0.1)")}catch{return""}},M=()=>{var v;const m=t.title||t.custom_title||t.manual_title||t.request_title||((v=t.job)==null?void 0:v.title);if(m)return m;const g=t.event_type==="load"?"Carga":"Descarga",r=t.transport_type?` - ${t.transport_type}`:"";return`${g}${r}`};return e.jsx("div",{onClick:C,style:{borderColor:d,backgroundColor:j()},className:Q("p-2 bg-card border rounded-md cursor-pointer hover:shadow-md transition-shadow",p),children:o==="calendar"?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs",children:M()})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex flex-col gap-2 flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(U,{variant:t.event_type==="load"?"default":"secondary",className:"flex items-center gap-1",children:[t.event_type==="load"?e.jsx(Ee,{className:"h-3 w-3"}):e.jsx(Re,{className:"h-3 w-3"}),e.jsx("span",{className:"capitalize",children:t.event_type==="load"?"Carga":"Descarga"})]}),e.jsxs(U,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-3 w-3"}),e.jsx("span",{className:"capitalize",children:t.transport_type})]})]})}),t.transport_provider&&q[t.transport_provider]&&q[t.transport_provider].icon&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:q[t.transport_provider].icon,alt:q[t.transport_provider].label,width:96,height:96,loading:"lazy",decoding:"async",className:"w-24 h-24 object-contain",onError:m=>{m.currentTarget.style.display="none"}})})]}),e.jsx("h3",{className:"font-medium mt-2",children:M()}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:a(new Date(`2000-01-01T${t.event_time}`),"HH:mm")}),t.license_plate&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:t.license_plate}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(c=t.departments)==null?void 0:c.map(m=>e.jsx(U,{variant:"secondary",className:"text-xs",children:m.department},m.department))}),t.loading_bay&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Muelle: ",t.loading_bay]}),t.notes&&e.jsxs("div",{className:"text-sm text-muted-foreground flex items-start gap-1.5 mt-2",children:[e.jsx(Fe,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2",children:t.notes})]})]})})}),me=({showDialog:s,setShowDialog:t,currentMonth:C,onGeneratePDF:o,onGenerateXLS:u})=>{const p=new Date,i=I(p,{weekStartsOn:1}),d=$(p,{weekStartsOn:1}),j=I(R(p,1),{weekStartsOn:1}),M=$(R(p,1),{weekStartsOn:1});return e.jsx(we,{open:s,onOpenChange:t,children:e.jsxs(De,{children:[e.jsx(Me,{children:e.jsx(be,{children:"Exportar Calendario de Logística"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-semibold text-base",children:"Imprimir a PDF"}),e.jsxs(_,{onClick:()=>{o("current_week")},children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Semana Actual (",a(i,"d MMM",{locale:x})," - ",a(d,"d MMM",{locale:x}),")"]}),e.jsxs(_,{onClick:()=>{o("next_week")},children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Próxima Semana (",a(j,"d MMM",{locale:x})," - ",a(M,"d MMM",{locale:x}),")"]}),e.jsxs(_,{onClick:()=>{o("month")},children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Mes Completo (",a(C,"MMMM yyyy",{locale:x}),")"]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-semibold text-base",children:"Exportar a Excel"}),e.jsxs(_,{onClick:()=>{u("current_week")},children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Semana Actual (",a(i,"d MMM",{locale:x})," - ",a(d,"d MMM",{locale:x}),")"]}),e.jsxs(_,{onClick:()=>{u("next_week")},children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Próxima Semana (",a(j,"d MMM",{locale:x})," - ",a(M,"d MMM",{locale:x}),")"]}),e.jsxs(_,{onClick:()=>{u("month")},children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Mes Completo (",a(C,"MMMM yyyy",{locale:x}),")"]})]})]})]})})},We={trailer:"Tráiler",van:"Furgoneta",truck:"Camión",car:"Coche",own_truck:"Camión Propio",rental_truck:"Camión Alquiler"},Ve={dachser:"Dachser",transgesa:"Transgesa",nacex:"Nacex",seur:"Seur",correos:"Correos",mrw:"MRW",own:"Propio",other:"Otro"},he=s=>We[s]||s,pe=s=>s?Ve[s]||s:"-",ue=s=>s==="load"?"Carga":"Descarga",xe=s=>!s||s.length===0?"-":s.map(t=>t.department.charAt(0).toUpperCase()+t.department.slice(1)).join(", "),ge=s=>{var t;return(t=s.job)!=null&&t.title?s.job.title:s.title?s.title:"-"},ye=async(s,t)=>{const{events:C,currentDate:o}=t;let u,p,i;const d=new Date;switch(s){case"current_week":u=I(d,{weekStartsOn:1}),p=$(d,{weekStartsOn:1}),i=`Semana Actual (${a(u,"d MMM",{locale:x})} - ${a(p,"d MMM yyyy",{locale:x})})`;break;case"next_week":u=I(R(d,1),{weekStartsOn:1}),p=$(R(d,1),{weekStartsOn:1}),i=`Próxima Semana (${a(u,"d MMM",{locale:x})} - ${a(p,"d MMM yyyy",{locale:x})})`;break;case"month":u=V(o),p=B(o),i=`Mes Completo - ${a(o,"MMMM yyyy",{locale:x})}`;break;default:u=V(o),p=B(o),i=a(o,"MMMM yyyy",{locale:x})}const M=[...C.filter(n=>{if(!n.event_date)return!1;const w=new Date(n.event_date);return w>=u&&w<=p})].sort((n,w)=>{const f=n.event_date.localeCompare(w.event_date);return f!==0?f:n.event_time.localeCompare(w.event_time)}),c=[];c.push([i,null,null,null,null,null,null]),c.push([]),c.push(["Fecha","Trabajo/Título","Tipo de Transporte","Hora","Tipo de Operación","Proveedor de Transporte","Departamento"]);for(const n of M){const w=new Date(n.event_date),f=a(w,"EEE, d MMM yyyy",{locale:x}),l=n.event_time,D=ge(n),b=he(n.transport_type),L=ue(n.event_type),O=pe(n.transport_provider),A=xe(n.departments);c.push([f,D,b,l,L,O,A])}M.length===0&&c.push(["No hay eventos de logística en este período",null,null,null,null,null,null]);const m=await Le(),g=m.utils.book_new(),r=m.utils.aoa_to_sheet(c);r["!cols"]=[{wch:20},{wch:30},{wch:18},{wch:10},{wch:18},{wch:22},{wch:18}],c.length>0&&(r["!merges"]=[{s:{r:0,c:0},e:{r:0,c:6}}]);const v=m.utils.decode_range(r["!ref"]||"A1");for(let n=v.s.r;n<=v.e.r;++n)for(let w=v.s.c;w<=v.e.c;++w){const f=m.utils.encode_cell({r:n,c:w});if(r[f]){if(r[f].s||(r[f].s={}),n===0)r[f].s={font:{bold:!0,sz:14,color:{rgb:"FFFFFF"}},fill:{patternType:"solid",fgColor:{rgb:"2980B9"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}};else if(n===2)r[f].s={font:{bold:!0,sz:11,color:{rgb:"FFFFFF"}},fill:{patternType:"solid",fgColor:{rgb:"34495E"}},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}};else if(n>2){const D=(n-3)%2===0?"F8F9FA":"FFFFFF";if(r[f].s={font:{sz:10},fill:{patternType:"solid",fgColor:{rgb:D}},alignment:{horizontal:w===0?"left":w===3?"center":"left",vertical:"center",wrapText:!0},border:{top:{style:"thin",color:{rgb:"DDDDDD"}},bottom:{style:"thin",color:{rgb:"DDDDDD"}},left:{style:"thin",color:{rgb:"DDDDDD"}},right:{style:"thin",color:{rgb:"DDDDDD"}}}},w===4&&r[f].v){const b=r[f].v.toString().includes("Carga");r[f].s.fill={patternType:"solid",fgColor:{rgb:b?"D5E8D4":"FFE6CC"}},r[f].s.font={bold:!0,sz:10,color:{rgb:b?"0D7C31":"D97700"}}}}}}const T=s==="month"?a(o,"MMM yyyy",{locale:x}):s==="current_week"?"Semana Actual":"Próxima Semana";m.utils.book_append_sheet(g,r,T);const F=`logistica-${s}-${a(new Date,"yyyy-MM-dd")}.xlsx`;m.writeFile(g,F,{bookSST:!0,cellStyles:!0})},fe=async(s,t)=>{const{jsPDF:C,autoTable:o}=await Pe(),{events:u,currentDate:p}=t;let i,d,j;const M=new Date;switch(s){case"current_week":i=I(M,{weekStartsOn:1}),d=$(M,{weekStartsOn:1}),j=`Semana Actual (${a(i,"d MMM",{locale:x})} - ${a(d,"d MMM yyyy",{locale:x})})`;break;case"next_week":i=I(R(M,1),{weekStartsOn:1}),d=$(R(M,1),{weekStartsOn:1}),j=`Próxima Semana (${a(i,"d MMM",{locale:x})} - ${a(d,"d MMM yyyy",{locale:x})})`;break;case"month":i=V(p),d=B(p),j=`Mes Completo - ${a(p,"MMMM yyyy",{locale:x})}`;break;default:i=V(p),d=B(p),j=a(p,"MMMM yyyy",{locale:x})}const m=[...u.filter(l=>{if(!l.event_date)return!1;const D=new Date(l.event_date);return D>=i&&D<=d})].sort((l,D)=>{const b=l.event_date.localeCompare(D.event_date);return b!==0?b:l.event_time.localeCompare(D.event_time)}),g=new C("landscape","mm","a4"),r=await new Promise((l,D)=>{const b=new Image;b.crossOrigin="anonymous",b.src="/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png",b.onload=()=>l(b),b.onerror=L=>D(L)}).catch(()=>null),v=g.internal.pageSize.getWidth(),T=50,F=r?T*(r.height/r.width):0,n=r?(v-T)/2:0;r&&g.addImage(r,"PNG",n,10,T,F),g.setFontSize(16),g.setTextColor(41,128,185),g.text("CALENDARIO DE LOGÍSTICA",v/2,r?10+F+10:20,{align:"center"}),g.setFontSize(12),g.setTextColor(52,73,94),g.text(j,v/2,r?10+F+18:28,{align:"center"});const w=m.map(l=>{const D=new Date(l.event_date),b=a(D,"EEE, d MMM yyyy",{locale:x}),L=l.event_time,O=ge(l),A=he(l.transport_type),h=ue(l.event_type),S=pe(l.transport_provider),P=xe(l.departments);return[b,O,A,L,h,S,P]});o(g,{startY:r?10+F+25:35,head:[["Fecha","Trabajo/Título","Tipo de Transporte","Hora","Tipo de Operación","Proveedor de Transporte","Departamento"]],body:w.length>0?w:[["No hay eventos de logística en este período","","","","","",""]],theme:"striped",tableWidth:"auto",margin:{left:10,right:10},headStyles:{fillColor:[52,73,94],textColor:[255,255,255],fontStyle:"bold",fontSize:10,halign:"center"},bodyStyles:{fontSize:9,cellPadding:3},alternateRowStyles:{fillColor:[248,249,250]},columnStyles:{0:{halign:"left"},1:{halign:"left"},2:{halign:"left"},3:{halign:"center"},4:{halign:"center"},5:{halign:"left"},6:{halign:"left"}},didParseCell:l=>{if(l.column.index===4&&l.section==="body"){const D=l.cell.raw;D==="Carga"?(l.cell.styles.fillColor=[213,232,212],l.cell.styles.textColor=[13,124,49],l.cell.styles.fontStyle="bold"):D==="Descarga"&&(l.cell.styles.fillColor=[255,230,204],l.cell.styles.textColor=[217,119,0],l.cell.styles.fontStyle="bold")}}});const f=`logistica-${s}-${a(new Date,"yyyy-MM-dd")}.pdf`;g.save(f)},Be=({onDateSelect:s})=>{const[t,C]=k.useState(new Date),[o,u]=k.useState(!1),[p,i]=k.useState(null),[d,j]=k.useState(!1),{toast:M}=Z(),{data:c,isLoading:m}=te({queryKey:["logistics-events"],queryFn:async()=>{const{data:y,error:E}=await ee.from("logistics_events").select(`
          *,
          job:jobs(title),
          departments:logistics_event_departments(department)
        `).order("event_time",{ascending:!0});if(E)throw M({title:"Error",description:"Failed to load logistics events",variant:"destructive"}),E;return y}}),g=V(t),r=B(t),v=Ae({start:g,end:r}),T=g.getDay(),F=T===0?6:T-1,n=Array.from({length:F}).map((y,E)=>{const N=new Date(g);return N.setDate(N.getDate()-(F-E)),N}),f=Array.from({length:42-(n.length+v.length)}).map((y,E)=>{const N=new Date(r);return N.setDate(N.getDate()+(E+1)),N}),l=[...n,...v,...f],D=y=>c?c.filter(E=>{if(!E.event_date)return!1;try{const N=new Date(E.event_date);return Y(N)&&a(N,"yyyy-MM-dd")===a(y,"yyyy-MM-dd")}catch{return!1}}):[],b=()=>{C(ae(t,-1))},L=()=>{C(ae(t,1))},O=()=>{C(new Date)},A=async y=>{await fe(y,{events:c||[],currentDate:t}),j(!1)},h=async y=>{await ye(y,{events:c||[],currentDate:t}),j(!1)},S=y=>{s&&Y(y)&&(s(y),C(y))},P=(y,E)=>{y.stopPropagation(),i(E),u(!0)};return e.jsxs(re,{className:"h-full flex flex-col",children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsx(ne,{className:"text-xl font-bold",children:"Logistics Calendar"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{showDialog:d,setShowDialog:j,currentMonth:t,onGeneratePDF:A,onGenerateXLS:h}),e.jsx(_,{variant:"ghost",size:"icon",onClick:b,children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-2 text-sm font-medium text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:a(t,"MMMM yyyy")})]}),e.jsx(_,{variant:"ghost",size:"icon",onClick:L,children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:O,children:"Today"}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>j(!0),children:e.jsx(z,{className:"h-4 w-4"})}),e.jsxs(_,{onClick:()=>{i(null),u(!0)},size:"sm",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Add Event"]})]})]}),e.jsxs(le,{className:"flex-grow p-4",children:[e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-muted",style:{minWidth:"980px"},children:[["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(y=>e.jsx("div",{className:"bg-background p-2 text-center text-sm text-muted-foreground font-medium",children:y},y)),l.map((y,E)=>{const N=D(y),je=ze(y,t),H=7;return e.jsxs("div",{className:Q("bg-background p-2 min-h-[200px] border-t relative cursor-pointer hover:bg-accent/50 transition-colors",!je&&"text-muted-foreground/50"),onClick:()=>S(y),children:[e.jsx("span",{className:"text-sm",children:a(y,"d")}),e.jsxs("div",{className:"space-y-1 mt-1",children:[N==null?void 0:N.slice(0,H).map(W=>e.jsxs(Ce,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx("div",{children:e.jsx(G,{event:W,onClick:X=>P(X,W),compact:!0,variant:"calendar",className:"px-1.5 py-0.5 text-xs truncate hover:bg-accent/50"})})}),e.jsx(_e,{side:"top",align:"start",className:"w-64",children:e.jsx(G,{event:W,onClick:X=>P(X,W),className:"border-0 shadow-none p-0"})})]},W.id)),N&&N.length>H&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["+ ",N.length-H," more"]})]})]},E)})]})}),e.jsx(se,{open:o,onOpenChange:u,selectedDate:t,selectedEvent:p})]})]})},qe=({date:s,onDateSelect:t})=>{const[o,u]=k.useState(s),[p,i]=k.useState(!1),[d,j]=k.useState(null),[M,c]=k.useState(!1),[m,g]=k.useState(10),{toast:r}=Z();k.useEffect(()=>{u(s)},[s]);const{data:v,isLoading:T}=te({queryKey:["logistics-events"],queryFn:async()=>{const{data:h,error:S}=await ee.from("logistics_events").select(`
          *,
          job:jobs(title),
          departments:logistics_event_departments(department)
        `).order("event_time",{ascending:!0});if(S)throw r({title:"Error",description:"No se pudieron cargar los eventos de logística",variant:"destructive"}),S;return h}}),n=k.useCallback(h=>v?v.filter(S=>{if(!S.event_date)return!1;try{const P=new Date(S.event_date);return Y(P)&&a(P,"yyyy-MM-dd")===a(h,"yyyy-MM-dd")}catch{return!1}}):[],[v])(o),w=ke.useMemo(()=>n.slice(0,m),[n,m]);k.useEffect(()=>{g(10)},[o]);const f=async h=>{await fe(h,{events:v||[],currentDate:o}),c(!1)},l=async h=>{await ye(h,{events:v||[],currentDate:o}),c(!1)},D=()=>{const h=$e(o,1);u(h),t(h)},b=()=>{const h=Oe(o,1);u(h),t(h)},L=()=>{const h=new Date;u(h),t(h)},O=(h,S)=>{h.stopPropagation(),j(S),i(!0)},A=()=>{j(null),i(!0)};return e.jsxs("div",{className:"w-full max-w-[520px] mx-auto space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-primary",children:"Logística"}),e.jsx("h2",{className:"text-xl font-bold leading-tight",children:"Agenda móvil"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gestiona cargas y descargas con acciones rápidas."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"ghost",size:"icon",onClick:D,"aria-label":"Día anterior",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:b,"aria-label":"Día siguiente",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"icon",onClick:()=>c(!0),"aria-label":"Exportar logística",children:e.jsx(z,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:Q(Ie(o)&&"text-primary font-bold"),children:a(o,"EEE, MMM d")}),e.jsx("span",{className:"text-muted-foreground",children:"·"}),e.jsx("button",{onClick:L,className:"text-primary underline-offset-2 hover:underline",children:"Hoy"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(_,{onClick:A,className:"w-full rounded-xl flex items-center justify-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Añadir evento"]}),e.jsxs(_,{variant:"outline",className:"w-full rounded-xl",onClick:()=>c(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"})," Exportar"]})]})]}),e.jsx("div",{className:"space-y-3",children:T?e.jsx("div",{className:"flex items-center justify-center py-10 rounded-2xl border bg-card text-muted-foreground",children:"Cargando eventos..."}):n.length>0?e.jsxs(e.Fragment,{children:[w.map(h=>e.jsx(G,{event:h,onClick:S=>O(S,h),className:"w-full rounded-2xl"},h.id)),n.length>m?e.jsxs(_,{type:"button",variant:"outline",className:"w-full rounded-2xl",onClick:()=>g(h=>h+10),children:["Cargar más (",n.length-m," restantes)"]}):null]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center rounded-2xl border bg-card",children:[e.jsx(J,{className:"h-8 w-8 mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay eventos de logística programados"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["para ",a(o,"MMMM d, yyyy")]})]})}),e.jsx(se,{open:p,onOpenChange:i,selectedDate:o,selectedEvent:d}),e.jsx(me,{showDialog:M,setShowDialog:c,currentMonth:o,onGeneratePDF:f,onGenerateXLS:l})]})},Ge=({selectedDate:s})=>{const{toast:t}=Z(),[C,o]=k.useState(!1),[u,p]=k.useState(null),i=a(s,"yyyy-MM-dd"),{data:d,isLoading:j}=te({queryKey:["today-logistics",i],queryFn:async()=>{const{data:c,error:m}=await ee.from("logistics_events").select(`
          *,
          job:jobs(id, title),
          departments:logistics_event_departments(department)
        `).eq("event_date",i).order("event_time",{ascending:!0});if(m)throw t({title:"Error",description:"Failed to load events",variant:"destructive"}),m;return c}}),M=c=>{p(c),o(!0)};return e.jsxs(re,{children:[e.jsx(oe,{children:e.jsxs(ne,{children:["Schedule for ",a(s,"MMMM do, yyyy")]})}),e.jsxs(le,{children:[e.jsxs("div",{className:"space-y-4",children:[d==null?void 0:d.map(c=>e.jsx(G,{event:c,onClick:()=>M(c)},c.id)),(d==null?void 0:d.length)===0&&e.jsx("div",{className:"text-muted-foreground text-center py-4",children:"No logistics events scheduled for this day"})]}),e.jsx(se,{open:C,onOpenChange:o,selectedDate:s,selectedEvent:u})]})]})},Mt=()=>{const[s,t]=k.useState(new Date),C=Se();return e.jsx("div",{className:"w-full max-w-full px-4 py-6 space-y-8",children:C?e.jsx(qe,{date:s,onDateSelect:t}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-9 xl:col-span-10",children:e.jsx(Be,{onDateSelect:t})}),e.jsx("div",{className:"lg:col-span-3 xl:col-span-2",children:e.jsx(Ge,{selectedDate:s})})]})})};export{Mt as default};
