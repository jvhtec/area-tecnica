import{l as J,j as e,C as o,W as x,Y as h,A as f,h as _,m as q}from"./index-NZ6jJLfQ.js";import{u as C}from"./useQuery-kdg2pmgf.js";import{S as L}from"./separator-E-JdTFOv.js";import{B as y}from"./badge-vNTKF5RD.js";import{J as D}from"./JobExtrasEditor-gQe73Sd8.js";import{u as R}from"./useJobPayoutTotals-CXAavZS-.js";import{U as S}from"./users-DMnpVLUq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=J("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),j="bg-card border-border text-card-foreground",$="bg-muted/30 border-border",v="text-muted-foreground",A="bg-primary/5 border-primary/10 text-primary dark:text-primary-foreground",W=({jobId:t,isManager:l=!1,technicianId:i})=>{var p;const{data:m,isLoading:w}=C({queryKey:["job-assignments",t],queryFn:async()=>{let s=q.from("job_assignments").select(`
          technician_id,
          profiles:technician_id (
            first_name,
            last_name
          )
        `).eq("job_id",t);i&&!l&&(s=s.eq("technician_id",i));const{data:c,error:n}=await s;if(n)throw n;return c},enabled:!!t}),{data:r,isLoading:E}=R(t,i);if(w||E)return e.jsxs(o,{className:j,children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Job Extras & Rates"]})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:`text-sm ${v}`,children:"Loading..."})})})]});const d=(m==null?void 0:m.filter(s=>!i||s.technician_id===i))||[];if(!d.length)return e.jsxs(o,{className:j,children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Job Extras & Rates"]})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:`text-sm ${v}`,children:"No extras available"})})})]});const b=l?(r==null?void 0:r.reduce((s,c)=>s+(c.extras_total_eur||0),0))||0:((p=r==null?void 0:r[0])==null?void 0:p.extras_total_eur)||0;return e.jsxs(o,{className:j,children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(u,{className:"h-4 w-4 sm:h-5 sm:w-5"}),"Job Extras & Rates"]}),l&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-sm text-foreground/70 dark:text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4"}),d.length," technician",d.length!==1?"s":""]}),b>0&&e.jsxs(y,{variant:"secondary",className:A,children:["Total Extras: ",_(b)]})]})]}),e.jsx(f,{className:"space-y-4 sm:space-y-6",children:d.map((s,c)=>{var g,N;const n=`${((g=s.profiles)==null?void 0:g.first_name)??""} ${((N=s.profiles)==null?void 0:N.last_name)??""}`.trim()||"Unnamed Technician",a=r==null?void 0:r.find(k=>k.technician_id===s.technician_id);return e.jsxs("div",{className:$+" rounded-xl p-4 sm:p-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4",children:[e.jsx("h3",{className:"font-semibold",children:n}),a&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground/70 dark:text-muted-foreground",children:[e.jsxs("span",{children:["Extras: ",_(a.extras_total_eur||0)]}),a.vehicle_disclaimer&&e.jsx(y,{variant:"outline",className:"text-xs text-amber-700 border-amber-500/30 bg-amber-500/10 dark:text-amber-200 dark:border-amber-500/40 dark:bg-amber-500/10",children:"Vehicle"})]})]}),e.jsx(D,{jobId:t,technicianId:s.technician_id,technicianName:n,isManager:l,showVehicleDisclaimer:(a==null?void 0:a.vehicle_disclaimer)||!1}),c<m.length-1&&e.jsx(L,{className:"mt-4 sm:mt-6"})]},s.technician_id)})})]})};export{u as D,W as J};
