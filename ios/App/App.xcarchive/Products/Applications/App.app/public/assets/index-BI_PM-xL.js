var le=Object.defineProperty;var he=(s,t,e)=>t in s?le(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var x=(s,t,e)=>he(s,typeof t!="symbol"?t+"":t,e);import{_ as ue}from"./vite-preload-helper-ckwbz45p.js";import{P as fe,L as ge}from"./logo-service-SlbhM6-i.js";import{s as U,aa as _t,i as me}from"./index-NZ6jJLfQ.js";import"./pdf-libs-BqoGqu1a.js";import"./commonjs-helpers-Cpj98o6Y.js";const pe=async(s,t,e)=>{var n;try{const r=e.replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_{2,}/g,"_").replace(/^_|_$/g,"");try{const{data:l,error:d}=await U.storage.from("job-documents").list(`hojas-de-ruta/${s}`);if(!d){if(l&&l.length>0){const h=l.map(w=>`hojas-de-ruta/${s}/${w.name}`),{error:f}=await U.storage.from("job-documents").remove(h)}}const{error:u}=await U.from("job_documents").delete().like("file_path",`hojas-de-ruta/${s}/%`).eq("job_id",s)}catch{}const{data:o,error:a}=await U.storage.from("job-documents").upload(`hojas-de-ruta/${s}/${r}`,t,{cacheControl:"3600",upsert:!1});if(a)throw a;const{data:c}=U.storage.from("job-documents").getPublicUrl(`hojas-de-ruta/${s}/${r}`),{error:i}=await U.from("job_documents").insert({job_id:s,file_name:r,file_path:`hojas-de-ruta/${s}/${r}`,file_type:"application/pdf",file_size:t.size,uploaded_by:(n=(await U.auth.getUser()).data.user)==null?void 0:n.id,original_type:"pdf",visible_to_tech:!0});if(i)throw i;try{U.functions.invoke("push",{body:{action:"broadcast",type:"document.uploaded",job_id:s,file_name:r}})}catch{}}catch(r){throw r}};class De{static addHeaderToCurrentPage(t,e,n,r,o,a){const{width:c}=t.dimensions;if(t.setFillColor(125,1,1),t.addRect(0,0,c,40,"F"),o)try{let d=24,u=8;if(a&&a.width>0&&a.height>0){const h=Math.min(28/a.height,160/a.width);d=Math.max(1,Math.round(a.width*h)),u=Math.max(1,Math.round(a.height*h))}else u=28,d=Math.min(160,Math.round(84));t.addImage(o,"PNG",10,5,d,u)}catch{}if(t.setText(24,[255,255,255]),t.addText(e,c/2,18,{align:"center"}),n&&(t.setText(12,[255,255,255]),t.addText(n,c/2,30,{align:"center"})),r){const i=this.formatJobDate(r);i&&(t.setText(10,[255,255,255]),t.addText(`Fecha del Trabajo: ${i}`,c/2,38,{align:"center"}))}}static formatJobDate(t){try{const e=new Date(t);if(!isNaN(e.getTime())){const n=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();return`${n}/${r}/${o}`}if(/^\d{4}-\d{2}-\d{2}/.test(t)){const[n,r,o]=t.split("-");return`${(o==null?void 0:o.slice(0,2))||"01"}/${r}/${n}`}return t}catch{return null}}}class we{constructor(t,e,n,r="Hoja de Ruta",o,a){this.pdfDoc=t,this.jobName=e,this.jobDate=n,this.headerTitle=r,this.smallLogoData=o,this.smallLogoDims=a}addSectionHeader(t,e=55){this.pdfDoc.addPage(),De.addHeaderToCurrentPage(this.pdfDoc,this.headerTitle,this.jobName,this.jobDate,this.smallLogoData,this.smallLogoDims);const{width:n}=this.pdfDoc.dimensions;return this.pdfDoc.setText(18,[125,1,1]),this.pdfDoc.addText(t,20,e),this.pdfDoc.setFillColor(125,1,1),this.pdfDoc.addRect(20,e+5,n-40,1.5,"F"),e+20}}class Se{constructor(t,e,n,r){this.pdfDoc=t,this.eventData=e,this.jobTitle=n,this.logoData=r}async generateCoverPage(){const{width:t,height:e}=this.pdfDoc.dimensions;if(this.pdfDoc.setFillColor(125,1,1),this.pdfDoc.addRect(0,0,t,e,"F"),this.pdfDoc.setFillColor(95,0,0),this.pdfDoc.addRect(0,0,t,60,"F"),this.pdfDoc.setFillColor(95,0,0),this.pdfDoc.addRect(0,e-50,t,50,"F"),this.pdfDoc.document.setFillColor(145,30,30),this.pdfDoc.document.circle(t-20,20,80,"F"),this.pdfDoc.document.circle(20,e-30,60,"F"),this.pdfDoc.document.setDrawColor(255,255,255),this.pdfDoc.document.setLineWidth(.5),this.pdfDoc.document.rect(15,15,t-30,e-30),this.logoData)try{const h=await new Promise(A=>{const D=new Image;D.onload=()=>{A({width:D.naturalWidth||D.width,height:D.naturalHeight||D.height})},D.onerror=()=>A({width:120,height:40}),D.src=this.logoData}),m=Math.min(70/h.height,220/h.width),M=Math.max(1,Math.round(h.width*m)),S=Math.max(1,Math.round(h.height*m)),b=e/2-30,p=Math.max(80,b-20-S),N=(t-M)/2,C=this.logoData.includes("data:image/png")?"PNG":this.logoData.includes("data:image/jpeg")?"JPEG":"PNG";this.pdfDoc.addImage(this.logoData,C,N,p,M,S)}catch{}this.pdfDoc.setText(42,[255,255,255]);const n=e/2-20;this.pdfDoc.addText("HOJA DE RUTA",t/2,n,{align:"center"}),this.pdfDoc.setFillColor(255,255,255);const r=80;this.pdfDoc.addRect((t-r)/2,n+8,r,1.5,"F");const o=this.eventData.eventName||this.jobTitle||"Evento sin título";this.pdfDoc.setText(26,[255,255,255]);const c=t-35*2,i=e/2+30,l=this.pdfDoc.addWrappedText(o,t/2,i,c,14,"center");this.pdfDoc.setText(14,[255,255,255]);const d=this.eventData.eventDates||new Date().toLocaleDateString("es-ES"),u=i+l*14+15;if(this.pdfDoc.addText(d,t/2,u,{align:"center"}),this.eventData.clientName){const h=e-90;this.pdfDoc.setFillColor(105,0,0),this.pdfDoc.addRect(40,h-5,t-80,25,"F"),this.pdfDoc.setText(14,[255,255,255]),this.pdfDoc.addText(`Cliente: ${this.eventData.clientName}`,t/2,h+8,{align:"center"})}}}class L{static hasData(t){return typeof t=="string"?t.trim()!=="":Array.isArray(t)?t.length>0&&t.some(e=>this.hasData(e)):typeof t=="object"&&t!==null?Object.values(t).some(e=>this.hasData(e)):t!=null}static hasMeaningfulTravelData(t){var e,n,r,o,a,c,i,l,d,u,h;return!!((e=t.transportation_type)!=null&&e.trim()||(n=t.pickup_address)!=null&&n.trim()||(r=t.pickup_time)!=null&&r.trim()||(o=t.departure_time)!=null&&o.trim()||(a=t.arrival_time)!=null&&a.trim()||(c=t.flight_train_number)!=null&&c.trim()||(i=t.company)!=null&&i.trim()||(l=t.driver_name)!=null&&l.trim()||(d=t.driver_phone)!=null&&d.trim()||(u=t.plate_number)!=null&&u.trim()||(h=t.notes)!=null&&h.trim())}static hasMeaningfulRoomData(t){var e,n,r,o;return!!((e=t.room_type)!=null&&e.trim()&&((n=t.room_number)!=null&&n.trim()||(r=t.staff_member1_id)!=null&&r.trim()||(o=t.staff_member2_id)!=null&&o.trim()))}}class Te{constructor(t){this.pdfDoc=t}addEventDetailsSection(t,e){var r;e=this.pdfDoc.checkPageBreak(e),this.pdfDoc.setText(14,[125,1,1]),this.pdfDoc.addText("Detalles del Evento",20,e),e+=15,this.pdfDoc.setText(10,[51,51,51]);const n=[["Evento",t.eventName],["Fechas",t.eventDates],["Cliente",t.clientName],["Hora Inicio",t.eventStartTime],["Hora Fin",t.eventEndTime],["Asistentes Estimados",(r=t.estimatedAttendees)==null?void 0:r.toString()],["Estado",t.eventStatus]].filter(([,o])=>L.hasData(o));return n.length>0&&(this.pdfDoc.addTable({startY:e,body:n,theme:"plain",styles:{fontSize:10,cellPadding:4},columnStyles:{0:{cellWidth:50,fontStyle:"bold",textColor:[125,1,1]},1:{cellWidth:120}},margin:{left:20,right:20},tableWidth:"auto"}),e=this.pdfDoc.getLastAutoTableY()+15),e}}class v{static async ensureGoogleApiKey(){return this.googleApiKey?this.googleApiKey:(this.googleKeyPromise||(this.googleKeyPromise=(async()=>{try{const{data:t,error:e}=await U.functions.invoke("get-google-maps-key");if(e)return null;const n=(t==null?void 0:t.apiKey)||null;return this.googleApiKey=n,n}catch{return null}})()),this.googleKeyPromise)}static async geocodeAddress(t){var e,n,r;try{const o=t.trim().toLowerCase(),a=this.geocodeCache.get(o);if(a)return a;const c=await this.ensureGoogleApiKey();if(c){const i=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(t)}&key=${c}`,l=await fetch(i);if(!l.ok)return null;const d=await l.json(),u=(r=(n=(e=d==null?void 0:d.results)==null?void 0:e[0])==null?void 0:n.geometry)==null?void 0:r.location;if(u&&typeof u.lat=="number"&&typeof u.lng=="number"){const h={lat:u.lat,lng:u.lng};return this.geocodeCache.set(o,h),h}return null}return null}catch{return null}}static async getStaticMapDataUrl(t,e,n=640,r=320,o=14){const a=await this.ensureGoogleApiKey();if(!a)return null;const c=2,i=Math.min(Math.max(Math.floor(n*2),1),640),l=Math.min(Math.max(Math.floor(r*2),1),640),d=`https://maps.googleapis.com/maps/api/staticmap?center=${t},${e}&zoom=${o}&size=${i}x${l}&scale=${c}&format=png&maptype=roadmap&markers=size:tiny%7Ccolor:red%7C${t},${e}&key=${a}`,u=`${t.toFixed(6)},${e.toFixed(6)}:${i}x${l}:google:${o}:s${c}:os2`,h=this.mapCache.get(u);if(h)return h;try{const f=await fetch(d);if(!f.ok)return null;const w=await f.blob(),m=await new Promise((M,S)=>{const b=new FileReader;b.onload=()=>M(b.result),b.onerror=()=>S(new Error("Failed to read map blob")),b.readAsDataURL(w)});return this.mapCache.set(u,m),m}catch{return null}}static generateRouteUrl(t,e){const n="https://www.google.com/maps/dir/",r=encodeURIComponent(t),o=encodeURIComponent(e);return`${n}${r}/${o}`}static generateDestinationUrl(t){const e="https://www.google.com/maps/dir/",n=`?api=1&destination=${encodeURIComponent(t)}`;return`${e}${n}`}static async getMapImageForAddress(t,e,n,r=14){try{const o=await this.ensureGoogleApiKey();if(!o)return null;const a=2,c=Math.min(Math.max(Math.floor(e*2),1),640),i=Math.min(Math.max(Math.floor(n*2),1),640),l=`${t.trim().toLowerCase()}:${c}x${i}:google:${r}:s${a}:os2`,d=this.mapCache.get(l);if(d)return d;const u=`https://maps.googleapis.com/maps/api/staticmap?center=${encodeURIComponent(t)}&zoom=${r}&size=${c}x${i}&scale=${a}&format=png&maptype=roadmap&markers=size:tiny%7Ccolor:red%7C${encodeURIComponent(t)}&key=${o}`,h=await fetch(u);if(!h.ok)return null;const f=await h.blob(),w=await new Promise((m,M)=>{const S=new FileReader;S.onload=()=>m(S.result),S.onerror=()=>M(new Error("Failed to read map blob")),S.readAsDataURL(f)});return this.mapCache.set(l,w),w}catch{return null}}}x(v,"geocodeCache",new Map),x(v,"mapCache",new Map),x(v,"googleApiKey",null),x(v,"googleKeyPromise",null);var O={},et,Nt;function Ce(){return Nt||(Nt=1,et=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),et}var nt={},W={},Bt;function P(){if(Bt)return W;Bt=1;let s;const t=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return W.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},W.getSymbolTotalCodewords=function(n){return t[n]},W.getBCHDigit=function(e){let n=0;for(;e!==0;)n++,e>>>=1;return n},W.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');s=n},W.isKanjiModeEnabled=function(){return typeof s<"u"},W.toSJIS=function(n){return s(n)},W}var rt={},Lt;function Et(){return Lt||(Lt=1,(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+e)}}s.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},s.from=function(n,r){if(s.isValid(n))return n;try{return t(n)}catch{return r}}})(rt)),rt}var ot,xt;function be(){if(xt)return ot;xt=1;function s(){this.buffer=[],this.length=0}return s.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let n=0;n<e;n++)this.putBit((t>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}},ot=s,ot}var at,vt;function Ae(){if(vt)return at;vt=1;function s(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}return s.prototype.set=function(t,e,n,r){const o=t*this.size+e;this.data[o]=n,r&&(this.reservedBit[o]=!0)},s.prototype.get=function(t,e){return this.data[t*this.size+e]},s.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n},s.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]},at=s,at}var it={},It;function Ee(){return It||(It=1,(function(s){const t=P().getSymbolSize;s.getRowColCoords=function(n){if(n===1)return[];const r=Math.floor(n/7)+2,o=t(n),a=o===145?26:Math.ceil((o-13)/(2*r-2))*2,c=[o-7];for(let i=1;i<r-1;i++)c[i]=c[i-1]-a;return c.push(6),c.reverse()},s.getPositions=function(n){const r=[],o=s.getRowColCoords(n),a=o.length;for(let c=0;c<a;c++)for(let i=0;i<a;i++)c===0&&i===0||c===0&&i===a-1||c===a-1&&i===0||r.push([o[c],o[i]]);return r}})(it)),it}var st={},kt;function Me(){if(kt)return st;kt=1;const s=P().getSymbolSize,t=7;return st.getPositions=function(n){const r=s(n);return[[0,0],[r-t,0],[0,r-t]]},st}var ct={},Ft;function ye(){return Ft||(Ft=1,(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};s.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},s.from=function(r){return s.isValid(r)?parseInt(r,10):void 0},s.getPenaltyN1=function(r){const o=r.size;let a=0,c=0,i=0,l=null,d=null;for(let u=0;u<o;u++){c=i=0,l=d=null;for(let h=0;h<o;h++){let f=r.get(u,h);f===l?c++:(c>=5&&(a+=t.N1+(c-5)),l=f,c=1),f=r.get(h,u),f===d?i++:(i>=5&&(a+=t.N1+(i-5)),d=f,i=1)}c>=5&&(a+=t.N1+(c-5)),i>=5&&(a+=t.N1+(i-5))}return a},s.getPenaltyN2=function(r){const o=r.size;let a=0;for(let c=0;c<o-1;c++)for(let i=0;i<o-1;i++){const l=r.get(c,i)+r.get(c,i+1)+r.get(c+1,i)+r.get(c+1,i+1);(l===4||l===0)&&a++}return a*t.N2},s.getPenaltyN3=function(r){const o=r.size;let a=0,c=0,i=0;for(let l=0;l<o;l++){c=i=0;for(let d=0;d<o;d++)c=c<<1&2047|r.get(l,d),d>=10&&(c===1488||c===93)&&a++,i=i<<1&2047|r.get(d,l),d>=10&&(i===1488||i===93)&&a++}return a*t.N3},s.getPenaltyN4=function(r){let o=0;const a=r.data.length;for(let i=0;i<a;i++)o+=r.data[i];return Math.abs(Math.ceil(o*100/a/5)-10)*t.N4};function e(n,r,o){switch(n){case s.Patterns.PATTERN000:return(r+o)%2===0;case s.Patterns.PATTERN001:return r%2===0;case s.Patterns.PATTERN010:return o%3===0;case s.Patterns.PATTERN011:return(r+o)%3===0;case s.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(o/3))%2===0;case s.Patterns.PATTERN101:return r*o%2+r*o%3===0;case s.Patterns.PATTERN110:return(r*o%2+r*o%3)%2===0;case s.Patterns.PATTERN111:return(r*o%3+(r+o)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}s.applyMask=function(r,o){const a=o.size;for(let c=0;c<a;c++)for(let i=0;i<a;i++)o.isReserved(i,c)||o.xor(i,c,e(r,i,c))},s.getBestMask=function(r,o){const a=Object.keys(s.Patterns).length;let c=0,i=1/0;for(let l=0;l<a;l++){o(l),s.applyMask(l,r);const d=s.getPenaltyN1(r)+s.getPenaltyN2(r)+s.getPenaltyN3(r)+s.getPenaltyN4(r);s.applyMask(l,r),d<i&&(i=d,c=l)}return c}})(ct)),ct}var J={},Ht;function re(){if(Ht)return J;Ht=1;const s=Et(),t=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],e=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return J.getBlocksCount=function(r,o){switch(o){case s.L:return t[(r-1)*4+0];case s.M:return t[(r-1)*4+1];case s.Q:return t[(r-1)*4+2];case s.H:return t[(r-1)*4+3];default:return}},J.getTotalCodewordsCount=function(r,o){switch(o){case s.L:return e[(r-1)*4+0];case s.M:return e[(r-1)*4+1];case s.Q:return e[(r-1)*4+2];case s.H:return e[(r-1)*4+3];default:return}},J}var dt={},G={},Ut;function Re(){if(Ut)return G;Ut=1;const s=new Uint8Array(512),t=new Uint8Array(256);return(function(){let n=1;for(let r=0;r<255;r++)s[r]=n,t[n]=r,n<<=1,n&256&&(n^=285);for(let r=255;r<512;r++)s[r]=s[r-255]})(),G.log=function(n){if(n<1)throw new Error("log("+n+")");return t[n]},G.exp=function(n){return s[n]},G.mul=function(n,r){return n===0||r===0?0:s[t[n]+t[r]]},G}var qt;function _e(){return qt||(qt=1,(function(s){const t=Re();s.mul=function(n,r){const o=new Uint8Array(n.length+r.length-1);for(let a=0;a<n.length;a++)for(let c=0;c<r.length;c++)o[a+c]^=t.mul(n[a],r[c]);return o},s.mod=function(n,r){let o=new Uint8Array(n);for(;o.length-r.length>=0;){const a=o[0];for(let i=0;i<r.length;i++)o[i]^=t.mul(r[i],a);let c=0;for(;c<o.length&&o[c]===0;)c++;o=o.slice(c)}return o},s.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let o=0;o<n;o++)r=s.mul(r,new Uint8Array([1,t.exp(o)]));return r}})(dt)),dt}var lt,Wt;function Ne(){if(Wt)return lt;Wt=1;const s=_e();function t(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}return t.prototype.initialize=function(n){this.degree=n,this.genPoly=s.generateECPolynomial(this.degree)},t.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const r=new Uint8Array(n.length+this.degree);r.set(n);const o=s.mod(r,this.genPoly),a=this.degree-o.length;if(a>0){const c=new Uint8Array(this.degree);return c.set(o,a),c}return o},lt=t,lt}var ht={},ut={},ft={},Pt;function oe(){return Pt||(Pt=1,ft.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40}),ft}var k={},Yt;function ae(){if(Yt)return k;Yt=1;const s="[0-9]+",t="[A-Z $%*+\\-./:]+";let e="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";e=e.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+e+`)(?:.|[\r
]))+`;k.KANJI=new RegExp(e,"g"),k.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),k.BYTE=new RegExp(n,"g"),k.NUMERIC=new RegExp(s,"g"),k.ALPHANUMERIC=new RegExp(t,"g");const r=new RegExp("^"+e+"$"),o=new RegExp("^"+s+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return k.testKanji=function(i){return r.test(i)},k.testNumeric=function(i){return o.test(i)},k.testAlphanumeric=function(i){return a.test(i)},k}var zt;function Y(){return zt||(zt=1,(function(s){const t=oe(),e=ae();s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(o,a){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!t.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?o.ccBits[0]:a<27?o.ccBits[1]:o.ccBits[2]},s.getBestModeForData=function(o){return e.testNumeric(o)?s.NUMERIC:e.testAlphanumeric(o)?s.ALPHANUMERIC:e.testKanji(o)?s.KANJI:s.BYTE},s.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},s.isValid=function(o){return o&&o.bit&&o.ccBits};function n(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+r)}}s.from=function(o,a){if(s.isValid(o))return o;try{return n(o)}catch{return a}}})(ut)),ut}var Ot;function Be(){return Ot||(Ot=1,(function(s){const t=P(),e=re(),n=Et(),r=Y(),o=oe(),a=7973,c=t.getBCHDigit(a);function i(h,f,w){for(let m=1;m<=40;m++)if(f<=s.getCapacity(m,w,h))return m}function l(h,f){return r.getCharCountIndicator(h,f)+4}function d(h,f){let w=0;return h.forEach(function(m){const M=l(m.mode,f);w+=M+m.getBitsLength()}),w}function u(h,f){for(let w=1;w<=40;w++)if(d(h,w)<=s.getCapacity(w,f,r.MIXED))return w}s.from=function(f,w){return o.isValid(f)?parseInt(f,10):w},s.getCapacity=function(f,w,m){if(!o.isValid(f))throw new Error("Invalid QR Code version");typeof m>"u"&&(m=r.BYTE);const M=t.getSymbolTotalCodewords(f),S=e.getTotalCodewordsCount(f,w),b=(M-S)*8;if(m===r.MIXED)return b;const g=b-l(m,f);switch(m){case r.NUMERIC:return Math.floor(g/10*3);case r.ALPHANUMERIC:return Math.floor(g/11*2);case r.KANJI:return Math.floor(g/13);case r.BYTE:default:return Math.floor(g/8)}},s.getBestVersionForData=function(f,w){let m;const M=n.from(w,n.M);if(Array.isArray(f)){if(f.length>1)return u(f,M);if(f.length===0)return 1;m=f[0]}else m=f;return i(m.mode,m.getLength(),M)},s.getEncodedBits=function(f){if(!o.isValid(f)||f<7)throw new Error("Invalid QR Code version");let w=f<<12;for(;t.getBCHDigit(w)-c>=0;)w^=a<<t.getBCHDigit(w)-c;return f<<12|w}})(ht)),ht}var gt={},jt;function Le(){if(jt)return gt;jt=1;const s=P(),t=1335,e=21522,n=s.getBCHDigit(t);return gt.getEncodedBits=function(o,a){const c=o.bit<<3|a;let i=c<<10;for(;s.getBCHDigit(i)-n>=0;)i^=t<<s.getBCHDigit(i)-n;return(c<<10|i)^e},gt}var mt={},pt,Vt;function xe(){if(Vt)return pt;Vt=1;const s=Y();function t(e){this.mode=s.NUMERIC,this.data=e.toString()}return t.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(n){let r,o,a;for(r=0;r+3<=this.data.length;r+=3)o=this.data.substr(r,3),a=parseInt(o,10),n.put(a,10);const c=this.data.length-r;c>0&&(o=this.data.substr(r),a=parseInt(o,10),n.put(a,c*3+1))},pt=t,pt}var Dt,Gt;function ve(){if(Gt)return Dt;Gt=1;const s=Y(),t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function e(n){this.mode=s.ALPHANUMERIC,this.data=n}return e.getBitsLength=function(r){return 11*Math.floor(r/2)+6*(r%2)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let o;for(o=0;o+2<=this.data.length;o+=2){let a=t.indexOf(this.data[o])*45;a+=t.indexOf(this.data[o+1]),r.put(a,11)}this.data.length%2&&r.put(t.indexOf(this.data[o]),6)},Dt=e,Dt}var wt,Kt;function Ie(){if(Kt)return wt;Kt=1;const s=Y();function t(e){this.mode=s.BYTE,typeof e=="string"?this.data=new TextEncoder().encode(e):this.data=new Uint8Array(e)}return t.getBitsLength=function(n){return n*8},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(e){for(let n=0,r=this.data.length;n<r;n++)e.put(this.data[n],8)},wt=t,wt}var St,Jt;function ke(){if(Jt)return St;Jt=1;const s=Y(),t=P();function e(n){this.mode=s.KANJI,this.data=n}return e.getBitsLength=function(r){return r*13},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){let r;for(r=0;r<this.data.length;r++){let o=t.toSJIS(this.data[r]);if(o>=33088&&o<=40956)o-=33088;else if(o>=57408&&o<=60351)o-=49472;else throw new Error("Invalid SJIS character: "+this.data[r]+`
Make sure your charset is UTF-8`);o=(o>>>8&255)*192+(o&255),n.put(o,13)}},St=e,St}var Tt={exports:{}},Xt;function Fe(){return Xt||(Xt=1,(function(s){var t={single_source_shortest_paths:function(e,n,r){var o={},a={};a[n]=0;var c=t.PriorityQueue.make();c.push(n,0);for(var i,l,d,u,h,f,w,m,M;!c.empty();){i=c.pop(),l=i.value,u=i.cost,h=e[l]||{};for(d in h)h.hasOwnProperty(d)&&(f=h[d],w=u+f,m=a[d],M=typeof a[d]>"u",(M||m>w)&&(a[d]=w,c.push(d,w),o[d]=l))}if(typeof r<"u"&&typeof a[r]>"u"){var S=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(S)}return o},extract_shortest_path_from_predecessor_list:function(e,n){for(var r=[],o=n;o;)r.push(o),e[o],o=e[o];return r.reverse(),r},find_path:function(e,n,r){var o=t.single_source_shortest_paths(e,n,r);return t.extract_shortest_path_from_predecessor_list(o,r)},PriorityQueue:{make:function(e){var n=t.PriorityQueue,r={},o;e=e||{};for(o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);return r.queue=[],r.sorter=e.sorter||n.default_sorter,r},default_sorter:function(e,n){return e.cost-n.cost},push:function(e,n){var r={value:e,cost:n};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=t})(Tt)),Tt.exports}var $t;function He(){return $t||($t=1,(function(s){const t=Y(),e=xe(),n=ve(),r=Ie(),o=ke(),a=ae(),c=P(),i=Fe();function l(S){return unescape(encodeURIComponent(S)).length}function d(S,b,g){const p=[];let N;for(;(N=S.exec(g))!==null;)p.push({data:N[0],index:N.index,mode:b,length:N[0].length});return p}function u(S){const b=d(a.NUMERIC,t.NUMERIC,S),g=d(a.ALPHANUMERIC,t.ALPHANUMERIC,S);let p,N;return c.isKanjiModeEnabled()?(p=d(a.BYTE,t.BYTE,S),N=d(a.KANJI,t.KANJI,S)):(p=d(a.BYTE_KANJI,t.BYTE,S),N=[]),b.concat(g,p,N).sort(function(A,D){return A.index-D.index}).map(function(A){return{data:A.data,mode:A.mode,length:A.length}})}function h(S,b){switch(b){case t.NUMERIC:return e.getBitsLength(S);case t.ALPHANUMERIC:return n.getBitsLength(S);case t.KANJI:return o.getBitsLength(S);case t.BYTE:return r.getBitsLength(S)}}function f(S){return S.reduce(function(b,g){const p=b.length-1>=0?b[b.length-1]:null;return p&&p.mode===g.mode?(b[b.length-1].data+=g.data,b):(b.push(g),b)},[])}function w(S){const b=[];for(let g=0;g<S.length;g++){const p=S[g];switch(p.mode){case t.NUMERIC:b.push([p,{data:p.data,mode:t.ALPHANUMERIC,length:p.length},{data:p.data,mode:t.BYTE,length:p.length}]);break;case t.ALPHANUMERIC:b.push([p,{data:p.data,mode:t.BYTE,length:p.length}]);break;case t.KANJI:b.push([p,{data:p.data,mode:t.BYTE,length:l(p.data)}]);break;case t.BYTE:b.push([{data:p.data,mode:t.BYTE,length:l(p.data)}])}}return b}function m(S,b){const g={},p={start:{}};let N=["start"];for(let C=0;C<S.length;C++){const A=S[C],D=[];for(let T=0;T<A.length;T++){const R=A[T],E=""+C+T;D.push(E),g[E]={node:R,lastCount:0},p[E]={};for(let y=0;y<N.length;y++){const _=N[y];g[_]&&g[_].node.mode===R.mode?(p[_][E]=h(g[_].lastCount+R.length,R.mode)-h(g[_].lastCount,R.mode),g[_].lastCount+=R.length):(g[_]&&(g[_].lastCount=R.length),p[_][E]=h(R.length,R.mode)+4+t.getCharCountIndicator(R.mode,b))}}N=D}for(let C=0;C<N.length;C++)p[N[C]].end=0;return{map:p,table:g}}function M(S,b){let g;const p=t.getBestModeForData(S);if(g=t.from(b,p),g!==t.BYTE&&g.bit<p.bit)throw new Error('"'+S+'" cannot be encoded with mode '+t.toString(g)+`.
 Suggested mode is: `+t.toString(p));switch(g===t.KANJI&&!c.isKanjiModeEnabled()&&(g=t.BYTE),g){case t.NUMERIC:return new e(S);case t.ALPHANUMERIC:return new n(S);case t.KANJI:return new o(S);case t.BYTE:return new r(S)}}s.fromArray=function(b){return b.reduce(function(g,p){return typeof p=="string"?g.push(M(p,null)):p.data&&g.push(M(p.data,p.mode)),g},[])},s.fromString=function(b,g){const p=u(b,c.isKanjiModeEnabled()),N=w(p),C=m(N,g),A=i.find_path(C.map,"start","end"),D=[];for(let T=1;T<A.length-1;T++)D.push(C.table[A[T]].node);return s.fromArray(f(D))},s.rawSplit=function(b){return s.fromArray(u(b,c.isKanjiModeEnabled()))}})(mt)),mt}var Qt;function Ue(){if(Qt)return nt;Qt=1;const s=P(),t=Et(),e=be(),n=Ae(),r=Ee(),o=Me(),a=ye(),c=re(),i=Ne(),l=Be(),d=Le(),u=Y(),h=He();function f(C,A){const D=C.size,T=o.getPositions(A);for(let R=0;R<T.length;R++){const E=T[R][0],y=T[R][1];for(let _=-1;_<=7;_++)if(!(E+_<=-1||D<=E+_))for(let B=-1;B<=7;B++)y+B<=-1||D<=y+B||(_>=0&&_<=6&&(B===0||B===6)||B>=0&&B<=6&&(_===0||_===6)||_>=2&&_<=4&&B>=2&&B<=4?C.set(E+_,y+B,!0,!0):C.set(E+_,y+B,!1,!0))}}function w(C){const A=C.size;for(let D=8;D<A-8;D++){const T=D%2===0;C.set(D,6,T,!0),C.set(6,D,T,!0)}}function m(C,A){const D=r.getPositions(A);for(let T=0;T<D.length;T++){const R=D[T][0],E=D[T][1];for(let y=-2;y<=2;y++)for(let _=-2;_<=2;_++)y===-2||y===2||_===-2||_===2||y===0&&_===0?C.set(R+y,E+_,!0,!0):C.set(R+y,E+_,!1,!0)}}function M(C,A){const D=C.size,T=l.getEncodedBits(A);let R,E,y;for(let _=0;_<18;_++)R=Math.floor(_/3),E=_%3+D-8-3,y=(T>>_&1)===1,C.set(R,E,y,!0),C.set(E,R,y,!0)}function S(C,A,D){const T=C.size,R=d.getEncodedBits(A,D);let E,y;for(E=0;E<15;E++)y=(R>>E&1)===1,E<6?C.set(E,8,y,!0):E<8?C.set(E+1,8,y,!0):C.set(T-15+E,8,y,!0),E<8?C.set(8,T-E-1,y,!0):E<9?C.set(8,15-E-1+1,y,!0):C.set(8,15-E-1,y,!0);C.set(T-8,8,1,!0)}function b(C,A){const D=C.size;let T=-1,R=D-1,E=7,y=0;for(let _=D-1;_>0;_-=2)for(_===6&&_--;;){for(let B=0;B<2;B++)if(!C.isReserved(R,_-B)){let q=!1;y<A.length&&(q=(A[y]>>>E&1)===1),C.set(R,_-B,q),E--,E===-1&&(y++,E=7)}if(R+=T,R<0||D<=R){R-=T,T=-T;break}}}function g(C,A,D){const T=new e;D.forEach(function(B){T.put(B.mode.bit,4),T.put(B.getLength(),u.getCharCountIndicator(B.mode,C)),B.write(T)});const R=s.getSymbolTotalCodewords(C),E=c.getTotalCodewordsCount(C,A),y=(R-E)*8;for(T.getLengthInBits()+4<=y&&T.put(0,4);T.getLengthInBits()%8!==0;)T.putBit(0);const _=(y-T.getLengthInBits())/8;for(let B=0;B<_;B++)T.put(B%2?17:236,8);return p(T,C,A)}function p(C,A,D){const T=s.getSymbolTotalCodewords(A),R=c.getTotalCodewordsCount(A,D),E=T-R,y=c.getBlocksCount(A,D),_=T%y,B=y-_,q=Math.floor(T/y),V=Math.floor(E/y),se=V+1,Mt=q-V,ce=new i(Mt);let $=0;const K=new Array(y),yt=new Array(y);let Q=0;const de=new Uint8Array(C.buffer);for(let z=0;z<y;z++){const tt=z<B?V:se;K[z]=de.slice($,$+tt),yt[z]=ce.encode(K[z]),$+=tt,Q=Math.max(Q,tt)}const Z=new Uint8Array(T);let Rt=0,F,H;for(F=0;F<Q;F++)for(H=0;H<y;H++)F<K[H].length&&(Z[Rt++]=K[H][F]);for(F=0;F<Mt;F++)for(H=0;H<y;H++)Z[Rt++]=yt[H][F];return Z}function N(C,A,D,T){let R;if(Array.isArray(C))R=h.fromArray(C);else if(typeof C=="string"){let q=A;if(!q){const V=h.rawSplit(C);q=l.getBestVersionForData(V,D)}R=h.fromString(C,q||40)}else throw new Error("Invalid data");const E=l.getBestVersionForData(R,D);if(!E)throw new Error("The amount of data is too big to be stored in a QR Code");if(!A)A=E;else if(A<E)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+E+`.
`);const y=g(A,D,R),_=s.getSymbolSize(A),B=new n(_);return f(B,A),w(B),m(B,A),S(B,D,0),A>=7&&M(B,A),b(B,y),isNaN(T)&&(T=a.getBestMask(B,S.bind(null,B,D))),a.applyMask(T,B),S(B,D,T),{modules:B,version:A,errorCorrectionLevel:D,maskPattern:T,segments:R}}return nt.create=function(A,D){if(typeof A>"u"||A==="")throw new Error("No input text");let T=t.M,R,E;return typeof D<"u"&&(T=t.from(D.errorCorrectionLevel,t.M),R=l.from(D.version),E=a.from(D.maskPattern),D.toSJISFunc&&s.setToSJISFunction(D.toSJISFunc)),N(A,R,T,E)},nt}var Ct={},bt={},Zt;function ie(){return Zt||(Zt=1,(function(s){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let n=e.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+e);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(o){return[o,o]}))),n.length===6&&n.push("F","F");const r=parseInt(n.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+n.slice(0,6).join("")}}s.getOptions=function(n){n||(n={}),n.color||(n.color={});const r=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,o=n.width&&n.width>=21?n.width:void 0,a=n.scale||4;return{width:o,scale:o?4:a,margin:r,color:{dark:t(n.color.dark||"#000000ff"),light:t(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},s.getScale=function(n,r){return r.width&&r.width>=n+r.margin*2?r.width/(n+r.margin*2):r.scale},s.getImageWidth=function(n,r){const o=s.getScale(n,r);return Math.floor((n+r.margin*2)*o)},s.qrToImageData=function(n,r,o){const a=r.modules.size,c=r.modules.data,i=s.getScale(a,o),l=Math.floor((a+o.margin*2)*i),d=o.margin*i,u=[o.color.light,o.color.dark];for(let h=0;h<l;h++)for(let f=0;f<l;f++){let w=(h*l+f)*4,m=o.color.light;if(h>=d&&f>=d&&h<l-d&&f<l-d){const M=Math.floor((h-d)/i),S=Math.floor((f-d)/i);m=u[c[M*a+S]?1:0]}n[w++]=m.r,n[w++]=m.g,n[w++]=m.b,n[w]=m.a}}})(bt)),bt}var te;function qe(){return te||(te=1,(function(s){const t=ie();function e(r,o,a){r.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=a,o.width=a,o.style.height=a+"px",o.style.width=a+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(o,a,c){let i=c,l=a;typeof i>"u"&&(!a||!a.getContext)&&(i=a,a=void 0),a||(l=n()),i=t.getOptions(i);const d=t.getImageWidth(o.modules.size,i),u=l.getContext("2d"),h=u.createImageData(d,d);return t.qrToImageData(h.data,o,i),e(u,l,d),u.putImageData(h,0,0),l},s.renderToDataURL=function(o,a,c){let i=c;typeof i>"u"&&(!a||!a.getContext)&&(i=a,a=void 0),i||(i={});const l=s.render(o,a,i),d=i.type||"image/png",u=i.rendererOpts||{};return l.toDataURL(d,u.quality)}})(Ct)),Ct}var At={},ee;function We(){if(ee)return At;ee=1;const s=ie();function t(r,o){const a=r.a/255,c=o+'="'+r.hex+'"';return a<1?c+" "+o+'-opacity="'+a.toFixed(2).slice(1)+'"':c}function e(r,o,a){let c=r+o;return typeof a<"u"&&(c+=" "+a),c}function n(r,o,a){let c="",i=0,l=!1,d=0;for(let u=0;u<r.length;u++){const h=Math.floor(u%o),f=Math.floor(u/o);!h&&!l&&(l=!0),r[u]?(d++,u>0&&h>0&&r[u-1]||(c+=l?e("M",h+a,.5+f+a):e("m",i,0),i=0,l=!1),h+1<o&&r[u+1]||(c+=e("h",d),d=0)):i++}return c}return At.render=function(o,a,c){const i=s.getOptions(a),l=o.modules.size,d=o.modules.data,u=l+i.margin*2,h=i.color.light.a?"<path "+t(i.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",f="<path "+t(i.color.dark,"stroke")+' d="'+n(d,l,i.margin)+'"/>',w='viewBox="0 0 '+u+" "+u+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+w+' shape-rendering="crispEdges">'+h+f+`</svg>
`;return typeof c=="function"&&c(null,M),M},At}var ne;function Pe(){if(ne)return O;ne=1;const s=Ce(),t=Ue(),e=qe(),n=We();function r(o,a,c,i,l){const d=[].slice.call(arguments,1),u=d.length,h=typeof d[u-1]=="function";if(!h&&!s())throw new Error("Callback required as last argument");if(h){if(u<2)throw new Error("Too few arguments provided");u===2?(l=c,c=a,a=i=void 0):u===3&&(a.getContext&&typeof l>"u"?(l=i,i=void 0):(l=i,i=c,c=a,a=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(c=a,a=i=void 0):u===2&&!a.getContext&&(i=c,c=a,a=void 0),new Promise(function(f,w){try{const m=t.create(c,i);f(o(m,a,i))}catch(m){w(m)}})}try{const f=t.create(c,i);l(null,o(f,a,i))}catch(f){l(f)}}return O.create=t.create,O.toCanvas=r.bind(null,e.render),O.toDataURL=r.bind(null,e.renderToDataURL),O.toString=r.bind(null,function(o,a,c){return n.render(o,c)}),O}var Ye=Pe();class X{static async generateQRCode(t){try{return await Ye.toDataURL(t,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}})}catch(e){throw e}}}class ze{constructor(t){this.pdfDoc=t}async addVenueSection(t,e,n,r){var c,i,l,d;n=this.pdfDoc.checkPageBreak(n,50),this.pdfDoc.setText(14,[125,1,1]),this.pdfDoc.addText("Venue",20,n),n+=15,this.pdfDoc.setText(10,[51,51,51]);const o=[["Nombre",(c=t.venue)==null?void 0:c.name],["Dirección",(i=t.venue)==null?void 0:i.address],["Tipo",t.venueType],["Capacidad",(l=t.venueCapacity)==null?void 0:l.toString()]].filter(([,u])=>L.hasData(u));o.length>0&&(this.pdfDoc.addTable({startY:n,body:o,theme:"plain",styles:{fontSize:10,cellPadding:4},columnStyles:{0:{cellWidth:50,fontStyle:"bold",textColor:[125,1,1]},1:{cellWidth:120}},margin:{left:20,right:20},tableWidth:"auto"}),n=this.pdfDoc.getLastAutoTableY()+15);let a=[];if(r&&r.length>0&&(a=r.slice(0,2)),a.length>0){n=this.pdfDoc.checkPageBreak(n,90),this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Imágenes del Venue",20,n),n+=12;const u=20,h=20,f=10,{width:w}=this.pdfDoc.dimensions,m=w-u-h,M=Math.floor((m-f)/2),S=60;let b=u;for(const g of a){try{this.pdfDoc.addImage(g,"JPEG",b,n,M,S)}catch{try{this.pdfDoc.addImage(g,"PNG",b,n,M,S)}catch{}}this.pdfDoc.document.setDrawColor(210,210,210),this.pdfDoc.document.setLineWidth(.3),this.pdfDoc.document.rect(b,n,M,S),b+=M+f}n+=S+10}if((d=t.venue)!=null&&d.address){n=this.pdfDoc.checkPageBreak(n,120);const u=20,h=20,f=10,w=60,m=50,{width:M}=this.pdfDoc.dimensions,S=M-u-h,b=100,g=S>=b+f+m,p=g?b:S,N=u,C=n,A=g?Math.min(u+p+f,M-h-m):u,D=g?n:n+w+10;let T=null;try{T=await v.getMapImageForAddress(t.venue.address,p,w)}catch{}if(!T&&e&&(T=e),T){try{this.pdfDoc.addImage(T,"PNG",N,C,p,w)}catch{try{this.pdfDoc.addImage(T,"JPEG",N,C,p,w)}catch{this.pdfDoc.addText("[MAPA NO DISPONIBLE]",N,C+w/2)}}this.pdfDoc.document.setDrawColor(200,200,200),this.pdfDoc.document.setLineWidth(.3),this.pdfDoc.document.rect(N,C,p,w)}else this.pdfDoc.addText("[MAPA NO DISPONIBLE]",N,C+w/2);try{const E=v.generateDestinationUrl(t.venue.address),y=await X.generateQRCode(E);this.pdfDoc.addImage(y,"PNG",A,D,m,m),this.pdfDoc.addLink(E,A,D,m,m),this.pdfDoc.setText(8,[51,51,51]),this.pdfDoc.addText("Escanea para direcciones",A,D+m+6)}catch{}n=(g?Math.max(C+w,D+m):D+m)+15}return n}}class I{static formatCurrency(t,e="EUR"){return new Intl.NumberFormat("es-ES",{style:"currency",currency:e}).format(t)}static formatPhone(t){if(!t)return"N/A";const e=t.replace(/\D/g,"");return e.length===9?`${e.slice(0,3)} ${e.slice(3,6)} ${e.slice(6)}`:t}static translateTransportType(t){return t?{van:"Furgoneta",sleeper_bus:"Autobús Cama",train:"Tren",plane:"Avión",RV:"Autocaravana",own_means:"Medios propios",trailer:"Trailer","9m":"9m","8m":"8m","6m":"6m","4m":"4m",furgoneta:"Furgoneta"}[t]||t:"N/A"}static translateCompany(t){return t?{pantoja:"Pantoja",transluminaria:"Transluminaria",transcamarena:"Transcamarena","wild tour":"Wild Tour",camionaje:"Camionaje","sector-pro":"Sector-Pro",other:"Otro"}[t]||t:""}static formatTime(t){if(!t)return"N/A";try{if(t.includes("T")||t.includes("-")){const e=new Date(t);if(!isNaN(e.getTime()))return _t(e,"Europe/Madrid","HH:mm")}return me(new Date(`2000-01-01T${t}`),"HH:mm")}catch{return t}}static formatDateTime(t){if(!t)return"N/A";try{const e=new Date(t);return isNaN(e.getTime())?t:_t(e,"Europe/Madrid","dd/MM/yy - HH:mm")}catch{return t}}static getStaffName(t,e){if(!t||!e)return"Por asignar";const n=parseInt(t);if(!isNaN(n)&&n>=0&&n<e.length){const o=e[n];if(o){if(o.profiles)return`${o.profiles.first_name||""} ${o.profiles.last_name||""}`.trim();if(o.name||o.surname1)return`${o.name||""} ${o.surname1||""} ${o.surname2||""}`.trim();if(o.first_name||o.last_name)return`${o.first_name||""} ${o.last_name||""}`.trim()}}let r=e.find(o=>{var a;return o.id===t||((a=o.id)==null?void 0:a.toString())===t});if(r||(r=e.find(o=>{var a,c,i;return o.user_id===t||o.technician_id===t||o.staff_id===t||((a=o.user_id)==null?void 0:a.toString())===t||((c=o.technician_id)==null?void 0:c.toString())===t||((i=o.staff_id)==null?void 0:i.toString())===t})),r){if(r.profiles)return`${r.profiles.first_name||""} ${r.profiles.last_name||""}`.trim();if(r.name||r.surname1)return`${r.name||""} ${r.surname1||""} ${r.surname2||""}`.trim();if(r.first_name||r.last_name)return`${r.first_name||""} ${r.last_name||""}`.trim()}return typeof t=="string"&&/[a-zA-Z]/.test(t)?t:"Por asignar"}}class Oe{constructor(t){this.pdfDoc=t}addContactsSection(t,e){var o;e=this.pdfDoc.checkPageBreak(e,30);const n=((o=t.contacts)==null?void 0:o.filter(a=>L.hasData(a.name)||L.hasData(a.role)||L.hasData(a.phone)))||[];if(n.length===0)return e;const r=n.map(a=>[a.name||"",a.role||"",I.formatPhone(a.phone||"")]);return this.pdfDoc.addTable({startY:e,head:[["Nombre","Cargo","Teléfono"]],body:r,theme:"grid",styles:{fontSize:9,cellPadding:4,valign:"top",overflow:"linebreak"},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:10,fontStyle:"bold"},alternateRowStyles:{fillColor:[250,245,245]},margin:{left:20,right:20},tableWidth:"auto"}),this.pdfDoc.getLastAutoTableY()+10}}class je{constructor(t){this.pdfDoc=t}addStaffSection(t,e){var o;e=this.pdfDoc.checkPageBreak(e,30);const n=((o=t.staff)==null?void 0:o.filter(a=>L.hasData(a.name)||L.hasData(a.position)||L.hasData(a.dni)))||[];if(n.length===0)return e;const r=n.map(a=>[(a.name||"").trim(),`${a.surname1||""} ${a.surname2||""}`.trim(),a.position||"",a.dni||"—"]);return this.pdfDoc.addTable({startY:e,head:[["Nombre","Apellidos","Posición","DNI"]],body:r,theme:"grid",styles:{fontSize:9,cellPadding:4,overflow:"linebreak"},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:10,fontStyle:"bold"},alternateRowStyles:{fillColor:[250,245,245]},margin:{left:20,right:20},tableWidth:"auto"}),this.pdfDoc.getLastAutoTableY()+10}}class Ve{constructor(t){this.pdfDoc=t}async addTravelSection(t,e,n){var o;const r=t.filter(L.hasMeaningfulTravelData);if(r.length===0)return e;e=this.pdfDoc.checkPageBreak(e);for(const a of r){e=this.pdfDoc.checkPageBreak(e,120),this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText(`Transporte: ${I.translateTransportType(a.transportation_type)}`,30,e),e+=15;const c=[["Recogida",a.pickup_address],["Fecha/Hora Recogida",I.formatDateTime(a.pickup_time||"")],["Fecha/Hora Salida",I.formatDateTime(a.departure_time||"")],["Fecha/Hora Llegada",I.formatDateTime(a.arrival_time||"")],["Vuelo/Tren",a.flight_train_number],["Compañía",I.translateCompany(a.company)],["Conductor",a.driver_name],["Teléfono",I.formatPhone(a.driver_phone||"")],["Matrícula",a.plate_number],["Notas",a.notes]].filter(([,i])=>L.hasData(i));if(c.length>0&&(this.pdfDoc.addTable({startY:e,body:c,theme:"plain",styles:{fontSize:10,cellPadding:4},columnStyles:{0:{cellWidth:50,fontStyle:"bold",textColor:[125,1,1]},1:{cellWidth:120}},margin:{left:20,right:20},tableWidth:"auto"}),e=this.pdfDoc.getLastAutoTableY()+10),a.pickup_address){const i=(o=a.pickup_address)==null?void 0:o.trim().toLowerCase(),l=n==null?void 0:n.trim().toLowerCase();(i&&l?i===l:!1)?(this.pdfDoc.setText(9,[125,125,125]),this.pdfDoc.addText("Mapa/QR igual que el del venue",25,e+10),e+=20):(await this.addPickupMapAndQR(a.pickup_address,e),e+=100)}}return e}async addPickupMapAndQR(t,e){e=this.pdfDoc.checkPageBreak(e,100),this.pdfDoc.setText(11,[125,1,1]),this.pdfDoc.addText("Mapa de Recogida:",20,e),e+=10;const n=160,r=80,o=50,a=10,c=20,i=20,{width:l}=this.pdfDoc.dimensions,d=l-c-i,u=d>=n+a+o;let h=c,f=e,w=n,m=c+n+a,M=e;u?(w=n,m=Math.min(c+w+a,l-i-o),M=e):(w=d,h=c,f=e,m=c,M=e+r+10);let S=!1;try{const b=await v.getMapImageForAddress(t,w,r);if(b){try{this.pdfDoc.addImage(b,"PNG",h,f,w,r),S=!0}catch{try{this.pdfDoc.addImage(b,"JPEG",h,f,w,r),S=!0}catch{}}this.pdfDoc.document.setDrawColor(200,200,200),this.pdfDoc.document.setLineWidth(.3),this.pdfDoc.document.rect(h,f,w,r)}}catch{}S||(this.pdfDoc.setText(10,[125,1,1]),this.pdfDoc.addText("[MAPA NO DISPONIBLE]",h+5,f+r/2));try{const b=v.generateDestinationUrl(t),g=await X.generateQRCode(b);g&&(this.pdfDoc.addImage(g,"PNG",m,M,o,o),this.pdfDoc.addLink(b,m,M,o,o),this.pdfDoc.setText(9,[125,1,1]),this.pdfDoc.addText("Ruta a Recogida",m,M+o+6),this.pdfDoc.setText(8,[51,51,51]),this.pdfDoc.addText("Escanea para direcciones",m,M+o+12))}catch{}}}class Ge{constructor(t){this.pdfDoc=t}async addAccommodationSection(t,e,n,r=!1){const o=t.filter(a=>L.hasData(a.hotel_name)||a.rooms.some(L.hasMeaningfulRoomData));if(o.length===0)return n;n=this.pdfDoc.checkPageBreak(n),this.pdfDoc.setText(14,[125,1,1]),this.pdfDoc.addText("Alojamiento",20,n),n+=15;for(const a of o){L.hasData(a.hotel_name)&&(this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText(a.hotel_name,30,n),n+=12),L.hasData(a.address)&&(this.pdfDoc.setText(10,[51,51,51]),this.pdfDoc.addText(`Dirección: ${a.address}`,35,n),n+=10);const c=[];if(a.check_in&&c.push(`Check-in: ${a.check_in}`),a.check_out&&c.push(`Check-out: ${a.check_out}`),c.length>0&&(this.pdfDoc.addText(c.join(" | "),35,n),n+=15),a.address){n=this.pdfDoc.checkPageBreak(n,110);const i=160,l=80,d=50,u=10,h=20,f=20,{width:w}=this.pdfDoc.dimensions,m=w-h-f,M=m>=i+u+d;let S=h,b=n,g=i,p=h+i+u,N=n;M?(g=i,p=Math.min(h+g+u,w-f-d),N=n):(g=m,S=h,b=n,p=h,N=n+l+10);let C=!1;try{const D=await v.getMapImageForAddress(a.address,g,l);if(D){try{this.pdfDoc.addImage(D,"PNG",S,b,g,l),C=!0}catch{try{this.pdfDoc.addImage(D,"JPEG",S,b,g,l),C=!0}catch{}}this.pdfDoc.document.setDrawColor(200,200,200),this.pdfDoc.document.setLineWidth(.3),this.pdfDoc.document.rect(S,b,g,l)}}catch{}C||(this.pdfDoc.setText(10,[125,1,1]),this.pdfDoc.addText("[MAPA NO DISPONIBLE]",S+5,b+l/2));try{const D=v.generateDestinationUrl(a.address),T=await X.generateQRCode(D);this.pdfDoc.addImage(T,"PNG",p,N,d,d),this.pdfDoc.addLink(D,p,N,d,d),this.pdfDoc.setText(9,[125,1,1]),this.pdfDoc.addText("Ruta al hotel",p,N+d+6),this.pdfDoc.setText(8,[80,80,80]),this.pdfDoc.addText("Escanea para direcciones",p,N+d+12)}catch{}n=(M?Math.max(b+l,N+d):N+d)+15}if(!r){n=this.pdfDoc.checkPageBreak(n,20),n>20&&n<=30&&(n=20),this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Rooming",20,n),n+=12;const i=a.rooms.filter(L.hasMeaningfulRoomData);if(i.length>0){const l=i.map(d=>[d.room_type||"N/A",d.room_number||"Por asignar",I.getStaffName(d.staff_member1_id||"",e.staff),I.getStaffName(d.staff_member2_id||"",e.staff)]);this.pdfDoc.addTable({startY:n,head:[["Tipo","Habitación","Huésped 1","Huésped 2"]],body:l,theme:"grid",styles:{fontSize:9,cellPadding:4},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:10,fontStyle:"bold"},alternateRowStyles:{fillColor:[250,245,245]},margin:{left:20,right:20},tableWidth:"auto"}),n=this.pdfDoc.getLastAutoTableY()+15}}}return n}}class Ke{constructor(t){this.pdfDoc=t}addScheduleSection(t,e){if(!L.hasData(t.schedule)&&!L.hasData(t.powerRequirements)&&!L.hasData(t.auxiliaryNeeds))return e;if(e=this.pdfDoc.checkPageBreak(e),this.pdfDoc.setText(14,[125,1,1]),this.pdfDoc.addText("Programa y Requerimientos",20,e),e+=15,this.pdfDoc.setText(10,[51,51,51]),L.hasData(t.schedule)){this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Programa:",30,e),e+=12,this.pdfDoc.setText(10,[51,51,51]);const n=t.schedule.split(`
`);for(const r of n)this.pdfDoc.addText(r,35,e),e+=8;e+=10}if(L.hasData(t.powerRequirements)){this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Requerimientos de Energía:",30,e),e+=12,this.pdfDoc.setText(10,[51,51,51]);const n=t.powerRequirements.split(`
`);for(const r of n)this.pdfDoc.addText(r,35,e),e+=8;e+=10}if(L.hasData(t.auxiliaryNeeds)){this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Necesidades Auxiliares:",30,e),e+=12,this.pdfDoc.setText(10,[51,51,51]);const n=t.auxiliaryNeeds.split(`
`);for(const r of n)this.pdfDoc.addText(r,35,e),e+=8}return e}}class Je{constructor(t){this.pdfDoc=t}addLogisticsSection(t,e){const n=t.logistics;if(!n)return e;if(e=this.pdfDoc.checkPageBreak(e,30),n.transport&&n.transport.length>0){const r=n.transport.map(o=>[o.transport_type||"",o.driver_name||"",o.driver_phone||"",o.license_plate||"",I.translateCompany(o.company||""),I.formatDateTime(o.date_time||""),o.has_return?"Sí":"No",I.formatDateTime(o.return_date_time||"")]);this.pdfDoc.addTable({startY:e,head:[["Tipo","Conductor","Teléfono","Matrícula","Empresa","Salida","Retorno","Vuelta"]],body:r,theme:"grid",styles:{fontSize:8,cellPadding:3,overflow:"linebreak"},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:9,fontStyle:"bold"},alternateRowStyles:{fillColor:[250,245,245]},margin:{left:20,right:20},tableWidth:"auto"}),e=this.pdfDoc.getLastAutoTableY()+10}if(L.hasData(n.loadingDetails)){e=this.pdfDoc.checkPageBreak(e,30),this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Detalles de Carga:",20,e),e+=15,this.pdfDoc.setText(10,[51,51,51]);const r=n.loadingDetails.split(`
`);for(const o of r)o.trim()&&(this.pdfDoc.addText(o.trim(),30,e),e+=12);e+=10}if(L.hasData(n.unloadingDetails)){e=this.pdfDoc.checkPageBreak(e,30),this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Detalles de Descarga:",20,e),e+=15,this.pdfDoc.setText(10,[51,51,51]);const r=n.unloadingDetails.split(`
`);for(const o of r)o.trim()&&(this.pdfDoc.addText(o.trim(),30,e),e+=12);e+=10}if(L.hasData(n.equipmentLogistics)){e=this.pdfDoc.checkPageBreak(e,30),this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText("Logística de Equipos:",20,e),e+=15,this.pdfDoc.setText(10,[51,51,51]);const r=n.equipmentLogistics.split(`
`);for(const o of r)o.trim()&&(this.pdfDoc.addText(o.trim(),30,e),e+=12);e+=10}return e}}class Xe{constructor(t){this.pdfDoc=t}addWeatherSection(t,e){if(e=this.pdfDoc.checkPageBreak(e,50),this.pdfDoc.setText(14,[125,1,1]),this.pdfDoc.addText("Meteorología",20,e),e+=15,!t.weather||t.weather.length===0)return e;const n=t.weather.map(r=>[r.date||"—",r.condition||"—",r.maxTemp?`${r.maxTemp}°C`:"—","—",r.precipitationProbability?`${r.precipitationProbability}%`:"—"]);return this.pdfDoc.addTable({startY:e,head:[["Fecha/Hora","Condición","Temperatura","Viento","Precipitación"]],body:n,theme:"grid",styles:{fontSize:9,cellPadding:4},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:10,fontStyle:"bold"},alternateRowStyles:{fillColor:[250,245,245]},margin:{left:20,right:20},tableWidth:"auto"}),this.pdfDoc.getLastAutoTableY()+15}}class $e{constructor(t){this.pdfDoc=t}addRoomingSection(t,e,n){n=this.pdfDoc.checkPageBreak(n,50),this.pdfDoc.setText(14,[125,1,1]),this.pdfDoc.addText("Rooming",20,n),n+=15;const r=[];if(t.forEach(a=>{a.rooms&&a.rooms.length>0&&a.rooms.forEach(c=>{const i=[];r.push({hotel:a.hotel_name||"Hotel no especificado",room:c.room_number||"N/A",type:c.room_type||"No especificado",occupants:i,notes:"—"})})}),r.length===0)return this.pdfDoc.setText(10,[128,128,128]),this.pdfDoc.addText("No hay asignaciones de habitaciones disponibles",30,n),n+20;const o=r.map(a=>[a.hotel,a.room,a.type,a.occupants.join(", ")||"Sin asignar",a.notes||"—"]);return this.pdfDoc.addTable({startY:n,head:[["Hotel","Habitación","Tipo","Ocupantes","Notas"]],body:o,theme:"grid",styles:{fontSize:9,cellPadding:3,overflow:"linebreak",columnWidth:"wrap"},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:10,fontStyle:"bold"},columnStyles:{0:{cellWidth:35},1:{cellWidth:25},2:{cellWidth:25},3:{cellWidth:50},4:{cellWidth:35}},margin:{left:20,right:20},tableWidth:"auto"}),this.pdfDoc.getLastAutoTableY()+15}}class Qe{constructor(t){this.pdfDoc=t}addPowerSection(t,e){if(e=this.pdfDoc.checkPageBreak(e,30),this.pdfDoc.setText(10,[51,51,51]),!L.hasData(t.powerRequirements))return e;const n=t.powerRequirements.split(`
`);for(const r of n)r.trim()&&(this.pdfDoc.addText(r.trim(),30,e),e+=5);return e+10}}class Ze{constructor(t){this.pdfDoc=t}addAuxNeedsSection(t,e){if(e=this.pdfDoc.checkPageBreak(e,30),this.pdfDoc.setText(10,[51,51,51]),!L.hasData(t.auxiliaryNeeds))return e;const n=t.auxiliaryNeeds.split(`
`);for(const r of n)r.trim()&&(this.pdfDoc.addText(r.trim(),30,e),e+=12);return e+10}}class tn{constructor(t){this.pdfDoc=t}addProgramSection(t,e){e=this.pdfDoc.checkPageBreak(e,30);const n=t;if(Array.isArray(n.programScheduleDays)&&n.programScheduleDays.some(r=>{var o;return((o=r==null?void 0:r.rows)==null?void 0:o.length)>0})){for(const[r,o]of n.programScheduleDays.entries()){const a=`${(o==null?void 0:o.label)||`Día ${r+1}`}${o!=null&&o.date?` (${o.date})`:""}`;if(this.pdfDoc.setText(12,[125,1,1]),this.pdfDoc.addText(a,20,e),e+=10,Array.isArray(o.rows)&&o.rows.length>0){const c=o.rows.map(i=>[i.time||"",i.item||"",i.dept||"",i.notes||""]);this.pdfDoc.addTable({startY:e,head:[["Hora","Ítem","Depto/Líder","Notas"]],body:c,styles:{fontSize:9,cellPadding:3,overflow:"linebreak"},headStyles:{fillColor:[240,240,240],textColor:[51,51,51]},theme:"grid",margin:{left:20,right:20},columnStyles:{0:{cellWidth:24},1:{cellWidth:40},2:{cellWidth:45},3:{cellWidth:"auto"}},tableWidth:"wrap"}),e=this.pdfDoc.getLastAutoTableY()+12}else e+=8;e=this.pdfDoc.checkPageBreak(e,24)}return e}if(t.programSchedule&&t.programSchedule.length>0){const r=t.programSchedule.map(o=>[o.time||"",o.item||"",o.dept||"",o.notes||""]);return this.pdfDoc.addTable({startY:e,head:[["Hora","Ítem","Depto/Líder","Notas"]],body:r,styles:{fontSize:9,cellPadding:3,overflow:"linebreak"},headStyles:{fillColor:[240,240,240],textColor:[51,51,51]},theme:"grid",margin:{left:20,right:20},columnStyles:{0:{cellWidth:24},1:{cellWidth:40},2:{cellWidth:45},3:{cellWidth:"auto"}},tableWidth:"wrap"}),this.pdfDoc.getLastAutoTableY()+12}if(this.pdfDoc.setText(10,[51,51,51]),L.hasData(t.schedule)){const r=t.schedule.split(`
`);for(const o of r)o.trim()&&(this.pdfDoc.addText(o.trim(),30,e),e+=12);return e+10}return e}}class en{constructor(t){this.pdfDoc=t}async addRestaurantsSection(t,e){if(!t||t.length===0)return e;let n=e;this.pdfDoc.setText(16,[51,51,51]),n+=14;const r=20,o=20,a=12,{width:c,height:i,footerSpace:l}=this.pdfDoc.dimensions,d=c-r-o,u=Math.floor((d-a)/2),h=80;let f=n,w=0;for(let m=0;m<t.length;m+=2){(w===2||f+h>i-l)&&(this.pdfDoc.addPage(),f=30,w=0);const M=r;if(await this.renderRestaurantCard(t[m],M,f,u,h),m+1<t.length){const S=r+u+a;await this.renderRestaurantCard(t[m+1],S,f,u,h)}w+=1,f+=h+6}return f}async renderRestaurantCard(t,e,n,r,o){var T,R;this.pdfDoc.document.setDrawColor(220,220,220),this.pdfDoc.document.setLineWidth(.4),this.pdfDoc.document.rect(e,n,r,o);const a=2,c=e+a,i=n+a,l=r-a*2,d=o-a*2;let u=null;try{(T=t.coordinates)!=null&&T.lat&&((R=t.coordinates)!=null&&R.lng)&&(u=await v.getStaticMapDataUrl(t.coordinates.lat,t.coordinates.lng,l,d,15)),!u&&t.address&&(u=await v.getMapImageForAddress(t.address,l,d,15))}catch{}if(u)try{this.pdfDoc.addImage(u,"PNG",c,i,l,d)}catch{try{this.pdfDoc.addImage(u,"JPEG",c,i,l,d)}catch{this.pdfDoc.setText(8,[150,150,150]),this.pdfDoc.addText("[MAPA NO DISPONIBLE]",c+8,i+d/2)}}else this.pdfDoc.setText(8,[150,150,150]),this.pdfDoc.addText("[MAPA NO DISPONIBLE]",c+8,i+d/2);const h=2,f=Math.max(60,Math.min(160,r-20)),w=24,m=e+6,M=n+6;this.pdfDoc.setFillColor(255,255,255),this.pdfDoc.addRect(m,M,f,w,"F"),this.pdfDoc.document.setDrawColor(230,230,230),this.pdfDoc.document.setLineWidth(.3),this.pdfDoc.document.rect(m,M,f,w);const S=t.originLabel?`${t.originLabel}: `:"";this.pdfDoc.setText(9,[51,51,51]);const b=this.pdfDoc.splitText(`${S}${t.name||""}`,f-h*2)[0]||"";this.pdfDoc.addText(b,m+h,M+7),this.pdfDoc.setText(7,[90,90,90]);const g=this.pdfDoc.splitText(t.address||"",f-h*2)[0]||"";this.pdfDoc.addText(g,m+h,M+14);const p=[];t.rating&&p.push(t.rating.toFixed(1)),t.priceLevel&&p.push("€".repeat(Math.max(1,Math.min(4,t.priceLevel)))),t.distance&&p.push(t.distance<1e3?`${t.distance} m`:`${(t.distance/1e3).toFixed(1)} km`),p.length&&(this.pdfDoc.setText(7,[120,120,120]),this.pdfDoc.addText(p.join(" • "),m+h,M+21));const N=18,C=4,A=e+r-C-N,D=n+o-C-N;try{const E=v.generateDestinationUrl(t.address||""),y=await X.generateQRCode(E);this.pdfDoc.addImage(y,"PNG",A,D,N,N),this.pdfDoc.addLink(E,A,D,N,N)}catch{this.pdfDoc.document.setDrawColor(180,180,180),this.pdfDoc.document.rect(A,D,N,N)}}static hasRestaurantsData(t){return t&&t.length>0}}class nn{constructor(t){x(this,"eventSection");x(this,"venueSection");x(this,"contactsSection");x(this,"staffSection");x(this,"travelSection");x(this,"accommodationSection");x(this,"scheduleSection");x(this,"logisticsSection");x(this,"weatherSection");x(this,"roomingSection");x(this,"powerSection");x(this,"auxNeedsSection");x(this,"programSection");x(this,"restaurantsSection");this.pdfDoc=t,this.eventSection=new Te(t),this.venueSection=new ze(t),this.contactsSection=new Oe(t),this.staffSection=new je(t),this.travelSection=new Ve(t),this.accommodationSection=new Ge(t),this.scheduleSection=new Ke(t),this.logisticsSection=new Je(t),this.weatherSection=new Xe(t),this.roomingSection=new $e(t),this.powerSection=new Qe(t),this.auxNeedsSection=new Ze(t),this.programSection=new tn(t),this.restaurantsSection=new en(t)}addContactsSection(t,e){return this.contactsSection.addContactsSection(t,e)}addEventDetailsSection(t,e){return this.eventSection.addEventDetailsSection(t,e)}async addVenueSection(t,e,n,r){return await this.venueSection.addVenueSection(t,e,n,r)}async addTravelSection(t,e,n){return await this.travelSection.addTravelSection(t,n,e)}async addAccommodationSection(t,e,n,r=!1){return await this.accommodationSection.addAccommodationSection(t,e,n,r)}addStaffSection(t,e){return this.staffSection.addStaffSection(t,e)}addScheduleSection(t,e){return this.scheduleSection.addScheduleSection(t,e)}addLogisticsSection(t,e){return this.logisticsSection.addLogisticsSection(t,e)}addWeatherSection(t,e){return this.weatherSection.addWeatherSection(t,e)}addRoomingSection(t,e,n){return this.roomingSection.addRoomingSection(t,e,n)}addPowerSection(t,e){return this.powerSection.addPowerSection(t,e)}addAuxNeedsSection(t,e){return this.auxNeedsSection.addAuxNeedsSection(t,e)}addProgramSection(t,e){return this.programSection.addProgramSection(t,e)}async addRestaurantsSection(t,e){const n=(t.restaurants||[]).filter(r=>r.isSelected);return await this.restaurantsSection.addRestaurantsSection(n,e)}hasEventDetailsData(t){return!!(t.eventName||t.clientName||t.eventDates||t.eventStartTime)}hasVenueData(t){var e,n;return!!((e=t.venue)!=null&&e.name||(n=t.venue)!=null&&n.address||t.venueType)}hasWeatherData(t){return t.weather&&t.weather.length>0}hasContactsData(t){return t.contacts&&t.contacts.some(e=>e.name||e.role||e.phone||e.email)}hasStaffData(t){return t.staff&&t.staff.some(e=>e.name||e.role||e.dni)}hasTravelData(t){return t&&t.length>0}hasAccommodationData(t){return!t||t.length===0?!1:t.some(e=>{if(!e)return!1;const n=L.hasData(e.hotel_name)||L.hasData(e.hotel_address)||L.hasData(e.address),r=L.hasData(e.check_in)||L.hasData(e.check_out),o=Array.isArray(e.rooms)&&(e.rooms.some(a=>L.hasMeaningfulRoomData(a))||e.rooms.length>0);return n||r||o})}hasRoomingData(t){return t&&t.some(e=>e.rooms&&e.rooms.length>0)}hasLogisticsData(t){if(!t.logistics)return!1;const{transport:e=[],loadingDetails:n,unloadingDetails:r,equipmentLogistics:o}=t.logistics,a=Array.isArray(e)&&e.some(i=>L.hasData(i)),c=L.hasData(n)||L.hasData(r)||L.hasData(o);return a||c}hasPowerData(t){return t.powerRequirements&&t.powerRequirements.trim().length>0}hasAuxNeedsData(t){return t.auxiliaryNeeds&&t.auxiliaryNeeds.trim().length>0}hasProgramData(t){const e=Array.isArray(t.programSchedule)&&t.programSchedule.length>0,n=Array.isArray(t.programScheduleDays)&&t.programScheduleDays.some(o=>Array.isArray(o.rows)&&o.rows.length>0),r=!!(t.schedule&&t.schedule.trim().length>0);return n||e||r}hasRestaurantsData(t){return t.restaurants&&t.restaurants.some(e=>e.isSelected)||!1}}class j{static async addFooterToAllPages(t,e){try{const n=await this.loadSectorProLogo(),r=t.document.getNumberOfPages(),{width:o,height:a}=t.dimensions,c=12;let i=0,l=0;if(n){const d=await this.getImageDimensions(n),u=Math.min(this.LOGO_MAX_HEIGHT/d.height,this.LOGO_MAX_WIDTH/d.width);i=Math.max(1,Math.round(d.width*u)),l=Math.max(1,Math.round(d.height*u))}for(let d=1;d<=r;d++){t.document.setPage(d);const u=d>1;if(u)if(t.document.setDrawColor(220,220,220),t.document.setLineWidth(.3),t.document.line(20,a-20,o-20,a-20),n&&i>0&&l>0){const h=(o-i)/2,f=a-l-c;t.addImage(n,"PNG",h,f,i,l)}else t.setText(8,[125,1,1]),t.addText("Sector-Pro",o/2,a-c,{align:"center"});if(u&&(t.setText(8,[120,120,120]),t.addText(`Pág. ${d-1} de ${r-1}`,20,a-c),e)){const h=e.length>40?e.substring(0,40)+"...":e;t.addText(h,o-20,a-c,{align:"right"})}}}catch{const r=t.document.getNumberOfPages(),{width:o,height:a}=t.dimensions,c=12;for(let i=1;i<=r;i++)t.document.setPage(i),t.setText(8,[125,1,1]),t.addText("Sector-Pro",o/2,a-c,{align:"center"}),i>1&&(t.setText(8,[120,120,120]),t.addText(`Pág. ${i-1} de ${r-1}`,20,a-c))}}static async loadSectorProLogo(){try{if(this.cachedLogoData)return this.cachedLogoData;const t=["/sector pro logo.png","/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png","/sector%20pro%20logo.png","/sector-pro-logo.png"];for(const e of t)try{const n=await fetch(e);if(n.ok){const r=await n.blob(),o=await this.blobToDataURL(r);return this.cachedLogoData=o,o}}catch{continue}}catch{}return null}static blobToDataURL(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsDataURL(t)})}static getImageDimensions(t){return this.cachedLogoDims?Promise.resolve(this.cachedLogoDims):new Promise(e=>{const n=new Image;n.onload=()=>{const r={width:n.naturalWidth||n.width,height:n.naturalHeight||n.height};this.cachedLogoDims=r,e(r)},n.onerror=()=>e({width:this.LOGO_MAX_WIDTH,height:this.LOGO_MAX_HEIGHT}),n.src=t})}}x(j,"FOOTER_HEIGHT",30),x(j,"LOGO_MAX_HEIGHT",6),x(j,"LOGO_MAX_WIDTH",50),x(j,"cachedLogoData",null),x(j,"cachedLogoDims",null);class rn{constructor(t){x(this,"pdfDoc");x(this,"headerSection");x(this,"coverSection");x(this,"contentSections");x(this,"logoData");this.options=t,this.pdfDoc=new fe,this.contentSections=new nn(this.pdfDoc)}async generate(){var i,l,d,u,h;const{eventData:t,selectedJobId:e,jobTitle:n,toast:r,travelArrangements:o,accommodations:a=[],venueMapPreview:c}=this.options;try{this.logoData=await ge.loadJobLogo(e);let f;if(this.logoData&&(f=await new Promise(g=>{const p=new Image;p.onload=()=>{const A=p.naturalWidth||p.width,D=p.naturalHeight||p.height;if(A>0&&D>0){const T=Math.min(28/D,160/A);g({width:Math.round(A*T),height:Math.round(D*T)})}else g({width:84,height:28})},p.onerror=()=>g({width:84,height:28}),p.src=this.logoData})),this.headerSection=new we(this.pdfDoc,n,this.options.jobDate,"Hoja de Ruta",this.logoData||void 0,f),await new Se(this.pdfDoc,this.options.eventData,this.options.jobTitle,this.logoData).generateCoverPage(),this.contentSections.hasEventDetailsData(this.options.eventData)||this.contentSections.hasVenueData(this.options.eventData)){let g=this.headerSection.addSectionHeader("Detalles y Venue");this.contentSections.hasEventDetailsData(this.options.eventData)&&(g=this.contentSections.addEventDetailsSection(this.options.eventData,g)),this.contentSections.hasVenueData(this.options.eventData)&&(g=await this.contentSections.addVenueSection(this.options.eventData,this.options.venueMapPreview,g,(i=this.options.imagePreviews)==null?void 0:i.venue))}if(this.contentSections.hasWeatherData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Clima");this.contentSections.addWeatherSection(this.options.eventData,g)}else try{const{getWeatherForJob:g}=await ue(async()=>{const{getWeatherForJob:p}=await import("./weatherApi-BatwQpQy.js");return{getWeatherForJob:p}},[]);if((l=this.options.eventData)!=null&&l.venue&&((d=this.options.eventData)!=null&&d.eventDates)){const p=await g(this.options.eventData.venue,this.options.eventData.eventDates);if(p&&p.length>0){this.options.eventData.weather=p;const N=this.headerSection.addSectionHeader("Clima");this.contentSections.addWeatherSection(this.options.eventData,N)}}}catch{}if(this.contentSections.hasContactsData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Contactos");this.contentSections.addContactsSection(this.options.eventData,g)}if(this.contentSections.hasStaffData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Personal");this.contentSections.addStaffSection(this.options.eventData,g)}const m=this.options.includeAccommodationRooming??!0,M=this.options.includeAggregatedRooming??!1,S=this.options.includeTravelArrangements??!0,b=this.options.includeLogisticsTransport??!0;if(S&&this.contentSections.hasTravelData(this.options.travelArrangements)){const g=this.headerSection.addSectionHeader("Viajes");await this.contentSections.addTravelSection(this.options.travelArrangements,(h=(u=this.options.eventData)==null?void 0:u.venue)==null?void 0:h.address,g)}if(this.contentSections.hasAccommodationData(this.options.accommodations)){const g=this.headerSection.addSectionHeader("Alojamientos");await this.contentSections.addAccommodationSection(this.options.accommodations||[],this.options.eventData,g,m===!1&&M===!0)}if(M&&this.contentSections.hasRoomingData(this.options.accommodations)){const g=this.headerSection.addSectionHeader("Rooming");this.contentSections.addRoomingSection(this.options.accommodations||[],this.options.eventData,g)}if(b&&this.contentSections.hasLogisticsData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Transportes");this.contentSections.addLogisticsSection(this.options.eventData,g)}if(this.contentSections.hasPowerData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Requerimientos eléctricos");this.contentSections.addPowerSection(this.options.eventData,g)}if(this.contentSections.hasAuxNeedsData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Necesidades auxiliares");this.contentSections.addAuxNeedsSection(this.options.eventData,g)}if(this.contentSections.hasProgramData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Programa");this.contentSections.addProgramSection(this.options.eventData,g)}if(this.contentSections.hasRestaurantsData(this.options.eventData)){const g=this.headerSection.addSectionHeader("Restaurantes");await this.contentSections.addRestaurantsSection(this.options.eventData,g)}await j.addFooterToAllPages(this.pdfDoc,n),await this.saveAndUploadPDF(),r==null||r({title:"✅ Documento generado",description:"La hoja de ruta ha sido generada y descargada correctamente."})}catch(f){throw r==null||r({title:"❌ Error",description:"Hubo un problema al generar el documento.",variant:"destructive"}),f}}async saveAndUploadPDF(){const{eventData:t,selectedJobId:e,jobTitle:n}=this.options,o=(t.eventName||n||"Evento").replace(/[^\w\s-]/g,"").replace(/\s+/g,"_"),a=new Date().toISOString().split("T")[0],c=`hoja_de_ruta_${o}_${a}.pdf`;this.pdfDoc.save(c);try{const i=this.pdfDoc.outputBlob();await pe(e,i,c)}catch{}}}const hn=async(s,t,e,n,r,o,a,c,i,l)=>new rn({eventData:s,travelArrangements:t,roomAssignments:e,imagePreviews:n,venueMapPreview:r,selectedJobId:o,jobTitle:a,jobDate:c,toast:i,accommodations:l}).generate();export{rn as PDFEngine,hn as generatePDF};
