import{a as q}from"./lazyPdf-xVUlxKNu.js";const J=async(M,l,n,y,w,W,L,d,D,B)=>{const{jsPDF:Y,autoTable:F}=await q();return new Promise(N=>{const t=new Y,r=t.internal.pageSize.width,x=t.internal.pageSize.height,v=new Date().toLocaleDateString("en-GB"),E=40;let f;try{const e=new Date(w);isNaN(e.getTime())?f=(w.includes("-")?new Date(w+"T00:00:00"):new Date).toLocaleDateString("en-GB"):f=e.toLocaleDateString("en-GB")}catch{f=new Date().toLocaleDateString("en-GB")}t.setFillColor(125,1,1),t.rect(0,0,r,40,"F");const A=n==="weight"?"Informe de Distribución de Peso":n==="power"?"Informe de Distribución de Potencia":"Informe de Rigging",z=e=>{if(e){const T=7.5*(e.width/e.height);try{t.addImage(e,"PNG",10,5,T,7.5)}catch{}}t.setFontSize(24),t.setTextColor(255,255,255),t.text(A,r/2,20,{align:"center"}),t.setFontSize(16),t.text(y||"Trabajo sin título",r/2,30,{align:"center"}),t.setFontSize(12),t.text(`Fecha del Trabajo: ${f}`,r/2,38,{align:"center"}),d!==void 0&&n==="power"&&(t.setFontSize(10),t.setTextColor(51,51,51),t.text(`Margen de Seguridad Aplicado: ${d}%`,14,50)),t.setFontSize(10),t.text(`Generado: ${new Date().toLocaleDateString("en-GB")}`,14,60),K()},K=()=>{var R,j;let e=70;const g=o=>e+o>x-E?(t.addPage(),e=20,!0):!1;l.forEach((o,i)=>{if(o.toolType==="rigging"){t.setFillColor(245,245,250),t.rect(14,e-6,r-28,10,"F"),t.setFontSize(14),t.setTextColor(125,1,1),t.text(`Truss: ${o.name}`,14,e),e+=10;const s=o.rows.filter(a=>a.componentName&&(a.weight!==void 0||a.x!==void 0)).map(a=>[a.quantity??"",a.componentName??"",a.weight??"",a.x!==void 0?`${Number(a.x).toFixed(2)} m`:""]);s.length>0&&(F(t,{head:[["Cantidad","Componente","Peso (kg)","Posición (m)"]],body:s,startY:e,theme:"grid",styles:{fontSize:10,cellPadding:5},headStyles:{fillColor:[125,1,1],textColor:[255,255,255]}}),e=t.lastAutoTable.finalY+10);const I=o.rows.filter(a=>a.reactionKg!==void 0).map(a=>[a.componentName??"",a.reactionKg!==void 0?Number(a.reactionKg).toFixed(0):"",a.hoistName??""]);I.length>0&&(F(t,{head:[["Punto de Montaje","Reacción (kg)","Motor Sugerido"]],body:I,startY:e,theme:"grid",styles:{fontSize:10,cellPadding:5},headStyles:{fillColor:[125,1,1],textColor:[255,255,255]}}),e=t.lastAutoTable.finalY+10),(o.maxMomentNm!==void 0||o.maxDeflectionMm!==void 0)&&(g(30),t.setFontSize(11),t.setTextColor(0,0,0),o.maxMomentNm!==void 0&&(t.text(`Momento Máximo: ${Number(o.maxMomentNm).toFixed(0)} N·m (${o.okMoment?"OK":"FALLA"})`,14,e),e+=6),o.maxDeflectionMm!==void 0&&(t.text(`Deflexión Máxima: ${Number(o.maxDeflectionMm).toFixed(1)} mm (${o.okDefl?"OK":"FALLA"})`,14,e),e+=10)),o.cablePick&&(g(10),t.setFontSize(10),t.setTextColor(80,80,80),t.text("*Incluye cable pick.",14,e),e+=10),e>x-40&&i<l.length-1&&(t.addPage(),e=20);return}const h=(o.rows.length+(n==="weight"&&o.totalWeight!==void 0?1:0))*15+20;g(h+40),t.setFillColor(245,245,250),t.rect(14,e-6,r-28,10,"F"),t.setFontSize(14),t.setTextColor(125,1,1);let S=o.name;n==="power"&&(o.customPduType||o.pduType)&&(/\([^)]+\)$/.test(o.name.trim())||(S=`${o.name} (${o.customPduType||o.pduType})`)),t.text(S,14,e),e+=10;const C=o.rows.map(s=>[s.quantity,s.componentName||"",n==="weight"?s.weight||"":s.watts||"",n==="weight"?s.totalWeight!==void 0?s.totalWeight.toFixed(2):"":s.totalWatts!==void 0?s.totalWatts.toFixed(2):""]);if(n==="weight"&&o.totalWeight!==void 0&&C.push(["","Peso Total","",o.totalWeight.toFixed(2)]),F(t,{head:n==="weight"?[["Cantidad","Componente","Peso (por unidad)","Peso Total"]]:[["Cantidad","Componente","Vatios (por unidad)","Vatios Totales"]],body:C,startY:e,theme:"grid",styles:{fontSize:10,cellPadding:5,lineColor:[220,220,230],lineWidth:.1},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontStyle:"bold"},bodyStyles:{textColor:[51,51,51]},alternateRowStyles:{fillColor:[250,250,255]},didDrawPage:s=>{e=s.cursor.y+10}}),e=t.lastAutoTable.finalY+10,n==="power"){if(o.totalWatts!==void 0){if(g(42),t.setFillColor(245,245,250),t.rect(14,e-6,r-28,28,"F"),t.setFontSize(11),t.setTextColor(125,1,1),t.text(`Potencia Total (sin margen): ${o.totalWatts.toFixed(2)} W`,14,e),e+=7,d!==void 0){const s=(o.totalWatts||0)*(1+(d||0)/100);t.text(`Potencia Ajustada (con ${d}%): ${s.toFixed(2)} W`,14,e),e+=7}o.currentPerPhase!==void 0&&(t.text(`Corriente: ${o.currentPerPhase.toFixed(2)} A`,14,e),e+=10)}o.includesHoist&&(g(20),t.setFontSize(10),t.setTextColor(51,51,51),t.setFont(void 0,"italic"),t.text(`Potencia adicional para motores requerida para ${o.name}: CEE32A 3P+N+G`,14,e),e+=10,t.setFont(void 0,"normal"))}e>x-40&&i<l.length-1&&(t.addPage(),e=20)});let T=[],G;n==="weight"&&(T=l.map(o=>({clusterName:o.name,riggingPoints:o.riggingPoint||"N/A",clusterWeight:o.totalWeight||0})));let u=[];const H=l.filter(o=>o.toolType==="rigging");if(H.length>0&&(u=H.map(o=>({clusterName:o.name,riggingPoints:String(o.rows.filter(i=>i.reactionKg!==void 0).length),clusterWeight:o.totalWeight||0}))),n==="power"){const o=l.reduce((c,h)=>c+(h.totalWatts||0),0),i=l.reduce((c,h)=>c+(h.currentPerPhase||0),0);G={totalSystemWatts:o,totalSystemAmps:i}}const $=W&&W.length>0?W:u.length>0?u:T,p=L||G;if(n==="weight"&&$.length>0||n==="power"&&l.length>0&&((R=l[0])==null?void 0:R.toolType)==="consumos"||n==="rigging"&&u.length>0||u.length>0){if(t.addPage(),t.setFillColor(125,1,1),t.rect(0,0,r,40,"F"),P){const i=7.5*(P.width/P.height);try{t.addImage(P,"PNG",10,5,i,7.5)}catch{}}if(t.setFontSize(24),t.setTextColor(255,255,255),t.text(A,r/2,20,{align:"center"}),t.setFontSize(16),t.text(y||"Trabajo sin título",r/2,30,{align:"center"}),t.setFontSize(12),t.text(`Fecha del Trabajo: ${f}`,r/2,38,{align:"center"}),d!==void 0&&n==="power"&&(t.setFontSize(10),t.setTextColor(51,51,51),t.text(`Margen de Seguridad Aplicado: ${d}%`,14,50)),t.setFontSize(10),t.text(`Generado: ${new Date().toLocaleDateString("en-GB")}`,14,60),e=70,n==="power"&&((j=l[0])==null?void 0:j.toolType)==="consumos"){if(t.setFontSize(16),t.setTextColor(125,1,1),t.text("Resumen",14,e),e+=10,B&&(g(12),t.setFontSize(10),t.setTextColor(80,80,80),t.setFont(void 0,"italic"),t.text("Se requiere potencia de 16A en formato schuko hembra en posicion FoH",14,e),e+=10,t.setFont(void 0,"normal")),l.forEach(o=>{g(30),t.setFontSize(12),t.setTextColor(0,0,0);const i=o.customPduType?o.customPduType:o.pduType;t.text(`${o.name} - PDU: ${i||"N/A"}`,14,e),e+=7;const c=d!==void 0?(o.totalWatts||0)*(1+(d||0)/100):o.totalWatts||0;t.setFontSize(10),t.setTextColor(60,60,60),t.text(`Potencia (ajustada): ${c.toFixed(2)} W — Corriente: ${(o.currentPerPhase||0).toFixed(2)} A`,14,e),e+=7,o.includesHoist&&(t.setTextColor(80,80,80),t.text(`*Potencia adicional para polipast requerida para ${o.name}: CEE32A 3P+N+G`,14,e),e+=7),e+=3}),p){if(g(30),t.setFontSize(14),t.setTextColor(125,1,1),t.text("Resumen de Potencia Total",14,e),e+=10,t.setFontSize(12),t.setTextColor(0,0,0),t.text(`Potencia Total del Sistema (sin margen): ${p.totalSystemWatts.toFixed(2)} W`,14,e),e+=7,d!==void 0){const o=p.totalSystemWatts*(1+(d||0)/100);t.text(`Potencia Total del Sistema (ajustada): ${o.toFixed(2)} W`,14,e),e+=7}t.text(`Corriente Total del Sistema: ${p.totalSystemAmps.toFixed(2)} A`,14,e),e+=7}}else if((n==="weight"||n==="rigging")&&$.length>0){t.setFontSize(16),t.setTextColor(125,1,1),t.text(u.length>0?"Resumen de Rigging":"Resumen",14,e),e+=6;const o=$.map(i=>[i.clusterName,i.riggingPoints,i.clusterWeight.toFixed(2)]);F(t,{head:[["Truss","Puntos de Montaje","Peso Total (kg)"]],body:o,startY:e,theme:"grid",styles:{fontSize:10,cellPadding:5,lineColor:[220,220,230],lineWidth:.1},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontStyle:"bold"},bodyStyles:{textColor:[51,51,51]},alternateRowStyles:{fillColor:[250,250,255]},didDrawPage:i=>{e=i.cursor.y+10}})}}const m=new Image;m.crossOrigin="anonymous",m.src="/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png",m.onload=()=>{const i=50*(m.height/m.width),c=t.internal.pages.length-1;for(let S=1;S<=c;S++){t.setPage(S);const C=(r-50)/2,k=x-20;try{t.addImage(m,"PNG",C,k-i,50,i)}catch{}}t.setPage(c),t.setFontSize(10),t.setTextColor(51,51,51),t.text(`Creado: ${v}`,r-10,x-10,{align:"right"});const h=t.output("blob");N(h)},m.onerror=()=>{const o=t.internal.pages.length-1;t.setPage(o),t.setFontSize(10),t.setTextColor(51,51,51),t.text(`Creado: ${v}`,r-10,x-10,{align:"right"});const i=t.output("blob");N(i)}};let P;if(D){const e=new Image;e.crossOrigin="anonymous",e.src=D,e.onload=()=>{P=e,z(e)},e.onerror=()=>{z()}}else z()})};export{J as e};
