import{e as pe,r as c,j as e,D as ue,q as fe,F as ye,G as je,I as Ee,B as k,s as S,a as he,i as oe,X as gs,L as V,V as Ie,J as $e,K as Fe,O as Te,T as ss,n as le,C as ns,W as is,Y as as,A as os,f as rs,S as Se,t as qe,v as ke,w as Ae,x as ee,aK as vs,aL as ys,aM as js,c as ws,aE as Ge}from"./index-NZ6jJLfQ.js";import{T as bs,a as Ns,b as ze,c as Z,d as Cs,e as X}from"./table-DnQAmABX.js";import{B as C}from"./badge-vNTKF5RD.js";import{C as ve}from"./copy-Dez5r9kU.js";import{R as ts}from"./refresh-ccw-Df63ipTH.js";import{a as ls}from"./startOfMonth-B5dVCv8B.js";import{i as We}from"./calendar--BDVgnXu.js";import{A as Ss,a as qs,b as ks,c as As,d as Es,e as $s,f as Fs,g as Ts}from"./alert-dialog-CtyYUxwH.js";import{F as Re}from"./file-text-igU140SQ.js";import{E as Ls}from"./eye-BE_DouVP.js";import{U as Ms}from"./upload-DF4rjO7T.js";import{e as Ps,a as Os}from"./artistPdfExport-DnsKQk1F.js";import{fetchJobLogo as cs}from"./logoUtils-D2o1jUVg.js";import{C as Ve}from"./circle-x-DDzV-xk_.js";import{T as Ke}from"./triangle-alert-D6qN0F8g.js";import{E as Je}from"./external-link-QJoXZ6ES.js";import{M as Qe}from"./mic-l4q2dREA.js";import{L as Ye}from"./link-z6ku9ZYO.js";import{P as ge}from"./printer-De77t3j8.js";import{P as Ze}from"./pencil-BxZTvEYh.js";import{B as Is,C as Rs}from"./ConsoleSetupSection-DPK89kfN.js";import{P as Hs,M as Us,W as Bs,C as Gs}from"./connection-indicator-DXjKDIC2.js";import{M as zs,E as Ws,I as Vs,N as Ks}from"./NotesSection-Cu_RhFOj.js";import{u as Js}from"./useEquipmentModels--fmk95xL.js";import{u as He}from"./useMutation-DluhVBs1.js";import{F as Qs}from"./FestivalDateNavigation-HWB3qH-8.js";import{u as Ys}from"./useRealtimeSubscription-Bj7PWAKC.js";import{C as _e}from"./checkbox-BsRNEGV1.js";import{u as Ce}from"./useQuery-kdg2pmgf.js";import{U as Xe}from"./users-DMnpVLUq.js";import{C as Zs}from"./calendar-_Cj_Sgy-.js";import{C as Xs}from"./clock-BXPvTWvY.js";import{a as Ds}from"./lazyPdf-xVUlxKNu.js";import{S as en,a as sn,b as nn,c as an,d as on}from"./sheet-DFFfLazF.js";import{A as rn}from"./arrow-left-VpQwT4cv.js";import{I as tn}from"./info-CpCfiYD2.js";import{P as Pe}from"./plus-C3JQqq7t.js";import{M as ln}from"./menu-BAW81oPe.js";import{e as cn}from"./eachDayOfInterval-CPmiA2bk.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./isSameDay-m1OvdnsV.js";import"./isSameMonth-BQ4F6s8O.js";import"./addMonths-j-Bb577B.js";import"./differenceInCalendarMonths-6exvViir.js";import"./endOfWeek-BYLwoWuZ.js";import"./endOfMonth-Byhxb84j.js";import"./subDays-D4REtaCB.js";import"./chevron-right-Bn7Eu0F7.js";import"./chevron-left-rq2ui83a.js";import"./logo-url-cache-eY6nfvu7.js";import"./radio-group-DzKNHD24.js";import"./index-hC3MxXep.js";import"./circle-CWxDyDxx.js";import"./search-D-OiWg8h.js";import"./minus-InO4I9Ks.js";import"./wifi-C3_7SFyW.js";import"./switch-DUBpZhIC.js";import"./circle-alert-LZYNzZ7F.js";import"./tabs-BdaywI_b.js";import"./DateTypeContextMenu-D-zx4rHd.js";import"./context-menu-DYP7Nyzl.js";import"./index-D9TsP8oP.js";import"./useTableSubscription-Cu79jct8.js";import"./flexUuidService-C9yZjzP-.js";import"./config-DVV3VxR4.js";import"./constants-DoXhG9KB.js";import"./plane-NSG-_bNT.js";import"./wrench-DzMvZxmF.js";import"./star-icpn3ybK.js";import"./moon-Bp9lP4EQ.js";import"./popover-Dl-b1R8L.js";import"./subWeeks-DXhfE23M.js";import"./filter-D0HnK7Nz.js";const dn=({open:i,onOpenChange:d,artistId:o,artistName:a})=>{const{toast:r}=pe(),[_,f]=c.useState(""),[m,q]=c.useState(!1),w=async()=>{if(!o){r({title:"Error",description:"Se requiere el ID del artista para generar un enlace de formulario.",variant:"destructive"});return}q(!0);try{const{error:g}=await S.from("festival_artist_forms").update({status:"expired",expires_at:new Date().toISOString()}).eq("artist_id",o).eq("status","pending");if(g)throw g;const j=ls(new Date,7),{data:h,error:x}=await S.from("festival_artist_forms").insert({artist_id:o,expires_at:j.toISOString(),status:"pending"}).select("token").maybeSingle();if(x)throw x;if(!(h!=null&&h.token))throw new Error("Failed to generate form token");const n=`${window.location.origin}/festival/artist-form/${h.token}`;f(n),r({title:"Enlace generado",description:"El nuevo enlace de formulario ha sido generado correctamente."})}catch{r({title:"Error",description:"No se pudo generar el enlace del formulario.",variant:"destructive"})}finally{q(!1)}},N=async()=>{try{await navigator.clipboard.writeText(_),r({title:"Copiado",description:"Enlace copiado al portapapeles"})}catch{r({title:"Error",description:"No se pudo copiar el enlace",variant:"destructive"})}};return c.useEffect(()=>{i&&o&&(async()=>{try{const{data:j,error:h}=await S.from("festival_artist_forms").select("token").eq("artist_id",o).eq("status","pending").gt("expires_at",new Date().toISOString()).limit(1).maybeSingle();if(h)throw h;if(j!=null&&j.token){const x=`${window.location.origin}/festival/artist-form/${j.token}`;f(x)}else f("")}catch{f(""),r({title:"Error",description:"No se pudo verificar el enlace de formulario existente.",variant:"destructive"})}})()},[i,o,r]),e.jsx(ue,{open:i,onOpenChange:d,children:e.jsxs(fe,{className:"sm:max-w-[425px]",children:[e.jsx(ye,{children:e.jsxs(je,{children:["Enlace de Formulario para ",a]})}),e.jsx("div",{className:"space-y-4 mt-4",children:_?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ee,{value:_,readOnly:!0,className:"flex-1"}),e.jsx(k,{variant:"outline",size:"icon",onClick:N,title:"Copiar enlace",children:e.jsx(ve,{className:"h-4 w-4"})})]}),e.jsxs(k,{onClick:w,className:"w-full",disabled:m,children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Generar Nuevo Enlace"]})]}):e.jsx(k,{onClick:w,className:"w-full",disabled:m,children:"Generar Enlace"})})]})})},mn=({open:i,onOpenChange:d,selectedDate:o,jobId:a})=>{const{toast:r}=pe(),[_,f]=c.useState(!0),[m,q]=c.useState([]),[w,N]=c.useState(!1),g=async()=>{try{const{data:t,error:p}=await S.from("festival_artists").select(`
          id,
          name,
          stage,
          festival_artist_forms (
            token,
            expires_at,
            status
          )
        `).eq("job_id",a).eq("date",o).order("stage").order("show_start");if(p)throw p;const v=t.map(b=>{var E,$,U,T,F,R;return{artistId:b.id,name:b.name,stage:b.stage,token:($=(E=b.festival_artist_forms)==null?void 0:E[0])==null?void 0:$.token,expires_at:(T=(U=b.festival_artist_forms)==null?void 0:U[0])==null?void 0:T.expires_at,status:(R=(F=b.festival_artist_forms)==null?void 0:F[0])==null?void 0:R.status}});q(v)}catch{r({title:"Error",description:"No se pudieron obtener los enlaces de artistas",variant:"destructive"})}finally{f(!1)}};c.useEffect(()=>{i&&g()},[i,a,o]);const j=async()=>{N(!0);try{for(const t of m)if(!t.token||t.expires_at&&!We(new Date(t.expires_at),new Date)){await S.from("festival_artist_forms").update({status:"expired",expires_at:new Date().toISOString()}).eq("artist_id",t.artistId).eq("status","pending");const p=ls(new Date,7);await S.from("festival_artist_forms").insert({artist_id:t.artistId,expires_at:p.toISOString(),status:"pending"})}await g(),r({title:"Éxito",description:"Enlaces faltantes generados correctamente"})}catch{r({title:"Error",description:"No se pudieron generar los enlaces",variant:"destructive"})}finally{N(!1)}},h=()=>{const t=m.reduce((v,b)=>{const E=`Stage ${b.stage}`;return v[E]||(v[E]=[]),v[E].push(b),v},{});let p=`Enlaces de Formularios de Artistas - ${oe(new Date(o),"dd/MM/yyyy")}

`;Object.entries(t).forEach(([v,b])=>{p+=`${v}:
`,b.forEach(E=>{const $=E.token?`${window.location.origin}/festival/artist-form/${E.token}`:"Enlace aún no generado";p+=`${E.name} - ${$}
`}),p+=`
`}),navigator.clipboard.writeText(p),r({title:"Copiado",description:"Todos los enlaces copiados al portapapeles"})},x=t=>{const p=m.filter(b=>b.stage===t);let v=`Stage ${t} - ${oe(new Date(o),"dd/MM/yyyy")}

`;p.forEach(b=>{const E=b.token?`${window.location.origin}/festival/artist-form/${b.token}`:"Enlace aún no generado";v+=`${b.name} - ${E}
`}),navigator.clipboard.writeText(v),r({title:"Copiado",description:`Enlaces del Stage ${t} copiados al portapapeles`})};if(_)return e.jsx(ue,{open:i,onOpenChange:d,children:e.jsx(fe,{children:e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx(he,{className:"h-8 w-8 animate-spin"})})})});const n=[...new Set(m.map(t=>t.stage))].sort();return e.jsx(ue,{open:i,onOpenChange:d,children:e.jsxs(fe,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsxs(je,{children:["Enlaces de Formularios de Artistas - ",oe(new Date(o),"dd/MM/yyyy")]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(k,{onClick:j,disabled:w,children:[e.jsx(ts,{className:`h-4 w-4 mr-2 ${w?"animate-spin":""}`}),"Generar Enlaces Faltantes"]}),e.jsxs(k,{onClick:h,children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Copiar Todos los Enlaces"]})]}),n.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Stage ",t]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>x(t),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Copiar Enlaces del Stage"]})]}),e.jsx("div",{className:"border rounded-lg divide-y",children:m.filter(p=>p.stage===t).map(p=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:p.name}),e.jsx("div",{className:"flex items-center gap-2",children:p.token?e.jsxs(e.Fragment,{children:[p.status==="expired"&&e.jsx(C,{variant:"destructive",children:"Expirado"}),p.expires_at&&We(new Date(p.expires_at),new Date)&&e.jsxs(C,{variant:"secondary",children:["Expira ",oe(new Date(p.expires_at),"dd/MM/yyyy")]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>{const v=`${window.location.origin}/festival/artist-form/${p.token}`;navigator.clipboard.writeText(v),r({title:"Copiado",description:"Enlace copiado al portapapeles"})},children:e.jsx(ve,{className:"h-4 w-4"})})]}):e.jsx(C,{variant:"outline",children:"Sin enlace generado"})})]},p.artistId))})]},t))]})]})})},hn=({open:i,onOpenChange:d,file:o,url:a})=>{const r=o==null?void 0:o.file_type.startsWith("image/"),_=(o==null?void 0:o.file_type)==="application/pdf",[f,m]=c.useState(null);return c.useEffect(()=>{if(!i||!r||!a){m(null);return}let q=!1;const w=new Image;return w.onload=()=>{if(q)return;const N=w.naturalWidth||0,g=w.naturalHeight||0;m(N>0&&g>0?{width:N,height:g}:null)},w.onerror=()=>{q||m(null)},w.src=a,()=>{q=!0}},[i,r,a]),e.jsx(ue,{open:i,onOpenChange:d,children:e.jsxs(fe,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"absolute right-4 top-4",onClick:()=>d(!1),children:e.jsx(gs,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-h-0 mt-6",children:[r&&e.jsx("img",{src:a,alt:o==null?void 0:o.file_name,width:f==null?void 0:f.width,height:f==null?void 0:f.height,loading:"lazy",decoding:"async",className:"max-w-full max-h-[70vh] object-contain mx-auto"}),_&&e.jsx("iframe",{src:`${a}#toolbar=0`,className:"w-full h-[70vh] border-0",title:o==null?void 0:o.file_name}),!r&&!_&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"La vista previa no está disponible para este tipo de archivo. Por favor descargue el archivo para verlo."})})]})]})})},un=({open:i,onOpenChange:d,artistId:o})=>{const{toast:a}=pe(),[r,_]=c.useState(!1),[f,m]=c.useState([]),[q,w]=c.useState(!1),[N,g]=c.useState(null),[j,h]=c.useState(!1),[x,n]=c.useState(null),[t,p]=c.useState(""),v=async()=>{try{const{data:T,error:F}=await S.from("festival_artist_files").select("*").eq("artist_id",o);if(F){a({title:"Error",description:"No se pudieron obtener los archivos",variant:"destructive"});return}m(T||[])}catch{a({title:"Error",description:"No se pudieron obtener los archivos",variant:"destructive"})}};c.useEffect(()=>{i&&o&&v()},[i,o]);const b=async T=>{var R;const F=(R=T.target.files)==null?void 0:R[0];if(F){_(!0);try{const G=F.name.split(".").pop(),z=`${o}/${crypto.randomUUID()}.${G}`,{error:ce}=await S.storage.from("festival_artist_files").upload(z,F);if(ce)throw ce;const{error:se}=await S.from("festival_artist_files").insert({artist_id:o,file_name:F.name,file_path:z,file_type:F.type,file_size:F.size});if(se)throw se;a({title:"Éxito",description:"Archivo cargado correctamente"}),v()}catch{a({title:"Error",description:"No se pudo cargar el archivo",variant:"destructive"})}finally{_(!1)}}},E=async()=>{if(N)try{const{error:T}=await S.storage.from("festival_artist_files").remove([N.file_path]);if(T)throw T;const{error:F}=await S.from("festival_artist_files").delete().eq("id",N.id);if(F)throw F;a({title:"Éxito",description:"Archivo eliminado correctamente"}),v()}catch{a({title:"Error",description:"No se pudo eliminar el archivo",variant:"destructive"})}finally{w(!1),g(null)}},$=async T=>{try{const{data:F,error:R}=await S.storage.from("festival_artist_files").download(T.file_path);if(R)throw R;const G=URL.createObjectURL(F),z=document.createElement("a");z.href=G,z.download=T.file_name,z.click(),URL.revokeObjectURL(G)}catch{a({title:"Error",description:"No se pudo descargar el archivo",variant:"destructive"})}},U=async T=>{try{const{data:F}=await S.storage.from("festival_artist_files").createSignedUrl(T.file_path,3600);F!=null&&F.signedUrl&&(p(F.signedUrl),n(T),h(!0))}catch{a({title:"Error",description:"No se pudo ver el archivo",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{open:i,onOpenChange:d,children:e.jsxs(fe,{className:"max-w-2xl",children:[e.jsx(ye,{children:e.jsx(je,{children:"Gestionar Archivos"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"file-upload",children:"Cargar Archivo"}),e.jsxs("div",{className:"mt-1 flex items-center gap-4",children:[e.jsx(Ee,{id:"file-upload",type:"file",onChange:b,disabled:r,className:"cursor-pointer"}),r&&e.jsx(he,{className:"h-4 w-4 animate-spin"})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Archivos"}),f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aún no se han cargado archivos."}):e.jsx("div",{className:"space-y-2",children:f.map(T=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:T.file_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(T.file_type.startsWith("image/")||T.file_type==="application/pdf")&&e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>U(T),title:"Ver archivo",children:e.jsx(Ls,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>$(T),title:"Descargar archivo",children:e.jsx(Ms,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>{g(T),w(!0)},title:"Eliminar archivo",children:e.jsx(Ie,{className:"h-4 w-4 text-destructive"})})]})]},T.id))})]})]})]})}),e.jsx(Ss,{open:q,onOpenChange:w,children:e.jsxs(qs,{children:[e.jsxs(ks,{children:[e.jsx(As,{children:"Eliminar Archivo"}),e.jsx(Es,{children:"¿Está seguro que desea eliminar este archivo? Esta acción no se puede deshacer."})]}),e.jsxs($s,{children:[e.jsx(Fs,{children:"Cancelar"}),e.jsx(Ts,{onClick:E,children:"Eliminar"})]})]})}),e.jsx(hn,{open:j,onOpenChange:h,file:x,url:t})]})},ds=i=>i.sort((d,o)=>{if(d.date!==o.date)return new Date(d.date).getTime()-new Date(o.date).getTime();if(d.stage!==o.stage)return d.stage-o.stage;const a=d.show_start||"",r=o.show_start||"";let _=a,f=r;if(d.isaftermidnight!==void 0&&o.isaftermidnight!==void 0)d.isaftermidnight&&(_=`${parseInt(a.split(":")[0],10)+24}${a.substring(a.indexOf(":"))}`),o.isaftermidnight&&(f=`${parseInt(r.split(":")[0],10)+24}${r.substring(r.indexOf(":"))}`);else{const m=a?parseInt(a.split(":")[0],10):0,q=r?parseInt(r.split(":")[0],10):0;_=m>=0&&m<7?`${m+24}${a.substring(a.indexOf(":"))}`:a,f=q>=0&&q<7?`${q+24}${r.substring(r.indexOf(":"))}`:r}return _<f?-1:_>f?1:(d.name||"").localeCompare(o.name||"")}),ms=(i,d,o)=>{var w,N,g;const a=[],r=o?{foh_consoles:o.foh_consoles,mon_consoles:o.mon_consoles,wireless_systems:o.wireless_systems,iem_systems:o.iem_systems,wired_mics:o.wired_mics||[],available_monitors:o.monitors_quantity,has_side_fills:o.extras_sf,has_drum_fills:o.extras_df,has_dj_booths:o.extras_djbooth,available_cat6_runs:o.infra_cat6_quantity,available_hma_runs:o.infra_hma_quantity,available_coax_runs:o.infra_coax_quantity,available_opticalcon_duo_runs:o.infra_opticalcon_duo_quantity,available_analog_runs:o.infra_analog}:d?{foh_consoles:d.foh_consoles,mon_consoles:d.mon_consoles,wireless_systems:d.wireless_systems,iem_systems:d.iem_systems,wired_mics:d.wired_mics||[],available_monitors:d.available_monitors,has_side_fills:d.has_side_fills,has_drum_fills:d.has_drum_fills,has_dj_booths:d.has_dj_booths,available_cat6_runs:d.available_cat6_runs,available_hma_runs:d.available_hma_runs,available_coax_runs:d.available_coax_runs,available_opticalcon_duo_runs:d.available_opticalcon_duo_runs,available_analog_runs:d.available_analog_runs}:{foh_consoles:[],mon_consoles:[],wireless_systems:[],iem_systems:[],wired_mics:[],available_monitors:0,has_side_fills:!1,has_drum_fills:!1,has_dj_booths:!1,available_cat6_runs:0,available_hma_runs:0,available_coax_runs:0,available_opticalcon_duo_runs:0,available_analog_runs:0};if(i.foh_console&&i.foh_console.trim()!=="")if((i.foh_console_provided_by||"festival")==="band")a.push({type:"console",severity:"warning",message:`Band bringing FOH Console "${i.foh_console}"`});else{const h=r.foh_consoles.find(x=>x.model.toLowerCase()===i.foh_console.toLowerCase());h?h.quantity<1&&a.push({type:"console",severity:"error",message:`FOH Console "${i.foh_console}" out of stock`,details:`Available quantity: ${h.quantity}`}):a.push({type:"console",severity:"error",message:`FOH Console "${i.foh_console}" not available`,details:`Available: ${r.foh_consoles.map(x=>x.model).join(", ")||"None"}`})}if(i.mon_console&&i.mon_console.trim()!=="")if((i.mon_console_provided_by||"festival")==="band")a.push({type:"console",severity:"warning",message:`Band bringing Monitor Console "${i.mon_console}"`});else{const h=r.mon_consoles.find(x=>x.model.toLowerCase()===i.mon_console.toLowerCase());h?h.quantity<1&&a.push({type:"console",severity:"error",message:`Monitor Console "${i.mon_console}" out of stock`,details:`Available quantity: ${h.quantity}`}):a.push({type:"console",severity:"error",message:`Monitor Console "${i.mon_console}" not available`,details:`Available: ${r.mon_consoles.map(x=>x.model).join(", ")||"None"}`})}if(i.wireless_systems&&i.wireless_systems.length>0){const j=i.wireless_provided_by||"festival";if(j==="band")a.push({type:"wireless",severity:"warning",message:"Band bringing wireless systems"});else if(j==="mixed"){let h=!1,x=!1;i.wireless_systems.forEach(n=>{if((n.provided_by||"festival")==="band")h=!0;else{x=!0;const p=r.wireless_systems.find(v=>v.model.toLowerCase()===n.model.toLowerCase());if(!p)a.push({type:"wireless",severity:"error",message:`Wireless system "${n.model}" not available`,details:`Available: ${r.wireless_systems.map(v=>v.model).join(", ")||"None"}`});else{const v=n.quantity_hh||0,b=n.quantity_bp||0,E=p.quantity_hh||0,$=p.quantity_bp||0;v>E&&a.push({type:"wireless",severity:"error",message:`Insufficient wireless handheld units for "${n.model}"`,details:`Required: ${v}, Available: ${E}`}),b>$&&a.push({type:"wireless",severity:"error",message:`Insufficient wireless beltpack units for "${n.model}"`,details:`Required: ${b}, Available: ${$}`})}}}),h&&x&&a.push({type:"wireless",severity:"warning",message:"Mixed wireless setup - band providing some systems"})}else i.wireless_systems.forEach(h=>{const x=r.wireless_systems.find(n=>n.model.toLowerCase()===h.model.toLowerCase());if(!x)a.push({type:"wireless",severity:"error",message:`Wireless system "${h.model}" not available`,details:`Available: ${r.wireless_systems.map(n=>n.model).join(", ")||"None"}`});else{const n=h.quantity_hh||0,t=h.quantity_bp||0,p=x.quantity_hh||0,v=x.quantity_bp||0;n>p&&a.push({type:"wireless",severity:"error",message:`Insufficient wireless handheld units for "${h.model}"`,details:`Required: ${n}, Available: ${p}`}),t>v&&a.push({type:"wireless",severity:"error",message:`Insufficient wireless beltpack units for "${h.model}"`,details:`Required: ${t}, Available: ${v}`})}})}if(i.iem_systems&&i.iem_systems.length>0){const j=i.iem_provided_by||"festival";if(j==="band")a.push({type:"iem",severity:"warning",message:"Band bringing IEM systems"});else if(j==="mixed"){let h=!1,x=!1;i.iem_systems.forEach(n=>{if((n.provided_by||"festival")==="band")h=!0;else{x=!0;const p=r.iem_systems.find(v=>v.model.toLowerCase()===n.model.toLowerCase());if(!p)a.push({type:"iem",severity:"error",message:`IEM system "${n.model}" not available`,details:`Available: ${r.iem_systems.map(v=>v.model).join(", ")||"None"}`});else{const v=n.quantity_hh||n.quantity||0,b=n.quantity_bp||0,E=p.quantity_hh||p.quantity||0,$=p.quantity_bp||0;v>E&&a.push({type:"iem",severity:"error",message:`Insufficient IEM channels for "${n.model}"`,details:`Required: ${v}, Available: ${E}`}),b>$&&a.push({type:"iem",severity:"error",message:`Insufficient IEM beltpacks for "${n.model}"`,details:`Required: ${b}, Available: ${$}`})}}}),h&&x&&a.push({type:"iem",severity:"warning",message:"Mixed IEM setup - band providing some systems"})}else i.iem_systems.forEach(h=>{const x=r.iem_systems.find(n=>n.model.toLowerCase()===h.model.toLowerCase());if(!x)a.push({type:"iem",severity:"error",message:`IEM system "${h.model}" not available`,details:`Available: ${r.iem_systems.map(n=>n.model).join(", ")||"None"}`});else{const n=h.quantity_hh||h.quantity||0,t=h.quantity_bp||0,p=x.quantity_hh||x.quantity||0,v=x.quantity_bp||0;n>p&&a.push({type:"iem",severity:"error",message:`Insufficient IEM channels for "${h.model}"`,details:`Required: ${n}, Available: ${p}`}),t>v&&a.push({type:"iem",severity:"error",message:`Insufficient IEM beltpacks for "${h.model}"`,details:`Required: ${t}, Available: ${v}`})}})}const _=i.mic_kit||"band",f=i.wired_mics&&Array.isArray(i.wired_mics)&&i.wired_mics.length>0,m=r.wired_mics&&Array.isArray(r.wired_mics)&&r.wired_mics.length>0;return _==="band"?f?a.push({type:"microphones",severity:"warning",message:`Band bringing microphone kit (${((w=i.wired_mics)==null?void 0:w.length)||0} mic types)`}):a.push({type:"microphones",severity:"warning",message:"Band bringing microphone kit"}):(_==="festival"||_==="mixed")&&(f?(m?(g=i.wired_mics)==null||g.forEach((j,h)=>{const x=r.wired_mics.find(n=>n.model.toLowerCase()===j.model.toLowerCase());x?x.quantity<j.quantity&&a.push({type:"microphones",severity:"error",message:`Insufficient "${j.model}" microphones`,details:`Required: ${j.quantity}, Available: ${x.quantity}`}):a.push({type:"microphones",severity:"error",message:`Wired microphone "${j.model}" not available`,details:`Available: ${r.wired_mics.map(n=>n.model).join(", ")||"None"}`})}):a.push({type:"microphones",severity:"error",message:"Festival microphones required but none configured",details:`Artist needs ${((N=i.wired_mics)==null?void 0:N.length)||0} microphone types but festival has no mics available`}),_==="mixed"&&a.push({type:"microphones",severity:"warning",message:"Mixed microphone setup - band providing additional mics"})):_==="festival"&&(m||a.push({type:"microphones",severity:"warning",message:"Festival microphone kit expected but none configured"}))),i.monitors_enabled&&i.monitors_quantity>r.available_monitors&&a.push({type:"monitors",severity:"error",message:"Insufficient monitors",details:`Required: ${i.monitors_quantity}, Available: ${r.available_monitors}`}),i.extras_sf&&!r.has_side_fills&&a.push({type:"extras",severity:"warning",message:"Side fills requested but not available"}),i.extras_df&&!r.has_drum_fills&&a.push({type:"extras",severity:"warning",message:"Drum fills requested but not available"}),i.extras_djbooth&&!r.has_dj_booths&&a.push({type:"extras",severity:"warning",message:"DJ booth requested but not available"}),(i.infrastructure_provided_by||"festival")==="band"?a.push({type:"infrastructure",severity:"warning",message:"Band bringing infrastructure"}):(i.infra_cat6&&(i.infra_cat6_quantity||0)>r.available_cat6_runs&&a.push({type:"infrastructure",severity:"error",message:"Insufficient CAT6 runs",details:`Required: ${i.infra_cat6_quantity||0}, Available: ${r.available_cat6_runs}`}),i.infra_hma&&(i.infra_hma_quantity||0)>r.available_hma_runs&&a.push({type:"infrastructure",severity:"error",message:"Insufficient HMA runs",details:`Required: ${i.infra_hma_quantity||0}, Available: ${r.available_hma_runs}`}),i.infra_coax&&(i.infra_coax_quantity||0)>r.available_coax_runs&&a.push({type:"infrastructure",severity:"error",message:"Insufficient Coax runs",details:`Required: ${i.infra_coax_quantity||0}, Available: ${r.available_coax_runs}`}),i.infra_opticalcon_duo&&(i.infra_opticalcon_duo_quantity||0)>r.available_opticalcon_duo_runs&&a.push({type:"infrastructure",severity:"error",message:"Insufficient OpticalCON DUO runs",details:`Required: ${i.infra_opticalcon_duo_quantity||0}, Available: ${r.available_opticalcon_duo_runs}`}),(i.infra_analog||0)>r.available_analog_runs&&a.push({type:"infrastructure",severity:"error",message:"Insufficient analog runs",details:`Required: ${i.infra_analog||0}, Available: ${r.available_analog_runs}`})),{artistName:i.name,stage:i.stage,mismatches:a,hasConflicts:a.length>0}},De=({mismatches:i,compact:d=!1})=>{if(i.length===0)return d?e.jsx(C,{variant:"secondary",className:"bg-green-100 text-green-800",children:"✓"}):e.jsx(C,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Sin problemas"});const o=i.filter(_=>_.severity==="error"),a=i.filter(_=>_.severity==="warning"),r=e.jsxs("div",{className:"max-w-sm space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Problemas de equipo:"}),o.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-red-600 font-medium text-xs",children:["Errores (",o.length,"):"]}),o.map((_,f)=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("p",{className:"text-red-600",children:["• ",_.message]}),_.details&&e.jsx("p",{className:"text-gray-500 ml-2",children:_.details})]},f))]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-orange-600 font-medium text-xs",children:["Advertencias (",a.length,"):"]}),a.map((_,f)=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("p",{className:"text-orange-600",children:["• ",_.message]}),_.details&&e.jsx("p",{className:"text-gray-500 ml-2",children:_.details})]},f))]})]});return d?e.jsxs($e,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1",children:[o.length>0&&e.jsxs(C,{variant:"destructive",className:"text-xs px-1",children:[e.jsx(Ve,{className:"h-3 w-3 mr-1"}),o.length]}),a.length>0&&e.jsxs(C,{variant:"outline",className:"text-xs px-1 bg-orange-100 text-orange-800 border-orange-300",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),a.length]})]})}),e.jsx(Te,{children:r})]}):e.jsxs($e,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[o.length>0&&e.jsxs(C,{variant:"destructive",className:"text-xs",children:[e.jsx(Ve,{className:"h-3 w-3 mr-1"}),o.length," Error",o.length!==1?"es":""]}),a.length>0&&e.jsxs(C,{variant:"outline",className:"text-xs bg-orange-100 text-orange-800 border-orange-300",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),a.length," Advertencia",a.length!==1?"s":""]})]})}),e.jsx(Te,{children:r})]})},fn=({artists:i,isLoading:d,onEditArtist:o,onDeleteArtist:a,searchTerm:r,stageFilter:_,equipmentFilter:f,riderFilter:m,dayStartTime:q,jobId:w,selectedDate:N})=>{const[g,j]=c.useState(null),[h,x]=c.useState(!1),[n,t]=c.useState(!1),[p,v]=c.useState(!1),[b,E]=c.useState(null),[$,U]=c.useState(null),[T,F]=c.useState({}),[R,G]=c.useState({}),[z,ce]=c.useState(null),[se,y]=c.useState({});c.useEffect(()=>{(async()=>{if(!w)return;const{data:u,error:L}=await S.from("festival_stages").select("number, name").eq("job_id",w);if(L)return;const O={};u==null||u.forEach(I=>{O[I.number]=I.name}),F(O)})()},[w]),c.useEffect(()=>{(async()=>{if(w)try{const{data:u,error:L}=await S.from("festival_gear_setups").select("*").eq("job_id",w).single();if(L&&L.code!=="PGRST116")return;if(ce(u),u){const{data:O,error:I}=await S.from("festival_stage_gear_setups").select("*").eq("gear_setup_id",u.id);if(!I){const ie={};O==null||O.forEach(de=>{ie[de.stage_number]=de}),y(ie)}}}catch{}})()},[w]),c.useEffect(()=>{if(!z||i.length===0){G({});return}const s={};i.forEach(u=>{const L=se[u.stage]||null,O={name:u.name,stage:u.stage,foh_console:u.foh_console,foh_console_provided_by:u.foh_console_provided_by,mon_console:u.mon_console,mon_console_provided_by:u.mon_console_provided_by,wireless_systems:u.wireless_systems||[],wireless_provided_by:u.wireless_provided_by,iem_systems:u.iem_systems||[],iem_provided_by:u.iem_provided_by,monitors_enabled:u.monitors_enabled,monitors_quantity:u.monitors_quantity,extras_sf:u.extras_sf,extras_df:u.extras_df,extras_djbooth:u.extras_djbooth,infra_cat6:u.infra_cat6||!1,infra_cat6_quantity:u.infra_cat6_quantity||0,infra_hma:u.infra_hma||!1,infra_hma_quantity:u.infra_hma_quantity||0,infra_coax:u.infra_coax||!1,infra_coax_quantity:u.infra_coax_quantity||0,infra_opticalcon_duo:u.infra_opticalcon_duo||!1,infra_opticalcon_duo_quantity:u.infra_opticalcon_duo_quantity||0,infra_analog:u.infra_analog||0,infrastructure_provided_by:u.infrastructure_provided_by,mic_kit:u.mic_kit||"band",wired_mics:u.wired_mics||[]},I=ms(O,z,L);s[u.id]=I}),G(s)},[i,z,se]);const A=s=>T[s]||`Stage ${s}`,H=s=>{const u=[];return s.infra_cat6&&s.infra_cat6_quantity&&u.push(`${s.infra_cat6_quantity}x CAT6`),s.infra_hma&&s.infra_hma_quantity&&u.push(`${s.infra_hma_quantity}x HMA`),s.infra_coax&&s.infra_coax_quantity&&u.push(`${s.infra_coax_quantity}x Coax`),s.infra_opticalcon_duo&&s.infra_opticalcon_duo_quantity&&u.push(`${s.infra_opticalcon_duo_quantity}x OpticalCON DUO`),s.infra_analog&&s.infra_analog>0&&u.push(`${s.infra_analog}x Analog`),s.other_infrastructure&&u.push(s.other_infrastructure),u.length>0?u.join(", "):"Ninguno"},re=s=>!s||s.trim()===""?"Sin notas":s.length>50?`${s.substring(0,50)}...`:s,l=i.filter(s=>{var ie;const u=s.name.toLowerCase().includes(r.toLowerCase()),L=_==="all"||((ie=s.stage)==null?void 0:ie.toString())===_,O=!f||s.foh_console.toLowerCase().includes(f.toLowerCase())||s.mon_console.toLowerCase().includes(f.toLowerCase())||s.wired_mics&&s.wired_mics.some(de=>de.model.toLowerCase().includes(f.toLowerCase())),I=m==="all"||m==="missing"&&s.rider_missing||m==="complete"&&!s.rider_missing;return u&&L&&O&&I}),D=ds(l),Q=async s=>{window.confirm(`¿Estás seguro de que quieres eliminar ${s.name}?`)&&(j(s.id),await a(s),j(null))},te=(s=[])=>s.length===0?"Ninguno":s.map(u=>{const L=u.exclusive_use?" (E)":"";return`${u.quantity}x ${u.model}${L}`}).join(", "),P=(s=[],u=!1)=>s.length===0?"Ninguno":s.map(L=>{if(u){const O=L.quantity_hh||L.quantity||0,I=L.quantity_bp||0;return`${L.model}: ${O} ch${I>0?`, ${I} bp`:""}`}else{const O=L.quantity_hh||0,I=L.quantity_bp||0,ie=O+I;return O>0&&I>0?`${L.model}: ${O}x HH, ${I}x BP`:ie>0?`${L.model}: ${ie}x`:L.model}}).join("; "),ne=s=>({festival:"bg-blue-100 text-blue-800",band:"bg-green-100 text-green-800",mixed:"bg-purple-100 text-purple-800",artist:"bg-orange-100 text-orange-800"})[s]||"bg-gray-100 text-gray-800",we=async s=>{let u;if(w)try{u=await cs(w)}catch{}return{name:s.name,stage:s.stage,date:s.date,schedule:{show:{start:s.show_start,end:s.show_end},soundcheck:s.soundcheck?{start:s.soundcheck_start||"",end:s.soundcheck_end||""}:void 0},technical:{fohTech:s.foh_tech||!1,monTech:s.mon_tech||!1,fohConsole:{model:s.foh_console,providedBy:s.foh_console_provided_by||"festival"},monConsole:{model:s.mon_console,providedBy:s.mon_console_provided_by||"festival"},wireless:{systems:s.wireless_systems||[],providedBy:s.wireless_provided_by||"festival"},iem:{systems:s.iem_systems||[],providedBy:s.iem_provided_by||"festival"},monitors:{enabled:s.monitors_enabled,quantity:s.monitors_quantity}},infrastructure:{providedBy:s.infrastructure_provided_by||"festival",cat6:{enabled:s.infra_cat6||!1,quantity:s.infra_cat6_quantity||0},hma:{enabled:s.infra_hma||!1,quantity:s.infra_hma_quantity||0},coax:{enabled:s.infra_coax||!1,quantity:s.infra_coax_quantity||0},opticalconDuo:{enabled:s.infra_opticalcon_duo||!1,quantity:s.infra_opticalcon_duo_quantity||0},analog:s.infra_analog||0,other:s.other_infrastructure||""},extras:{sideFill:s.extras_sf,drumFill:s.extras_df,djBooth:s.extras_djbooth,wired:""},notes:s.notes||"",wiredMics:s.wired_mics||[],logoUrl:u,micKit:s.mic_kit||"band",riderMissing:s.rider_missing||!1}},xe=async s=>{U(s.id);try{const u=await we(s),L=await Ps(u),O=URL.createObjectURL(L),I=document.createElement("a");I.href=O,I.download=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Requirements.pdf`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(O),le.success(`PDF generado para ${s.name}`)}catch{le.error("Error al generar PDF")}finally{U(null)}},be=s=>{E(s),x(!0)},Ne=()=>{t(!0)},Le=s=>{E(s),v(!0)};return d?e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(he,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando artistas..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ss,{children:e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-4 px-2",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-semibold leading-none tracking-tight",children:["Cronograma de artistas (",D.length," artistas)"]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:Ne,className:"hidden md:flex",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Ver todos los enlaces"]}),e.jsx(k,{variant:"outline",size:"icon",onClick:Ne,className:"md:hidden",children:e.jsx(Je,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"hidden md:block w-full overflow-x-auto",children:e.jsxs(bs,{className:"w-full min-w-full",children:[e.jsx(Ns,{children:e.jsxs(ze,{children:[e.jsx(Z,{className:"min-w-[140px]",children:"Artista"}),e.jsx(Z,{className:"min-w-[80px]",children:"Stage"}),e.jsx(Z,{className:"min-w-[100px]",children:"Hora del show"}),e.jsx(Z,{className:"min-w-[100px]",children:"Soundcheck"}),e.jsx(Z,{className:"min-w-[200px]",children:"Consolas"}),e.jsx(Z,{className:"min-w-[180px]",children:"Wireless/IEM"}),e.jsx(Z,{className:"min-w-[140px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Micrófonos"]})}),e.jsx(Z,{className:"min-w-[80px]",children:"Monitores"}),e.jsx(Z,{className:"min-w-[160px]",children:"Infraestructura"}),e.jsx(Z,{className:"min-w-[80px]",children:"Extras"}),e.jsx(Z,{className:"min-w-[120px]",children:"Notas"}),e.jsx(Z,{className:"min-w-[80px]",children:"Estado"}),e.jsx(Z,{className:"min-w-[100px]",children:"Estado del equipo"}),e.jsx(Z,{className:"min-w-[200px]",children:"Acciones"})]})}),e.jsx(Cs,{children:D.map(s=>{const u=R[s.id];return e.jsxs(ze,{children:[e.jsx(X,{className:"min-w-[140px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.isaftermidnight&&e.jsx(C,{variant:"outline",className:"text-xs bg-blue-700",children:"Después de medianoche"})]})}),e.jsx(X,{className:"min-w-[80px]",children:e.jsx(C,{variant:"outline",children:A(s.stage)})}),e.jsx(X,{className:"min-w-[100px]",children:e.jsxs("div",{className:"text-sm",children:[s.show_start," - ",s.show_end]})}),e.jsx(X,{className:"min-w-[100px]",children:s.soundcheck?e.jsxs("div",{className:"text-sm",children:[e.jsx(C,{variant:"secondary",children:"Sí"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.soundcheck_start," - ",s.soundcheck_end]})]}):e.jsx(C,{variant:"outline",children:"No"})}),e.jsx(X,{className:"min-w-[200px]",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxs("span",{children:["FOH: ",s.foh_console||"No especificado"]}),s.foh_console_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.foh_console_provided_by)}`,children:s.foh_console_provided_by}),s.foh_tech&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Técnico"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxs("span",{children:["MON: ",s.mon_console||"No especificado"]}),s.mon_console_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.mon_console_provided_by)}`,children:s.mon_console_provided_by}),s.mon_tech&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Técnico"})]})]})}),e.jsx(X,{className:"min-w-[180px]",children:e.jsxs("div",{className:"text-sm space-y-1",children:[s.wireless_systems&&s.wireless_systems.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxs("div",{className:"text-xs",title:P(s.wireless_systems),children:["Wireless: ",P(s.wireless_systems)]}),s.wireless_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.wireless_provided_by)}`,children:s.wireless_provided_by==="mixed"?"Mixed":s.wireless_provided_by})]}),s.iem_systems&&s.iem_systems.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxs("div",{className:"text-xs",title:P(s.iem_systems,!0),children:["IEM: ",P(s.iem_systems,!0)]}),s.iem_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.iem_provided_by)}`,children:s.iem_provided_by==="mixed"?"Mixed":s.iem_provided_by})]})]})}),e.jsx(X,{className:"min-w-[140px]",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx(C,{variant:s.mic_kit==="festival"?"default":s.mic_kit==="mixed"?"secondary":"outline",className:s.mic_kit==="mixed"?"bg-purple-100 text-purple-800":"",children:s.mic_kit==="festival"?"Festival":s.mic_kit==="mixed"?"Mixed":"Band"}),(s.mic_kit==="festival"||s.mic_kit==="mixed")&&s.wired_mics&&s.wired_mics.length>0&&e.jsx("div",{className:"text-xs text-muted-foreground max-w-32 truncate",title:te(s.wired_mics),children:te(s.wired_mics)})]})}),e.jsx(X,{className:"min-w-[80px]",children:s.monitors_enabled?e.jsx("div",{className:"text-sm",children:e.jsxs(C,{variant:"secondary",children:[s.monitors_quantity,"x"]})}):e.jsx(C,{variant:"outline",children:"Ninguno"})}),e.jsx(X,{className:"min-w-[160px]",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs($e,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("div",{className:"text-xs text-muted-foreground max-w-36 truncate cursor-help",children:H(s)})}),e.jsx(Te,{children:e.jsxs("div",{className:"max-w-sm",children:[e.jsx("p",{className:"font-medium",children:"Requisitos de infraestructura:"}),e.jsx("p",{children:H(s)}),s.infrastructure_provided_by&&e.jsxs("p",{className:"text-xs mt-1",children:["Provisto por: ",s.infrastructure_provided_by]})]})})]}),s.infrastructure_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.infrastructure_provided_by)}`,children:s.infrastructure_provided_by})]})}),e.jsx(X,{className:"min-w-[80px]",children:e.jsxs("div",{className:"text-xs space-y-1 flex flex-wrap gap-1",children:[s.extras_sf&&e.jsx(C,{variant:"outline",className:"text-xs",children:"SF"}),s.extras_df&&e.jsx(C,{variant:"outline",className:"text-xs",children:"DF"}),s.extras_djbooth&&e.jsx(C,{variant:"outline",className:"text-xs",children:"DJ"})]})}),e.jsx(X,{className:"min-w-[120px]",children:s.notes&&s.notes.trim()!==""?e.jsxs($e,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("div",{className:"text-xs text-muted-foreground max-w-28 truncate cursor-help",children:re(s.notes)})}),e.jsx(Te,{children:e.jsxs("div",{className:"max-w-sm",children:[e.jsx("p",{className:"font-medium",children:"Notas:"}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.notes})]})})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sin notas"})}),e.jsx(X,{className:"min-w-[80px]",children:e.jsx(C,{variant:s.rider_missing?"destructive":"default",children:s.rider_missing?"Faltante":"Completo"})}),e.jsx(X,{className:"min-w-[100px]",children:u?e.jsx(De,{mismatches:u.mismatches,compact:!0}):e.jsx(C,{variant:"outline",className:"text-xs",children:"Sin configuración"})}),e.jsx(X,{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>be(s),title:"Generate form link",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>Le(s),title:"Manage files/riders",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>xe(s),disabled:$===s.id,title:"Print artist details",children:$===s.id?e.jsx(he,{className:"h-4 w-4 animate-spin"}):e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>o(s),title:"Edit artist",children:e.jsx(Ze,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>Q(s),disabled:g===s.id,title:"Delete artist",children:g===s.id?e.jsx(he,{className:"h-4 w-4 animate-spin"}):e.jsx(Ie,{className:"h-4 w-4"})})]})})]},s.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:D.map(s=>{const u=R[s.id];return e.jsxs("div",{className:"border rounded-lg p-4 space-y-3 bg-card",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsx(C,{variant:"outline",className:"text-xs",children:A(s.stage)}),e.jsx(C,{variant:s.rider_missing?"destructive":"default",className:"text-xs",children:s.rider_missing?"Faltante":"Completo"}),s.isaftermidnight&&e.jsx(C,{variant:"outline",className:"text-xs bg-blue-700",children:"Después de medianoche"})]})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Hora del show"}),e.jsxs("div",{className:"text-sm",children:[s.show_start," - ",s.show_end]})]}),s.soundcheck&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Soundcheck"}),e.jsxs("div",{className:"text-sm",children:[s.soundcheck_start," - ",s.soundcheck_end]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Consolas"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"FOH:"}),e.jsx("span",{children:s.foh_console||"No especificado"}),s.foh_console_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.foh_console_provided_by)}`,children:s.foh_console_provided_by}),s.foh_tech&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Técnico"})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"MON:"}),e.jsx("span",{children:s.mon_console||"No especificado"}),s.mon_console_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.mon_console_provided_by)}`,children:s.mon_console_provided_by}),s.mon_tech&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Técnico"})]})]})]}),(s.wireless_systems&&s.wireless_systems.length>0||s.iem_systems&&s.iem_systems.length>0)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Wireless/IEM"}),e.jsxs("div",{className:"text-sm space-y-1",children:[s.wireless_systems&&s.wireless_systems.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs",children:["Wireless: ",P(s.wireless_systems)]}),s.wireless_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.wireless_provided_by)}`,children:s.wireless_provided_by})]}),s.iem_systems&&s.iem_systems.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs",children:["IEM: ",P(s.iem_systems,!0)]}),s.iem_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.iem_provided_by)}`,children:s.iem_provided_by})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Micrófonos"]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(C,{variant:s.mic_kit==="festival"?"default":s.mic_kit==="mixed"?"secondary":"outline",className:s.mic_kit==="mixed"?"bg-purple-100 text-purple-800":"",children:s.mic_kit==="festival"?"Festival":s.mic_kit==="mixed"?"Mixed":"Band"})}),(s.mic_kit==="festival"||s.mic_kit==="mixed")&&s.wired_mics&&s.wired_mics.length>0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:te(s.wired_mics)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Monitores"}),e.jsx("div",{children:s.monitors_enabled?e.jsxs(C,{variant:"secondary",children:[s.monitors_quantity,"x"]}):e.jsx(C,{variant:"outline",children:"Ninguno"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Infraestructura"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:H(s)}),s.infrastructure_provided_by&&e.jsx(C,{variant:"outline",className:`text-xs ${ne(s.infrastructure_provided_by)}`,children:s.infrastructure_provided_by})]}),(s.extras_sf||s.extras_df||s.extras_djbooth)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Extras"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.extras_sf&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Side Fill"}),s.extras_df&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Drum Fill"}),s.extras_djbooth&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Cabina DJ"})]})]}),s.notes&&s.notes.trim()!==""&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Notas"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-wrap",children:s.notes})]}),u&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:"Estado del equipo"}),e.jsx(De,{mismatches:u.mismatches,compact:!0})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t",children:[e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>be(s),children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Enlace"})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>Le(s),children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Archivos"})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>xe(s),disabled:$===s.id,children:[$===s.id?e.jsx(he,{className:"h-4 w-4 animate-spin"}):e.jsx(ge,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Imprimir"})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>o(s),children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Editar"})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>Q(s),disabled:g===s.id,children:[g===s.id?e.jsx(he,{className:"h-4 w-4 animate-spin"}):e.jsx(Ie,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Eliminar"})]})]})]},s.id)})}),D.length===0&&!d&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No se encontraron artistas con los filtros actuales."})]})}),b&&e.jsxs(e.Fragment,{children:[e.jsx(dn,{open:h,onOpenChange:x,artistId:b.id,artistName:b.name}),e.jsx(un,{open:p,onOpenChange:v,artistId:b.id})]}),e.jsx(mn,{open:n,onOpenChange:t,selectedDate:N||"",jobId:w||""})]})},xn=({micKit:i,wiredMics:d,onMicKitChange:o,onWiredMicsChange:a})=>{const{models:r}=Js(),_=r.filter(f=>f.category==="wired_mics").map(f=>f.name);return e.jsxs(ns,{children:[e.jsx(is,{children:e.jsx(as,{children:"Kit de Micrófonos"})}),e.jsxs(os,{className:"space-y-6",children:[e.jsx(Hs,{value:i,onChange:o,label:"Proveedor del Kit de Micrófonos",id:"mic-kit",showMixed:!0}),(i==="festival"||i==="mixed")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:i==="mixed"?"Micrófonos Cableados Proporcionados por el Festival":"Micrófonos Cableados Requeridos"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:i==="mixed"?"Seleccione solo los micrófonos que el festival proporcionará. La banda proporcionará cualquier micrófono adicional.":"Seleccione los micrófonos cableados que necesita para su presentación."})]}),e.jsx(Us,{value:d,onChange:a,availableMics:_,showExclusiveUse:!0,showNotes:!0})]}),i==="band"&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"La banda proporcionará su propio kit de micrófonos."})}),i==="mixed"&&e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsx("p",{className:"text-sm text-blue-700",children:"Configuración mixta de micrófonos: Ingrese solo los micrófonos que el festival proporcionará. La banda proporcionará cualquier micrófono adicional que necesite."})})]})]})},pn=(i,d,o)=>{const[a,r]=c.useState(null),[_,f]=c.useState(!0),[m,q]=c.useState(null);return c.useEffect(()=>{(async()=>{if(i){f(!0),q(null);try{const{data:N,error:g}=await S.from("festival_gear_setups").select("*").eq("job_id",i).maybeSingle();if(g)throw new Error(`Error fetching global setup: ${g.message}`);let j=null;if(N&&o){const{data:h,error:x}=await S.from("festival_stage_gear_setups").select("*").eq("gear_setup_id",N.id).eq("stage_number",o).maybeSingle();if(x)throw new Error(`Error fetching stage setup: ${x.message}`);j=h}r({globalSetup:N,stageSetup:j})}catch(N){q(N.message)}finally{f(!1)}}})()},[i,d,o]),{combinedSetup:a,isLoading:_,error:m}},_n=({artist:i,jobId:d,selectedDate:o,dayStartTime:a="07:00",onSubmit:r,isSubmitting:_})=>{const{toast:f}=pe(),{combinedSetup:m}=pn(d||"",o,1),[q,w]=c.useState(!1),N=n=>({name:(n==null?void 0:n.name)||"",stage:(n==null?void 0:n.stage)||1,date:o,show_start:(n==null?void 0:n.show_start)||"20:00",show_end:(n==null?void 0:n.show_end)||"21:00",soundcheck:(n==null?void 0:n.soundcheck)||!1,soundcheck_start:(n==null?void 0:n.soundcheck_start)||"18:00",soundcheck_end:(n==null?void 0:n.soundcheck_end)||"19:00",foh_console:(n==null?void 0:n.foh_console)||"",foh_console_provided_by:(n==null?void 0:n.foh_console_provided_by)||"festival",mon_console:(n==null?void 0:n.mon_console)||"",mon_console_provided_by:(n==null?void 0:n.mon_console_provided_by)||"festival",wireless_systems:(n==null?void 0:n.wireless_systems)||[],iem_systems:(n==null?void 0:n.iem_systems)||[],wireless_provided_by:(n==null?void 0:n.wireless_provided_by)||"festival",iem_provided_by:(n==null?void 0:n.iem_provided_by)||"festival",monitors_enabled:(n==null?void 0:n.monitors_enabled)||!1,monitors_quantity:(n==null?void 0:n.monitors_quantity)||0,extras_sf:(n==null?void 0:n.extras_sf)||!1,extras_df:(n==null?void 0:n.extras_df)||!1,extras_djbooth:(n==null?void 0:n.extras_djbooth)||!1,extras_wired:(n==null?void 0:n.extras_wired)||"",infra_cat6:(n==null?void 0:n.infra_cat6)||!1,infra_cat6_quantity:(n==null?void 0:n.infra_cat6_quantity)||0,infra_hma:(n==null?void 0:n.infra_hma)||!1,infra_hma_quantity:(n==null?void 0:n.infra_hma_quantity)||0,infra_coax:(n==null?void 0:n.infra_coax)||!1,infra_coax_quantity:(n==null?void 0:n.infra_coax_quantity)||0,infra_opticalcon_duo:(n==null?void 0:n.infra_opticalcon_duo)||!1,infra_opticalcon_duo_quantity:(n==null?void 0:n.infra_opticalcon_duo_quantity)||0,infra_analog:(n==null?void 0:n.infra_analog)||0,infrastructure_provided_by:(n==null?void 0:n.infrastructure_provided_by)||"festival",other_infrastructure:(n==null?void 0:n.other_infrastructure)||"",notes:(n==null?void 0:n.notes)||"",foh_tech:(n==null?void 0:n.foh_tech)||!1,mon_tech:(n==null?void 0:n.mon_tech)||!1,rider_missing:(n==null?void 0:n.rider_missing)||!1,isaftermidnight:(n==null?void 0:n.isaftermidnight)||!1,mic_kit:(n==null?void 0:n.mic_kit)||"band",wired_mics:(n==null?void 0:n.wired_mics)||[]}),[g,j]=c.useState(N(i));c.useEffect(()=>{i&&j(N(i))},[i,o,m]),c.useEffect(()=>{i&&(w(!0),(async()=>{try{const{data:t,error:p}=await S.from("festival_artists").select("*").eq("id",i.id).single();p?f({title:"Error",description:"No se pudieron cargar los detalles del artista",variant:"destructive"}):t&&j(N(t))}catch{f({title:"Error",description:"No se pudieron cargar los detalles del artista",variant:"destructive"})}finally{w(!1)}})())},[i,o,f,m]);const h=async n=>{n.preventDefault(),await r(g)},x=n=>{j(t=>({...t,...n}))};return e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsx(Is,{formData:g,onChange:x,gearSetup:(m==null?void 0:m.globalSetup)||null}),e.jsx(Rs,{formData:g,onChange:x,gearSetup:(m==null?void 0:m.globalSetup)||null}),e.jsx(Bs,{formData:g,onChange:x,gearSetup:(m==null?void 0:m.globalSetup)||null}),e.jsx(xn,{micKit:g.mic_kit,wiredMics:g.wired_mics,onMicKitChange:n=>x({mic_kit:n}),onWiredMicsChange:n=>x({wired_mics:n})}),e.jsx(zs,{formData:g,onChange:x,gearSetup:(m==null?void 0:m.globalSetup)||null}),e.jsx(Ws,{formData:g,onChange:x,gearSetup:(m==null?void 0:m.globalSetup)||null}),e.jsx(Vs,{formData:g,onChange:x,gearSetup:(m==null?void 0:m.globalSetup)||null}),e.jsx(Ks,{formData:g,onChange:x}),e.jsx(k,{type:"submit",disabled:_,className:"w-full",children:_?"Guardando...":i?"Actualizar Artista":"Agregar Artista"})]})},es=i=>{const d={...i};return["show_start","show_end","soundcheck_start","soundcheck_end"].forEach(a=>{d[a]===""&&(d[a]=null)}),d},gn=(i,d)=>{const o=rs(),{toast:a}=pe(),r=He({mutationFn:async f=>{const m=es({...f,job_id:i}),{data:q,error:w}=await S.from("festival_artists").insert([m]).select().single();if(w)throw w;return q},onSuccess:()=>{o.invalidateQueries({queryKey:["festival-artists",i,d]}),a({title:"Success",description:"Artist created successfully"})},onError:f=>{a({title:"Error",description:"Could not create artist: "+f.message,variant:"destructive"})}}),_=He({mutationFn:async({id:f,...m})=>{const q=es(m),{data:w,error:N}=await S.from("festival_artists").update(q).eq("id",f).select().single();if(N)throw N;return w},onSuccess:()=>{o.invalidateQueries({queryKey:["festival-artists",i,d]}),a({title:"Success",description:"Artist updated successfully"})},onError:f=>{a({title:"Error",description:"Could not update artist: "+f.message,variant:"destructive"})}});return{createArtist:r.mutate,updateArtist:_.mutate,isCreating:r.isPending,isUpdating:_.isPending}},vn=({open:i,onOpenChange:d,artist:o,jobId:a,selectedDate:r,dayStartTime:_="07:00"})=>{const{createArtist:f,updateArtist:m,isCreating:q,isUpdating:w}=gn(a,r),N=async j=>{try{o?await m({id:o.id,...j}):await f(j),d(!1,!0)}catch{}},g=()=>{d(!1,!1)};return e.jsx(ue,{open:i,onOpenChange:g,children:e.jsxs(fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto w-[95vw] sm:w-full",children:[e.jsx(ye,{children:e.jsx(je,{children:o?"Editar Artista":"Agregar Artista"})}),e.jsx(_n,{artist:o,jobId:a,selectedDate:r,dayStartTime:_,onSubmit:N,isSubmitting:q||w})]})})},yn=({searchTerm:i,onSearchChange:d,stageFilter:o,onStageFilterChange:a,equipmentFilter:r,onEquipmentFilterChange:_,riderFilter:f="all",onRiderFilterChange:m,hideStageFilter:q=!1})=>{const w=q?"lg:grid-cols-3":"lg:grid-cols-4";return e.jsx("div",{className:"space-y-4 mb-4",children:e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 ${w} gap-4`,children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"search",className:"text-sm",children:"Buscar artista"}),e.jsx(Ee,{id:"search",placeholder:"Buscar por nombre...",value:i,onChange:N=>d(N.target.value),className:"h-10"})]}),!q&&e.jsxs("div",{children:[e.jsx(V,{htmlFor:"stage",className:"text-sm",children:"Filtrar por Stage"}),e.jsxs(Se,{value:o,onValueChange:a,children:[e.jsx(qe,{id:"stage",className:"h-10",children:e.jsx(ke,{placeholder:"Todos los Stages"})}),e.jsxs(Ae,{children:[e.jsx(ee,{value:"all",children:"Todos los Stages"}),e.jsx(ee,{value:"1",children:"Stage 1"}),e.jsx(ee,{value:"2",children:"Stage 2"}),e.jsx(ee,{value:"3",children:"Stage 3"})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"equipment",className:"text-sm",children:"Filtrar por equipo"}),e.jsxs(Se,{value:r,onValueChange:_,children:[e.jsx(qe,{id:"equipment",className:"h-10",children:e.jsx(ke,{placeholder:"Todo el equipo"})}),e.jsxs(Ae,{children:[e.jsx(ee,{value:"all",children:"Todo el equipo"}),e.jsx(ee,{value:"wireless",children:"Wireless"}),e.jsx(ee,{value:"iem",children:"IEM"}),e.jsx(ee,{value:"monitors",children:"Monitores"})]})]})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"rider",className:"text-sm",children:"Filtrar por estado del rider"}),e.jsxs(Se,{value:f,onValueChange:m,children:[e.jsx(qe,{id:"rider",className:"h-10",children:e.jsx(ke,{placeholder:"Todos los riders"})}),e.jsxs(Ae,{children:[e.jsx(ee,{value:"all",children:"Todos los riders"}),e.jsx(ee,{value:"complete",children:"Rider completo"}),e.jsx(ee,{value:"missing",children:"Rider faltante"})]})]})]})]})})},jn=({artists:i,jobTitle:d,selectedDate:o,stageFilter:a,jobId:r,stageNames:_,open:f,onOpenChange:m,jobDates:q,onDateChange:w,onStageChange:N,onPrint:g,isLoading:j})=>{const[h,x]=c.useState(!1),[n,t]=c.useState(!1),[p,v]=c.useState(void 0),[b,E]=c.useState(!1),$=f!==void 0?f:h,U=m||x;c.useEffect(()=>{(async()=>{if(r)try{const R=await cs(r);v(R)}catch{}})()},[r]);const T=async()=>{t(!0);try{const F=i.filter(l=>{var Q;return a==="all"||!a||((Q=l.stage)==null?void 0:Q.toString())===a}),R=ds(F);if(F.length===0){le.error("No se encontraron artistas para los criterios seleccionados");return}let G=null;const z={};if(r)try{const{data:l,error:D}=await S.from("festival_gear_setups").select("*").eq("job_id",r).single();if(!(D&&D.code!=="PGRST116")){if(G=l,l){const{data:Q,error:te}=await S.from("festival_stage_gear_setups").select("*").eq("gear_setup_id",l.id);te||Q==null||Q.forEach(P=>{z[P.stage_number]=P})}}}catch{}const ce=R.map(l=>{const D=z[l.stage]||null,Q={name:l.name,stage:l.stage,foh_console:l.foh_console,foh_console_provided_by:l.foh_console_provided_by||"festival",mon_console:l.mon_console,mon_console_provided_by:l.mon_console_provided_by||"festival",wireless_systems:l.wireless_systems||[],wireless_provided_by:l.wireless_provided_by||"festival",iem_systems:l.iem_systems||[],iem_provided_by:l.iem_provided_by||"festival",monitors_enabled:l.monitors_enabled,monitors_quantity:l.monitors_quantity,extras_sf:l.extras_sf,extras_df:l.extras_df,extras_djbooth:l.extras_djbooth,infra_cat6:l.infra_cat6||!1,infra_cat6_quantity:l.infra_cat6_quantity||0,infra_hma:l.infra_hma||!1,infra_hma_quantity:l.infra_hma_quantity||0,infra_coax:l.infra_coax||!1,infra_coax_quantity:l.infra_coax_quantity||0,infra_opticalcon_duo:l.infra_opticalcon_duo||!1,infra_opticalcon_duo_quantity:l.infra_opticalcon_duo_quantity||0,infra_analog:l.infra_analog||0,infrastructure_provided_by:l.infrastructure_provided_by||"festival",mic_kit:l.mic_kit||"band",wired_mics:l.wired_mics||[]},te=ms(Q,G,D);return{name:l.name,stage:l.stage,showTime:{start:l.show_start,end:l.show_end},soundcheck:l.soundcheck?{start:l.soundcheck_start||"",end:l.soundcheck_end||""}:void 0,technical:{fohTech:l.foh_tech||!1,monTech:l.mon_tech||!1,fohConsole:{model:l.foh_console,providedBy:l.foh_console_provided_by||"festival"},monConsole:{model:l.mon_console,providedBy:l.mon_console_provided_by||"festival"},wireless:{systems:l.wireless_systems||[],providedBy:l.wireless_provided_by||"festival"},iem:{systems:l.iem_systems||[],providedBy:l.iem_provided_by||"festival"},monitors:{enabled:l.monitors_enabled,quantity:l.monitors_quantity}},extras:{sideFill:l.extras_sf,drumFill:l.extras_df,djBooth:l.extras_djbooth},notes:l.notes,micKit:l.mic_kit||"band",wiredMics:l.wired_mics||[],infrastructure:{infra_cat6:l.infra_cat6,infra_cat6_quantity:l.infra_cat6_quantity,infra_hma:l.infra_hma,infra_hma_quantity:l.infra_hma_quantity,infra_coax:l.infra_coax,infra_coax_quantity:l.infra_coax_quantity,infra_opticalcon_duo:l.infra_opticalcon_duo,infra_opticalcon_duo_quantity:l.infra_opticalcon_duo_quantity,infra_analog:l.infra_analog,other_infrastructure:l.other_infrastructure,infrastructure_provided_by:l.infrastructure_provided_by},riderMissing:l.rider_missing||!1,gearMismatches:te.mismatches}}),y=await Os({jobTitle:d||"Cronograma del festival",date:o,stage:a!=="all"?a:void 0,stageNames:_,artists:ce,logoUrl:p,includeGearConflicts:b}),A=URL.createObjectURL(y),H=document.createElement("a");H.href=A;const re=a&&a!=="all"?(_==null?void 0:_[parseInt(a)])||`stage${a}`:"";H.download=`artist_schedule_${o}${re?`_${re.replace(/[^a-zA-Z0-9]/g,"_")}`:""}.pdf`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(A),le.success("PDF del cronograma de artistas generado exitosamente"),U(!1)}catch{le.error("Error al generar PDF")}finally{t(!1)}};return e.jsx(ue,{open:$,onOpenChange:U,children:e.jsxs(fe,{className:"sm:max-w-[425px] w-[95vw]",children:[e.jsxs(ye,{children:[e.jsx(je,{children:"Imprimir cronograma de artistas"}),e.jsx(vs,{children:"Generar un PDF del cronograma de artistas actual."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-center gap-2 sm:gap-4",children:[e.jsx(V,{htmlFor:"name",className:"sm:text-right",children:"Título del trabajo"}),e.jsx(Ee,{id:"name",value:d||"Cronograma del festival",className:"sm:col-span-3",disabled:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-center gap-2 sm:gap-4",children:[e.jsx(V,{htmlFor:"username",className:"sm:text-right",children:"Fecha"}),e.jsx(Ee,{id:"username",value:o,className:"sm:col-span-3",disabled:!0})]}),e.jsxs("div",{className:"flex items-start space-x-2 pt-2",children:[e.jsx(_e,{id:"gear-conflicts",checked:b,onCheckedChange:F=>{E(F===!0)},className:"mt-1"}),e.jsx(V,{htmlFor:"gear-conflicts",className:"text-sm font-medium leading-normal cursor-pointer",children:"Incluir resumen de conflictos de equipo"})]})]}),e.jsx(k,{onClick:T,disabled:n||j,className:"w-full",children:n||j?e.jsxs(e.Fragment,{children:["Generando ",e.jsx(he,{className:"ml-2 h-4 w-4 animate-spin"})]}):"Generar PDF"})]})})},wn=(i,d,o="07:00")=>{const a=rs(),{toast:r}=pe(),{data:_=[],isLoading:f,error:m,refetch:q}=Ce({queryKey:["festival-artists",i,d],queryFn:async()=>{if(!i||!d)return[];const{data:g,error:j}=await S.from("festival_artists").select("*").eq("job_id",i).eq("date",d).order("show_start",{ascending:!0});if(j)throw j;return(g==null?void 0:g.map(x=>{if(x.isaftermidnight!==void 0||!x.show_start)return x;const[n]=x.show_start.split(":").map(Number),[t]=o.split(":").map(Number),p=n<t;return{...x,isaftermidnight:p}}))||[]},enabled:!!i&&!!d,staleTime:1e3*60*2,refetchOnWindowFocus:!0}),w=He({mutationFn:async g=>{const{error:j}=await S.from("festival_artists").delete().eq("id",g);if(j)throw j},onSuccess:()=>{a.invalidateQueries({queryKey:["festival-artists",i,d]}),r({title:"Success",description:"Artist deleted successfully"})},onError:g=>{r({title:"Error",description:"Could not delete artist: "+g.message,variant:"destructive"})}}),N=()=>{a.invalidateQueries({queryKey:["festival-artists",i,d]})};return{artists:_,isLoading:f,error:m,refetch:q,deleteArtist:w.mutate,isDeletingArtist:w.isPending,invalidateArtists:N}},bn=({open:i,onOpenChange:d,currentJobId:o,targetDate:a,onArtistsCopied:r})=>{const[_,f]=c.useState([]),[m,q]=c.useState(""),[w,N]=c.useState([]),[g,j]=c.useState(""),[h,x]=c.useState([]),[n,t]=c.useState([]),[p,v]=c.useState(!1),[b,E]=c.useState(!1),[$,U]=c.useState({resetTimes:!0,resetStages:!1,copyNotes:!0,copyTechnicalSpecs:!0});c.useEffect(()=>{i&&T()},[i,o]),c.useEffect(()=>{m&&g&&R()},[m,g]);const T=async()=>{v(!0);try{const{data:y,error:A}=await S.from("jobs").select("id, title, start_time, end_time").eq("job_type","festival").neq("id",o).order("start_time",{ascending:!1});if(A)throw A;f(y||[])}catch{le.error("Error al cargar festivales")}finally{v(!1)}},F=async y=>{try{const{data:A,error:H}=await S.from("festival_artists").select("date").eq("job_id",y).not("date","is",null);if(H)throw H;const re=[...new Set((A==null?void 0:A.map(l=>l.date))||[])];N(re.sort())}catch{le.error("Error al cargar fechas disponibles")}},R=async()=>{v(!0);try{const{data:y,error:A}=await S.from("festival_artists").select("id, name, stage, date, show_start, show_end").eq("job_id",m).eq("date",g).order("show_start",{ascending:!0});if(A)throw A;x(y||[]),t((y==null?void 0:y.map(H=>H.id))||[])}catch{le.error("Error al cargar artistas")}finally{v(!1)}},G=y=>{q(y),j(""),x([]),t([]),F(y)},z=y=>{t(A=>A.includes(y)?A.filter(H=>H!==y):[...A,y])},ce=()=>{n.length===h.length?t([]):t(h.map(y=>y.id))},se=async()=>{if(n.length===0){le.error("Por favor selecciona al menos un artista para copiar");return}E(!0);try{const{data:y,error:A}=await S.from("festival_artists").select("*").in("id",n);if(A)throw A;const H=(y==null?void 0:y.map(l=>{const{id:D,created_at:Q,updated_at:te,...P}=l;return{...P,job_id:o,date:a,show_start:$.resetTimes?null:P.show_start,show_end:$.resetTimes?null:P.show_end,soundcheck_start:$.resetTimes?null:P.soundcheck_start,soundcheck_end:$.resetTimes?null:P.soundcheck_end,stage:$.resetStages?1:P.stage,notes:$.copyNotes?P.notes:null,foh_console:$.copyTechnicalSpecs?P.foh_console:null,mon_console:$.copyTechnicalSpecs?P.mon_console:null,wireless_systems:$.copyTechnicalSpecs?P.wireless_systems:[],iem_systems:$.copyTechnicalSpecs?P.iem_systems:[],wired_mics:$.copyTechnicalSpecs?P.wired_mics:[]}}))||[],{error:re}=await S.from("festival_artists").insert(H);if(re)throw re;le.success(`Se copiaron exitosamente ${n.length} artista${n.length>1?"s":""}`),r(),d(!1)}catch{le.error("Error al copiar artistas")}finally{E(!1)}};return e.jsx(ue,{open:i,onOpenChange:d,children:e.jsxs(fe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto w-[95vw] sm:w-full",children:[e.jsx(ye,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"Copiar artistas de otro festival"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Seleccionar festival de origen"}),e.jsxs(Se,{onValueChange:G,disabled:p,children:[e.jsx(qe,{className:"h-10",children:e.jsx(ke,{placeholder:"Elegir festival del que copiar..."})}),e.jsx(Ae,{children:_.map(y=>e.jsx(ee,{value:y.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-4 w-4"}),e.jsx("span",{children:y.title}),e.jsx(C,{variant:"outline",className:"text-xs",children:oe(new Date(y.start_time),"MMM yyyy")})]})},y.id))})]})]}),m&&w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Seleccionar fecha de origen"}),e.jsxs(Se,{onValueChange:j,children:[e.jsx(qe,{className:"h-10",children:e.jsx(ke,{placeholder:"Elegir fecha..."})}),e.jsx(Ae,{children:w.map(y=>e.jsx(ee,{value:y,children:oe(new Date(y),"EEEE, MMMM d, yyyy")},y))})]})]}),h.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{className:"text-base font-medium",children:"Opciones de copia"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(_e,{id:"resetTimes",checked:$.resetTimes,onCheckedChange:y=>U(A=>({...A,resetTimes:!!y})),className:"mt-1"}),e.jsx(V,{htmlFor:"resetTimes",className:"text-sm leading-normal cursor-pointer",children:"Restablecer horarios del show"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(_e,{id:"resetStages",checked:$.resetStages,onCheckedChange:y=>U(A=>({...A,resetStages:!!y})),className:"mt-1"}),e.jsx(V,{htmlFor:"resetStages",className:"text-sm leading-normal cursor-pointer",children:"Restablecer a Stage 1"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(_e,{id:"copyNotes",checked:$.copyNotes,onCheckedChange:y=>U(A=>({...A,copyNotes:!!y})),className:"mt-1"}),e.jsx(V,{htmlFor:"copyNotes",className:"text-sm leading-normal cursor-pointer",children:"Copiar notas"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(_e,{id:"copyTechnicalSpecs",checked:$.copyTechnicalSpecs,onCheckedChange:y=>U(A=>({...A,copyTechnicalSpecs:!!y})),className:"mt-1"}),e.jsx(V,{htmlFor:"copyTechnicalSpecs",className:"text-sm leading-normal cursor-pointer",children:"Copiar especificaciones técnicas"})]})]})]}),h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(V,{className:"text-base font-medium",children:["Seleccionar artistas (",n.length,"/",h.length,")"]}),e.jsx(k,{variant:"outline",size:"sm",onClick:ce,children:n.length===h.length?"Deseleccionar todo":"Seleccionar todo"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded-md p-2 space-y-2",children:h.map(y=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-muted rounded-md",children:[e.jsx(_e,{id:y.id,checked:n.includes(y.id),onCheckedChange:()=>z(y.id)}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:y.name}),e.jsxs(C,{variant:"secondary",children:["Stage ",y.stage]}),y.show_start&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Xs,{className:"h-3 w-3"}),y.show_start,y.show_end&&` - ${y.show_end}`]})]})})]},y.id))})]}),m&&w.length===0&&!p&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Xe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No se encontraron artistas en el festival seleccionado."})]})]}),e.jsxs(ys,{children:[e.jsx(k,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(k,{onClick:se,disabled:n.length===0||b,className:"min-w-24",children:b?"Copiando...":`Copiar ${n.length} artista${n.length!==1?"s":""}`})]})]})})},Oe=async(i,d)=>new Promise(o=>{const a=new Image;a.crossOrigin="anonymous";const r=setTimeout(()=>{o(null)},1e4);a.onload=()=>{clearTimeout(r),o(a)},a.onerror=_=>{clearTimeout(r),o(null)},a.src=i}),Nn=async i=>{const{jsPDF:d,autoTable:o}=await Ds(),a=new d("portrait"),r=a.internal.pageSize.width,_=a.internal.pageSize.height;a.setFillColor(125,1,1),a.rect(0,0,r,35,"F");let f=!1;if(i.logoUrl){const t=await Oe(i.logoUrl);if(t)try{const v=t.width/t.height,b=Math.min(20,t.height),E=b*v;a.addImage(t,"JPEG",10,7,E,b),f=!0}catch{}}if(!f){const t=await Oe("/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png");if(t)try{const v=t.width/t.height,b=Math.min(20,t.height),E=b*v;a.addImage(t,"PNG",10,7,E,b)}catch{}}a.setFontSize(18),a.setTextColor(255,255,255);const m=`${i.jobTitle} - Festival Schedule`;a.text(m,r/2,20,{align:"center"}),a.setFontSize(12),a.text("Complete Show Schedule",r/2,30,{align:"center"});const q=i.artists.filter(t=>t.show_start).sort((t,p)=>{const v=t.date.localeCompare(p.date);return v!==0?v:t.show_start.localeCompare(p.show_start)}),w=q.map(t=>{var E;const p=((E=i.stageNames)==null?void 0:E[t.stage])||`Stage ${t.stage}`,v=`${t.show_start} - ${t.show_end}`,b=t.soundcheck&&t.soundcheck_start&&t.soundcheck_end?`${t.soundcheck_start} - ${t.soundcheck_end}`:"-";return[oe(new Date(t.date),"dd/MM/yyyy"),oe(new Date(t.date),"EEEE"),t.name,p,v,b]});o(a,{head:[["FECHA","DÍA","ARTISTA","ESCENARIO","HORA DE SHOW","SOUNDCHECK"]],body:w,startY:45,theme:"grid",styles:{fontSize:9,cellPadding:2,valign:"middle",lineColor:[200,200,200],lineWidth:.1},headStyles:{fillColor:[125,1,1],textColor:[255,255,255],fontSize:10,fontStyle:"bold",cellPadding:3},columnStyles:{0:{cellWidth:20,halign:"center"},1:{cellWidth:22,halign:"center"},2:{cellWidth:60,halign:"left"},3:{cellWidth:25,halign:"center"},4:{cellWidth:30,halign:"center"},5:{cellWidth:25,halign:"center"}},alternateRowStyles:{fillColor:[248,249,250]},margin:{left:10,right:10}});const N=[...new Set(q.map(t=>t.date))],g=q.length,j=[...new Set(q.map(t=>t.stage))];let h=a.lastAutoTable.finalY+20;if(h>_-80&&(a.addPage(),h=20),a.setFontSize(14),a.setTextColor(125,1,1),a.text("Resumen del Festival",15,h),h+=15,a.setFontSize(11),a.setTextColor(0,0,0),a.text(`Total de fechas: ${N.length}`,15,h),h+=8,a.text(`Total de artistas: ${g}`,15,h),h+=8,a.text(`Escenarios utilizados: ${j.length} (${j.map(t=>{var p;return((p=i.stageNames)==null?void 0:p[t])||`Stage ${t}`}).join(", ")})`,15,h),h+=8,N.length>0){const t=oe(new Date(N[0]),"dd/MM/yyyy"),p=oe(new Date(N[N.length-1]),"dd/MM/yyyy");a.text(`Período: ${t} - ${p}`,15,h)}const x=await Oe("/sector pro logo.png");if(x)try{const v=30/(x.width/x.height);a.addImage(x,"PNG",r/2-30/2,_-v-10,30,v)}catch{}else{const t=await Oe("/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png");if(t)try{const b=30/(t.width/t.height);a.addImage(t,"PNG",r/2-30/2,_-b-10,30,b)}catch{}}a.setFontSize(8),a.setTextColor(100,100,100);const n=new Date().toLocaleDateString("es-ES");return a.text(`Generado: ${n}`,r-15,_-5,{align:"right"}),a.output("blob")},Vi=()=>{const{jobId:i}=js(),d=ws(),{toast:o}=pe(),[a,r]=c.useState(!1),[_,f]=c.useState(null),[m,q]=c.useState(""),[w,N]=c.useState([]),[g,j]=c.useState(""),[h,x]=c.useState(""),[n,t]=c.useState("all"),[p,v]=c.useState(""),[b,E]=c.useState("all"),[$,U]=c.useState(!1),[T,F]=c.useState(!1),[R,G]=c.useState(""),[z,ce]=c.useState(""),[se,y]=c.useState({}),[A,H]=c.useState("07:00"),[re,l]=c.useState(""),[D,Q]=c.useState(3),[te,P]=c.useState({}),[ne,we]=c.useState(!1),[xe,be]=c.useState(!1),{artists:Ne,isLoading:Le,deleteArtist:s,invalidateArtists:u}=wn(i,g,A),{data:L}=Ce({queryKey:["festival-settings",i],queryFn:async()=>{if(!i)return null;const{data:M,error:Y}=await S.from("festival_settings").select("*").eq("job_id",i).maybeSingle();if(Y)return null;if(M)return M;const{data:B,error:K}=await S.from("festival_settings").insert({job_id:i,day_start_time:"07:00"}).select().single();return K?null:B},enabled:!!i});c.useEffect(()=>{L!=null&&L.day_start_time&&H(L.day_start_time)},[L]);const{data:O,refetch:I}=Ce({queryKey:["job-date-types",i],queryFn:async()=>{if(!i)return{};const{data:M,error:Y}=await S.from("job_date_types").select("*").eq("job_id",i);if(Y)return{};const B={};return M.forEach(K=>{B[`${i}-${K.date}`]=K.type}),B},enabled:!!i});c.useEffect(()=>{O&&y(O)},[O]);const{data:ie}=Ce({queryKey:["festival-stages",i],queryFn:async()=>{if(!i)return{};const{data:M,error:Y}=await S.from("festival_stages").select("number, name").eq("job_id",i);if(Y)return{};const B={};return M==null||M.forEach(K=>{B[K.number]=K.name}),B},enabled:!!i});c.useEffect(()=>{ie&&P(ie)},[ie]),Ys({table:"festival_artists",filter:`job_id=eq.${i}`,queryKey:["festival-artists",i,g]}),c.useEffect(()=>{(async()=>{if(!i)return;const{data:Y,error:B}=await S.from("jobs").select("title, start_time, end_time").eq("id",i).single();if(!B){q(Y.title);const ae=new Date(Y.start_time),W=new Date(Y.end_time);if(Ge(ae)&&Ge(W)){const Me=cn({start:ae,end:W});N(Me);const _s=oe(Me[0],"yyyy-MM-dd");j(_s)}}const{data:K,error:J}=await S.from("festival_gear_setups").select("max_stages").eq("job_id",i).order("created_at",{ascending:!1}).limit(1);J||K&&K.length>0&&Q(K[0].max_stages||3)})()},[i]);const{data:de}=Ce({queryKey:["festival-logo",i],queryFn:async()=>{if(!i)return null;const{data:M,error:Y}=await S.from("festival_logos").select("file_path").eq("job_id",i).maybeSingle();if(M!=null&&M.file_path){const{data:J}=S.storage.from("festival-logos").getPublicUrl(M.file_path);if(J!=null&&J.publicUrl)try{if((await fetch(J.publicUrl,{method:"HEAD"})).ok)return J.publicUrl}catch{}}const{data:B,error:K}=await S.from("jobs").select("tour_id").eq("id",i).maybeSingle();if(K)return null;if(B!=null&&B.tour_id){const{data:J,error:ae}=await S.from("tour_logos").select("file_path").eq("tour_id",B.tour_id).maybeSingle();if(ae)return null;if(J!=null&&J.file_path){const{data:W}=S.storage.from("tour-logos").getPublicUrl(J.file_path);if(W!=null&&W.publicUrl)try{if((await fetch(W.publicUrl,{method:"HEAD"})).ok)return W.publicUrl}catch{}}}return null},enabled:!!i});c.useEffect(()=>{de&&l(de)},[de]);const Ue=()=>{f(null),r(!0)},hs=M=>{f(M),r(!0)},us=async M=>{s(M.id)},fs=(M=!1)=>{r(!1),f(null),M&&u()},xs=M=>{const Y=oe(M,"yyyy-MM-dd"),B=`${i}-${Y}`;return se[B]==="show"},ps=()=>{if(!g||!i)return null;const M=`${i}-${g}`;return se[M]},Be=async()=>{if(i){be(!0);try{const{data:M,error:Y}=await S.from("festival_artists").select("*").eq("job_id",i).not("show_start","is",null).order("date",{ascending:!0}).order("show_start",{ascending:!0});if(Y){o({title:"Error",description:"No se pudieron obtener los artistas del festival",variant:"destructive"});return}if(!M||M.length===0){o({title:"Sin Datos",description:"No se encontraron artistas para este festival",variant:"destructive"});return}const B={jobTitle:m,artists:M.map(W=>({name:W.name,date:W.date,stage:W.stage,show_start:W.show_start,show_end:W.show_end,soundcheck_start:W.soundcheck_start,soundcheck_end:W.soundcheck_end,soundcheck:W.soundcheck})),stageNames:te,logoUrl:re||void 0},K=await Nn(B),J=URL.createObjectURL(K),ae=document.createElement("a");ae.href=J,ae.download=`${m.replace(/[^a-zA-Z0-9]/g,"_")}_full_schedule.pdf`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(J),o({title:"Éxito",description:"PDF del horario completo del festival generado exitosamente"})}catch{o({title:"Error",description:"No se pudo generar el PDF del horario completo",variant:"destructive"})}finally{be(!1)}}},me=ps()==="show";return e.jsxs("div",{className:"w-full py-6",children:[e.jsxs("div",{className:"mb-6 px-4 md:px-6",children:[e.jsxs(k,{variant:"ghost",onClick:()=>d(`/festival-management/${i}`),className:"mb-4",children:[e.jsx(rn,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Volver a Gestión de Festival"}),e.jsx("span",{className:"sm:hidden",children:"Volver"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold truncate",children:m}),e.jsx(Gs,{})]})]}),e.jsxs(ns,{className:"mx-4 md:mx-6",children:[e.jsxs(is,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs(as,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg md:text-xl",children:"Gestión de Artistas"}),e.jsx(ss,{children:e.jsxs($e,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("div",{className:"cursor-help",children:e.jsx(tn,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsxs(Te,{className:"max-w-sm",children:[e.jsxs("p",{children:["Los días del festival van desde las ",A," hasta las ",A," del día siguiente."]}),e.jsx("p",{children:"Los shows después de medianoche se incluyen en el horario del día anterior."})]})]})})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[me&&e.jsxs(k,{variant:"outline",onClick:()=>we(!0),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Copiar Artistas"]}),e.jsxs(k,{variant:"outline",onClick:Be,disabled:xe,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),xe?"Generando...":"Imprimir Horario Completo"]}),e.jsxs(k,{onClick:()=>{G(g),U(!0)},children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Imprimir Horario del Día"]}),me?e.jsxs(k,{onClick:Ue,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Añadir Artista"]}):e.jsxs(k,{disabled:!0,title:"Los artistas solo se pueden añadir en fechas de show",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Añadir Artista"]})]}),e.jsxs("div",{className:"flex lg:hidden items-center gap-2 w-full sm:w-auto",children:[me?e.jsxs(k,{onClick:Ue,className:"flex-1 sm:flex-initial",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Añadir Artista"]}):e.jsxs(k,{disabled:!0,title:"Los artistas solo se pueden añadir en fechas de show",className:"flex-1 sm:flex-initial",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Añadir Artista"]}),e.jsxs(en,{children:[e.jsx(sn,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"icon",children:e.jsx(ln,{className:"h-4 w-4"})})}),e.jsxs(nn,{side:"right",className:"w-[300px] sm:w-[400px]",children:[e.jsx(an,{children:e.jsx(on,{children:"Acciones"})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-6",children:[me&&e.jsxs(k,{variant:"outline",onClick:()=>we(!0),className:"justify-start w-full",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Copiar Artistas"]}),e.jsxs(k,{variant:"outline",onClick:Be,disabled:xe,className:"justify-start w-full",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),xe?"Generando...":"Imprimir Horario Completo"]}),e.jsxs(k,{variant:"outline",onClick:()=>{G(g),U(!0)},className:"justify-start w-full",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Imprimir Horario del Día"]})]})]})]})]})]}),e.jsx(os,{className:"p-0",children:e.jsxs("div",{className:"space-y-4 p-6",children:[me&&e.jsx(yn,{searchTerm:h,onSearchChange:x,stageFilter:"all",onStageFilterChange:()=>{},equipmentFilter:p,onEquipmentFilterChange:v,riderFilter:b,onRiderFilterChange:E}),w.length>0?e.jsx(Qs,{jobDates:w,selectedDate:g,onDateChange:j,dateTypes:se,jobId:i||"",onTypeChange:()=>I(),dayStartTime:A,showStageFilter:me,selectedStage:n,onStageChange:t,maxStages:D}):null,g&&(xs(new Date(g))?e.jsx("div",{className:"w-full",children:e.jsx(fn,{artists:Ne,isLoading:Le,onEditArtist:hs,onDeleteArtist:us,searchTerm:h,stageFilter:n,equipmentFilter:p,riderFilter:b,dayStartTime:A,jobId:i,selectedDate:g})}):e.jsxs("div",{className:"p-8 text-center text-muted-foreground border rounded-md",children:[e.jsx("p",{children:"Esta fecha no está configurada como fecha de show."}),e.jsx("p",{children:"La gestión de artistas solo está disponible en fechas de show."}),e.jsx("p",{className:"mt-2 text-sm",children:"Haz clic derecho en la pestaña de fecha para cambiar su tipo."})]}))]})})]}),me&&e.jsx(vn,{open:a,onOpenChange:fs,artist:_,jobId:i,selectedDate:g,dayStartTime:A}),e.jsx(jn,{artists:Ne,jobTitle:m,selectedDate:R,stageFilter:z,jobId:i,stageNames:te,open:$,onOpenChange:U,jobDates:w,onDateChange:G,onStageChange:ce,onPrint:void 0,isLoading:T}),me&&i&&e.jsx(bn,{open:ne,onOpenChange:we,currentJobId:i,targetDate:g,onArtistsCopied:u})]})};export{Vi as default};
