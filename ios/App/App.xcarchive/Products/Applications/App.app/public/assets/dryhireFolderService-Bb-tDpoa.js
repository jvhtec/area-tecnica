import{m as d}from"./index-NZ6jJLfQ.js";import{c as p}from"./api-C9EDenHJ.js";import{R as h,a as u,F as i}from"./constants-DoXhG9KB.js";const D=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];async function R(){const{data:e,error:s}=await d.from("dryhire_parent_folders").select("year, department").order("year",{ascending:!0});if(s)throw new Error("Failed to fetch dryhire folder statuses");const o=new Map;for(const t of e||[]){o.has(t.year)||o.set(t.year,{sound:0,lights:0});const n=o.get(t.year);t.department==="sound"&&n.sound++,t.department==="lights"&&n.lights++}return Array.from(o.entries()).map(([t,n])=>({year:t,...n}))}async function M(e,s,o){const{data:t,error:n}=await d.from("dryhire_parent_folders").select("element_id").eq("year",e).eq("department",s).eq("month",o).single();return n?null:(t==null?void 0:t.element_id)||null}async function N(e){const s=["sound","lights"],o={sound:"Sonido",lights:"Luces"},{data:t}=await d.from("dryhire_parent_folders").select("id").eq("year",e).limit(1);if(t&&t.length>0)throw new Error(`Dryhire folders for ${e} already exist`);const n=`${e}-01-01T00:00:00.000Z`,w=`${e}-12-31T23:59:59.000Z`;for(const r of s){const I={definitionId:i.mainFolder,open:!0,locked:!1,name:`Dry Hire ${e} - ${o[r]}`,plannedStartDate:n,plannedEndDate:w,locationId:i.location,departmentId:u[r],personResponsibleId:h[r]},l=await p(I);if(!l.elementId)throw new Error(`Failed to create main folder for ${e} ${r}`);const c=[];for(let a=0;a<12;a++){const E=String(a+1).padStart(2,"0"),m=D[a],S=new Date(e,a,1),F=new Date(e,a+1,0,23,59,59),g={definitionId:i.subFolder,parentElementId:l.elementId,open:!0,locked:!1,name:m,plannedStartDate:S.toISOString().split(".")[0]+".000Z",plannedEndDate:F.toISOString().split(".")[0]+".000Z",locationId:i.location,departmentId:u[r],personResponsibleId:h[r]},f=await p(g);if(!f.elementId)throw new Error(`Failed to create ${m} folder for ${e} ${r}`);c.push({year:e,department:r,month:E,element_id:f.elementId})}const{error:y}=await d.from("dryhire_parent_folders").insert(c);if(y)throw new Error(`Failed to save dryhire folders for ${e} ${r}`)}}export{M as a,N as c,R as g};
