import{af as y,r as m,i as a,j as e,B as u,L as v,S as Y,t as Z,v as I,w as ee,x as C,T as se,J as te,K as ae,O as re}from"./index-NZ6jJLfQ.js";import{T as ne,a as le,b as oe,c as ie}from"./tabs-BdaywI_b.js";import{D as ce}from"./DateTypeContextMenu-D-zx4rHd.js";import{P as T,a as W,b as O}from"./popover-Dl-b1R8L.js";import{C as F}from"./calendar--BDVgnXu.js";import{S as $}from"./switch-DUBpZhIC.js";import{s as D}from"./subWeeks-DXhfE23M.js";import{F as de}from"./filter-D0HnK7Nz.js";import{C as me}from"./chevron-left-rq2ui83a.js";import{C as he}from"./chevron-right-Bn7Eu0F7.js";import{C as E}from"./calendar-_Cj_Sgy-.js";import{e as V,a as P}from"./endOfWeek-BYLwoWuZ.js";function z(r,h,f){const c=y(r,f),o=y(h,f);return+c==+o}const Se=({jobDates:r,selectedDate:h,onDateChange:f,dateTypes:c,jobId:o,onTypeChange:L,dayStartTime:M,showStageFilter:R=!1,selectedStage:B="all",onStageChange:k,maxStages:G=3})=>{const[n,w]=m.useState(()=>{const s=new Date(h);return y(s,{weekStartsOn:1})}),[p,N]=m.useState(!0),[x,b]=m.useState("week"),d=m.useMemo(()=>p?r.filter(s=>{const t=a(s,"yyyy-MM-dd"),i=`${o}-${t}`,l=c[i];return l==="show"||l==="setup"||l==="rehearsal"}):r,[r,p,c,o]),g=m.useMemo(()=>{if(x==="all")return d;const s=V(n,{weekStartsOn:1});return d.filter(t=>t>=n&&t<=s)},[n,d,x]),J=m.useMemo(()=>{const s=D(n);return d.some(t=>z(t,s,{weekStartsOn:1}))},[n,d]),A=m.useMemo(()=>{const s=P(n,1);return d.some(t=>z(t,s,{weekStartsOn:1}))},[n,d]),K=()=>{w(s=>D(s))},_=()=>{w(s=>P(s,1))},q=s=>{const t=a(s,"yyyy-MM-dd"),i=`${o}-${t}`;switch(c[i]){case"travel":return"border-blue-500 bg-blue-50";case"setup":return"border-amber-500 bg-amber-50";case"show":return"border-green-500 bg-green-50";case"off":return"border-gray-500 bg-gray-50";case"rehearsal":return"border-purple-500 bg-purple-50";default:return"border-gray-300"}},H=s=>{const t=a(s,"yyyy-MM-dd"),i=`${o}-${t}`,l=c[i];if(!l)return null;const j={travel:{text:"T",color:"bg-blue-500"},setup:{text:"S",color:"bg-amber-500"},show:{text:"●",color:"bg-green-500"},off:{text:"O",color:"bg-gray-500"},rehearsal:{text:"R",color:"bg-purple-500"}}[l];return j?e.jsx("span",{className:`absolute -top-1 -right-1 w-4 h-4 ${j.color} text-white text-xs rounded-full flex items-center justify-center font-bold`,children:j.text}):null},S=s=>{if(!s)return;const t=a(s,"yyyy-MM-dd");r.some(l=>a(l,"yyyy-MM-dd")===t)&&(f(t),w(y(s,{weekStartsOn:1})))},Q=s=>a(s,"EEE, MMM d"),U=()=>{const s=V(n,{weekStartsOn:1});return`${a(n,"MMM d")} - ${a(s,"MMM d")}`},X=r.length>=7;return g.length===0?e.jsx("div",{className:"flex items-center justify-center p-8 text-center text-muted-foreground border rounded-md",children:e.jsxs("div",{children:[e.jsxs("p",{children:["No se encontraron fechas ",p?"de show/clave":""," para esta semana."]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>N(!1),disabled:!p,children:"Mostrar todas las fechas"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>b("all"),disabled:x==="all",children:"Mostrar todas las semanas"})]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[X&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:"view-mode",className:"text-sm whitespace-nowrap",children:"Vista:"}),e.jsx($,{id:"view-mode",checked:x==="week",onCheckedChange:s=>b(s?"week":"all")}),e.jsx("span",{className:"text-sm",children:x==="week"?"Semana":"Todo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx($,{id:"show-filter",checked:p,onCheckedChange:N}),e.jsx(v,{htmlFor:"show-filter",className:"text-sm whitespace-nowrap",children:"Solo fechas clave"})]})]}),R&&k&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:"stage-filter",className:"text-sm whitespace-nowrap",children:"Stage:"}),e.jsxs(Y,{value:B,onValueChange:k,children:[e.jsx(Z,{id:"stage-filter",className:"w-[120px] h-10",children:e.jsx(I,{})}),e.jsxs(ee,{children:[e.jsx(C,{value:"all",children:"Todos los Stages"}),Array.from({length:G},(s,t)=>t+1).map(s=>e.jsxs(C,{value:s.toString(),children:["Stage ",s]},s))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-between sm:justify-end",children:[x==="week"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"outline",size:"sm",onClick:K,disabled:!J,className:"h-10 min-w-[40px]",children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium min-w-[100px] sm:min-w-[120px] text-center",children:U()}),e.jsx(u,{variant:"outline",size:"sm",onClick:_,disabled:!A,className:"h-10 min-w-[40px]",children:e.jsx(he,{className:"h-4 w-4"})})]}),e.jsxs(T,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",className:"h-10 hidden sm:flex",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Ir a fecha"]})}),e.jsx(O,{className:"w-auto p-0",align:"end",children:e.jsx(F,{mode:"single",selected:new Date(h),onSelect:S,disabled:s=>!r.some(t=>a(t,"yyyy-MM-dd")===a(s,"yyyy-MM-dd")),initialFocus:!0})})]}),e.jsxs(T,{children:[e.jsx(W,{asChild:!0,children:e.jsx(u,{variant:"outline",size:"icon",className:"h-10 w-10 sm:hidden",children:e.jsx(E,{className:"h-4 w-4"})})}),e.jsx(O,{className:"w-auto p-0",align:"end",children:e.jsx(F,{mode:"single",selected:new Date(h),onSelect:S,disabled:s=>!r.some(t=>a(t,"yyyy-MM-dd")===a(s,"yyyy-MM-dd")),initialFocus:!0})})]})]})]}),e.jsxs(ne,{value:h,onValueChange:f,className:"w-full",children:[e.jsx("div",{className:"overflow-x-auto -mx-2 px-2 touch-pan-x",children:e.jsx(le,{className:"mb-4 inline-flex h-auto p-1 w-auto min-w-full",children:g.map(s=>{const t=a(s,"yyyy-MM-dd"),i=q(s);return e.jsx(ce,{jobId:o,date:s,onTypeChange:L,children:e.jsx(se,{children:e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(oe,{value:t,className:`relative border-b-2 ${i} min-w-[100px] h-12 touch-manipulation`,children:[Q(s),H(s)]})}),e.jsx(re,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{children:["El día del festival es de ",M," a ",M," del día siguiente"]}),e.jsxs("p",{children:["Fecha: ",t]}),e.jsxs("p",{children:["Tipo: ",c[`${o}-${t}`]||"No configurado"]})]})})]})})},t)})})}),g.map(s=>e.jsx(ie,{value:a(s,"yyyy-MM-dd"),className:"mt-0"},a(s,"yyyy-MM-dd")))]})]})};export{Se as F};
