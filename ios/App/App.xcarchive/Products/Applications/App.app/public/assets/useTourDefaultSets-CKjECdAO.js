import{u as m}from"./useQuery-kdg2pmgf.js";import{e as S,f as q,s as i}from"./index-NZ6jJLfQ.js";import{u}from"./useMutation-DluhVBs1.js";const E=(s,l)=>{const{toast:r}=S(),n=q(),{data:o=[],isLoading:p}=m({queryKey:["tour-default-sets",s,l],queryFn:async()=>{let e=i.from("tour_default_sets").select("*").eq("tour_id",s).order("created_at",{ascending:!0});l&&(e=e.eq("department",l));const{data:t,error:a}=await e;if(a)throw a;return t},enabled:!!s}),{data:_=[],isLoading:v}=m({queryKey:["tour-default-tables",s,l],queryFn:async()=>{if(o.length===0)return[];const e=o.map(d=>d.id),{data:t,error:a}=await i.from("tour_default_tables").select("*").in("set_id",e).order("metadata->order_index",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!0});if(a)throw a;return t},enabled:o.length>0}),c=u({mutationFn:async e=>{const{data:t,error:a}=await i.from("tour_default_sets").insert(e).select().single();if(a)throw a;return t},onSuccess:()=>{n.invalidateQueries({queryKey:["tour-default-sets",s]}),r({title:"Success",description:"Default set created successfully"})},onError:e=>{r({title:"Error",description:e.message||"Failed to create default set",variant:"destructive"})}}),f=u({mutationFn:async e=>{const{data:t,error:a}=await i.from("tour_default_tables").insert(e).select().single();if(a)throw a;return t},onSuccess:()=>{n.invalidateQueries({queryKey:["tour-default-tables",s]}),r({title:"Success",description:"Default table saved successfully"})},onError:e=>{r({title:"Error",description:e.message||"Failed to save default table",variant:"destructive"})}}),y=u({mutationFn:async({tableId:e,updates:t})=>{const{data:a,error:d}=await i.from("tour_default_tables").update(t).eq("id",e).select().single();if(d)throw d;return a},onSuccess:()=>{n.invalidateQueries({queryKey:["tour-default-tables",s]}),r({title:"Success",description:"Default table updated successfully"})},onError:e=>{r({title:"Error",description:e.message||"Failed to update default table",variant:"destructive"})}}),b=u({mutationFn:async e=>{const{error:t}=await i.from("tour_default_sets").delete().eq("id",e);if(t)throw t;return e},onSuccess:()=>{n.invalidateQueries({queryKey:["tour-default-sets",s]}),n.invalidateQueries({queryKey:["tour-default-tables",s]}),r({title:"Success",description:"Default set deleted successfully"})},onError:e=>{r({title:"Error",description:e.message||"Failed to delete default set",variant:"destructive"})}}),g=u({mutationFn:async e=>{const{error:t}=await i.from("tour_default_tables").delete().eq("id",e);if(t)throw t;return e},onSuccess:()=>{n.invalidateQueries({queryKey:["tour-default-tables",s]}),r({title:"Success",description:"Default table deleted successfully"})},onError:e=>{r({title:"Error",description:e.message||"Failed to delete default table",variant:"destructive"})}});return{defaultSets:o,defaultTables:_,isLoading:p||v,createSet:c.mutateAsync,createTable:f.mutateAsync,updateTable:y.mutateAsync,deleteSet:b.mutateAsync,deleteTable:g.mutateAsync,isCreatingSet:c.isPending,isCreatingTable:f.isPending,isUpdatingTable:y.isPending,isDeletingSet:b.isPending,isDeletingTable:g.isPending}};export{E as u};
