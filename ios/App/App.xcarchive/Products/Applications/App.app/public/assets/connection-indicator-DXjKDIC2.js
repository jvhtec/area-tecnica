import{j as e,L as g,r as d,I as U,B as p,V as $,D as q,q as R,F as P,G as F,aK as L,ac as X,aL as D,s as A,ca as W,c7 as E,T as Y,J as Z,K as ee,a as b,O as se,R as H,n as O}from"./index-NZ6jJLfQ.js";import{W as B}from"./NotesSection-Cu_RhFOj.js";import{R as te,a as k}from"./radio-group-DzKNHD24.js";import{C as ae}from"./checkbox-BsRNEGV1.js";import{S as re}from"./search-D-OiWg8h.js";import{M as ie}from"./minus-InO4I9Ks.js";import{P as ne}from"./plus-C3JQqq7t.js";import{T as le}from"./triangle-alert-D6qN0F8g.js";import{B as oe}from"./badge-vNTKF5RD.js";import{W as T,a as I}from"./wifi-C3_7SFyW.js";const G=({value:a,onChange:o,label:i,id:n,showMixed:m=!1})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:i}),e.jsxs(te,{value:a,onValueChange:o,className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"festival",id:`${n}-festival`}),e.jsx(g,{htmlFor:`${n}-festival`,children:"Festival"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"band",id:`${n}-band`}),e.jsx(g,{htmlFor:`${n}-band`,children:"Banda"})]}),m&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"mixed",id:`${n}-mixed`}),e.jsx(g,{htmlFor:`${n}-mixed`,children:"Mixto"})]})]})]}),je=({formData:a,onChange:o})=>{const i=l=>{if(!l||l.length===0)return"festival";const f=l.map(j=>j.provided_by||"festival"),u=[...new Set(f)];return u.length>1?"mixed":u[0]||"festival"},n=l=>{if(!l||l.length===0)return"festival";const f=l.map(j=>j.provided_by||"festival"),u=[...new Set(f)];return u.length>1?"mixed":u[0]||"festival"};d.useEffect(()=>{const l=i(a.wireless_systems||[]),f=n(a.iem_systems||[]);l!==a.wireless_provided_by&&o({wireless_provided_by:l}),f!==a.iem_provided_by&&o({iem_provided_by:f})},[a.wireless_systems,a.iem_systems]);const m=l=>{o({wireless_systems:l})},h=l=>{o({iem_systems:l})},x=l=>{o({wireless_provided_by:l})},c=l=>{o({iem_provided_by:l})};return e.jsxs("div",{className:"space-y-4 border rounded-lg p-3 md:p-4",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold",children:"Configuración RF & Wireless"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{systems:a.wireless_systems||[],onChange:m,label:"Sistemas Wireless",includeQuantityTypes:!0}),e.jsx(G,{value:a.wireless_provided_by||"festival",onChange:x,label:"Sistemas Wireless Proporcionados Por",id:"wireless-provider",showMixed:!0})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{systems:a.iem_systems||[],onChange:h,label:"Sistemas IEM",includeQuantityTypes:!0,isIEM:!0}),e.jsx(G,{value:a.iem_provided_by||"festival",onChange:c,label:"Sistemas IEM Proporcionados Por",id:"iem-provider",showMixed:!0})]})]})]})},be=({value:a=[],onChange:o,availableMics:i=[],readOnly:n=!1,className:m="",showExclusiveUse:h=!0,showNotes:x=!0})=>{const[c,l]=d.useState(""),[f,u]=d.useState(!1),[j,C]=d.useState(null),M=d.useMemo(()=>{if(!c.trim())return i;const s=c.toLowerCase();return i.filter(t=>t.toLowerCase().includes(s))},[i,c]),z=d.useMemo(()=>{const s={};return a.forEach(t=>{s[t.model]=(s[t.model]||0)+t.quantity}),s},[a]),v=d.useMemo(()=>a.reduce((s,t)=>s+t.quantity,0),[a]),S=d.useMemo(()=>{const s={};return a.forEach(t=>{s[t.model]?(s[t.model].quantity+=t.quantity,s[t.model].exclusive=s[t.model].exclusive||!!t.exclusive_use):s[t.model]={quantity:t.quantity,exclusive:!!t.exclusive_use}}),Object.entries(s).map(([t,r])=>({model:t,...r})).sort((t,r)=>t.model.localeCompare(r.model))},[a]),V=s=>{if(n)return;const t=a.findIndex(r=>r.model===s);if(t>=0){const r=[...a];r[t]={...r[t],quantity:r[t].quantity+1},o(r)}else o([...a,{model:s,quantity:1}])},Q=s=>{if(n)return;const t=a.findIndex(r=>r.model===s);if(t>=0){const r=[...a];r[t].quantity>1?r[t]={...r[t],quantity:r[t].quantity-1}:r.splice(t,1),o(r)}},K=s=>{n||o(a.filter(t=>t.model!==s))},_=(s,t)=>{if(n)return;const r=a.map(w=>w.model===s?{...w,...t}:w);o(r)},J=()=>{n||(o([]),u(!1))},y=d.useMemo(()=>{const s=[];return a.forEach(t=>{for(let r=0;r<t.quantity;r++)s.push({model:t.model,index:r,total:t.quantity})}),s},[a]);return e.jsxs("div",{className:`space-y-6 ${m}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(g,{htmlFor:"mic-search",className:"sr-only",children:"Buscar micrófonos"}),e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 dark:text-gray-500","aria-hidden":"true"}),e.jsx(U,{id:"mic-search",type:"text",placeholder:"Buscar micrófonos...",value:c,onChange:s=>l(s.target.value),className:"pl-10",disabled:n,"aria-label":"Buscar micrófonos disponibles","aria-describedby":"mic-search-description"}),e.jsxs("span",{id:"mic-search-description",className:"sr-only",children:["Escriba para filtrar la lista de micrófonos disponibles. Total actual: ",v," micrófonos."]})]}),e.jsxs("div",{role:"region","aria-label":"Micrófonos disponibles",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx(g,{className:"text-sm font-semibold",id:"tally-grid-label",children:"Micrófonos Disponibles"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400","aria-live":"polite","aria-atomic":"true",children:["Clic para añadir • Total: ",v]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",role:"group","aria-labelledby":"tally-grid-label",children:M.map(s=>{const t=z[s]||0;return e.jsxs(p,{type:"button",variant:t>0?"default":"outline",className:"relative h-auto py-3 px-4 text-left justify-start",onClick:()=>V(s),disabled:n,"aria-label":`Añadir ${s}${t>0?`, actualmente ${t} en la lista`:""}`,"aria-pressed":t>0,children:[e.jsx("span",{className:"text-sm truncate flex-1",children:s}),t>0&&e.jsx("span",{className:"ml-2 bg-white dark:bg-gray-800 text-primary dark:text-primary-foreground font-bold px-2 py-0.5 rounded-full text-xs","aria-label":`${t} unidades`,children:t})]},s)})}),M.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",role:"status",children:['No se encontraron micrófonos que coincidan con "',c,'"']})]}),y.length>0&&e.jsxs("div",{role:"region","aria-label":"Entradas de micrófonos",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs(g,{className:"text-sm font-semibold",id:"entries-label",children:["Entradas (",y.length,")"]}),!n&&e.jsxs(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(!0),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-950","aria-label":`Limpiar todas las ${y.length} entradas de micrófonos`,children:[e.jsx($,{className:"h-4 w-4 mr-1","aria-hidden":"true"}),"Limpiar Todo"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto border rounded-lg p-3 bg-gray-50 dark:bg-gray-900",role:"list","aria-labelledby":"entries-label",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 p-3 rounded border",role:"listitem",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:s.model}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400","aria-label":`Entrada ${s.index+1} de ${s.total}`,children:["(",s.index+1," de ",s.total,")"]})]}),!n&&e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>Q(s.model),className:"h-8 w-8 p-0","aria-label":`Eliminar un micrófono ${s.model}`,children:e.jsx(ie,{className:"h-4 w-4","aria-hidden":"true"})})]},`${s.model}-${t}`))})]}),S.length>0&&e.jsxs("div",{role:"region","aria-label":"Resumen de micrófonos",children:[e.jsx(g,{className:"text-sm font-semibold mb-3 block",id:"summary-label",children:"Resumen"}),e.jsxs("div",{className:"space-y-2 border rounded-lg p-4 bg-blue-50 dark:bg-blue-950",role:"list","aria-labelledby":"summary-label",children:[S.map(s=>{const t=a.find(r=>r.model===s.model);return e.jsxs("div",{className:"space-y-3",role:"listitem",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.model}),s.exclusive&&e.jsx("span",{className:"text-xs bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-0.5 rounded",role:"status","aria-label":"Se requiere uso exclusivo",children:"Exclusivo"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400","aria-label":`${s.quantity} unidades de ${s.model}`,children:["×",s.quantity]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(s.model),className:"h-8 px-2","aria-label":`Editar notas para ${s.model}`,children:"Notas"}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>K(s.model),className:"h-8 w-8 p-0 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-950","aria-label":`Eliminar todos los ${s.quantity} micrófonos ${s.model}`,children:e.jsx($,{className:"h-4 w-4","aria-hidden":"true"})})]})]})]}),!n&&h&&e.jsxs("div",{className:"flex items-center space-x-2 pl-1",children:[e.jsx(ae,{id:`exclusive-inline-${s.model}`,checked:(t==null?void 0:t.exclusive_use)||!1,onCheckedChange:r=>_(s.model,{exclusive_use:!!r})}),e.jsx(g,{htmlFor:`exclusive-inline-${s.model}`,className:"text-sm font-normal cursor-pointer",children:"Uso exclusivo (no se puede compartir con otros artistas)"})]}),(t==null?void 0:t.notes)&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 pl-4 border-l-2 border-gray-300 dark:border-gray-600",children:t.notes}),j===s.model&&x&&e.jsx(q,{open:!0,onOpenChange:()=>C(null),children:e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsxs(F,{children:["Notas para ",s.model]}),e.jsx(L,{children:"Agregue notas adicionales o requisitos especiales para este micrófono"})]}),e.jsx("div",{className:"py-4",children:e.jsx(X,{id:`notes-${s.model}`,placeholder:"Agregar notas sobre este micrófono...",value:(t==null?void 0:t.notes)||"",onChange:r=>_(s.model,{notes:r.target.value}),rows:5,autoFocus:!0})}),e.jsx(D,{children:e.jsx(p,{onClick:()=>C(null),children:"Listo"})})]})})]},s.model)}),e.jsx("div",{className:"pt-2 border-t mt-3",children:e.jsxs("div",{className:"flex justify-between items-center font-bold",children:[e.jsx("span",{children:"Total de Micrófonos"}),e.jsx("span",{className:"text-xl text-blue-600 dark:text-blue-400","aria-label":`Total: ${v} micrófonos`,children:v})]})})]})]}),a.length===0&&e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",role:"status",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto text-gray-400 dark:text-gray-600 mb-3","aria-hidden":"true"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mb-1",children:"Aún no se han añadido micrófonos"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Haga clic en un botón de micrófono arriba para agregarlo a su lista"})]}),e.jsx(q,{open:f,onOpenChange:u,children:e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-500"}),"¿Limpiar Todos los Micrófonos?"]}),e.jsxs(L,{children:["Esto eliminará ",v===1?"el micrófono":`los ${v} micrófonos`," de su lista. Esta acción no se puede deshacer."]})]}),e.jsxs(D,{children:[e.jsx(p,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(p,{variant:"destructive",onClick:J,children:"Limpiar Todo"})]})]})})]})},N={isActive:!1,recoveryInterval:null,lastRecoveryAttempt:0,recoveryInProgress:!1,consecutiveFailures:0,maxRetryDelay:3e4,pauseHealthCheck(){this.recoveryInterval&&(clearInterval(this.recoveryInterval),this.recoveryInterval=null)},resumeHealthCheck(){this.recoveryInterval||(this.recoveryInterval=setInterval(()=>this.performHealthCheck(),6e4))},startRecovery(){this.isActive||(this.isActive=!0,window.addEventListener("online",this.handleNetworkStatusChange),window.addEventListener("offline",this.handleNetworkStatusChange),document.addEventListener("visibilitychange",this.handleVisibilityChange),document.hidden||this.resumeHealthCheck(),setTimeout(()=>this.performHealthCheck(),5e3))},stopRecovery(){this.isActive&&(window.removeEventListener("online",this.handleNetworkStatusChange),window.removeEventListener("offline",this.handleNetworkStatusChange),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.pauseHealthCheck(),this.isActive=!1)},handleNetworkStatusChange(){navigator.onLine&&(window.dispatchEvent(new CustomEvent("supabase-reconnect")),W.getInstance().refreshToken().catch(a=>{}))},handleVisibilityChange(){if(document.hidden){N.pauseHealthCheck();return}N.resumeHealthCheck(),setTimeout(()=>N.performHealthCheck(),1e3)},async performHealthCheck(){if(this.recoveryInProgress)return;const a=Date.now();if(!(a-this.lastRecoveryAttempt<3e4))try{this.recoveryInProgress=!0,this.lastRecoveryAttempt=a;const{data:o}=await A.auth.getSession(),i=o.session;if(!i)return;const n=W.getInstance();await n.checkTokenExpiration(i,600*1e3)&&await n.refreshToken();const h=A.getChannels(),x=h.some(c=>c.state==="joined");if(!x&&h.length>0){if(window.dispatchEvent(new CustomEvent("supabase-reconnect")),this.consecutiveFailures>0){const c=Math.min(Math.pow(2,this.consecutiveFailures)*1e3,this.maxRetryDelay);await new Promise(l=>setTimeout(l,c))}this.consecutiveFailures++}else x&&(this.consecutiveFailures=0)}catch{this.consecutiveFailures++}finally{this.recoveryInProgress=!1}}};function ye({className:a="",variant:o="badge"}){const[i,n]=d.useState(E()),[m,h]=d.useState(!1);d.useEffect(()=>{const c=setInterval(()=>{n(E())},5e3);return n(E()),()=>clearInterval(c)},[]);const x=async()=>{h(!0);try{N.startRecovery(),O.info("Attempting to restore connection..."),setTimeout(()=>{h(!1)},3e3)}catch{h(!1),O.error("Failed to restore connection")}};return o==="icon"?e.jsx(Y,{children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs("div",{className:`cursor-help ${a}`,children:[i==="CONNECTED"&&e.jsx(T,{className:"h-4 w-4 text-green-500"}),i==="CONNECTING"&&e.jsx(b,{className:"h-4 w-4 text-amber-500 animate-spin"}),i==="DISCONNECTED"&&e.jsx(I,{className:"h-4 w-4 text-red-500"})]})}),e.jsxs(se,{children:[e.jsx("p",{children:i==="CONNECTED"?"Connected to real-time updates":i==="CONNECTING"?"Connecting...":"Disconnected from real-time updates"}),i!=="CONNECTED"&&e.jsx(p,{variant:"link",className:"p-0 h-auto text-xs",onClick:x,children:"Click to reconnect"})]})]})}):o==="badge"?e.jsxs(oe,{variant:"outline",className:`flex items-center gap-1 cursor-pointer ${a}`,onClick:x,children:[i==="CONNECTED"&&e.jsx(T,{className:"h-3 w-3 text-green-500"}),i==="CONNECTING"&&e.jsx(b,{className:"h-3 w-3 text-amber-500 animate-spin"}),i==="DISCONNECTED"&&e.jsx(I,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{className:"text-xs",children:i==="CONNECTED"?"Connected":i==="CONNECTING"?"Connecting...":"Disconnected"}),m?e.jsx(b,{className:"h-3 w-3 animate-spin"}):e.jsx(H,{className:"h-3 w-3"})]}):e.jsxs("div",{className:`flex items-center gap-2 ${a}`,children:[i==="CONNECTED"&&e.jsx(T,{className:"h-4 w-4 text-green-500"}),i==="CONNECTING"&&e.jsx(b,{className:"h-4 w-4 text-amber-500 animate-spin"}),i==="DISCONNECTED"&&e.jsx(I,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{children:i==="CONNECTED"?"Connected to real-time updates":i==="CONNECTING"?"Connecting to real-time updates...":"Disconnected from real-time updates"}),e.jsx(p,{variant:"outline",size:"sm",onClick:x,disabled:m,className:"ml-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Reconnecting"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Reconnect"]})})]})}export{ye as C,be as M,G as P,je as W};
