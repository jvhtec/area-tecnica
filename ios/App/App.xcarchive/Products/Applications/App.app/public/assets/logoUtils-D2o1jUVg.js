import{s as i}from"./index-NZ6jJLfQ.js";import{l}from"./logo-url-cache-eY6nfvu7.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";const d="company-assets",p="sector-pro-logo.png",h=["/sector pro logo.png","/sector-pro-logo.png","/sector%20pro%20logo.png","/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png"],g=new Map,m=(o,r,t)=>{const e=`${o}:${r}`,n=g.get(e);if(n)return n;const s=t().finally(()=>g.delete(e));return g.set(e,s),s},y=async o=>{try{const{data:r,error:t}=await i.from("tour_logos").select("file_path").eq("tour_id",o).maybeSingle();if(r!=null&&r.file_path)return r.file_path}catch{}try{const{data:r,error:t}=await i.storage.from("tour-logos").list("",{search:o,limit:1});if(t)return null;const e=(r||[]).find(n=>{var s;return(s=n.name)==null?void 0:s.toLowerCase().includes(o.toLowerCase())})||(r==null?void 0:r[0]);return(e==null?void 0:e.name)??null}catch{return null}},w=async o=>{try{const{data:r,error:t}=await i.from("festival_logos").select("file_path, file_name, uploaded_at").eq("job_id",o).maybeSingle();if(t||!r)return;if(r!=null&&r.file_path)try{const e=l.get("festival-logos",r.file_path);return e||await m("festival-logos",r.file_path,async()=>{const{data:n,error:s}=await i.storage.from("festival-logos").createSignedUrl(r.file_path,3600);if(s){const{data:f}=i.storage.from("festival-logos").getPublicUrl(r.file_path);return f!=null&&f.publicUrl?(l.set("festival-logos",r.file_path,f.publicUrl,900*1e3),f.publicUrl):void 0}if(n!=null&&n.signedUrl)return l.set("festival-logos",r.file_path,n.signedUrl,2700*1e3),n.signedUrl;const{data:a}=i.storage.from("festival-logos").getPublicUrl(r.file_path);if(a!=null&&a.publicUrl)return l.set("festival-logos",r.file_path,a.publicUrl,900*1e3),a.publicUrl})}catch{}return}catch{return}},_=async o=>{try{const r=await y(o);if(!r)return;let t=r.trim();t.startsWith("/")&&(t=t.slice(1)),t.startsWith("tour-logos/")&&(t=t.slice(11));const e=l.get("tour-logos",t);return e||(t.startsWith("http")?(l.set("tour-logos",t,t,2700*1e3),t):await m("tour-logos",t,async()=>{const{data:n,error:s}=await i.storage.from("tour-logos").createSignedUrl(t,3600);if(n!=null&&n.signedUrl)return l.set("tour-logos",t,n.signedUrl,2700*1e3),n.signedUrl;const{data:a}=i.storage.from("tour-logos").getPublicUrl(t);if(a!=null&&a.publicUrl)return l.set("tour-logos",t,a.publicUrl,900*1e3),a.publicUrl}))}catch{return}},C=async o=>{try{const r=await w(o);if(r)return r;const{data:t,error:e}=await i.from("jobs").select("tour_id").eq("id",o).maybeSingle();return e?void 0:t!=null&&t.tour_id?await _(t.tour_id):void 0}catch{return}},u=o=>new Promise(r=>{if(!o||typeof Image>"u"){r(null);return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>r(t),t.onerror=e=>{r(null)},t.src=o}),U=o=>new Promise((r,t)=>{const e=new FileReader;e.onload=()=>r(e.result),e.onerror=n=>t(n),e.readAsDataURL(o)});let c=null;const v=async()=>{try{const{data:o,error:r}=await i.storage.from(d).download(p);if(!r&&o){const t=await U(o),e=await u(t);if(e)return e}}catch{}try{const{data:o,error:r}=await i.storage.from(d).createSignedUrl(p,3600);if(!r&&(o!=null&&o.signedUrl)){const t=await u(o.signedUrl);if(t)return t}}catch{}return null},O=async()=>c||(c=(async()=>{if(typeof window>"u"||typeof Image>"u")return null;const o=await v();if(o)return o;for(const r of h){const t=await u(r);if(t)return t}return null})(),c.catch(()=>{c=null}),c);export{C as fetchJobLogo,w as fetchLogoUrl,_ as fetchTourLogo,O as getCompanyLogo};
