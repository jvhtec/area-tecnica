var P=Object.defineProperty;var R=(p,t,a)=>t in p?P(p,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):p[t]=a;var b=(p,t,a)=>R(p,typeof t!="symbol"?t+"":t,a);import{l as M,s as _}from"./index-NZ6jJLfQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=M("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);class N{static async ensureApiKey(){if(this.apiKey)return this.apiKey;try{const{data:t,error:a}=await _.functions.invoke("get-google-maps-key");if(a)return null;if(t!=null&&t.apiKey)return this.apiKey=t.apiKey,this.apiKey}catch{}return null}static async searchRestaurantsNearVenue(t,a=2e3,r=20,n){var o;try{if(!n&&!(t!=null&&t.trim()))return[];const l=`${n?`${n.lat},${n.lng}`:t.trim().toLowerCase()}::${a}::${r}`,u=this.restaurantCache.get(l);if(u)return u;try{const{data:i,error:c}=await _.functions.invoke("place-restaurants",{body:{location:(t==null?void 0:t.trim())||void 0,radius:a,maxResults:r,coordinates:n}});if(!c&&(i!=null&&i.restaurants)){const s=i.restaurants.map(e=>{var d,L;return this.formatRestaurantData({id:e.id||e.place_id,name:e.name||((d=e.displayName)==null?void 0:d.text),displayName:e.displayName,formattedAddress:e.formatted_address||e.formattedAddress,rating:e.rating,price_level:e.price_level,priceLevel:e.priceLevel,types:e.types,formatted_phone_number:e.formatted_phone_number,internationalPhoneNumber:e.internationalPhoneNumber,website:e.website||e.websiteUri,websiteUri:e.websiteUri,geometry:e.geometry,location:e.location||((L=e.geometry)!=null&&L.location?{latitude:e.geometry.location.lat,longitude:e.geometry.location.lng}:void 0),photos:e.photos,distance:e.distance})});return s.sort((e,d)=>(e.distance||0)-(d.distance||0)),this.restaurantCache.set(l,s),s}}catch{}const y=await this.ensureApiKey();if(!y)return[];let h=n==null?void 0:n.lat,m=n==null?void 0:n.lng;if((!h||!m)&&(t!=null&&t.trim())){const i=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(t.trim())}&key=${y}`,c=await fetch(i);if(!c.ok)return[];const s=await c.json();if(((o=s==null?void 0:s.results)==null?void 0:o.length)>0)h=s.results[0].geometry.location.lat,m=s.results[0].geometry.location.lng;else return[]}if(typeof h!="number"||typeof m!="number")return[];const g=await fetch("https://places.googleapis.com/v1/places:searchNearby",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":y,"X-Goog-FieldMask":"places.id,places.displayName,places.formattedAddress,places.rating,places.priceLevel,places.types,places.internationalPhoneNumber,places.websiteUri,places.location,places.photos"},body:JSON.stringify({includedPrimaryTypes:["restaurant"],maxResultCount:Math.min(r,20),rankPreference:"DISTANCE",locationRestriction:{circle:{center:{latitude:h,longitude:m},radius:a}},languageCode:"es",regionCode:"ES"})});if(!g.ok){const i=await g.text().catch(()=>"");return[]}const f=await g.json(),E=((f==null?void 0:f.places)||[]).map(i=>{const c=this.calculateDistance({lat:h,lng:m},{lat:i.location.latitude,lng:i.location.longitude});let s=[];return i.photos&&i.photos.length>0&&(s=i.photos.slice(0,3).map(e=>e.name)),this.formatRestaurantData({id:i.id,displayName:i.displayName,formattedAddress:i.formattedAddress,rating:i.rating,priceLevel:this.mapPriceLevel(i.priceLevel),types:i.types,internationalPhoneNumber:i.internationalPhoneNumber,websiteUri:i.websiteUri,location:{latitude:i.location.latitude,longitude:i.location.longitude},photos:s,distance:c})});return E.sort((i,c)=>(i.distance||0)-(c.distance||0)),this.restaurantCache.set(l,E),E}catch{return[]}}static async getRestaurantDetails(t){try{try{const{data:o,error:l}=await _.functions.invoke("place-restaurants",{body:{details:!0,placeId:t}});if(!l&&(o!=null&&o.restaurant))return this.formatRestaurantData(o.restaurant)}catch{}const a=await this.ensureApiKey();if(!a)return null;const r=await fetch(`https://places.googleapis.com/v1/places/${t}`,{method:"GET",headers:{"Content-Type":"application/json","X-Goog-Api-Key":a,"X-Goog-FieldMask":"id,displayName,formattedAddress,rating,priceLevel,types,internationalPhoneNumber,websiteUri,location,photos"}});if(!r.ok)return null;const n=await r.json();return this.formatRestaurantData(n)}catch{return null}}static calculateDistance(t,a){const n=this.deg2rad(a.lat-t.lat),o=this.deg2rad(a.lng-t.lng),l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.deg2rad(t.lat))*Math.cos(this.deg2rad(a.lat))*Math.sin(o/2)*Math.sin(o/2),u=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return Math.round(6371*u*1e3)}static deg2rad(t){return t*(Math.PI/180)}static formatRestaurantData(t){var a,r,n;return{id:t.place_id||t.id,name:t.name||((a=t.displayName)==null?void 0:a.text)||"",address:t.formatted_address||t.formattedAddress||"",rating:t.rating||void 0,priceLevel:t.price_level??t.priceLevel??void 0,photos:t.photos||[],cuisine:((r=t.types)==null?void 0:r.filter(o=>!["establishment","point_of_interest","food","restaurant"].includes(o)))||t.cuisine||[],phone:t.formatted_phone_number||t.internationalPhoneNumber||void 0,website:t.website||t.websiteUri||void 0,coordinates:((n=t.geometry)==null?void 0:n.location)||(t.location?{lat:t.location.latitude,lng:t.location.longitude}:void 0)||t.location||void 0,distance:t.distance||void 0,googlePlaceId:t.place_id||t.id,isSelected:!1}}static mapPriceLevel(t){return t?{PRICE_LEVEL_FREE:0,PRICE_LEVEL_INEXPENSIVE:1,PRICE_LEVEL_MODERATE:2,PRICE_LEVEL_EXPENSIVE:3,PRICE_LEVEL_VERY_EXPENSIVE:4}[t]??void 0:void 0}static clearCache(){this.restaurantCache.clear()}}b(N,"restaurantCache",new Map),b(N,"apiKey",null);export{U as G,N as P};
