const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/logoUtils-D2o1jUVg.js","assets/index-NZ6jJLfQ.js","assets/vite-preload-helper-ckwbz45p.js","assets/commonjs-helpers-Cpj98o6Y.js","assets/index-DFO7exW2.css","assets/logo-url-cache-eY6nfvu7.js","assets/jobDocumentsUpload-BaycvzFe.js","assets/taskAutoCompletion-DInRlPJM.js","assets/taskCompletion-NTcmWFA_.js"])))=>i.map(i=>d[i]);
import{_ as xe}from"./vite-preload-helper-ckwbz45p.js";import{j as e,B as w,C as He,A as Qe,L as J,I as de,S as pe,t as fe,v as je,w as Ne,x as be,V as Ge,c as Xe,e as Ye,b as Ze,r as h,s as oe}from"./index-NZ6jJLfQ.js";import{e as et}from"./pdfExport-DjZPdCcG.js";import{u as tt}from"./useJobSelection-B9iLNF5-.js";import{u as st}from"./useTourDefaultSets-CKjECdAO.js";import{u as at}from"./useTourDateOverrides-CHDvO8ks.js";import{B as ce}from"./badge-vNTKF5RD.js";import{C as ve}from"./checkbox-BsRNEGV1.js";import{A as it}from"./arrow-left-VpQwT4cv.js";import{F as nt}from"./file-text-igU140SQ.js";import{S as Ie}from"./save-z_re-Mcq.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./lazyPdf-xVUlxKNu.js";import"./useQuery-kdg2pmgf.js";import"./useMutation-DluhVBs1.js";const rt=({handleBackNavigation:P,handleExportPDF:g,isTourDefaults:c,tourName:k,isDefaults:x,isTourDateContext:j,tourDateInfo:y,isTourContext:I,isJobOverrideMode:R,jobTourInfo:M,tables:S,currentSetName:W,setCurrentSetName:D,jobIdFromUrl:te,selectedJobId:o,handleJobSelect:z,jobs:b,tableName:se,setTableName:T,useDualMotors:O,setUseDualMotors:A,mirroredCluster:ae,setMirroredCluster:ie,cablePick:C,setCablePick:L,cablePickWeight:H,setCablePickWeight:U,soundComponentDatabase:ue,currentTable:B,updateInput:Q,removeRow:K,addRow:ne,generateTable:he,resetCurrentTable:re,defaultSets:q,defaultTables:$,deleteSet:G,weightOverrides:V,deleteOverride:X,saveAsDefaultSet:Y,removeTable:Z})=>e.jsxs("div",{className:"w-full p-4 lg:p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:P,children:e.jsx(it,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Weight Calculator"}),c&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx(ce,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Tour Defaults Mode"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Creating defaults for: ",e.jsx("span",{className:"font-medium",children:k})]})]}),x&&!c&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Managing defaults for: ",e.jsx("span",{className:"font-medium",children:k})]}),j&&y&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[e.jsx("p",{children:"Creating overrides for tour date"}),e.jsxs("p",{className:"font-medium",children:[y.date," - ",y.location]})]}),I&&!x&&!j&&!c&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Creating weight requirements for tour: ",e.jsx("span",{className:"font-medium",children:k})]}),R&&M&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-2",children:[e.jsx(ce,{variant:"secondary",children:"Override Mode"}),e.jsxs("p",{children:["Tour: ",M.tourName," • ",M.date," - ",M.location]})]})]})]}),S.length>0&&!x&&!I&&!c&&e.jsxs(w,{onClick:g,variant:"outline",className:"gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Export & Upload PDF"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:"lg:col-span-4",children:e.jsx(He,{children:e.jsx(Qe,{className:"pt-6",children:e.jsxs("div",{className:"space-y-6",children:[R&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Job Override Mode Active"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This job is part of a tour. Any tables you create will be saved as overrides for the specific tour date."})]}),c&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Tour Defaults Mode Active"})]}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Any tables you create will be saved as global defaults for this tour. These defaults will apply to all tour dates unless specifically overridden."})]}),j&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Override Mode Active"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Any tables you create will be saved as overrides for this specific tour date."})]}),x&&!c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"setName",children:"Default Set Name"}),e.jsx(de,{id:"setName",value:W,onChange:a=>D(a.target.value),placeholder:"Enter set name (e.g., 'Main Stage Rigging')"})]}),!I&&!c&&!te&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"jobSelect",children:"Select Job"}),e.jsxs(pe,{value:o,onValueChange:z,children:[e.jsx(fe,{children:e.jsx(je,{placeholder:"Select a job"})}),e.jsx(Ne,{children:b==null?void 0:b.map(a=>e.jsx(be,{value:a.id,children:a.title},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"tableName",children:x||c?"Weight Default Name":"Table Name"}),e.jsx(de,{id:"tableName",value:se,onChange:a=>T(a.target.value),placeholder:x||c?"Enter default name (e.g., K2 Array)":"Enter table name"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ve,{id:"dualMotors",checked:O,onCheckedChange:a=>A(a)}),e.jsx(J,{htmlFor:"dualMotors",className:"text-sm font-medium",children:"Dual Motors Configuration"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ve,{id:"mirroredCluster",checked:ae,onCheckedChange:a=>ie(a)}),e.jsx(J,{htmlFor:"mirroredCluster",className:"text-sm font-medium",children:"Mirrored Cluster"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ve,{id:"cablePick",checked:C,onCheckedChange:a=>L(a)}),e.jsx(J,{htmlFor:"cablePick",className:"text-sm font-medium",children:"Cable Pick"}),C&&e.jsxs(pe,{value:H,onValueChange:a=>U(a),children:[e.jsx(fe,{className:"w-32",children:e.jsx(je,{placeholder:"Select weight"})}),e.jsx(Ne,{children:["100","200","300","400","500"].map(a=>e.jsxs(be,{value:a,children:[a," kg"]},a))})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Component"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Weight (per unit)"}),e.jsx("th",{className:"w-12 px-4 py-3 text-left font-medium",children:" "})]})}),e.jsx("tbody",{children:B.rows.map((a,p)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-4",children:e.jsx(de,{type:"number",value:a.quantity,onChange:d=>Q(p,"quantity",d.target.value),min:"0",className:"w-full"})}),e.jsx("td",{className:"p-4",children:e.jsxs(pe,{value:a.componentId,onValueChange:d=>Q(p,"componentId",d),children:[e.jsx(fe,{className:"w-full",children:e.jsx(je,{placeholder:"Select component"})}),e.jsx(Ne,{children:ue.map(d=>e.jsx(be,{value:d.id.toString(),children:d.name},d.id))})]})}),e.jsx("td",{className:"p-4",children:e.jsx(de,{type:"number",value:a.weight,readOnly:!0,className:"w-full bg-muted"})}),e.jsx("td",{className:"p-4",children:e.jsx(w,{type:"button",variant:"ghost",size:"icon",onClick:()=>K(p),className:"text-destructive hover:text-destructive","aria-label":"Delete row",children:e.jsx(Ge,{className:"h-4 w-4"})})})]},p))})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{onClick:ne,children:"Add Row"}),e.jsx(w,{onClick:he,variant:"secondary",children:x?"Save Default":c?"Save Tour Default":"Generate Table"}),e.jsx(w,{onClick:re,variant:"destructive",children:"Reset"})]})]})})})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"space-y-6",children:[x&&q.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Existing Default Sets"}),q.map(a=>{const p=$.filter(d=>d.set_id===a.id&&d.table_type==="weight");return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>G(a.id),children:"Delete Set"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[a.description," • ",p.length," tables"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.map(d=>e.jsxs("div",{className:"text-sm border rounded p-2",children:[e.jsx("div",{className:"font-medium",children:d.table_name}),e.jsxs("div",{className:"text-muted-foreground",children:[d.total_value.toFixed(2)," kg"]})]},d.id))})]},a.id)})]}),j&&V.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Existing Overrides for This Date"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:V.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium",children:a.item_name}),e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>X({id:a.id,table:"weight"}),children:"Delete"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(a.weight_kg*a.quantity).toFixed(2)," kg"]})]},a.id))})]}),S.slice(0,Math.ceil(S.length/2)).map(a=>{var p;return e.jsxs("div",{className:"border rounded-lg overflow-x-auto",children:[e.jsxs("div",{className:"bg-muted px-4 py-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:a.name}),c&&e.jsx(ce,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Default"})]}),e.jsxs("div",{className:"flex gap-2",children:[!x&&I&&e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>Y(),children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Save as Default"]}),e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>a.id&&Z(a.id),children:"Remove Table"})]})]}),(a.dualMotors||a.clusterId||C)&&e.jsxs("div",{className:"p-4 bg-muted/50 space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Configuration:"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[a.dualMotors&&e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Dual Motors"}),a.clusterId&&e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded",children:"Mirrored Cluster"}),C&&e.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded",children:["Cable Pick (",H," kg)"]})]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Component"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Weight (per unit)"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Total Weight"})]})}),e.jsxs("tbody",{children:[a.rows.map((d,ee)=>{var _;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:d.quantity}),e.jsx("td",{className:"px-4 py-3",children:d.componentName}),e.jsxs("td",{className:"px-4 py-3",children:[d.weight," kg"]}),e.jsxs("td",{className:"px-4 py-3",children:[(_=d.totalWeight)==null?void 0:_.toFixed(2)," kg"]})]},ee)}),e.jsxs("tr",{className:"border-t bg-muted/50 font-medium",children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Total Weight:"}),e.jsxs("td",{className:"px-4 py-3",children:[(p=a.totalWeight)==null?void 0:p.toFixed(2)," kg"]})]})]})]}),a.dualMotors&&e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500 bg-muted/30 italic",children:"*This configuration uses dual motors. Load is distributed between two motors for safety and redundancy."}),a.riggingPoints&&e.jsxs("div",{className:"px-4 py-2 text-sm text-blue-600 bg-blue-50 border-t",children:[e.jsx("strong",{children:"Rigging Points:"})," ",a.riggingPoints]})]},a.id)})]})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx("div",{className:"space-y-6",children:S.slice(Math.ceil(S.length/2)).map(a=>{var p;return e.jsxs("div",{className:"border rounded-lg overflow-x-auto mt-6",children:[e.jsxs("div",{className:"bg-muted px-4 py-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:a.name}),c&&e.jsx(ce,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Default"})]}),e.jsxs("div",{className:"flex gap-2",children:[!x&&I&&e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>Y(),children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Save as Default"]}),e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>a.id&&Z(a.id),children:"Remove Table"})]})]}),(a.dualMotors||a.clusterId||C)&&e.jsxs("div",{className:"p-4 bg-muted/50 space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Configuration:"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[a.dualMotors&&e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Dual Motors"}),a.clusterId&&e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded",children:"Mirrored Cluster"}),C&&e.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded",children:["Cable Pick (",H," kg)"]})]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Component"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Weight (per unit)"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium",children:"Total Weight"})]})}),e.jsxs("tbody",{children:[a.rows.map((d,ee)=>{var _;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:d.quantity}),e.jsx("td",{className:"px-4 py-3",children:d.componentName}),e.jsxs("td",{className:"px-4 py-3",children:[d.weight," kg"]}),e.jsxs("td",{className:"px-4 py-3",children:[(_=d.totalWeight)==null?void 0:_.toFixed(2)," kg"]})]},ee)}),e.jsxs("tr",{className:"border-t bg-muted/50 font-medium",children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Total Weight:"}),e.jsxs("td",{className:"px-4 py-3",children:[(p=a.totalWeight)==null?void 0:p.toFixed(2)," kg"]})]})]})]}),a.dualMotors&&e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500 bg-muted/30 italic",children:"*This configuration uses dual motors. Load is distributed between two motors for safety and redundancy."}),a.riggingPoints&&e.jsxs("div",{className:"px-4 py-2 text-sm text-blue-600 bg-blue-50 border-t",children:[e.jsx("strong",{children:"Rigging Points:"})," ",a.riggingPoints]})]},a.id)})})})]})]}),we=[{id:1,name:" K1 ",weight:106},{id:2,name:" K2 ",weight:56},{id:3,name:" K3 ",weight:43},{id:4,name:" KARA II ",weight:25},{id:5,name:" KIVA ",weight:14},{id:6,name:" KS28 ",weight:79},{id:7,name:" K1-SB ",weight:83},{id:8,name:" BUMPER K1 ",weight:108},{id:9,name:" BUMPER K2 ",weight:60},{id:10,name:" BUMPER K3 ",weight:50},{id:11,name:" BUMPER KARA ",weight:20},{id:12,name:" BUMPER KIVA ",weight:13},{id:13,name:" BUMPER KS28 ",weight:15},{id:14,name:" KARADOWNK1 ",weight:15},{id:15,name:" KARADOWNK2 ",weight:15},{id:16,name:" MOTOR 2T ",weight:90},{id:17,name:" MOTOR 1T ",weight:70},{id:18,name:" MOTOR 750Kg ",weight:60},{id:19,name:" MOTOR 500Kg ",weight:50},{id:20,name:" POLIPASTO 1T ",weight:10.4},{id:21,name:" TFS900H ",weight:102},{id:22,name:" TFA600 ",weight:41},{id:23,name:" TFS550H ",weight:13.4},{id:24,name:" TFS550L ",weight:27},{id:25,name:" BUMPER TFS900 ",weight:20},{id:26,name:" TFS900>TFA600 ",weight:14},{id:27,name:" TFS900>TFS550 ",weight:14},{id:28,name:" BUMPER TFS550 ",weight:16},{id:29,name:" CABLEADO L ",weight:100},{id:30,name:" CABLEADO H ",weight:250}],ye=()=>{var P,g;return((g=(P=globalThis.crypto)==null?void 0:P.randomUUID)==null?void 0:g.call(P))??`row_${Date.now()}_${Math.random().toString(16).slice(2)}`},me=()=>({id:ye(),quantity:"",componentId:"",weight:""}),wt=()=>{const P=Xe(),{toast:g}=Ye(),{data:c}=tt(),[k]=Ze(),x=k.get("jobId"),j=k.get("tourId"),y=k.get("tourDateId"),I=k.get("mode"),R=I==="defaults",M=I==="tour-defaults",S=!!j,W=!!y,[D,te]=h.useState(""),[o,z]=h.useState(null),[b,se]=h.useState(""),[T,O]=h.useState([]),[A,ae]=h.useState(!1),[ie,C]=h.useState(!1),[L,H]=h.useState(!1),[U,ue]=h.useState("100"),[B,Q]=h.useState(""),[K,ne]=h.useState(!1),[he,re]=h.useState(null),[q,$]=h.useState({name:"",rows:[me()]}),G=s=>{const t=s.match(/^(.*?)(?:\s*\(.*\))?$/);return t?t[1].trim():s},V=s=>`SX${s.toString().padStart(2,"0")}`,X=s=>{let t=1;return s.map(i=>{const n=i.baseName||G(i.name);if(i.dualMotors){const f=V(t++),v=V(t++),r=`${f}, ${v}`;return{...i,baseName:n,name:`${n} (${r})`,riggingPoints:r}}const l=V(t++);return{...i,baseName:n,name:`${n} (${l})`,riggingPoints:l}})},Y=s=>{let t=[];return O(i=>(t=X(s(i)),t)),t},{defaultSets:Z,defaultTables:a,createSet:p,createTable:d,deleteSet:ee}=st(j||"","sound"),{weightOverrides:_,createWeightOverride:Se,deleteOverride:Me}=at(y||"","weight"),[_e,We]=h.useState(""),[De,Ee]=h.useState(null);h.useEffect(()=>{(async()=>{if(x)try{te(x);const t=(c||[]).find(l=>l.id===x);if(t){z(t);return}const{data:i,error:n}=await oe.from("jobs").select("id, title, start_time, end_time, tour_date_id").eq("id",x).single();!n&&i&&z(i)}catch{}})()},[x,c]);const Fe=async()=>{const s=Z.find(i=>i.department==="sound");return s?s.id:(await p({tour_id:j,name:`${_e} Sound Defaults`,department:"sound",description:"Sound department weight defaults"})).id};h.useEffect(()=>{o!=null&&o.tour_date_id&&!S?(ne(!0),Re()):(ne(!1),re(null))},[o,S]);const Re=async()=>{var s,t;if(o!=null&&o.tour_date_id)try{const{data:i}=await oe.from("tour_dates").select(`
          date,
          tour:tours(name),
          location:locations(name)
        `).eq("id",o.tour_date_id).single();i&&re({tourName:((s=i.tour)==null?void 0:s.name)||"Unknown Tour",date:new Date(i.date).toLocaleDateString(),location:((t=i.location)==null?void 0:t.name)||"Unknown Location"})}catch{}};h.useEffect(()=>{(async()=>{var t;if(j){const{data:i}=await oe.from("tours").select("name").eq("id",j).single();i&&We(i.name)}if(y){const{data:i}=await oe.from("tour_dates").select(`
            date,
            locations (
              name
            )
          `).eq("id",y).single();i&&Ee({date:new Date(i.date).toLocaleDateString(),location:((t=i.locations)==null?void 0:t.name)||"Unknown location"})}})()},[j,y]);const Oe=()=>{P(S?"/tours":"/sound")};h.useEffect(()=>{if(R&&a.length>0){const s=a.filter(t=>t.table_type==="weight").map((t,i)=>{var n,l,f,v,r,m,u,N,E;return{name:t.table_name,rows:(((n=t.table_data)==null?void 0:n.rows)||[{quantity:"1",componentId:"",weight:t.total_value.toString(),componentName:t.table_name,totalWeight:t.total_value}]).map(F=>({...F,id:(F==null?void 0:F.id)||ye()})),totalWeight:t.total_value,id:Date.now()+i,clusterId:(l=t.metadata)==null?void 0:l.clusterId,dualMotors:(f=t.metadata)==null?void 0:f.dualMotors,riggingPoints:(v=t.metadata)==null?void 0:v.riggingPoints,cablePick:!!(((r=t.metadata)==null?void 0:r.cablePick)??((m=t.table_data)==null?void 0:m.cablePick)??!1),cablePickWeight:(((u=t.metadata)==null?void 0:u.cablePickWeight)??((N=t.table_data)==null?void 0:N.cablePickWeight)??"100").toString(),defaultTableId:t.id,baseName:((E=t.metadata)==null?void 0:E.baseName)||G(t.table_name)}});O(X(s))}},[R,a]),h.useEffect(()=>{if(W&&_.length>0){const s=_.map((t,i)=>{var n,l,f,v,r,m,u,N,E,F,Pe,Te,Ce,ke;return{name:t.item_name,rows:(((l=(n=t.override_data)==null?void 0:n.tableData)==null?void 0:l.rows)||[{quantity:t.quantity.toString(),componentId:"",weight:t.weight_kg.toString(),componentName:t.item_name,totalWeight:t.weight_kg*t.quantity}]).map(le=>({...le,id:(le==null?void 0:le.id)||ye()})),totalWeight:t.weight_kg*t.quantity,id:Date.now()+i,clusterId:(v=(f=t.override_data)==null?void 0:f.tableData)==null?void 0:v.clusterId,dualMotors:(m=(r=t.override_data)==null?void 0:r.tableData)==null?void 0:m.dualMotors,riggingPoints:(N=(u=t.override_data)==null?void 0:u.tableData)==null?void 0:N.riggingPoints,cablePick:!!(((F=(E=t.override_data)==null?void 0:E.tableData)==null?void 0:F.cablePick)??!1),cablePickWeight:(((Te=(Pe=t.override_data)==null?void 0:Pe.tableData)==null?void 0:Te.cablePickWeight)??"100").toString(),overrideId:t.id,baseName:((ke=(Ce=t.override_data)==null?void 0:Ce.tableData)==null?void 0:ke.baseName)||G(t.item_name)}});O(X(s))}},[W,_]);const Ae=()=>{$(s=>({...s,rows:[...s.rows,me()]}))},Le=s=>{$(t=>{const i=t.rows.filter((n,l)=>l!==s);return{...t,rows:i.length>0?i:[me()]}})},Ue=(s,t,i)=>{const n=[...q.rows];if(t==="componentId"){const l=we.find(f=>f.id.toString()===i);n[s]={...n[s],[t]:i,weight:l?l.weight.toString():""}}else n[s]={...n[s],[t]:i};$(l=>({...l,rows:n}))},Be=s=>{te(s);const t=(c==null?void 0:c.find(i=>i.id===s))||null;z(t)},Ke=async()=>{if(!j||!B||T.length===0){g({title:"Missing information",description:"Please enter a set name and create at least one table",variant:"destructive"});return}try{const s=await p({tour_id:j,name:B,description:`Weight calculation set with ${T.length} tables`,department:"sound"});for(const t of T)await d({set_id:s.id,table_name:t.name,table_data:{rows:t.rows,toolType:"pesos"},table_type:"weight",total_value:t.totalWeight||0,metadata:{dualMotors:t.dualMotors,riggingPoints:t.riggingPoints,clusterId:t.clusterId,baseName:t.baseName}});g({title:"Success",description:`Default set "${B}" saved successfully`}),Q(""),O([]),ge()}catch{g({title:"Error",description:"Failed to save default set",variant:"destructive"})}},qe=async s=>{if(j)try{const t=await Fe();await d({set_id:t,table_name:s.name,table_data:{rows:s.rows,dualMotors:s.dualMotors,mirroredCluster:!!s.clusterId,riggingPoints:s.riggingPoints,cablePick:s.cablePick,cablePickWeight:s.cablePickWeight,baseName:s.baseName},table_type:"weight",total_value:s.totalWeight||0,metadata:{dualMotors:s.dualMotors,riggingPoints:s.riggingPoints,clusterId:s.clusterId,cablePick:s.cablePick,cablePickWeight:s.cablePickWeight,baseName:s.baseName}}),g({title:"Success",description:"Tour default saved successfully"})}catch{g({title:"Error",description:"Failed to save tour default",variant:"destructive"})}},$e=async s=>{if(K&&(o!=null&&o.tour_date_id))try{await Se({tour_date_id:o.tour_date_id,default_table_id:s.defaultTableId,item_name:s.name,weight_kg:s.totalWeight||0,quantity:1,category:null,department:"sound",override_data:{tableData:s,toolType:"pesos"}}),g({title:"Success",description:"Override saved for tour date"});return}catch{g({title:"Error",description:"Failed to save override",variant:"destructive"});return}if(y)try{await Se({tour_date_id:y,default_table_id:s.defaultTableId,item_name:s.name,weight_kg:s.totalWeight||0,quantity:1,category:null,department:"sound",override_data:{tableData:s,toolType:"pesos"}}),g({title:"Success",description:"Override saved for this tour date"})}catch{g({title:"Error",description:"Failed to save override",variant:"destructive"})}},Ve=()=>{if(!b){g({title:"Missing table name",description:"Please enter a name for the table",variant:"destructive"});return}const s=q.rows.map(r=>{const m=we.find(N=>N.id.toString()===r.componentId),u=parseFloat(r.quantity)&&parseFloat(r.weight)?parseFloat(r.quantity)*parseFloat(r.weight):0;return{...r,componentName:(m==null?void 0:m.name)||"",totalWeight:u}}),t=s.reduce((r,m)=>r+(m.totalWeight||0),0),i=Date.now().toString();let n=[];if(ie){const r={name:`${b} L`,baseName:`${b} L`,riggingPoints:"",rows:s,totalWeight:t,id:Date.now(),dualMotors:A,clusterId:i,cablePick:L,cablePickWeight:U},m={name:`${b} R`,baseName:`${b} R`,riggingPoints:"",rows:s,totalWeight:t,id:Date.now()+1,dualMotors:A,clusterId:i,cablePick:L,cablePickWeight:U};n=[r,m]}else n=[{name:b,baseName:b,riggingPoints:"",rows:s,totalWeight:t,id:Date.now(),dualMotors:A,clusterId:i,cablePick:L,cablePickWeight:U}];(W||K)&&(n=n.map(r=>({...r,isOverride:!0})));const l=n.map(r=>r.id??0);Y(r=>[...r,...n]).filter(r=>l.includes(r.id??0)).forEach(r=>{M?qe(r):(W||K)&&$e(r)}),ge(),ae(!1),C(!1)},ge=()=>{$({name:"",rows:[me()]}),se("")},Je=s=>{Y(t=>t.filter(i=>i.id!==s))},ze=async()=>{if(!D||!o){g({title:"No job selected",description:"Please select a job before exporting.",variant:"destructive"});return}const s=T.map(n=>({clusterName:n.name.split("(")[0].trim(),riggingPoints:n.riggingPoints||"",clusterWeight:n.totalWeight||0})),t=T.reduce((n,l)=>(l.clusterId&&(n[l.clusterId]||(n[l.clusterId]=[]),n[l.clusterId].push(l)),n),{});let i=0;Object.values(t).forEach(n=>{const l=n.find(f=>f.cablePick);l&&(i+=1,s.push({clusterName:"CABLE PICK",riggingPoints:`CP${String(i).padStart(2,"0")}`,clusterWeight:parseFloat(l.cablePickWeight||"0")||0}))});try{let n;try{const{fetchJobLogo:u}=await xe(async()=>{const{fetchJobLogo:N}=await import("./logoUtils-D2o1jUVg.js");return{fetchJobLogo:N}},__vite__mapDeps([0,1,2,3,4,5]));n=await u(D)}catch{}const l=await et(o.title,T.map(u=>({...u,toolType:"pesos"})),"weight",o.title,(o==null?void 0:o.start_time)||new Date().toISOString(),s,void 0,void 0,n),f=`Pesos Report - ${o.title}.pdf`;try{const{uploadJobPdfWithCleanup:u}=await xe(async()=>{const{uploadJobPdfWithCleanup:N}=await import("./jobDocumentsUpload-BaycvzFe.js");return{uploadJobPdfWithCleanup:N}},__vite__mapDeps([6,1,2,3,4]));await u(D,l,f,"calculators/pesos")}catch(u){throw u}let v=0;try{const{autoCompletePesosTasks:u}=await xe(async()=>{const{autoCompletePesosTasks:E}=await import("./taskAutoCompletion-DInRlPJM.js");return{autoCompletePesosTasks:E}},__vite__mapDeps([7,8,1,2,3,4])),N=await u(D);v=N.completedCount,N.completedCount>0}catch{}g({title:"Success",description:v>0?`PDF uploaded successfully. ${v} Pesos task(s) auto-completed.`:"PDF has been generated and uploaded successfully."});const r=window.URL.createObjectURL(l),m=document.createElement("a");m.href=r,m.download=f,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(r),document.body.removeChild(m)}catch{g({title:"Error",description:"Failed to generate or upload the PDF.",variant:"destructive"})}};return e.jsx(rt,{handleBackNavigation:Oe,handleExportPDF:ze,isTourDefaults:M,tourName:_e,isDefaults:R,isTourDateContext:W,tourDateInfo:De,isTourContext:S,isJobOverrideMode:K,jobTourInfo:he,tables:T,currentSetName:B,setCurrentSetName:Q,jobIdFromUrl:x,selectedJobId:D,handleJobSelect:Be,jobs:c,tableName:b,setTableName:se,useDualMotors:A,setUseDualMotors:ae,mirroredCluster:ie,setMirroredCluster:C,cablePick:L,setCablePick:H,cablePickWeight:U,setCablePickWeight:ue,soundComponentDatabase:we,currentTable:q,updateInput:Ue,removeRow:Le,addRow:Ae,generateTable:Ve,resetCurrentTable:ge,defaultSets:Z,defaultTables:a,deleteSet:ee,weightOverrides:_,deleteOverride:Me,saveAsDefaultSet:Ke,removeTable:Je})};export{wt as default};
