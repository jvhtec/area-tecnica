import{e as P,r as n,j as e,B as c,H as Y,I as k,S as M,t as _,v as D,w as I,x as z,s as d}from"./index-NZ6jJLfQ.js";import{u as J}from"./useRoleGuard-DLTKaScw.js";import{S as B}from"./switch-DUBpZhIC.js";import{T as K,a as Q,b as w,c as o,d as W,e as r}from"./table-DnQAmABX.js";import{A as N}from"./announcementLevels-BJlHb9ui.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";const H=["info","warn","critical"],V=({level:a})=>e.jsxs("span",{className:`inline-flex items-center gap-2 uppercase text-xs font-medium px-2 py-1 rounded border ${N[a].badge}`,children:[e.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${N[a].dot}`}),a]}),R=({level:a})=>e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsx(V,{level:a}),e.jsx("span",{className:N[a].text,children:"Ticker preview"})]});function ie(){J(["admin","management"]);const{toast:a}=P(),[q,b]=n.useState(!1),[C,x]=n.useState([]),[m,S]=n.useState(""),[u,A]=n.useState("info"),[y,L]=n.useState(!0),[h,j]=n.useState(null),[v,T]=n.useState(""),[g,E]=n.useState("info"),p=async()=>{b(!0);const{data:s,error:t}=await d.from("announcements").select("id, message, level, active, created_at, created_by").order("created_at",{ascending:!1}).limit(50);t?a({title:"Failed to load",description:t.message,variant:"destructive"}):x(s),b(!1)};n.useEffect(()=>{p()},[]);const F=async()=>{var l;if(!m.trim())return;const{data:s}=await d.auth.getUser(),t=((l=s.user)==null?void 0:l.id)??null,{error:i}=await d.from("announcements").insert({message:m.trim(),level:u,active:y,created_by:t});i?a({title:"Create failed",description:i.message,variant:"destructive"}):(S(""),A("info"),L(!0),p(),a({title:"Announcement added"}))},U=s=>{j(s.id),T(s.message),E(s.level)},O=async s=>{const{error:t}=await d.from("announcements").update({message:v,level:g}).eq("id",s);t?a({title:"Update failed",description:t.message,variant:"destructive"}):(j(null),p(),a({title:"Announcement updated"}))},$=async(s,t)=>{const{error:i}=await d.from("announcements").update({active:t}).eq("id",s);i?a({title:"Toggle failed",description:i.message,variant:"destructive"}):x(l=>l.map(f=>f.id===s?{...f,active:t}:f))},G=async s=>{if(!confirm("Delete this announcement?"))return;const{error:t}=await d.from("announcements").delete().eq("id",s);t?a({title:"Delete failed",description:t.message,variant:"destructive"}):(x(i=>i.filter(l=>l.id!==s)),a({title:"Announcement deleted"}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Announcements (Ticker)"}),e.jsx("p",{className:"text-muted-foreground",children:"Messages shown in the wallboard ticker. Newest first. Toggle Active to show/hide."})]}),e.jsx(c,{asChild:!0,variant:"outline",className:"w-full sm:w-auto",children:e.jsx(Y,{to:"/management/wallboard-presets",children:"Configure wallboards"})})]}),e.jsxs("div",{className:"border rounded-md p-4 space-y-3",children:[e.jsx("div",{className:"text-lg font-medium",children:"Add Announcement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3 items-center",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(k,{placeholder:"Message",value:m,onChange:s=>S(s.target.value)})}),e.jsx("div",{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{value:u,onValueChange:s=>A(s),children:[e.jsx(_,{children:e.jsx(D,{placeholder:"Level"})}),e.jsx(I,{children:H.map(s=>e.jsx(z,{value:s,children:s},s))})]}),e.jsx(R,{level:u})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{checked:y,onCheckedChange:L}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(c,{className:"w-full",onClick:F,disabled:!m.trim(),children:"Add"})})]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(w,{children:[e.jsx(o,{children:"Message"}),e.jsx(o,{className:"w-[120px]",children:"Level"}),e.jsx(o,{className:"w-[100px]",children:"Active"}),e.jsx(o,{className:"w-[160px]",children:"Created"}),e.jsx(o,{className:"w-[160px]"})]})}),e.jsxs(W,{children:[C.map(s=>e.jsxs(w,{children:[e.jsx(r,{children:h===s.id?e.jsx(k,{value:v,onChange:t=>T(t.target.value)}):e.jsx("div",{className:"truncate max-w-[600px]",title:s.message,children:s.message})}),e.jsx(r,{children:h===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{value:g,onValueChange:t=>E(t),children:[e.jsx(_,{children:e.jsx(D,{})}),e.jsx(I,{children:H.map(t=>e.jsx(z,{value:t,children:t},t))})]}),e.jsx(R,{level:g})]}):e.jsx(V,{level:s.level})}),e.jsx(r,{children:e.jsx(B,{checked:s.active,onCheckedChange:t=>$(s.id,t)})}),e.jsx(r,{children:new Date(s.created_at).toLocaleString()}),e.jsx(r,{className:"text-right space-x-2",children:h===s.id?e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"secondary",onClick:()=>j(null),children:"Cancel"}),e.jsx(c,{size:"sm",onClick:()=>O(s.id),disabled:!v.trim(),children:"Save"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>U(s),children:"Edit"}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>G(s.id),children:"Delete"})]})})]},s.id)),C.length===0&&e.jsx(w,{children:e.jsx(r,{colSpan:5,className:"text-center text-muted-foreground py-6",children:q?"Loadingâ€¦":"No announcements yet"})})]})]})})]})}export{ie as default};
