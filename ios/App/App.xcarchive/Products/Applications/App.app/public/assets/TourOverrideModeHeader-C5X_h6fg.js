import{r as f,e as q,s as a,j as e,C as D,A as E,M as y}from"./index-NZ6jJLfQ.js";import{B as g}from"./badge-vNTKF5RD.js";import{S as T}from"./settings-egXcSQW9.js";import{C as M}from"./calendar-_Cj_Sgy-.js";const A=(t,s,r)=>{const[l,n]=f.useState(null),[d,c]=f.useState(!1),{toast:m}=q(),x=!!(t&&s);return f.useEffect(()=>{if(!x||!r)return;(async()=>{var u;c(!0);try{const{data:i,error:o}=await a.from("tours").select("name").eq("id",t).single();if(o)throw o;const{data:h,error:p}=await a.from("tour_dates").select(`
            date,
            locations (name)
          `).eq("id",s).single();if(p)throw p;const{data:_,error:b}=await a.from("tour_default_tables").select(`
            *,
            tour_default_sets!inner(tour_id, department)
          `).eq("tour_default_sets.tour_id",t).eq("tour_default_sets.department",r);if(b)throw b;const w=a.from("tour_date_power_overrides").select("*").eq("tour_date_id",s).eq("department",r),N=a.from("tour_date_weight_overrides").select("*").eq("tour_date_id",s).eq("department",r),[j,O]=await Promise.all([w,N]);n({tourId:t,tourDateId:s,tourName:i.name,tourDate:h.date,locationName:((u=h.locations)==null?void 0:u.name)||"Unknown Location",defaults:_||[],overrides:[...j.data||[],...O.data||[]]})}catch{m({title:"Error",description:"Failed to load tour override data",variant:"destructive"})}finally{c(!1)}})()},[t,s,r,x,m]),{isOverrideMode:x,overrideData:l,isLoading:d,saveOverride:async(v,u)=>{if(!(!s||!r))try{const i=v==="power"?"tour_date_power_overrides":"tour_date_weight_overrides",{error:o}=await a.from(i).insert({tour_date_id:s,department:r,...u});if(o)throw o;return m({title:"Success",description:"Override saved successfully"}),!0}catch{return m({title:"Error",description:"Failed to save override",variant:"destructive"}),!1}}}},F=({tourName:t,tourDate:s,locationName:r,defaultsCount:l,overridesCount:n,department:d})=>{const c=new Date(s).toLocaleDateString("en-GB");return e.jsx(D,{className:"mb-6 bg-blue-50 border-blue-200",children:e.jsxs(E,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(T,{className:"h-5 w-5 text-blue-600"}),e.jsxs("h2",{className:"text-lg font-semibold text-blue-900",children:["Override Mode - ",d.charAt(0).toUpperCase()+d.slice(1)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-blue-900",children:"Tour:"}),e.jsx("span",{className:"text-blue-700",children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Date:"}),e.jsx("span",{className:"text-blue-700",children:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Location:"}),e.jsx("span",{className:"text-blue-700",children:r})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(g,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[l," Default",l!==1?"s":""]}),e.jsxs(g,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:[n," Override",n!==1?"s":""]})]}),e.jsx("p",{className:"text-sm text-blue-600 mt-3",children:"Any tables created here will be saved as overrides for this specific tour date. These will be combined with defaults when exporting PDFs."})]})})};export{F as T,A as u};
