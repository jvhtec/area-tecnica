const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-NZ6jJLfQ.js","assets/vite-preload-helper-ckwbz45p.js","assets/commonjs-helpers-Cpj98o6Y.js","assets/index-DFO7exW2.css"])))=>i.map(i=>d[i]);
var Xt=Object.defineProperty;var Qt=(t,n,r)=>n in t?Xt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var Ke=(t,n,r)=>Qt(t,typeof n!="symbol"?n+"":n,r);import{r as h,j as e,s as T,a4 as Zt,aM as es}from"./index-NZ6jJLfQ.js";import{_ as Nt}from"./vite-preload-helper-ckwbz45p.js";import{A as ts}from"./announcementLevels-BJlHb9ui.js";import{M as ss}from"./mic-l4q2dREA.js";import{M as ns}from"./moon-Bp9lP4EQ.js";import{S as as}from"./star-icpn3ybK.js";import{W as rs}from"./wrench-DzMvZxmF.js";import{P as is}from"./plane-NSG-_bNT.js";import{T as U}from"./transportProviders-CPS1W6Xy.js";const os=({onComplete:t,duration:n=8e3})=>{const[r,s]=h.useState(!1);h.useEffect(()=>{const l=document.getElementById("splash-particles");if(l)for(let o=0;o<30;o++){const m=document.createElement("div");m.className="splash-particle",m.style.left=Math.random()*100+"%",m.style.animationDelay=Math.random()*10+"s",m.style.animationDuration=Math.random()*10+10+"s",l.appendChild(m)}const d=setTimeout(()=>{s(!0),setTimeout(()=>{t==null||t()},800)},n);return()=>{clearTimeout(d),l&&(l.innerHTML="")}},[n,t]);const c=()=>{s(!0),setTimeout(()=>{t==null||t()},800)};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .splash-container {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          z-index: 9999;
          animation: splashFadeIn 0.5s ease-in;
          cursor: pointer;
        }

        .splash-container.fade-out {
          animation: splashFadeOut 0.8s ease-out forwards;
        }

        .splash-logo-container {
          position: relative;
          animation: splashLogoEntrance 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
          opacity: 0;
        }

        .splash-logo {
          width: 600px;
          max-width: 80vw;
          height: auto;
          filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.3));
          animation: splashPulse 2s ease-in-out infinite;
        }

        .splash-glow-effect {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 120%;
          height: 120%;
          background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
          animation: splashGlowPulse 3s ease-in-out infinite;
          pointer-events: none;
        }

        .splash-loading-text {
          margin-top: 40px;
          color: #ffffff;
          font-size: 18px;
          font-weight: 300;
          letter-spacing: 4px;
          text-transform: uppercase;
          opacity: 0;
          animation: splashTextFade 1s ease-in 0.8s forwards;
        }

        .splash-loading-bar-container {
          margin-top: 30px;
          width: 300px;
          height: 2px;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 2px;
          overflow: hidden;
          opacity: 0;
          animation: splashTextFade 1s ease-in 1s forwards;
        }

        .splash-loading-bar {
          height: 100%;
          background: linear-gradient(90deg, transparent, #ffffff, transparent);
          background-size: 200% 100%;
          animation: splashLoadingBar 1.5s ease-in-out infinite;
        }

        .splash-grid-background {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-image:
            linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
          background-size: 50px 50px;
          animation: splashGridMove 20s linear infinite;
          pointer-events: none;
        }

        .splash-particles {
          position: absolute;
          width: 100%;
          height: 100%;
          overflow: hidden;
        }

        .splash-particle {
          position: absolute;
          width: 2px;
          height: 2px;
          background: rgba(255, 255, 255, 0.5);
          border-radius: 50%;
          animation: splashParticleFloat 10s linear infinite;
        }

        @keyframes splashFadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        @keyframes splashFadeOut {
          to {
            opacity: 0;
            visibility: hidden;
          }
        }

        @keyframes splashLogoEntrance {
          0% {
            opacity: 0;
            transform: scale(0.5) translateY(50px);
          }
          100% {
            opacity: 1;
            transform: scale(1) translateY(0);
          }
        }

        @keyframes splashPulse {
          0%, 100% {
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.3));
          }
          50% {
            filter: drop-shadow(0 0 50px rgba(255, 255, 255, 0.5));
          }
        }

        @keyframes splashGlowPulse {
          0%, 100% {
            opacity: 0.3;
            transform: translate(-50%, -50%) scale(1);
          }
          50% {
            opacity: 0.6;
            transform: translate(-50%, -50%) scale(1.1);
          }
        }

        @keyframes splashTextFade {
          to {
            opacity: 1;
          }
        }

        @keyframes splashLoadingBar {
          0% {
            background-position: -200% 0;
          }
          100% {
            background-position: 200% 0;
          }
        }

        @keyframes splashGridMove {
          0% {
            transform: translate(0, 0);
          }
          100% {
            transform: translate(50px, 50px);
          }
        }

        @keyframes splashParticleFloat {
          0% {
            transform: translateY(100vh) translateX(0);
            opacity: 0;
          }
          10% {
            opacity: 0.5;
          }
          90% {
            opacity: 0.5;
          }
          100% {
            transform: translateY(-100vh) translateX(100px);
            opacity: 0;
          }
        }

        @media (max-width: 768px) {
          .splash-logo {
            width: 90vw;
          }

          .splash-loading-text {
            font-size: 14px;
            letter-spacing: 2px;
          }

          .splash-loading-bar-container {
            width: 200px;
          }
        }
      `}),e.jsxs("div",{className:`splash-container ${r?"fade-out":""}`,onClick:c,children:[e.jsx("div",{className:"splash-grid-background"}),e.jsx("div",{className:"splash-particles",id:"splash-particles"}),e.jsxs("div",{className:"splash-logo-container",children:[e.jsx("div",{className:"splash-glow-effect"}),e.jsx("img",{src:"/sector pro logo.png",alt:"Sector-Pro",className:"splash-logo",width:794,height:100,loading:"eager",decoding:"async",onError:l=>{const d=l.target;d.src="/lovable-uploads/ce3ff31a-4cc5-43c8-b5bb-a4056d3735e4.png"}})]}),e.jsx("div",{className:"splash-loading-text",children:"Inicializando Sistema"}),e.jsx("div",{className:"splash-loading-bar-container",children:e.jsx("div",{className:"splash-loading-bar"})})]})]})};class De extends Error{constructor(r,s){super(r);Ke(this,"status");this.status=s}}class Ue{constructor(n){Ke(this,"token");this.token=n}async request(n){var r,s,c,l;try{const{supabase:d}=await Nt(async()=>{const{supabase:x}=await import("./index-NZ6jJLfQ.js").then(f=>f.cl);return{supabase:x}},__vite__mapDeps([0,1,2,3])),i=this.token?{"x-wallboard-jwt":this.token}:{},{data:o,error:m}=await d.functions.invoke("wallboard-feed",{body:{path:n},headers:i,responseType:"json"});if(m)throw m;return o}catch{const i=((s=(r=import.meta)==null?void 0:r.env)==null?void 0:s.VITE_SUPABASE_ANON_KEY)||((l=(c=import.meta)==null?void 0:c.env)==null?void 0:l.VITE_SUPABASE_PUBLISHABLE_KEY),o=this.token?{"x-wallboard-jwt":this.token}:{};i&&(o.Authorization=`Bearer ${i}`);const m=await fetch(`/functions/v1/wallboard-feed${n}`,{headers:o,cache:"no-store"});if(!m.ok)throw new De(`${n} failed`,m.status);if(!(m.headers.get("content-type")||"").includes("application/json"))throw new De(`${n} returned non-JSON`,m.status);return m.json()}}jobsOverview(){return this.request("/jobs-overview")}crewAssignments(){return this.request("/crew-assignments")}docProgress(){return this.request("/doc-progress")}pendingActions(){return this.request("/pending-actions")}announcements(){return this.request("/announcements")}logistics(){return this.request("/logistics")}calendar(){return this.request("/calendar")}presetConfig(){return this.request("/preset-config")}}async function Vs(t,n){try{const l=(await Nt(()=>import("./index-NZ6jJLfQ.js").then(o=>o.cl),__vite__mapDeps([0,1,2,3]))).supabase,{data:d,error:i}=await l.functions.invoke("wallboard-auth",{body:{wallboardToken:t,preset:n,presetSlug:n}});if(i)throw i;if(d!=null&&d.token)return d}catch{}let r=`/functions/v1/wallboard-auth?wallboardToken=${encodeURIComponent(t)}`;n&&(r+=`&preset=${encodeURIComponent(n)}`);const s=await fetch(r);if(!s.ok)throw new Error(`wallboard-auth failed: ${s.status}`);return s.json()}const cs=()=>{h.useEffect(()=>{try{const r=new window.WebOSServiceBridge,s="luna://com.webos.service.tvpower/power/registerScreenSaverRequest",c=JSON.stringify({subscribe:!0,clientName:"ReactKiosk"});r.call(s,c),r.onservicecallback=l=>{try{const d=JSON.parse(l);(d.state==="Active"||d.returnValue===!0)&&r.call("luna://com.webos.service.tvpower/power/responseScreenSaverRequest",JSON.stringify({clientName:"ReactKiosk",ack:!1,timestamp:d.timestamp||Date.now()}))}catch{}}}catch{}const t=()=>{window.dispatchEvent(new Event("mousemove")),window.dispatchEvent(new KeyboardEvent("keydown",{key:"F24",code:"F24"}))},n=setInterval(t,4e4);return t(),()=>clearInterval(n)},[])},ls=()=>{const t=h.useRef(null);return h.useEffect(()=>{const n=t.current;if(!n)return;(async()=>{try{await n.play()}catch(s){if((s==null?void 0:s.name)==="NotSupportedError")return;const c=()=>{n.play().catch(()=>{}),window.removeEventListener("click",c),window.removeEventListener("keydown",c),window.removeEventListener("touchstart",c)};window.addEventListener("click",c,{once:!0}),window.addEventListener("keydown",c,{once:!0}),window.addEventListener("touchstart",c,{passive:!0,once:!0})}})()},[]),e.jsx("video",{ref:t,src:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmRBfX17cD0J+ACHcB2ITO4h2JwtsD0J+AKAA=",loop:!0,muted:!0,autoPlay:!0,playsInline:!0,width:"1",height:"1",style:{position:"fixed",bottom:0,right:0,width:"1px",height:"1px",opacity:.01,pointerEvents:"none",zIndex:0},"aria-hidden":"true"})},ds=["Lun","Mar","MiÃ©","Jue","Vie","SÃ¡b","Dom"],H=1440*60*1e3,ms=["DOMINGO","LUNES","MARTES","MIÃ‰RCOLES","JUEVES","VIERNES","SÃBADO"];function ae(t){const n=t.getFullYear(),r=`${t.getMonth()+1}`.padStart(2,"0"),s=`${t.getDate()}`.padStart(2,"0");return`${n}-${r}-${s}`}function us(t){const n=new Date,r=new Date(n.getFullYear(),n.getMonth(),1),s=(r.getDay()+6)%7,c=new Date(r.getTime()-s*H),l=new Date(c.getTime()+42*H-1),d=c.toISOString(),i=l.toISOString(),o=c.getTime(),m=l.getTime(),x={},f={},p=[...t].sort((u,v)=>new Date(u.start_time).getTime()-new Date(v.start_time).getTime());return p.forEach(u=>{const v=new Date(u.start_time).getTime(),S=new Date(u.end_time).getTime();if(!Number.isFinite(v)||!Number.isFinite(S))return;const J=Math.max(v,o),k=Math.min(S,m);if(k<J)return;const B=ae(new Date(u.start_time));f[u.id]=B;let D=new Date(J);D.setHours(0,0,0,0);const C=new Date(k);for(C.setHours(0,0,0,0);D.getTime()<=C.getTime();){const q=ae(D);(x[q]??(x[q]=[])).push(u),D=new Date(D.getTime()+H)}}),{jobs:p,jobsByDate:x,jobDateLookup:f,range:{start:d,end:i},focusMonth:n.getMonth(),focusYear:n.getFullYear()}}function jt(t,n,r=!0){const s=new Date,c=n?new Set(n):new Set,l=new Date(s.getFullYear(),s.getMonth(),1),d=(l.getDay()+6)%7,i=new Date(l.getTime()-d*H);new Date(i.getTime()+41*H);const o=42,m=ae(s),x=(t==null?void 0:t.jobsByDate)??{},f=new Map;t&&c.forEach(k=>{const B=t.jobDateLookup[k];if(!B)return;const D=f.get(B)??new Set;D.add(k),f.set(B,D)});const u=new Intl.DateTimeFormat(void 0,{month:"long",year:"numeric"}).format(l),v=s.getMonth(),S=s.getFullYear(),J=Array.from({length:o},(k,B)=>{const D=new Date(i.getTime()+B*H),C=ae(D),q=x[C]??[],F=f.get(C)??new Set;return{date:D,isoKey:C,inMonth:D.getMonth()===v&&D.getFullYear()===S,isToday:C===m,jobs:q,hasHighlight:F.size>0,highlightJobIds:new Set(F)}});return{dayNames:ds,monthLabel:u,cells:J}}const Te=["overview","crew","logistics","pending","calendar"],ge=[...Te],Z={overview:12,crew:12,logistics:12,pending:12,calendar:12},He=12,Se=300,Ee=20;function ps(t){if(!Array.isArray(t))return[...ge];const n=new Set,r=[];for(const s of t){const c=typeof s=="string"?s.toLowerCase():"";Te.includes(c)&&!n.has(c)&&(r.push(c),n.add(c))}return r.length?(Te.forEach(s=>{n.has(s)||(r.push(s),n.add(s))}),r):[...ge]}function Ne(t,n,r=1,s=600){const c=Number(t);if(!Number.isFinite(c))return n;const l=Math.min(Math.max(c,r),s);return Math.round(l)}function gs({effectiveSlug:t,isApiMode:n,isProduccionPreset:r,wallboardApiToken:s,setPanelOrder:c,setPanelDurations:l,setRotationFallbackSeconds:d,setHighlightTtlMs:i,setTickerIntervalMs:o,setPresetMessage:m,setHighlightJobs:x,setIdx:f}){h.useEffect(()=>{let p=!1;return m(null),(async()=>{let v=null,S=null;if(n){if(t==="produccion"){c(["calendar"]),l({overview:12,crew:12,logistics:12,pending:12,calendar:600}),d(600),i(300*1e3),o(20*1e3),m(null),x(new Map),f(0);return}if(t==="almacen"){c(["logistics","overview","calendar"]),l({overview:15,crew:12,logistics:15,pending:12,calendar:30}),d(15),i(300*1e3),o(20*1e3),m(null),x(new Map),f(0);return}if(t==="oficinas"){c(["overview","crew","logistics","pending","calendar"]),l({overview:15,crew:15,logistics:15,pending:10,calendar:30}),d(15),i(300*1e3),o(20*1e3),m(null),x(new Map),f(0);return}}if(n)try{v=(await new Ue(s).presetConfig()).config}catch(F){S=F}else{const F=await T.from("wallboard_presets").select("panel_order, panel_durations, rotation_fallback_seconds, highlight_ttl_seconds, ticker_poll_interval_seconds").eq("slug",t).maybeSingle();v=F.data,S=F.error}if(p)return;if(S||!v){r?(c(["calendar"]),l({overview:Z.overview,crew:Z.crew,logistics:Z.logistics,pending:Z.pending,calendar:30}),d(30),i(Se*1e3),o(Ee*1e3),m("Wallboard de producciÃ³n: solo calendario (configurable en Presets)."),x(new Map),f(0)):(c([...ge]),l({...Z}),d(He),i(Se*1e3),o(Ee*1e3),m(`Using default wallboard preset${t!=="default"?` (missing "${t}")`:""}.`),x(new Map),f(0));return}const J=Ne(v.rotation_fallback_seconds,He),k=Ne(v.highlight_ttl_seconds,Se,30,3600),B=Ne(v.ticker_poll_interval_seconds,Ee,10,600),D=ps(v.panel_order),C=v.panel_durations??{},q={...Z};Te.forEach(F=>{q[F]=Ne(C[F],J)}),c(D),l(q),d(J),i(k*1e3),o(B*1e3),m(null),x(new Map),f(0)})(),()=>{p=!0}},[t,n,r,s])}const hs=({messages:t,bottomOffset:n=0,theme:r="light",onMeasureHeight:s})=>{const[c,l]=h.useState(0),d=h.useRef(null),i=h.useRef(null),o=64,m=(t||[]).map(p=>`${p.level}:${p.message}`).join("|"),x=t.length>0,f=p=>e.jsx("span",{ref:p==null?void 0:p.ref,className:"inline-flex items-center text-30",style:p!=null&&p.paddingLeft?{paddingLeft:p.paddingLeft}:void 0,children:t.map((u,v)=>e.jsxs(Zt.Fragment,{children:[e.jsx("span",{className:`px-2 whitespace-nowrap ${ts[u.level].text}`,children:u.message}),v<t.length-1&&e.jsx("span",{className:`px-6 ${r==="light"?"text-zinc-400":"text-zinc-500"}`,children:"â€¢"})]},`${v}-${u.message}`))});return h.useEffect(()=>{var u;const p=((u=d.current)==null?void 0:u.offsetWidth)||0;l(p)},[m]),h.useEffect(()=>{var u;const p=((u=d.current)==null?void 0:u.offsetWidth)||0;l(p)},[]),h.useEffect(()=>{if(!x)return;let p=0,u=performance.now();const v=50,S=J=>{const k=(J-u)/1e3;u=J,l(B=>{var q;const D=(((q=i.current)==null?void 0:q.offsetWidth)||0)+o;if(D<=0)return B;let C=B-v*k;for(;C<=-D;)C+=D;return C}),p=requestAnimationFrame(S)};return p=requestAnimationFrame(S),()=>cancelAnimationFrame(p)},[m,x]),h.useEffect(()=>{const p=d.current;if(!p||!s)return;const u=()=>s(p.offsetHeight);u();const v=new ResizeObserver(u);return v.observe(p),window.addEventListener("resize",u),()=>{v.disconnect(),window.removeEventListener("resize",u)}},[s]),e.jsx("div",{ref:d,className:`fixed bottom-0 left-0 right-0 border-t py-2 text-xl overflow-hidden ${r==="light"?"bg-zinc-100/95 border-zinc-200":"bg-zinc-900/95 border-zinc-800"}`,style:{bottom:n},children:x?e.jsxs("div",{className:"whitespace-nowrap will-change-transform",style:{transform:`translateX(${c}px)`},children:[f({ref:p=>{i.current=p}}),f({paddingLeft:o})]}):e.jsx("div",{children:"â€”"})})},xs=({onToggle:t,onMeasure:n,theme:r="light"})=>{const{data:s}=T.storage.from("public logos").getPublicUrl("sectorpro.png"),c=s==null?void 0:s.publicUrl,l=["/sector pro logo.png","/icon.png"],[d,i]=h.useState(0),o=c?[c,...l]:l,m=o[Math.min(d,o.length-1)],x=h.useRef(null);return h.useEffect(()=>{const f=x.current;if(!f)return;const p=()=>n&&n(f.offsetHeight);p();const u=new ResizeObserver(p);return u.observe(f),window.addEventListener("resize",p),()=>{u.disconnect(),window.removeEventListener("resize",p)}},[n]),e.jsx("div",{ref:x,className:`fixed bottom-0 left-0 right-0 py-3 border-t flex items-center justify-center z-50 ${r==="light"?"bg-white/70 border-zinc-200":"bg-black/70 border-zinc-800"}`,children:e.jsx("img",{src:m,alt:"Logo de la Empresa",width:192,height:48,loading:"lazy",decoding:"async",className:"h-12 w-48 object-contain opacity-90 cursor-pointer select-none",onError:()=>i(f=>f+1),onClick:()=>t&&t()})})},fs=1440*60*1e3;function bs(t){switch(t){case"approved":return"aprobado";case"submitted":return"enviado";case"draft":return"borrador";case"missing":return"faltante";case"rejected":return"rechazado";default:return t}}function ke(t){switch((t||"").toLowerCase()){case"single":return"Evento Ãºnico";case"tour":return"Gira";case"tourdate":return"Fecha de gira";case"festival":return"Festival";case"dryhire":return"Dry hire";default:return null}}function ze(t,n){if(!t||!n)return null;const r=new Date(t),s=new Date(n);return Number.isNaN(r.getTime())||Number.isNaN(s.getTime())?null:r.getFullYear()===s.getFullYear()&&r.getMonth()===s.getMonth()&&r.getDate()===s.getDate()?"1 dÃ­a":`${Math.max(1,Math.round((s.getTime()-r.getTime())/fs)+1)} dÃ­as`}function re(t,n="light"){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t)){let r=t.replace("#","");r.length===3&&(r=r.split("").map(i=>i+i).join(""));const s=parseInt(r.slice(0,2),16),c=parseInt(r.slice(2,4),16),l=parseInt(r.slice(4,6),16);return`rgba(${s}, ${c}, ${l}, ${n==="light"?.35:.55})`}return n==="light"?"#f4f4f5":"#020617"}function Ae(t,n){if(!(String(t.job_type||"").toLowerCase()==="tourdate"))return null;const s=new Date(t.start_time),c=new Date(t.end_time);if(Number.isNaN(s.getTime())||Number.isNaN(c.getTime()))return null;if(!(s.toDateString()===c.toDateString()))return"travel";const d=(c.getTime()-s.getTime())/36e5;return d>=6?"show":d>=3?"rehearsal":"setup"}function $e(t){if(!t)return null;switch(t){case"travel":return e.jsx(is,{className:"w-4 h-4"});case"setup":return e.jsx(rs,{className:"w-4 h-4"});case"show":return e.jsx(as,{className:"w-4 h-4"});case"off":return e.jsx(ns,{className:"w-4 h-4"});case"rehearsal":return e.jsx(ss,{className:"w-4 h-4"});default:return null}}function ws(t,n,r){const s=(t||"").toLowerCase(),l=(n||"").toLowerCase()==="unload";let d="ðŸšš";s==="rv"?d="ðŸ•ï¸":s==="furgoneta"||s==="van"?d="ðŸš":s==="plane"||s==="avion"?d="âœˆï¸":s==="train"?d="ðŸš†":(s==="trailer"||s==="9m"||s==="8m"||s==="6m"||s==="4m")&&(d="ðŸš›");const i=l;return e.jsx("span",{className:r,style:i?{display:"inline-block",transform:"scaleX(-1)"}:void 0,children:d})}const he=({children:t,theme:n="light"})=>e.jsx("div",{className:`w-full p-6 space-y-4 ${n==="light"?"bg-white text-zinc-900":"bg-black text-white"}`,children:t}),St=({color:t})=>e.jsx("span",{className:`inline-block w-3 h-3 rounded-full mr-2 ${t==="green"?"bg-green-500":t==="yellow"?"bg-yellow-400":"bg-red-500"}`}),xe=({children:t,speed:n=150,resetKey:r})=>{const s=h.useRef(null);return h.useEffect(()=>{const c=s.current;if(!c)return;c.scrollTop=0;let l=null,d=performance.now(),i=1,o=!1,m=null,x=c.scrollTop;const f=p=>{const u=(p-d)/1e3;if(d=p,u<=0||u>1){l=window.requestAnimationFrame(f);return}const v=c.scrollHeight-c.clientHeight;if(v>0&&!o){const S=(n??0)*u;let k=x+i*S;i===1&&k>=v?(k=v,o=!0,m=window.setTimeout(()=>{o=!1,i=-1},1e3)):i===-1&&k<=0&&(k=0,o=!0,m=window.setTimeout(()=>{o=!1,i=1},1e3)),x=k,c.scrollTop=x}l=window.requestAnimationFrame(f)};return l=window.requestAnimationFrame(f),()=>{l!==null&&window.cancelAnimationFrame(l),m!==null&&window.clearTimeout(m)}},[n,r]),e.jsx("div",{ref:s,className:"h-full overflow-y-auto scrollbar-hide",style:{scrollBehavior:"auto"},children:t})},je=3,vs=5e3,_s=({jobs:t,highlightSet:n,theme:r,cellKey:s,cellDate:c})=>{const[l,d]=h.useState(0);h.useEffect(()=>{if(d(0),t.length<=je)return;let m=!1;const x=window.setInterval(()=>{m||d(f=>{if(t.length<=je)return 0;const p=f+je;return p>=t.length?0:p})},vs);return()=>{m=!0,window.clearInterval(x)}},[s,t]);const i=Math.min(t.length,l+je),o=t.slice(l,i);return e.jsxs("div",{className:"flex-1 space-y-1 overflow-hidden",children:[o.map(m=>{const x=n.has(m.id),f=new Date(m.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),p=$e(Ae({id:m.id,job_type:m.job_type,start_time:m.start_time,end_time:m.end_time}));return e.jsxs("div",{className:`flex items-center gap-1.5 rounded px-2 py-1 text-xs border ${x?"border-amber-400":r==="light"?"border-zinc-200":"border-zinc-700"}`,style:{backgroundColor:re(m.color,r)},children:[e.jsx(St,{color:m.status}),e.jsxs("div",{className:"flex-1 truncate",children:[e.jsx("div",{className:"font-semibold truncate text-sm",children:m.title}),e.jsxs("div",{className:`text-xs flex gap-2 ${r==="light"?"text-zinc-500":"text-zinc-400"}`,children:[e.jsx("span",{className:"tabular-nums",children:f}),m.departments.length>0&&e.jsx("span",{className:"uppercase",children:m.departments.join("/")})]})]}),p&&e.jsx("div",{className:`w-5 h-5 rounded-md flex items-center justify-center ${r==="light"?"bg-white/70 text-zinc-700":"bg-black/40 text-zinc-100"}`,children:p})]},m.id)}),t.length>i&&e.jsxs("div",{className:`text-xs text-center ${r==="light"?"text-zinc-500":"text-zinc-400"}`,children:["+",t.length-i," mÃ¡s"]})]})},ys=({data:t,highlightIds:n,theme:r="light",scrollSpeed:s=50})=>{const{dayNames:c,monthLabel:l,cells:d}=jt(t,n,!0),i=t?`${t.range.start}-${t.range.end}-${t.jobs.length}`:"no-data";return e.jsx(xe,{speed:s,resetKey:i,children:e.jsxs(he,{theme:r,children:[e.jsxs("div",{className:`sticky top-0 z-10 pb-2 ${r==="light"?"bg-white":"bg-black"}`,children:[e.jsxs("div",{className:"flex items-end justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-5xl font-semibold leading-tight",children:"Calendario de Trabajos"}),e.jsx("div",{className:`text-38 uppercase tracking-[0.35em] mt-2 ${r==="light"?"text-zinc-500":"text-zinc-400"}`,children:l})]}),e.jsx("div",{className:`text-right text-2xl max-w-[28rem] leading-snug ${r==="light"?"text-zinc-400":"text-zinc-500"}`,children:"Vista del mes actual con visualizaciÃ³n compacta de trabajos"})]}),e.jsx("div",{className:`grid grid-cols-7 gap-2 uppercase tracking-[0.35em] text-xl font-semibold pt-2 ${r==="light"?"text-zinc-400":"text-zinc-500"}`,children:c.map(o=>e.jsx("div",{className:"text-center",children:o},o))})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2",style:{gridAutoRows:"minmax(12rem, auto)"},children:d.map((o,m)=>{const x=o.jobs,f=o.highlightJobIds,p=["rounded-lg border p-3 flex flex-col gap-2 shadow-inner transition-all duration-300",r==="light"?o.inMonth?"bg-white border-zinc-200 text-zinc-900":"bg-zinc-50 border-zinc-100 text-zinc-400":o.inMonth?"bg-zinc-950/90 border-zinc-800 text-white":"bg-zinc-900/40 border-zinc-800/40 text-zinc-500",o.isToday?"border-blue-400/80 ring-2 ring-blue-400/30 shadow-[0_0_45px_rgba(96,165,250,0.35)]":"",o.hasHighlight?"border-amber-400/80 ring-4 ring-amber-400/30 shadow-[0_0_55px_rgba(251,191,36,0.35)]":""].filter(Boolean).join(" ");return e.jsxs("div",{className:p,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:`text-38 font-bold leading-none ${o.inMonth?"":r==="light"?"text-zinc-300":"text-zinc-600"}`,children:o.date.getDate()}),x.length>0&&e.jsx("div",{className:"px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-600 text-lg font-semibold tabular-nums",children:x.length})]}),e.jsx(_s,{jobs:x,highlightSet:f,theme:r,cellKey:o.isoKey,cellDate:o.date})]},o.isoKey+m)})})]})})},Ns=({data:t,page:n=0,pageSize:r=4,theme:s="light"})=>{const c=(t==null?void 0:t.jobs)??[],l=c.slice(n*r,(n+1)*r),d=Math.ceil(c.length/r);return e.jsx(xe,{speed:50,resetKey:n,children:e.jsxs(he,{theme:s,children:[e.jsx("div",{className:`sticky top-0 z-10 pb-4 ${s==="light"?"bg-white":"bg-black"}`,children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-5xl font-semibold",children:"Asignaciones de Equipo"}),d>1&&e.jsxs("div",{className:`text-38 ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:["PÃ¡gina ",n+1," de ",d]})]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[l.map(i=>e.jsxs("div",{className:`rounded-lg p-4 border ${s==="light"?"border-zinc-200":"border-zinc-800"}`,style:{backgroundColor:re(i.color,s)},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-38 font-medium",children:i.title}),$e(Ae({id:i.id,job_type:i.jobType,start_time:i.start_time||"",end_time:i.end_time||""},new Date(i.start_time||"")))&&e.jsx("div",{className:`w-6 h-6 rounded-md flex items-center justify-center ${s==="light"?"bg-white/80 text-zinc-700":"bg-black/40 text-zinc-100"}`,children:$e(Ae({id:i.id,job_type:i.jobType,start_time:i.start_time||"",end_time:i.end_time||""},new Date(i.start_time||"")))})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-xs",children:[ke(i.jobType||i.job_type)&&e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${s==="light"?"bg-blue-50 text-blue-700 border-blue-200":"bg-blue-900/40 text-blue-200 border-blue-700/60"}`,children:ke(i.jobType||i.job_type)}),ze(i.start_time,i.end_time)&&e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${s==="light"?"bg-zinc-50 text-zinc-700 border-zinc-300":"bg-zinc-900/40 text-zinc-200 border-zinc-700/60"}`,children:ze(i.start_time,i.end_time)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:[i.crew.map((o,m)=>e.jsxs("div",{className:`flex items-center justify-between rounded-md px-3 py-2 ${s==="light"?"bg-zinc-100":"bg-zinc-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 truncate",children:[e.jsx("span",{className:"text-38",children:o.dept==="sound"?"ðŸŽ§":o.dept==="lights"?"ðŸ’¡":o.dept==="video"?"ðŸ“¹":"ðŸ‘¤"}),e.jsxs("div",{className:"truncate",children:[e.jsx("div",{className:"text-32 truncate",children:o.name||"â€”"}),e.jsx("div",{className:`text-xl truncate ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:o.role})]})]}),String(i.jobType||i.job_type||"").toLowerCase()!=="tourdate"&&e.jsx("div",{className:`px-2 py-1 rounded text-xl ${o.timesheetStatus==="approved"?"bg-green-600":o.timesheetStatus==="submitted"?"bg-blue-600":o.timesheetStatus==="draft"?"bg-amber-600":"bg-red-600"} text-white`,children:bs(o.timesheetStatus)})]},m)),i.crew.length===0&&e.jsx("div",{className:`text-30 ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:"AÃºn no hay equipo asignado"})]})]},i.id)),c.length===0&&e.jsx("div",{className:`text-38 ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:"No hay trabajos para mostrar"})]})]})})},js=({data:t,highlightIds:n,page:r=0,pageSize:s=6,theme:c="light"})=>{const l=(t==null?void 0:t.jobs)??[],d=l.slice(r*s,(r+1)*s),i=Math.ceil(l.length/s);return e.jsx(xe,{speed:50,resetKey:r,children:e.jsxs(he,{theme:c,children:[e.jsx("div",{className:`sticky top-0 z-10 pb-4 ${c==="light"?"bg-white":"bg-black"}`,children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-5xl font-semibold",children:"Trabajos â€“ PrÃ³ximos dÃ­as"}),i>1&&e.jsxs("div",{className:`text-38 ${c==="light"?"text-zinc-500":"text-zinc-400"}`,children:["PÃ¡gina ",r+1," de ",i]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[d.map(o=>{var p;const m=o.jobType||o.job_type||"",x=String(m).toLowerCase(),f=$e(Ae({id:o.id,job_type:x,start_time:o.start_time,end_time:o.end_time},new Date(o.start_time)));return e.jsxs("div",{className:`rounded-lg p-4 border shadow-sm ${n!=null&&n.has(o.id)?c==="light"?"border-amber-500 ring-4 ring-amber-400/40 animate-pulse":"border-amber-400 ring-4 ring-amber-400/40 animate-pulse":c==="light"?"border-zinc-200":"border-zinc-800"}`,style:{backgroundColor:re(o.color,c)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-38 font-medium truncate pr-2",children:o.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{color:o.status}),f&&e.jsx("div",{className:`w-6 h-6 rounded-md flex items-center justify-center ${c==="light"?"bg-white/80 text-zinc-700":"bg-black/40 text-zinc-100"}`,children:f})]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-xs",children:[ke(m)&&e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${c==="light"?"bg-white/70 text-blue-800 border-blue-200":"bg-black/40 text-blue-200 border-blue-700/60"}`,children:ke(m)}),ze(o.start_time,o.end_time)&&e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${c==="light"?"bg-white/70 text-zinc-800 border-zinc-300":"bg-black/40 text-zinc-200 border-zinc-700/60"}`,children:ze(o.start_time,o.end_time)})]}),e.jsx("div",{className:`text-30 mt-1 ${c==="light"?"text-zinc-600":"text-zinc-300"}`,children:((p=o.location)==null?void 0:p.name)??"â€”"}),e.jsxs("div",{className:`mt-2 text-32 ${c==="light"?"text-zinc-500":"text-zinc-400"}`,children:[new Date(o.start_time).toLocaleString()," â†’"," ",new Date(o.start_time).toDateString()===new Date(o.end_time).toDateString()?new Date(o.end_time).toLocaleTimeString():new Date(o.end_time).toLocaleString()]}),e.jsx("div",{className:"mt-3 flex gap-6 text-30",children:o.departments.map(u=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-38",children:u==="sound"?"ðŸŽ§":u==="lights"?"ðŸ’¡":"ðŸ“¹"}),e.jsxs("span",{className:"tabular-nums",children:[o.crewAssigned[u]||0,"/",o.crewNeeded[u]??0]})]},u))}),e.jsxs("div",{className:`mt-2 text-2xl ${c==="light"?"text-zinc-400":"text-zinc-500"}`,children:["Docs: ",o.departments.map(u=>{var v,S;return`${u[0].toUpperCase()}${u.slice(1)} ${((v=o.docs[u])==null?void 0:v.have)??0}/${((S=o.docs[u])==null?void 0:S.need)??0}`}).join(" â€¢ ")]})]},o.id)}),l.length===0&&e.jsx("div",{className:`text-38 ${c==="light"?"text-zinc-500":"text-zinc-400"}`,children:"No hay trabajos en los prÃ³ximos 7 dÃ­as"})]})]})})},Ss=({data:t,page:n=0,pageSize:r=6,theme:s="light"})=>{const c=t??[],l=c.slice(n*r,(n+1)*r),d=Math.ceil(c.length/r);return e.jsx(xe,{speed:75,children:e.jsxs(he,{theme:s,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-5xl font-semibold",children:"LogÃ­stica â€“ PrÃ³ximos dÃ­as"}),d>1&&e.jsxs("div",{className:`text-38 ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:["PÃ¡gina ",n+1," de ",d]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[l.map(i=>{var o;return e.jsxs("div",{className:`border rounded p-3 flex items-center justify-between ${s==="light"?"border-zinc-200":"border-zinc-800"}`,style:{backgroundColor:re(i.color||void 0,s)},children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`text-32 tabular-nums ${s==="light"?"text-zinc-700":"text-zinc-200"}`,children:[i.date," ",(o=i.time)==null?void 0:o.slice(0,5)]}),e.jsx("div",{className:`text-2xl font-semibold ${s==="light"?"text-zinc-700":"text-zinc-100"}`,children:ms[new Date(i.date).getDay()]})]}),ws(i.transport_type,i.procedure,"text-38"),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-38 font-medium",children:i.title}),e.jsxs("div",{className:`mt-1 flex flex-wrap items-center gap-2 text-2xl ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:[i.procedure?e.jsx("span",{className:`px-2 py-0.5 rounded capitalize ${s==="light"?"bg-zinc-200 text-zinc-700":"bg-zinc-800 text-zinc-200"}`,children:i.procedure.replace(/_/g," ")}):null,e.jsx("span",{className:s==="light"?"text-zinc-600":"text-zinc-300",children:i.transport_type||"transport"}),i.transport_provider&&U[i.transport_provider]&&e.jsx("span",{className:s==="light"?"text-zinc-600":"text-zinc-300",children:U[i.transport_provider].label}),i.loadingBay&&e.jsxs("span",{className:s==="light"?"text-zinc-600":"text-zinc-300",children:["Bay ",i.loadingBay]}),i.plate&&e.jsxs("span",{className:s==="light"?"text-zinc-400":"text-zinc-500",children:["Plate ",i.plate]})]}),i.departments.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:i.departments.map(m=>e.jsx("span",{className:`px-2 py-0.5 rounded text-lg uppercase tracking-wide ${s==="light"?"bg-zinc-200 text-zinc-700":"bg-zinc-800 text-zinc-200"}`,children:m},m))}),i.notes&&e.jsx("div",{className:"text-sm opacity-80 line-clamp-1 mt-1",children:i.notes})]})]}),i.transport_provider&&U[i.transport_provider]&&U[i.transport_provider].icon&&e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsx("img",{src:U[i.transport_provider].icon,alt:U[i.transport_provider].label,width:192,height:192,loading:"lazy",decoding:"async",className:"w-48 h-48 object-contain",onError:m=>{m.currentTarget.style.display="none"}})})]},i.id)}),c.length===0&&e.jsx("div",{className:`text-38 ${s==="light"?"text-zinc-500":"text-zinc-400"}`,children:"No hay logÃ­stica en los prÃ³ximos 7 dÃ­as"})]})]})})},Es=({data:t,theme:n="light"})=>{const r=((t==null?void 0:t.items)??[]).map(s=>`${s.severity}:${s.text}`).join("|");return e.jsx(xe,{speed:50,resetKey:r,children:e.jsxs(he,{theme:n,children:[e.jsx("div",{className:`sticky top-0 z-10 pb-4 ${n==="light"?"bg-white":"bg-black"}`,children:e.jsx("h1",{className:"text-5xl font-semibold",children:"Acciones Pendientes"})}),e.jsxs("div",{className:"flex flex-col gap-3 text-38",children:[((t==null?void 0:t.items)??[]).map((s,c)=>e.jsx("div",{className:`rounded-md px-4 py-3 border ${s.severity==="red"?"border-red-500/60":"border-amber-500/60"}`,style:{backgroundColor:s.severity==="red"?re("#ef4444",n):re("#f59e0b",n)},children:s.text},c)),((t==null?void 0:t.items.length)??0)===0&&e.jsx("div",{className:n==="light"?"text-zinc-500":"text-zinc-400",children:"Todo bien âœ…"})]})]})})},ie=({title:t,kind:n="standard",children:r})=>{const s=n==="critical"?"bg-red-400":n==="env"?"bg-blue-400":n==="tracker"?"bg-green-400":"bg-amber-400";return e.jsxs("div",{className:"bg-black border border-amber-400 h-full overflow-hidden font-mono",children:[e.jsx("div",{className:`${s} text-black px-3 py-1 text-sm font-bold tracking-wider uppercase`,children:t}),e.jsx("div",{className:"p-3 text-amber-300 text-xs overflow-auto",children:r})]})},Ds=({data:t,highlightIds:n})=>{const{dayNames:r,monthLabel:s,cells:c}=jt(t,n);return e.jsx(ie,{title:`VENTANA DE CALENDARIO â€“ ${s.toUpperCase()}`,kind:"tracker",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 text-[10px] uppercase tracking-[0.35em] text-amber-300",children:r.map(l=>e.jsx("div",{className:"text-center",children:l},l))}),e.jsx("div",{className:"grid grid-cols-7 gap-2 auto-rows-fr",children:c.map((l,d)=>{const i=l.jobs,o=l.highlightJobIds,m=["border border-[var(--alien-border-dim)] bg-black/70 p-3 flex flex-col gap-2 min-h-[12rem] transition-all duration-300",l.inMonth?"text-amber-200":"text-amber-400/50",l.isToday?"border-blue-400 text-blue-200 shadow-[0_0_35px_rgba(96,165,250,0.35)]":"",l.hasHighlight?"bg-amber-400/25 border-amber-300 text-black shadow-[0_0_40px_rgba(251,191,36,0.45)]":""].filter(Boolean).join(" ");return e.jsxs("div",{className:m,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xl font-bold tabular-nums",children:l.date.getDate().toString().padStart(2,"0")}),i.length>0&&e.jsxs("div",{className:"text-[10px] uppercase tracking-[0.4em] text-amber-300",children:[i.length," evt"]})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[i.slice(0,4).map(x=>{var v;const f=o.has(x.id),p=new Date(x.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=f?"px-2 py-1 bg-amber-300 text-black font-bold uppercase tracking-[0.2em]":"px-2 py-1 border border-[var(--alien-border-dim)] text-amber-200 uppercase tracking-[0.2em]";return e.jsxs("div",{className:u,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-[11px]",children:[e.jsx("span",{className:"tabular-nums",children:p}),e.jsx("span",{className:"text-[9px] text-amber-400/80",children:x.departments.join("/")})]}),e.jsx("div",{className:"text-[11px] truncate",children:x.title}),((v=x.location)==null?void 0:v.name)&&e.jsx("div",{className:"text-[9px] text-amber-400/70 truncate",children:x.location.name})]},x.id)}),i.length>4&&e.jsxs("div",{className:"text-[10px] uppercase tracking-[0.4em] text-amber-300",children:["+",i.length-4," MÃS"]}),i.length===0&&e.jsx("div",{className:"text-[11px] text-amber-500/40 uppercase tracking-[0.4em]",children:"â€”"})]})]},l.isoKey+d)})})]})})},Ts=({data:t,highlightIds:n})=>e.jsxs("div",{className:"p-2 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2 min-h-[calc(100vh-120px)]",children:[((t==null?void 0:t.jobs)??[]).map(r=>{var s;return e.jsx(ie,{title:"RESUMEN DE TRABAJOS - OPERACIONES",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:`flex justify-between items-center ${n!=null&&n.has(r.id)?"animate-pulse":""}`,children:[e.jsx("div",{className:`text-amber-100 text-sm font-bold uppercase tracking-wider ${n!=null&&n.has(r.id)?"bg-amber-400 text-black px-1":""}`,children:r.title}),e.jsx("div",{className:`w-2 h-2 ${r.status==="green"?"bg-green-400 animate-pulse":r.status==="yellow"?"bg-yellow-400":"bg-red-400"}`})]}),e.jsx("div",{className:"text-amber-300 text-xs",children:((s=r.location)==null?void 0:s.name)??"â€”"}),e.jsxs("div",{className:"text-amber-200 text-xs tabular-nums",children:[new Date(r.start_time).toLocaleString()," â†’ ",new Date(r.end_time).toLocaleTimeString()]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2",children:r.departments.map(c=>{var l,d;return e.jsxs("div",{className:"border border-[var(--alien-border-dim)] p-2",children:[e.jsx("div",{className:"uppercase text-amber-300 text-[10px]",children:c}),e.jsxs("div",{className:"text-amber-100 text-xs tabular-nums",children:[r.crewAssigned[c]||0," equipo"]}),e.jsxs("div",{className:"text-amber-200 text-[10px]",children:["docs ",((l=r.docs[c])==null?void 0:l.have)??0,"/",((d=r.docs[c])==null?void 0:d.need)??0]})]},c)})})]})},r.id)}),(!t||t.jobs.length===0)&&e.jsx(ie,{title:"RESUMEN DE TRABAJOS - OPERACIONES",children:e.jsx("div",{className:"text-amber-300",children:"NO HAY TRABAJOS EN VENTANA"})})]}),ks=({data:t})=>e.jsx(ie,{title:"ESTADO DEL EQUIPO - MONITOR BIOSIGN",kind:"tracker",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2",children:[((t==null?void 0:t.jobs)??[]).map(n=>e.jsxs("div",{className:"border border-[var(--alien-border-dim)] p-2",children:[e.jsx("div",{className:"uppercase text-amber-100 text-xs font-bold tracking-wider mb-1",children:n.title}),e.jsxs("div",{className:"space-y-1",children:[n.crew.map((r,s)=>e.jsxs("div",{className:"flex items-center justify-between text-amber-200 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 ${r.timesheetStatus==="approved"?"bg-green-400 animate-pulse":r.timesheetStatus==="submitted"?"bg-blue-400":r.timesheetStatus==="draft"?"bg-yellow-400":"bg-red-400"}`}),e.jsxs("span",{className:"truncate",children:[r.name||"â€”"," (",r.dept||"â€”",")"]})]}),e.jsx("div",{className:"uppercase text-amber-300 text-[10px]",children:r.role})]},s)),n.crew.length===0&&e.jsx("div",{className:"text-amber-300 text-xs",children:"NO HAY EQUIPO ASIGNADO"})]})]},n.id)),(!t||t.jobs.length===0)&&e.jsx("div",{className:"text-amber-300",children:"NO HAY TRABAJOS"})]})}),zs=({data:t})=>e.jsx(ie,{title:"ALERTAS DEL SISTEMA - PROTOCOLO DE EMERGENCIA",kind:"critical",children:e.jsxs("div",{className:"space-y-2",children:[((t==null?void 0:t.items)??[]).map((n,r)=>e.jsx("div",{className:`px-2 py-1 text-xs font-mono ${n.severity==="red"?"bg-red-600 text-white":"bg-yellow-600 text-black"}`,children:n.text},r)),((t==null?void 0:t.items.length)??0)===0&&e.jsx("div",{className:"text-amber-300",children:"TODOS LOS SISTEMAS NOMINALES"})]})}),As=({data:t})=>e.jsx(ie,{title:"LOGÃSTICA - ESCANEO DE PROXIMIDAD",kind:"tracker",children:e.jsxs("div",{className:"space-y-2",children:[(t??[]).map(n=>{var r;return e.jsxs("div",{className:"border border-[var(--alien-border-dim)] p-2 flex items-center justify-between text-amber-200 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"font-mono tabular-nums",children:[n.date," ",(r=n.time)==null?void 0:r.slice(0,5)]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"uppercase text-amber-100",children:n.title}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[10px] text-amber-200 mt-1",children:[n.procedure?e.jsx("span",{className:"border border-[var(--alien-border-dim)] px-1 py-0.5 uppercase",children:n.procedure.replace(/_/g," ")}):null,e.jsx("span",{className:"uppercase",children:n.transport_type||"transport"}),n.loadingBay&&e.jsxs("span",{className:"uppercase",children:["Bay ",n.loadingBay]}),n.plate&&e.jsxs("span",{className:"uppercase text-amber-300",children:["Plate ",n.plate]})]}),n.departments.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-amber-300",children:n.departments.map(s=>e.jsx("span",{className:"border border-[var(--alien-border-dim)] px-1 py-0.5 uppercase tracking-wide",children:s},s))})]})]}),n.transport_provider&&U[n.transport_provider]&&U[n.transport_provider].icon&&e.jsx("div",{className:"flex-shrink-0 ml-4",children:e.jsx("img",{src:U[n.transport_provider].icon,alt:U[n.transport_provider].label,width:128,height:128,loading:"lazy",decoding:"async",className:"w-32 h-32 object-contain",onError:s=>{s.currentTarget.style.display="none"}})})]},n.id)}),(!t||t.length===0)&&e.jsx("div",{className:"text-amber-300",children:"NO HAY LOGÃSTICA EN VENTANA"})]})});function Xs({presetSlug:t,skipSplash:n=!1,wallboardApiToken:r,onFatalError:s}={}){const{presetSlug:c}=es(),l=t!==void 0?t:c,d=((l==null?void 0:l.trim())||"default").toLowerCase(),i=d==="produccion",o=!!r;cs();const[m,x]=h.useState(!n),[f,p]=h.useState(!1),[u,v]=h.useState("light"),[S,J]=h.useState([...ge]),[k,B]=h.useState({...Z}),[D,C]=h.useState(He),[q,F]=h.useState(Se*1e3),[oe,Et]=h.useState(Ee*1e3),[We,Dt]=h.useState(null),[Me,Le]=h.useState(0),[ee,Ge]=h.useState(null),[Ve,Xe]=h.useState(null),[te,Qe]=h.useState(null),[$s,Ze]=h.useState(null),[et,tt]=h.useState(null),[se,st]=h.useState(null),[Tt,kt]=h.useState([]),[fe,Oe]=h.useState(new Map),[nt,zt]=h.useState(72),[At,$t]=h.useState(32),[ce,at]=h.useState({overview:0,crew:0,logistics:0,pending:0,calendar:0});gs({effectiveSlug:d,isApiMode:o,isProduccionPreset:i,wallboardApiToken:r,setPanelOrder:J,setPanelDurations:B,setRotationFallbackSeconds:C,setHighlightTtlMs:F,setTickerIntervalMs:Et,setPresetMessage:Dt,setHighlightJobs:Oe,setIdx:Le});const be=h.useCallback(N=>{const y=/^\s*\[HIGHLIGHT_JOB:([a-f0-9\-]+)\]\s*/i,M=Date.now(),E=Math.max(1e3,q),w=[],L=[];return Oe(z=>{const I=new Map(z);(N||[]).forEach(j=>{let R=(j==null?void 0:j.message)||"";const ne=(j==null?void 0:j.level)??"info",Q=["info","warn","critical"].includes(ne)?ne:"info",de=R.match(y);if(de){const Pe=de[1],me=(j!=null&&j.created_at?new Date(j.created_at).getTime():M)+E;me>M?I.set(Pe,me):j!=null&&j.id&&w.push(j.id),R=R.replace(y,"")}R.trim()&&L.push({message:R.trim(),level:Q})});for(const[j,R]of I)R<M&&I.delete(j);return I}),kt(L),w},[q]);h.useEffect(()=>{Le(0)},[S]),h.useEffect(()=>{if(!S.length)return;const N=S,y=N[Me%N.length],M=k[y]??D,E=Math.max(1,M)*1e3,w=window.setTimeout(()=>{const z=y==="overview"?Math.ceil(((ee==null?void 0:ee.jobs.length)??0)/6):y==="crew"?Math.ceil(((te==null?void 0:te.jobs.length)??0)/4):y==="logistics"?Math.ceil(((se==null?void 0:se.length)??0)/6):1;if(N.length===1&&z<=1)return;const I=ce[y]??0;I+1<z?at(j=>({...j,[y]:I+1})):(at(j=>({...j,[y]:0})),Le(j=>{const R=N.length;return R<=0?0:(j+1)%R}))},E);return()=>clearTimeout(w)},[Me,S,k,D,ce,ee,te,se]),h.useEffect(()=>{if(o)return;let N=!1,y=!0;const M=async()=>{const z=new Date,I=new Date(z.getFullYear(),z.getMonth(),z.getDate()),j=new Date(I.getTime()+7*H-1),R=new Date(I.getFullYear(),I.getMonth(),1),ne=(R.getDay()+6)%7,Q=new Date(R.getTime()-ne*H),de=new Date(Q.getTime()+42*H-1),Pe=I.toISOString(),rt=j.toISOString(),me=Q.toISOString(),it=de.toISOString(),Lt=`[${me},${it}]`,Ot=I.getTime(),It=j.getTime(),ot=Q.getTime(),ct=de.getTime(),we=a=>{const b=new Date(a.start_time).getTime();return new Date(a.end_time).getTime()>=Ot&&b<=It},Pt=a=>{const b=new Date(a.start_time).getTime();return new Date(a.end_time).getTime()>=ot&&b<=ct},{data:Ct,error:Ms}=await T.from("jobs").select("id,title,start_time,end_time,status,location_id,job_type,tour_id,timezone,color").in("job_type",["single","festival","tourdate","dryhire","evento"]).in("status",["Confirmado","Tentativa","Completado"]).filter("time_range","ov",Lt).order("start_time",{ascending:!0});let Y=Ct||[];const lt=Array.from(new Set(Y.map(a=>a.tour_id).filter(Boolean)));if(lt.length){const{data:a,error:b}=await T.from("tours").select("id,status").in("id",lt);if(!b){if(a&&a.length){const g=new Set(a.filter(_=>_.status==="cancelled").map(_=>_.id));g.size&&(Y=Y.filter(_=>!_.tour_id||!g.has(_.tour_id)))}}}const dt=Y.map(a=>a.id),ue=new Set(Y.filter(we).map(a=>a.id)),W=Array.from(ue),pe=new Set(Y.filter(a=>a.job_type==="dryhire").map(a=>a.id)),mt=Array.from(new Set(Y.map(a=>a.location_id).filter(Boolean))),{data:Rt,error:Ls}=dt.length?await T.from("job_departments").select("job_id,department").in("job_id",dt):{data:[],error:null},ve=new Map;(Rt||[]).forEach(a=>{const b=ve.get(a.job_id)??[];b.push(a.department),ve.set(a.job_id,b)});const{data:Bt,error:Os}=W.length?await T.from("job_assignments").select("job_id,technician_id,sound_role,lights_role,video_role").in("job_id",W):{data:[],error:null},_e=new Map;(Bt||[]).forEach(a=>{const b=_e.get(a.job_id)??[];b.push(a),_e.set(a.job_id,b)});const{data:Ft,error:Is}=W.length?await T.from("job_required_roles_summary").select("job_id, department, total_required").in("job_id",W):{data:[],error:null},ut=new Map;(Ft||[]).forEach(a=>{ut.set(`${a.job_id}:${a.department}`,Number(a.total_required||0))});const{data:Jt,error:Ps}=mt.length?await T.from("locations").select("id,name").in("id",mt):{data:[],error:null},pt=new Map;(Jt||[]).forEach(a=>pt.set(a.id,a.name));const ye=new Map;if(W.length){const{data:a}=await T.from("wallboard_timesheet_status").select("job_id, technician_id, status").in("job_id",W);a==null||a.forEach(b=>{const g=ye.get(b.job_id)??new Map;g.set(b.technician_id,b.status),ye.set(b.job_id,g)})}const[{data:qt},{data:Yt}]=await Promise.all([W.length?T.from("wallboard_doc_counts").select("job_id,department,have").in("job_id",W):Promise.resolve({data:[]}),T.from("wallboard_doc_requirements").select("department,need")]),gt=new Map((Yt||[]).map(a=>[a.department,a.need])),Ce=new Map;(qt||[]).forEach(a=>Ce.set(`${a.job_id}:${a.department}`,a.have));const ht=a=>{const g=(ve.get(a.id)??[]).filter($=>$!=="video"),_={sound:0,lights:0,video:0};(ue.has(a.id)?_e.get(a.id)??[]:[]).forEach($=>{$.sound_role&&_.sound++,$.lights_role&&_.lights++,$.video_role&&_.video++});const A={sound:0,lights:0,video:0};g.forEach($=>{A[$]=ue.has(a.id)&&ut.get(`${a.id}:${$}`)||0});let P;if(ue.has(a.id))if(g.some(K=>(A[K]||0)>0)){const K=g.map(Ye=>{const X=A[Ye]||0,yt=_[Ye]||0;return X<=0||yt>=X?1:yt>0?.5:0}),V=Math.min(...K);P=V>=1?"green":V>0?"yellow":"red"}else{const K=g.map(X=>_[X]),V=K.some(X=>X>0);P=g.length>0&&K.every(X=>X>0)?"green":V?"yellow":"red"}else P=a.status==="Confirmado"?"green":"yellow";const G={};return g.forEach($=>{const K=ue.has(a.id)?Ce.get(`${a.id}:${$}`)??0:0,V=gt.get($)??0;G[$]={have:K,need:V}}),{id:a.id,title:a.title,start_time:a.start_time,end_time:a.end_time,location:{name:a.location_id?pt.get(a.location_id)??null:null},departments:g,crewAssigned:{..._,total:_.sound+_.lights+_.video},crewNeeded:{...A,total:A.sound+A.lights+A.video},docs:G,status:P,color:a.color??null,job_type:a.job_type??null}},xt=Y.filter(a=>!pe.has(a.id)).filter(Pt).map(ht).sort((a,b)=>new Date(a.start_time).getTime()-new Date(b.start_time).getTime()),Kt=Y.filter(a=>!pe.has(a.id)).filter(we).map(ht).sort((a,b)=>new Date(a.start_time).getTime()-new Date(b.start_time).getTime()),Re={},ft={};xt.forEach(a=>{const b=new Date(a.start_time).getTime(),g=new Date(a.end_time).getTime();if(!Number.isFinite(b)||!Number.isFinite(g))return;const _=ae(new Date(a.start_time));ft[a.id]=_;const O=Math.max(b,ot),A=Math.min(g,ct);if(A<O)return;let P=new Date(O);P.setHours(0,0,0,0);const G=new Date(A);for(G.setHours(0,0,0,0);P.getTime()<=G.getTime();){const $=ae(P);(Re[$]??(Re[$]=[])).push(a),P=new Date(P.getTime()+H)}});const bt={jobs:Kt},Be=new Map,Fe={jobs:Y.filter(a=>!pe.has(a.id)).filter(we).map(a=>{const b=(_e.get(a.id)??[]).filter(g=>g.video_role==null).map(g=>{const _=g.sound_role?"sound":g.lights_role?"lights":null,O=g.sound_role||g.lights_role||"assigned",A=Be.get(a.id)??[];return A.push(g.technician_id),Be.set(a.id,A),{name:"",role:O,dept:_,timesheetStatus:"missing",technician_id:g.technician_id}});return{id:a.id,title:a.title,jobType:a.job_type,start_time:a.start_time,end_time:a.end_time,color:a.color??null,crew:b}})},wt=Array.from(new Set(Fe.jobs.flatMap(a=>a.crew.map(b=>b.technician_id))));if(wt.length){const{data:a}=await T.from("wallboard_profiles").select("id,first_name,last_name,department").in("id",wt),b=new Map((a||[]).map(g=>[g.id,g]));Fe.jobs.forEach(g=>{g.crew.forEach(_=>{var $,K;const O=b.get(_.technician_id);_.name=[O==null?void 0:O.first_name,O==null?void 0:O.last_name].filter(Boolean).join(" ")||"";const A=($=ye.get(g.id))==null?void 0:$.get(_.technician_id),P=new Date(((K=Y.find(V=>V.id===g.id))==null?void 0:K.end_time)||Date.now())<new Date,G=A==="rejected"?"rejected":A;_.timesheetStatus=P&&G==="approved"?"approved":G||"missing",delete _.technician_id})})}const Ut={jobs:Y.filter(a=>!pe.has(a.id)).filter(we).map(a=>{const b=ve.get(a.id)??[];return{id:a.id,title:a.title,color:a.color??null,departments:b.map(g=>({dept:g,have:Ce.get(`${a.id}:${g}`)??0,need:gt.get(g)??0,missing:[]}))}})},Je=[];bt.jobs.forEach(a=>{if(pe.has(a.id))return;if(a.departments.filter(g=>g!=="video").forEach(g=>{const _=a.crewNeeded[g]||0,O=a.crewAssigned[g]||0;if(_>0&&O<_){const P=new Date(a.start_time).getTime()-Date.now()<=24*3600*1e3;Je.push({severity:P?"red":"yellow",text:`${a.title} â€“ ${_-O} open ${g} slot(s)`})}}),new Date(a.end_time).getTime()<Date.now()-24*3600*1e3){const g=ye.get(a.id)??new Map,O=(Be.get(a.id)??[]).filter(A=>{const P=g.get(A);return!(P==="approved"||P==="submitted")}).length;O>0&&Je.push({severity:"red",text:`${a.title} â€“ ${O} missing timesheets`})}}),N||(Ge(bt),Xe({jobs:xt,jobsByDate:Re,jobDateLookup:ft,range:{start:me,end:it},focusMonth:I.getMonth(),focusYear:I.getFullYear()}),Qe(Fe),Ze(Ut),tt({items:Je}));const Ht=Pe.slice(0,10),Wt=rt.slice(0,10),{data:Gt,error:Cs}=await T.from("logistics_events").select("id,event_date,event_time,title,transport_type,license_plate,job_id,event_type,loading_bay,color,logistics_event_departments(department)").gte("event_date",Ht).lte("event_date",Wt).order("event_date",{ascending:!0}).order("event_time",{ascending:!0}),vt=Gt||[],_t=Array.from(new Set(vt.map(a=>a.job_id).filter(Boolean))),qe=new Map;if(_t.length){const{data:a}=await T.from("jobs").select("id,title").in("id",_t);(a||[]).forEach(b=>qe.set(b.id,b.title))}const Vt=vt.map(a=>{const b=Array.isArray(a.logistics_event_departments)?a.logistics_event_departments.map(g=>g==null?void 0:g.department).filter(Boolean):[];return{id:a.id,date:a.event_date,time:a.event_time,title:a.title||qe.get(a.job_id)||"Logistics",transport_type:a.transport_type??null,plate:a.license_plate??null,job_title:qe.get(a.job_id)||null,procedure:a.event_type??null,loadingBay:a.loading_bay??null,departments:b,color:a.color??null}}).sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));N||(st(Vt),y&&(x(!1),y=!1))};let E=null;const w=()=>{N||E||(E=window.setTimeout(()=>{E=null,M()},300))},L=T.channel("wallboard-realtime").on("postgres_changes",{event:"*",schema:"public",table:"jobs"},w).on("postgres_changes",{event:"*",schema:"public",table:"tours"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_assignments"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_departments"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_documents"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_required_roles"},w).on("postgres_changes",{event:"*",schema:"public",table:"timesheets"},w).on("postgres_changes",{event:"*",schema:"public",table:"announcements"},w).on("postgres_changes",{event:"*",schema:"public",table:"logistics_events"},w).on("postgres_changes",{event:"*",schema:"public",table:"logistics_event_departments"},w).on("postgres_changes",{event:"*",schema:"public",table:"profiles"},w).on("postgres_changes",{event:"*",schema:"public",table:"locations"},w).subscribe(z=>{});return M(),()=>{N=!0,E&&window.clearTimeout(E),T.removeChannel(L)}},[o]),h.useEffect(()=>{if(!r)return;let N=!1;const y=new Ue(r),M=async()=>{try{const[z,I,j,R,ne,Q]=await Promise.all([y.jobsOverview(),y.crewAssignments(),y.docProgress(),y.pendingActions(),y.logistics(),y.calendar()]);if(N)return;Ge(z),Xe(us(Q.jobs)),Qe(I),Ze(j),tt(R),st(ne.items),x(!1)}catch(z){if(N)return;z instanceof De&&(z.status===401||z.status===403)&&(s==null||s("Access token expired or invalid. Please request a new wallboard link."))}};M();let E=null;const w=()=>{N||E||(E=window.setTimeout(()=>{E=null,M()},300))},L=T.channel("wallboard-realtime-api").on("postgres_changes",{event:"*",schema:"public",table:"jobs"},w).on("postgres_changes",{event:"*",schema:"public",table:"tours"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_assignments"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_departments"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_documents"},w).on("postgres_changes",{event:"*",schema:"public",table:"job_required_roles"},w).on("postgres_changes",{event:"*",schema:"public",table:"timesheets"},w).on("postgres_changes",{event:"*",schema:"public",table:"announcements"},w).on("postgres_changes",{event:"*",schema:"public",table:"logistics_events"},w).on("postgres_changes",{event:"*",schema:"public",table:"logistics_event_departments"},w).on("postgres_changes",{event:"*",schema:"public",table:"profiles"},w).on("postgres_changes",{event:"*",schema:"public",table:"locations"},w).subscribe(z=>{});return()=>{N=!0,E&&window.clearTimeout(E),T.removeChannel(L)}},[r,s]),h.useEffect(()=>{if(r)return;let N=!1;const y=async()=>{const{data:w}=await T.from("announcements").select("id, message, level, active, created_at").eq("active",!0).order("created_at",{ascending:!1}).limit(20);if(N)return;const L=be(w||[]);if(L.length)try{await T.from("announcements").update({active:!1}).in("id",L)}catch{}};y();const M=Math.max(5e3,oe),E=setInterval(y,M);return()=>{N=!0,clearInterval(E)}},[oe,r,be]),h.useEffect(()=>{if(!r)return;let N=!1;const y=new Ue(r),M=async()=>{try{const{announcements:L}=await y.announcements();if(N)return;be(L||[])}catch(L){if(N)return;L instanceof De&&(L.status===401||L.status===403)&&(s==null||s("Access token expired or invalid. Please request a new wallboard link."))}};M();const E=Math.max(5e3,oe),w=window.setInterval(M,E);return()=>{N=!0,window.clearInterval(w)}},[r,oe,be,s]),h.useEffect(()=>{const N=setInterval(()=>{Oe(y=>{const M=Date.now(),E=new Map(y);let w=!1;for(const[L,z]of E)z<M&&(E.delete(L),w=!0);return w?E:y})},5e3);return()=>clearInterval(N)},[]);const Ie=S.length?S:ge,Mt=Ie.length?Me%Ie.length:0,le=Ie[Mt]??"overview";return m?e.jsx(os,{onComplete:()=>x(!1)}):e.jsxs("div",{className:`min-h-screen ${f?"bg-black text-[var(--alien-amber)] alien-scanlines alien-vignette":u==="light"?"bg-zinc-100 text-zinc-900":"bg-black text-white"}`,children:[We&&e.jsx("div",{className:"bg-amber-500/20 text-amber-200 text-sm text-center py-2",children:We}),e.jsxs("div",{className:"overflow-hidden",style:{height:`calc(100vh - ${nt+At}px)`},children:[le==="overview"&&(f?e.jsx(Ts,{data:ee,highlightIds:new Set(fe.keys())}):e.jsx(js,{data:ee,highlightIds:new Set(fe.keys()),page:ce.overview,theme:u})),le==="crew"&&(f?e.jsx(ks,{data:te}):e.jsx(Ns,{data:te,page:ce.crew,theme:u})),le==="logistics"&&(f?e.jsx(As,{data:se}):e.jsx(Ss,{data:se,page:ce.logistics,theme:u})),le==="pending"&&(f?e.jsx(zs,{data:et}):e.jsx(Es,{data:et,theme:u})),le==="calendar"&&(f?e.jsx(Ds,{data:Ve,highlightIds:new Set(fe.keys())}):e.jsx(ys,{data:Ve,highlightIds:new Set(fe.keys()),theme:u,scrollSpeed:i?20:50}))]}),e.jsx(hs,{messages:Tt,bottomOffset:nt,theme:u,onMeasureHeight:$t}),e.jsx(xs,{onToggle:()=>p(N=>!N),onMeasure:zt,theme:u}),e.jsx(ls,{})]})}export{os as S,Xs as W,Vs as e};
