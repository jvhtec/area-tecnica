var p=Object.defineProperty;var f=(d,t,e)=>t in d?p(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var g=(d,t,e)=>f(d,typeof t!="symbol"?t+"":t,e);import{E as b,a as m}from"./pdf-libs-BqoGqu1a.js";import{s as l}from"./index-NZ6jJLfQ.js";class R{constructor(){g(this,"doc");g(this,"pageWidth");g(this,"pageHeight");g(this,"footerSpace",40);this.doc=new b,this.pageWidth=this.doc.internal.pageSize.width,this.pageHeight=this.doc.internal.pageSize.height}get document(){return this.doc}get dimensions(){return{width:this.pageWidth,height:this.pageHeight,footerSpace:this.footerSpace}}addPage(){this.doc.addPage()}checkPageBreak(t,e=25){return t+e>this.pageHeight-this.footerSpace?(this.addPage(),30):t}addImage(t,e,c,s,r,a){try{this.doc.addImage(t,e,c,s,r,a)}catch{}}setText(t,e){this.doc.setFontSize(t),this.doc.setTextColor(e[0],e[1],e[2])}addText(t,e,c,s){this.doc.text(t,e,c,s)}splitText(t,e){try{return this.doc.splitTextToSize(t,e)}catch{return[t]}}addWrappedText(t,e,c,s,r=10,a="center"){const i=this.splitText(t,s);return i.forEach((o,n)=>{const h=c+n*r;this.doc.text(o,e,h,{align:a})}),i.length}addTable(t){m(this.doc,t)}setFillColor(t,e,c){this.doc.setFillColor(t,e,c)}addRect(t,e,c,s,r){this.doc.rect(t,e,c,s,r)}save(t){this.doc.save(t)}output(t){return this.doc.output(t)}outputBlob(){return this.doc.output("blob")}getLastAutoTableY(){var t;return((t=this.doc.lastAutoTable)==null?void 0:t.finalY)||0}addLink(t,e,c,s,r){try{this.doc.link(e,c,s,r,{url:t})}catch{}}}class T{static async loadJobLogo(t){try{const{data:e,error:c}=await l.from("festival_logos").select("file_path, job_id").eq("job_id",t).order("uploaded_at",{ascending:!1}).limit(1);if(e&&e.length>0&&e[0].file_path){const r=e[0].file_path;try{const{data:a,error:i}=await l.storage.from("festival-logos").download(r);if(!i&&a)return await this.blobToDataURL(a)}catch{}try{const{data:a,error:i}=await l.storage.from("festival-logos").createSignedUrl(r,60);if(!i&&(a!=null&&a.signedUrl)){const o=await fetch(a.signedUrl);if(o.ok){const n=await o.blob();return await this.blobToDataURL(n)}}}catch{}}const{data:s}=await l.from("jobs").select("tour_id").eq("id",t).maybeSingle();if(s!=null&&s.tour_id){const{data:r,error:a}=await l.from("tour_logos").select("file_path").eq("tour_id",s.tour_id).order("uploaded_at",{ascending:!1}).limit(1);if(r&&r.length>0&&r[0].file_path){const i=r[0].file_path;try{const{data:o,error:n}=await l.storage.from("tour-logos").download(i);if(!n&&o)return await this.blobToDataURL(o)}catch{}try{const{data:o,error:n}=await l.storage.from("tour-logos").createSignedUrl(i,60);if(!n&&(o!=null&&o.signedUrl)){const h=await fetch(o.signedUrl);if(h.ok){const u=await h.blob();return await this.blobToDataURL(u)}}}catch{}}}return null}catch{return null}}static async blobToDataURL(t){const e=(t.type||"").toLowerCase();return e.includes("image/png")||e.includes("image/jpeg")||e.includes("image/jpg")?new Promise((s,r)=>{const a=new FileReader;a.onload=()=>s(a.result),a.onerror=r,a.readAsDataURL(t)}):new Promise((s,r)=>{try{const a=URL.createObjectURL(t),i=new Image;i.onload=()=>{try{const o=document.createElement("canvas");o.width=i.naturalWidth||i.width,o.height=i.naturalHeight||i.height;const n=o.getContext("2d");if(!n)return URL.revokeObjectURL(a),r(new Error("Canvas not supported"));n.drawImage(i,0,0);const h=o.toDataURL("image/png");URL.revokeObjectURL(a),s(h)}catch(o){URL.revokeObjectURL(a),r(o)}},i.onerror=o=>{URL.revokeObjectURL(a),r(o)},i.src=a}catch(a){r(a)}})}}export{T as L,R as P};
