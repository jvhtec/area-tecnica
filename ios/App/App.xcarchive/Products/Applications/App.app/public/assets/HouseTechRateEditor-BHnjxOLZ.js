import{r as o,j as e,C as N,W as S,Y as T,A as E,L as l,I as n,B as w,m as P}from"./index-NZ6jJLfQ.js";import{S as A}from"./separator-E-JdTFOv.js";import{B as L}from"./badge-vNTKF5RD.js";import{u as D,a as I,b as k}from"./useHouseTechRates-BLqiuvHa.js";import{u as q}from"./useQuery-kdg2pmgf.js";import{E as C}from"./euro-DgRTeGAz.js";import{I as M}from"./info-CpCfiYD2.js";import{S as O}from"./save-z_re-Mcq.js";function J({profileId:d,profileName:F,category:u="tecnico"}){const{data:s,isLoading:R}=D(d),c=I(),B=k(),[t,j]=o.useState(""),[m,f]=o.useState(""),[h,v]=o.useState(""),[p,b]=o.useState("30"),[x,g]=o.useState(""),{data:r}=q({queryKey:["rate-card-defaults",u],queryFn:async()=>{const{data:a,error:i}=await P.from("rate_cards_2025").select("base_day_eur, plus_10_12_eur, overtime_hour_eur").eq("category",u).single();if(i)throw i;return a}});o.useEffect(()=>{var a,i,_,y;s&&(j(s.base_day_eur.toString()),f(((a=s.tour_base_responsable_eur)==null?void 0:a.toString())||""),v(((i=s.tour_base_other_eur)==null?void 0:i.toString())||""),b(((_=s.plus_10_12_eur)==null?void 0:_.toString())||"30"),g(((y=s.overtime_hour_eur)==null?void 0:y.toString())||""))},[s]);const H=async()=>{!t||parseFloat(t)<=0||(await c.mutateAsync({profile_id:d,base_day_eur:parseFloat(t),tour_base_responsable_eur:m?parseFloat(m):null,tour_base_other_eur:h?parseFloat(h):null,plus_10_12_eur:p?parseFloat(p):null,overtime_hour_eur:x?parseFloat(x):null}),await B.mutateAsync({profileId:d,profileName:F}))};return R?e.jsxs(N,{children:[e.jsx(S,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Tarifas internas"]})}),e.jsx(E,{children:e.jsx("div",{className:"flex items-center justify-center p-4",children:"Cargando..."})})]}):e.jsxs(N,{children:[e.jsxs(S,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Tarifas internas",e.jsx(L,{variant:"secondary",children:"Solo gestión"})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:"Estos valores están ocultos para los técnicos y sobrescriben los valores por defecto de la categoría en los cálculos de partes. Se aplican inmediatamente al recalcular."})]})]}),e.jsxs(E,{className:"space-y-6",children:[r&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Valores por defecto de la categoría (",u,")"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Día base: €",r.base_day_eur]}),e.jsxs("div",{children:["Plus 10-12h: €",r.plus_10_12_eur]}),e.jsxs("div",{children:["Horas extra: €",r.overtime_hour_eur,"/h"]})]})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"base-day",children:"Tarifa día base (€) *"}),e.jsx(n,{id:"base-day",type:"number",step:"0.01",min:"0",value:t,onChange:a=>j(a.target.value),placeholder:"Introduce la tarifa de día base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Se usa para eventos de house y turnos de hasta 10 horas"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"tour-base-responsable",children:"Tarifa día base para tours - Responsable (€)"}),e.jsx(n,{id:"tour-base-responsable",type:"number",step:"0.01",min:"0",value:m,onChange:a=>f(a.target.value),placeholder:"Dejar vacío para usar tarifa estándar"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tarifa cuando trabaja como responsable en tours. Si está vacío, se usará la tarifa día base estándar."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"tour-base-other",children:"Tarifa día base para tours - Técnico/Especialista (€)"}),e.jsx(n,{id:"tour-base-other",type:"number",step:"0.01",min:"0",value:h,onChange:a=>v(a.target.value),placeholder:"Dejar vacío para usar tarifa estándar"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tarifa cuando trabaja como técnico o especialista en tours. Si está vacío, se usará la tarifa día base estándar."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"plus-1012",children:"Plus 10-12h (€)"}),e.jsx(n,{id:"plus-1012",type:"number",step:"0.01",min:"0",value:p,onChange:a=>b(a.target.value),placeholder:"30"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Importe adicional para turnos de 10-12 horas (por defecto: €30)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"overtime",children:"Tarifa horas extra (€/hora)"}),e.jsx(n,{id:"overtime",type:"number",step:"0.01",min:"0",value:x,onChange:a=>g(a.target.value),placeholder:`Por defecto: €${(r==null?void 0:r.overtime_hour_eur)||"20"}/h`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Precio por hora por encima de 12 (dejar vacío para usar el valor por defecto de la categoría)"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(w,{onClick:H,disabled:c.isPending||!t||parseFloat(t)<=0,className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),c.isPending?"Guardando...":"Guardar tarifa"]})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Tramos de cálculo de tarifa"}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("div",{children:"• Hasta 10h: Tarifa día base"}),e.jsx("div",{children:"• 10-12h: Tarifa base + plus 10-12h"}),e.jsx("div",{children:"• Más de 12h: Tarifa base + plus 10-12h + (horas extra × horas por encima de 12)"}),e.jsx("div",{children:"• Redondeo a 30 minutos: La siguiente hora empieza a los ≥ 30 minutos"})]})]})]})]})}export{J as H};
