import{f as E,e as g,r as c,s as l}from"./index-NZ6jJLfQ.js";function S(f){const e=E(),{toast:v}=g(),t=c.useRef(null),y=c.useRef([]),b=Array.isArray(f)?f:[f],m=c.useMemo(()=>JSON.stringify(b),[b]),u=c.useMemo(()=>b,[m]);return c.useEffect(()=>{y.current=u;const A=`${u.map(r=>r.table).join("-")}-${Math.random().toString(36).substring(2,10)}`,h=l.channel(A);t.current=h,u.forEach(r=>{const{table:n,schema:a="public",event:d="*",filter:o,queryKey:s}=r,i={event:d,schema:a,table:n};o&&(i.filter=o),h.on("postgres_changes",i,p=>{Array.isArray(s)?e.invalidateQueries({queryKey:s}):e.invalidateQueries({queryKey:[s]}),n==="festival_artists"&&(Array.isArray(s)?e.refetchQueries({queryKey:s}):e.refetchQueries({queryKey:[s]}))})});let Q=!1;h.subscribe(r=>{r==="SUBSCRIBED"?Q=!0:r==="CHANNEL_ERROR"&&Q&&v({title:"Connection issue",description:"Real-time updates may be delayed",variant:"destructive"})});const R=()=>{if(t.current){try{l.removeChannel(t.current)}catch{}const r=l.channel(`${A}-reconnect`);t.current=r,y.current.forEach(n=>{const{table:a,schema:d="public",event:o="*",filter:s,queryKey:i}=n,p={event:o,schema:d,table:a};s&&(p.filter=s),r.on("postgres_changes",p,C=>{Array.isArray(i)?(e.invalidateQueries({queryKey:i}),e.refetchQueries({queryKey:i})):(e.invalidateQueries({queryKey:[i]}),e.refetchQueries({queryKey:[i]}))})}),r.subscribe(n=>{}),y.current.forEach(n=>{const{queryKey:a}=n;Array.isArray(a)?e.invalidateQueries({queryKey:a}):e.invalidateQueries({queryKey:[a]})})}};return window.addEventListener("supabase-reconnect",R),()=>{if(window.removeEventListener("supabase-reconnect",R),t.current){try{l.removeChannel(t.current)}catch{}t.current=null}}},[m,u,e,v]),{isSubscribed:!!t.current}}export{S as u};
