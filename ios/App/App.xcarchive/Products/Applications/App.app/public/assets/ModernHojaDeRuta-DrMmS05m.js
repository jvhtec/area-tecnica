const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BI_PM-xL.js","assets/vite-preload-helper-ckwbz45p.js","assets/logo-service-SlbhM6-i.js","assets/pdf-libs-BqoGqu1a.js","assets/commonjs-helpers-Cpj98o6Y.js","assets/index-NZ6jJLfQ.js","assets/index-DFO7exW2.css"])))=>i.map(i=>d[i]);
import{_ as Rs}from"./vite-preload-helper-ckwbz45p.js";import{l as ts,e as Ne,f as Ps,s as B,r as x,j as e,C as re,W as ie,Y as le,A as ne,L as R,S as he,t as pe,v as ge,w as xe,x as M,B as W,I as Q,bh as ps,ac as ye,M as fe,a as we,m as Re,X as Ms,D as gs,aF as Ls,q as xs,F as fs,G as js,V as Ce,Q as $s,aa as qs,bn as Bs,R as vs,i as bs,a4 as Vs}from"./index-NZ6jJLfQ.js";import{B as _e}from"./badge-vNTKF5RD.js";import{T as Is,c as ue}from"./tabs-BdaywI_b.js";import{u as Hs}from"./useJobSelection-B9iLNF5-.js";import{u as zs}from"./useQuery-kdg2pmgf.js";import{u as Te}from"./useMutation-DluhVBs1.js";import{m as O,A as je,T as os,B as ys,H as Os,a as Gs,M as Us,C as Xe}from"./MultiDayScheduleBuilder-DmGkt0fN.js";import{B as Pe}from"./building-2-nIk8XRuA.js";import{C as _s}from"./calendar-_Cj_Sgy-.js";import{Z as Ye}from"./zap-QKspq41J.js";import{S as Ns}from"./sparkles-BZkmCd_8.js";import{I as ns}from"./image--Pql38nK.js";import{U as Ks}from"./upload-DF4rjO7T.js";import{S as Js}from"./settings-egXcSQW9.js";import{P as Ae}from"./phone-BlFwiuho.js";import{P as Fe}from"./plus-C3JQqq7t.js";import{U as Se}from"./user-E3OATBQk.js";import{B as ws}from"./briefcase-BrpPecAy.js";import{S as Cs}from"./search-D-OiWg8h.js";import{U as Fs}from"./users-DMnpVLUq.js";import{I as is}from"./id-card-oCs3SPbN.js";import{C as ve}from"./car-vrO_NvCk.js";import{P as ls}from"./plane-NSG-_bNT.js";import{C as Ss}from"./clock-BXPvTWvY.js";import{C as Ze}from"./checkbox-BsRNEGV1.js";import{T as Ws}from"./truck-Br5sduv3.js";import{D as ks}from"./download-C1rVE0-J.js";import{P as Qs}from"./package-Oxfj-CNq.js";import{A as Xs,a as Ys}from"./arrow-up-BTt-lBKB.js";import{A as As}from"./activity-BNQuCEmB.js";import{P as Zs}from"./progress-C8XsV-Me.js";import{C as es}from"./circle-check-C0N48OpO.js";import{C as ea}from"./circle-CWxDyDxx.js";import{getWeatherForJob as sa}from"./weatherApi-BatwQpQy.js";import{T as aa}from"./triangle-alert-D6qN0F8g.js";import{P as ta,G as Es}from"./places-restaurant-service-CakuSyx6.js";import{U as ss}from"./utensils-crossed-CZeagqP3.js";import{S as ra}from"./star-icpn3ybK.js";import{P as oa}from"./printer-De77t3j8.js";import{T as na,l as ia}from"./lazyXlsx-BrFBF17_.js";import{e as la}from"./es-CSiFCUGj.js";import{F as ca}from"./file-text-igU140SQ.js";import{S as da}from"./save-z_re-Mcq.js";import{C as cs}from"./circle-alert-LZYNzZ7F.js";import{E as ma}from"./eye-BE_DouVP.js";import{F as ua}from"./file-down-Buu6FgvW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=ts("Bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=ts("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=ts("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),ga=(s,t={})=>{Ne();const r=Ps(),{onSuccess:a,onError:c,onSettled:i}=t,{data:m,isLoading:N,error:y}=zs({queryKey:["hoja-de-ruta",s],queryFn:async()=>{if(!s)return null;const{data:n,error:p}=await B.from("hoja_de_ruta").select("*").eq("job_id",s).maybeSingle();if(p)throw p;if(!n)return null;const[{data:d,error:o},{data:g,error:u},{data:v,error:C},{data:k,error:P},{data:q,error:U},{data:X,error:se},{data:Y,error:z}]=await Promise.all([B.from("hoja_de_ruta_contacts").select("*").eq("hoja_de_ruta_id",n.id),B.from("hoja_de_ruta_staff").select("*").eq("hoja_de_ruta_id",n.id),B.from("hoja_de_ruta_logistics").select("*").eq("hoja_de_ruta_id",n.id).maybeSingle(),B.from("hoja_de_ruta_transport").select("*").eq("hoja_de_ruta_id",n.id),B.from("hoja_de_ruta_travel_arrangements").select("*").eq("hoja_de_ruta_id",n.id),B.from("hoja_de_ruta_accommodations").select(`
          *,
          hoja_de_ruta_room_assignments(*)
        `).eq("hoja_de_ruta_id",n.id),B.from("hoja_de_ruta_images").select("*").eq("hoja_de_ruta_id",n.id)]),b=[{name:"contacts",error:o},{name:"staff",error:u},{name:"logistics",error:C},{name:"transport",error:P},{name:"travel",error:U},{name:"accommodations",error:se},{name:"images",error:z}].filter(F=>F.error);b.length>0&&b.forEach(({name:F,error:J})=>{});let V=null;try{const{data:F,error:J}=await B.from("jobs").select("location_id").eq("id",s).maybeSingle();if(!J&&(F!=null&&F.location_id)){const{data:H,error:de}=await B.from("locations").select("name, formatted_address, latitude, longitude").eq("id",F.location_id).maybeSingle();!de&&H&&(V={name:H.name||void 0,address:H.formatted_address||H.name||void 0,coordinates:typeof H.latitude=="number"&&typeof H.longitude=="number"?{lat:H.latitude,lng:H.longitude}:void 0})}}catch{}const K={eventName:n.event_name||"",eventDates:n.event_dates||"",venue:V||{name:n.venue_name||"",address:n.venue_address||"",coordinates:n.venue_latitude&&n.venue_longitude?{lat:parseFloat(n.venue_latitude),lng:parseFloat(n.venue_longitude)}:void 0},contacts:d!=null&&d.length?d.map(F=>({name:F.name,role:F.role||"",phone:F.phone||""})):[{name:"",role:"",phone:""}],logistics:{transport:k!=null&&k.length?k.map(F=>({id:F.id,transport_type:F.transport_type,driver_name:F.driver_name,driver_phone:F.driver_phone,license_plate:F.license_plate,company:F.company,date_time:F.date_time?String(F.date_time).replace(" ","T").slice(0,16):"",has_return:F.has_return,return_date_time:F.return_date_time?String(F.return_date_time).replace(" ","T").slice(0,16):""})):[],loadingDetails:(v==null?void 0:v.loading_details)||"",unloadingDetails:(v==null?void 0:v.unloading_details)||"",equipmentLogistics:(v==null?void 0:v.equipment_logistics)||""},staff:g!=null&&g.length?g.map(F=>({name:F.name,surname1:F.surname1||"",surname2:F.surname2||"",position:F.position||"",dni:F.dni||""})):[{name:"",surname1:"",surname2:"",position:"",dni:""}],schedule:n.schedule||"",programScheduleDays:n.program_schedule_json||void 0,powerRequirements:n.power_requirements||"",auxiliaryNeeds:n.auxiliary_needs||"",weather:n.weather_data||[]},G=(X==null?void 0:X.map(F=>{var J;return{id:F.id,hotel_name:F.hotel_name,address:F.address||"",check_in:F.check_in||"",check_out:F.check_out||"",coordinates:F.latitude&&F.longitude?{lat:parseFloat(F.latitude),lng:parseFloat(F.longitude)}:void 0,rooms:((J=F.hoja_de_ruta_room_assignments)==null?void 0:J.map(H=>({room_type:H.room_type,room_number:H.room_number||"",staff_member1_id:H.staff_member1_id||"",staff_member2_id:H.staff_member2_id||""})))||[]}}))||[],S=(q==null?void 0:q.map(F=>({transportation_type:F.transportation_type,pickup_address:F.pickup_address,pickup_time:F.pickup_time,flight_train_number:F.flight_train_number,departure_time:F.departure_time,arrival_time:F.arrival_time,driver_name:F.driver_name,driver_phone:F.driver_phone,plate_number:F.plate_number,notes:F.notes})))||[];return{...n,eventData:K,travelArrangements:S,accommodations:G,images:Y||[]}},enabled:!!s,staleTime:300*1e3,retry:1}),w=Te({mutationFn:async({eventData:n,userId:p})=>{var se,Y,z,b,V,K,G,S,F,J,H,de,me;if(!s)throw new Error("No job ID provided");if(!((se=n.eventName)!=null&&se.trim()))throw new Error("Event name is required");const d=new Date().toISOString(),o={job_id:s,event_name:n.eventName,event_dates:n.eventDates||"",venue_name:((Y=n.venue)==null?void 0:Y.name)||"",venue_address:((z=n.venue)==null?void 0:z.address)||"",venue_latitude:((V=(b=n.venue)==null?void 0:b.coordinates)==null?void 0:V.lat)||null,venue_longitude:((G=(K=n.venue)==null?void 0:K.coordinates)==null?void 0:G.lng)||null,schedule:n.schedule||"",program_schedule_json:n.programScheduleDays&&n.programScheduleDays.length>0?n.programScheduleDays:null,power_requirements:n.powerRequirements||"",auxiliary_needs:n.auxiliaryNeeds||"",weather_data:n.weather||null,updated_at:d,last_modified:d,last_modified_by:p},{data:g,error:u}=await B.from("hoja_de_ruta").upsert(o,{onConflict:"job_id",ignoreDuplicates:!1}).select().single();if(u)throw u;const v=g.id,C={hoja_de_ruta_id:v,loading_details:((S=n.logistics)==null?void 0:S.loadingDetails)||"",unloading_details:((F=n.logistics)==null?void 0:F.unloadingDetails)||"",equipment_logistics:((J=n.logistics)==null?void 0:J.equipmentLogistics)||""},{error:k}=await B.from("hoja_de_ruta_logistics").upsert(C,{onConflict:"hoja_de_ruta_id"});if((H=n.logistics)!=null&&H.transport&&Array.isArray(n.logistics.transport)){const{error:ae}=await B.from("hoja_de_ruta_transport").delete().eq("hoja_de_ruta_id",v);if(n.logistics.transport.length>0){const te=n.logistics.transport.map(Z=>({hoja_de_ruta_id:v,transport_type:Z.transport_type,driver_name:Z.driver_name||"",driver_phone:Z.driver_phone||"",license_plate:Z.license_plate||"",company:Z.company||null,date_time:Z.date_time||null,has_return:Z.has_return||!1,return_date_time:Z.return_date_time||null})),{error:L}=await B.from("hoja_de_ruta_transport").insert(te)}}const{error:P}=await B.from("hoja_de_ruta_contacts").delete().eq("hoja_de_ruta_id",v),q=((de=n.contacts)==null?void 0:de.filter(ae=>{var te,L,Z;return((te=ae.name)==null?void 0:te.trim())||((L=ae.role)==null?void 0:L.trim())||((Z=ae.phone)==null?void 0:Z.trim())}))||[];if(q.length>0){const ae=q.map(L=>({hoja_de_ruta_id:v,name:L.name||"",role:L.role||"",phone:L.phone||""})),{error:te}=await B.from("hoja_de_ruta_contacts").insert(ae)}const{error:U}=await B.from("hoja_de_ruta_staff").delete().eq("hoja_de_ruta_id",v),X=((me=n.staff)==null?void 0:me.filter(ae=>{var te,L,Z,ce;return((te=ae.name)==null?void 0:te.trim())||((L=ae.surname1)==null?void 0:L.trim())||((Z=ae.surname2)==null?void 0:Z.trim())||((ce=ae.position)==null?void 0:ce.trim())}))||[];if(X.length>0){const ae=X.map(L=>({hoja_de_ruta_id:v,name:L.name||"",surname1:L.surname1||"",surname2:L.surname2||"",position:L.position||"",dni:L.dni||""})),{error:te}=await B.from("hoja_de_ruta_staff").insert(ae)}return g},onSuccess:n=>{r.invalidateQueries({queryKey:["hoja-de-ruta",s]}),a==null||a()},onError:n=>{c==null||c(n)},onSettled:()=>{i==null||i()}}),l=Te({mutationFn:async n=>{if(!s)throw new Error("No job ID provided");const{data:p,error:d}=await B.from("hoja_de_ruta").select("id").eq("job_id",s).maybeSingle();if(d||!p)throw new Error("Hoja de ruta not found. Please save the main data first.");const o=p.id,{error:g}=await B.from("hoja_de_ruta_travel_arrangements").delete().eq("hoja_de_ruta_id",o);if(g)throw g;const u=n.filter(v=>{var C,k,P,q,U;return((C=v.transportation_type)==null?void 0:C.trim())||((k=v.pickup_address)==null?void 0:k.trim())||((P=v.pickup_time)==null?void 0:P.trim())||((q=v.departure_time)==null?void 0:q.trim())||((U=v.arrival_time)==null?void 0:U.trim())});if(u.length>0){const v=u.map(k=>({hoja_de_ruta_id:o,transportation_type:k.transportation_type,pickup_address:k.pickup_address||"",pickup_time:k.pickup_time||null,flight_train_number:k.flight_train_number||"",departure_time:k.departure_time||null,arrival_time:k.arrival_time||null,driver_name:k.driver_name||"",driver_phone:k.driver_phone||"",plate_number:k.plate_number||"",notes:k.notes||""})),{error:C}=await B.from("hoja_de_ruta_travel_arrangements").insert(v);if(C)throw C}return n},onSuccess:()=>{r.invalidateQueries({queryKey:["hoja-de-ruta",s]})},onError:n=>{c==null||c(n)}}),h=Te({mutationFn:async n=>{var v,C,k;if(!s)throw new Error("No job ID provided");const{data:p,error:d}=await B.from("hoja_de_ruta").select("id").eq("job_id",s).maybeSingle();if(d||!p)throw new Error("Hoja de ruta not found. Please save the main data first.");const o=p.id,{error:g}=await B.from("hoja_de_ruta_accommodations").delete().eq("hoja_de_ruta_id",o);if(g)throw g;const u=n.filter(P=>{var q,U;return((q=P.hotel_name)==null?void 0:q.trim())||((U=P.address)==null?void 0:U.trim())});if(u.length>0)for(const P of u){const q={hoja_de_ruta_id:o,hotel_name:P.hotel_name||"",address:P.address||"",check_in:P.check_in||"",check_out:P.check_out||"",latitude:((v=P.coordinates)==null?void 0:v.lat)||null,longitude:((C=P.coordinates)==null?void 0:C.lng)||null},{data:U,error:X}=await B.from("hoja_de_ruta_accommodations").insert(q).select().single();if(X)throw X;const se=((k=P.rooms)==null?void 0:k.filter(Y=>{var z,b,V,K;return((z=Y.room_type)==null?void 0:z.trim())||((b=Y.room_number)==null?void 0:b.trim())||((V=Y.staff_member1_id)==null?void 0:V.trim())||((K=Y.staff_member2_id)==null?void 0:K.trim())}))||[];if(se.length>0){const Y=se.map(b=>({accommodation_id:U.id,room_type:b.room_type,room_number:b.room_number||"",staff_member1_id:b.staff_member1_id||"",staff_member2_id:b.staff_member2_id||""})),{error:z}=await B.from("hoja_de_ruta_room_assignments").insert(Y);if(z)throw z}}return n},onSuccess:()=>{r.invalidateQueries({queryKey:["hoja-de-ruta",s]})},onError:n=>{c==null||c(n)}}),j=Te({mutationFn:async n=>{if(!s)throw new Error("No job ID provided");const{data:p,error:d}=await B.from("hoja_de_ruta").select("id").eq("job_id",s).maybeSingle();if(d||!p)throw new Error("Hoja de ruta not found. Please save the main data first.");const o=p.id,{error:g}=await B.from("hoja_de_ruta_images").delete().eq("hoja_de_ruta_id",o);if(g)throw g;if(n.length>0){const u=n.map(C=>({hoja_de_ruta_id:o,image_path:C.image_path,image_type:C.image_type})),{error:v}=await B.from("hoja_de_ruta_images").insert(u);if(v)throw v}return n},onSuccess:()=>{r.invalidateQueries({queryKey:["hoja-de-ruta",s]})},onError:n=>{c==null||c(n)}}),f=x.useCallback(()=>{s&&r.invalidateQueries({queryKey:["hoja-de-ruta",s]})},[s,r]);return{hojaDeRuta:m||null,isLoading:N,fetchError:y,saveHojaDeRuta:w.mutateAsync,isSaving:w.isPending,saveTravelArrangements:l.mutateAsync,isSavingTravel:l.isPending,saveRoomAssignments:h.mutateAsync,isSavingRooms:h.isPending,saveAccommodations:h.mutateAsync,saveVenueImages:j.mutateAsync,isSavingImages:j.isPending,refreshData:f,resetSaveMutation:w.reset,resetTravelMutation:l.reset,resetRoomsMutation:h.reset,resetImagesMutation:j.reset}},ms={eventName:"",eventDates:"",venue:{name:"",address:""},contacts:[{name:"",role:"",phone:""}],staff:[{name:"",surname1:"",surname2:"",position:"",dni:""}],logistics:{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},schedule:"",powerRequirements:"",auxiliaryNeeds:""},xa=()=>{const[s,t]=x.useState(ms),[r,a]=x.useState([]),[c,i]=x.useState([]),[m,N]=x.useState(""),[y,w]=x.useState(!1),[l,h]=x.useState(!1);return x.useEffect(()=>{m&&(t(ms),a([]),i([]),w(!1),h(!1))},[m]),x.useEffect(()=>{const j=s.eventName||s.eventDates||s.venue.name||s.venue.address||s.schedule||s.powerRequirements||s.auxiliaryNeeds||s.contacts.some(f=>f.name)||s.staff.some(f=>f.name)||r.length>0||c.length>0;h(j&&y)},[s,r,c,y]),{eventData:s,setEventData:t,travelArrangements:r,setTravelArrangements:a,accommodations:c,setAccommodations:i,selectedJobId:m,setSelectedJobId:N,isInitialized:y,setIsInitialized:w,isDirty:l,setIsDirty:h}},fa=(s,t,r,a,c,i,m,N,y,w)=>{const{toast:l}=Ne(),h=x.useCallback(async n=>{if(!n)return"";try{const{data:p,error:d}=await B.from("power_requirement_tables").select("*").eq("job_id",n);return d||!p||p.length===0?"":p.reduce((u,v)=>u.find(k=>k.table_name===v.table_name&&k.department===v.department)?u:u.concat([v]),[]).map(u=>{const v=typeof u.current_per_phase=="number"?u.current_per_phase.toFixed(2):u.current_per_phase,C=u.custom_pdu_type||u.pdu_type;let k=`${u.department.toUpperCase()} - ${u.table_name}:
Potencia Total: ${u.total_watts}W
Corriente por Fase: ${v}A
PDU Recomendado: ${C}
`;return u.includes_hoist&&(k+=`Requiere potencia adicional de motores (CEE32A 3P+N+G)
`),k}).join(`
`)}catch{return""}},[]),j=x.useCallback(async n=>{var p;if(!n)return null;try{const{data:d,error:o}=await B.from("jobs").select(`
          *,
          location:locations(name, formatted_address, latitude, longitude),
          job_assignments(
            *,
            profiles:technician_id(first_name, last_name, dni)
          )
        `).eq("id",n).single();if(o||!d)return null;const g=((p=d.job_assignments)==null?void 0:p.map(u=>{var v,C,k;return{name:((v=u.profiles)==null?void 0:v.first_name)||"",surname1:((C=u.profiles)==null?void 0:C.last_name)||"",surname2:"",position:u.sound_role||u.lights_role||u.video_role||"TÃ©cnico",dni:((k=u.profiles)==null?void 0:k.dni)||""}}))||[];return{jobData:d,staffFromAssignments:g}}catch{return null}},[]),f=x.useCallback(async n=>{var p,d,o,g;if(n)try{const[u,v]=await Promise.all([j(n),h(n)]);if(!u)return;const{jobData:C,staffFromAssignments:k}=u,P=C.start_time?new Date(C.start_time):null,q=C.end_time?new Date(C.end_time):null;let U="";P&&q&&(P.toDateString()===q.toDateString()?U=P.toLocaleDateString("es-ES"):U=`${P.toLocaleDateString("es-ES")} - ${q.toLocaleDateString("es-ES")}`);const X={eventName:C.title||"",eventDates:U,venue:{name:((p=C.location)==null?void 0:p.name)||"",address:((d=C.location)==null?void 0:d.formatted_address)||"",coordinates:((o=C.location)==null?void 0:o.latitude)!=null&&((g=C.location)==null?void 0:g.longitude)!=null?{lat:C.location.latitude,lng:C.location.longitude}:void 0},contacts:C.client_name?[{name:C.client_name,role:"Cliente",phone:C.client_phone||""}]:[{name:"",role:"",phone:""}],logistics:{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},staff:k.length>0?k:[{name:"",surname1:"",surname2:"",position:"",dni:""}],schedule:P?`Load in: ${P.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}`:"",powerRequirements:v||"",auxiliaryNeeds:"",weather:void 0};a(X),y(!0),w("job");const se=[k.length>0&&`${k.length} miembros del personal asignado`,v&&"requisitos de potencia"].filter(Boolean).join(" y ");l({title:"ðŸ“‹ Datos bÃ¡sicos cargados",description:se?`Se han cargado los datos bÃ¡sicos del trabajo con ${se}.`:"Se han cargado los datos bÃ¡sicos del trabajo seleccionado."})}catch{l({title:"Error",description:"No se pudieron cargar los datos bÃ¡sicos del trabajo.",variant:"destructive"})}},[l,j,h,a,y,w]);return x.useEffect(()=>{if(!s||r)return;(async()=>{var k,P,q,U,X,se,Y,z,b,V,K,G;const[p,d]=await Promise.all([j(s),h(s)]);if(!p){m(!0);return}const{jobData:o,staffFromAssignments:g}=p,u=o.start_time?new Date(o.start_time):null,v=o.end_time?new Date(o.end_time):null;let C="";if(u&&v&&(u.toDateString()===v.toDateString()?C=u.toLocaleDateString("es-ES"):C=`${u.toLocaleDateString("es-ES")} - ${v.toLocaleDateString("es-ES")}`),t){N(!0),w("saved");const S=t.eventData,J=((H=[],de=[])=>{const me=L=>(L||"").trim().toLowerCase(),ae=L=>`${me(L==null?void 0:L.name)}|${me(L==null?void 0:L.surname1)}`,te=new Map;for(const L of H)te.set(ae(L),{...L});for(const L of de){const Z=ae(L);if(te.has(Z)){const ce=te.get(Z);te.set(Z,{name:ce.name||L.name||"",surname1:ce.surname1||L.surname1||"",surname2:ce.surname2||L.surname2||"",position:ce.position||L.position||"",dni:ce.dni||L.dni||""})}else te.set(Z,{...L})}return Array.from(te.values())})((S==null?void 0:S.staff)||[],g||[]);a({eventName:(S==null?void 0:S.eventName)||o.title||"",eventDates:(S==null?void 0:S.eventDates)||C,venue:{name:((k=S==null?void 0:S.venue)==null?void 0:k.name)||((P=o.location)==null?void 0:P.name)||"",address:((q=S==null?void 0:S.venue)==null?void 0:q.address)||((U=o.location)==null?void 0:U.formatted_address)||"",coordinates:((X=S==null?void 0:S.venue)==null?void 0:X.coordinates)||(((se=o.location)==null?void 0:se.latitude)!=null&&((Y=o.location)==null?void 0:Y.longitude)!=null?{lat:o.location.latitude,lng:o.location.longitude}:void 0)},contacts:((z=S==null?void 0:S.contacts)==null?void 0:z.length)>0?S.contacts:o.client_name?[{name:o.client_name,role:"Cliente",phone:o.client_phone||""}]:[{name:"",role:"",phone:""}],logistics:(S==null?void 0:S.logistics)||{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},staff:J.length>0?J:[{name:"",surname1:"",surname2:"",position:"",dni:""}],schedule:(S==null?void 0:S.schedule)||(u?`Load in: ${u.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}`:""),programSchedule:(S==null?void 0:S.programSchedule)||void 0,programScheduleDays:(S==null?void 0:S.programScheduleDays)||void 0,powerRequirements:d||(S==null?void 0:S.powerRequirements)||"",auxiliaryNeeds:(S==null?void 0:S.auxiliaryNeeds)||"",weather:(S==null?void 0:S.weather)||void 0,restaurants:(S==null?void 0:S.restaurants)||void 0,selectedRestaurants:(S==null?void 0:S.selectedRestaurants)||void 0}),t.travelArrangements&&t.travelArrangements.length>0&&c(t.travelArrangements),t.accommodations&&t.accommodations.length>0&&i(t.accommodations),l({title:"âœ… Datos cargados",description:`Se han cargado los datos guardados con ${g.length} miembros del personal actual.`})}else{N(!1),w("job");const S={eventName:o.title||"",eventDates:C,venue:{name:((b=o.location)==null?void 0:b.name)||"",address:((V=o.location)==null?void 0:V.formatted_address)||"",coordinates:((K=o.location)==null?void 0:K.latitude)!=null&&((G=o.location)==null?void 0:G.longitude)!=null?{lat:o.location.latitude,lng:o.location.longitude}:void 0},contacts:o.client_name?[{name:o.client_name,role:"Cliente",phone:o.client_phone||""}]:[{name:"",role:"",phone:""}],logistics:{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},staff:g.length>0?g:[{name:"",surname1:"",surname2:"",position:"",dni:""}],schedule:u?`Load in: ${u.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}`:"",powerRequirements:d||"",auxiliaryNeeds:"",weather:void 0};a(S),c([]),i([]);const F=[g.length>0&&`${g.length} miembros del personal asignado`,d&&"requisitos de potencia"].filter(Boolean).join(" y ");l({title:"ðŸ“‹ Datos del trabajo cargados",description:F?`Se han cargado ${F}.`:"Se han cargado los datos bÃ¡sicos del trabajo."})}m(!0)})()},[s,t,r,j,h,l,a,c,i,m,N,w]),{autoPopulateBasicJobData:f,loadCurrentJobAssignments:j}},ja=(s,t)=>{let r=null;return(...a)=>{r&&clearTimeout(r),r=setTimeout(()=>{r=null,s(...a)},t)}},va=(s,t,r,a,c,i,m,N,y,w,l,h)=>{const{toast:j}=Ne(),f=x.useRef(!1),n=x.useRef(""),p=x.useCallback(async()=>{if(!s){j({title:"Error",description:"No hay trabajo seleccionado para auto-completar.",variant:"destructive"});return}try{const{data:g,error:u}=await B.from("power_requirement_tables").select("*").eq("job_id",s);if(u)throw u;return g&&g.length>0?{powerRequirements:g.map(C=>`${C.department.toUpperCase()} - ${C.table_name}:
Potencia Total: ${C.total_watts}W
Corriente por Fase: ${C.current_per_phase}A
PDU Recomendado: ${C.pdu_type}
`).join(`
`)}:{powerRequirements:t.powerRequirements}}catch(g){throw j({title:"Error",description:"No se pudieron cargar los datos adicionales del trabajo.",variant:"destructive"}),g}},[s,t.powerRequirements,j]),d=x.useCallback(async()=>{var u,v;if(!s){j({title:"Error",description:"No hay trabajo seleccionado para guardar.",variant:"destructive"});return}if(f.current)return;const g=JSON.stringify({eventData:t,travelArrangements:r,accommodations:a,venueImages:y,selectedJobId:s});if(n.current!==g){f.current=!0;try{const{data:{user:C}}=await B.auth.getUser();if(!C)throw new Error("Usuario no autenticado");await c({eventData:t,userId:C.id});const k=[];r.length>0&&k.push(i(r)),a.length>0&&k.push(m(a)),y.length>0&&k.push(N(y)),k.length>0&&await Promise.all(k),n.current=g,h(Date.now()),j({title:"âœ… Guardado exitoso",description:"Todos los datos han sido guardados correctamente."})}catch(C){let k="Error desconocido al guardar los datos.";throw(u=C.message)!=null&&u.includes("duplicate key")?k="Ya existe un registro con estos datos.":(v=C.message)!=null&&v.includes("network")?k="Error de conexiÃ³n. Verifique su conexiÃ³n a internet.":C.message&&(k=C.message),j({title:"âŒ Error al guardar",description:k,variant:"destructive"}),C}finally{f.current=!1}}},[s,t,r,a,y,c,i,m,N,h,j]),o=x.useCallback(ja(()=>{!w&&!l&&d().catch(console.error)},2e3),[d,w,l]);return{handleSaveAll:d,autoPopulateFromJob:p,debouncedSave:o,saveInProgress:f.current}},ba=(s=[])=>{const{toast:t}=Ne(),{data:r,isLoading:a}=Hs(),[c,i]=x.useState(!1),[m,N]=x.useState(""),{eventData:y,setEventData:w,travelArrangements:l,setTravelArrangements:h,accommodations:j,setAccommodations:f,selectedJobId:n,setSelectedJobId:p,isInitialized:d,setIsInitialized:o,setIsDirty:g}=xa(),[u,v]=x.useState(!1),[C,k]=x.useState(!1),[P,q]=x.useState("none"),[U,X]=x.useState(0),{hojaDeRuta:se,isLoading:Y,fetchError:z,saveHojaDeRuta:b,isSaving:V,saveTravelArrangements:K,isSavingTravel:G,isSavingRooms:S,saveVenueImages:F,isSavingImages:J,refreshData:H,resetSaveMutation:de,resetTravelMutation:me,resetRoomsMutation:ae,resetImagesMutation:te,saveAccommodations:L}=ga(n),{autoPopulateBasicJobData:Z}=fa(n,se,Y,w,h,f,o,v,k,q),{handleSaveAll:ce,autoPopulateFromJob:Me}=va(n,y,l,j,b,K,L,F,s,V,G,X);x.useEffect(()=>{n?(o(!1),v(!1),k(!1),q("none"),X(0),g(!1),de(),me(),ae(),te(),H()):(v(!1),k(!1),q("none"),X(0),o(!0))},[n,H,de,me,ae,te,o,g]),x.useEffect(()=>{z&&t({title:"Error",description:"No se pudieron cargar los datos guardados. Por favor, intente de nuevo.",variant:"destructive"})},[z,t]);const Le=x.useMemo(()=>{var A,$,E,I;return d?y.eventName||y.eventDates||((A=y.venue)==null?void 0:A.name)||(($=y.venue)==null?void 0:$.address)||y.schedule||y.powerRequirements||y.auxiliaryNeeds||((E=y.contacts)==null?void 0:E.some(oe=>oe.name))||((I=y.staff)==null?void 0:I.some(oe=>oe.name))||l.length>0||j.length>0:!1},[y,l,j,d]),$e=x.useCallback((_,A,$)=>{w(E=>{var I;return{...E,contacts:((I=E.contacts)==null?void 0:I.map((oe,be)=>be===_?{...oe,[A]:$}:oe))||[]}})},[w]),qe=x.useCallback(()=>{w(_=>({..._,contacts:[..._.contacts||[],{name:"",role:"",phone:""}]}))},[w]),Be=x.useCallback((_,A,$)=>{w(E=>{var I;return{...E,staff:((I=E.staff)==null?void 0:I.map((oe,be)=>be===_?{...oe,[A]:$}:oe))||[]}})},[w]),Ve=x.useCallback(()=>{w(_=>({..._,staff:[..._.staff||[],{name:"",surname1:"",surname2:"",position:"",dni:""}]}))},[w]),Ie=x.useCallback((_,A,$)=>{h(E=>E.map((I,oe)=>oe===_?{...I,[A]:$}:I))},[h]),He=x.useCallback(()=>{h(_=>[..._,{transportation_type:"van",pickup_address:"",pickup_time:"",departure_time:"",arrival_time:"",flight_train_number:"",driver_name:"",driver_phone:"",plate_number:"",notes:""}])},[h]),ze=x.useCallback(_=>{h(A=>A.filter(($,E)=>E!==_))},[h]),Oe=x.useCallback((_,A,$)=>{f(E=>E.map((I,oe)=>oe===_?{...I,[A]:$}:I))},[f]),Ge=x.useCallback(()=>{f(_=>[..._,{id:crypto.randomUUID(),hotel_name:"",address:"",check_in:"",check_out:"",rooms:[]}])},[f]),Ue=x.useCallback(_=>{f(A=>A.filter(($,E)=>E!==_))},[f]),Ke=x.useCallback((_,A,$,E)=>{f(I=>I.map((oe,be)=>be===_?{...oe,rooms:oe.rooms.map((rs,Ts)=>Ts===A?{...rs,[$]:E}:rs)}:oe))},[f]),Je=x.useCallback(_=>{f(A=>A.map(($,E)=>E===_?{...$,rooms:[...$.rooms,{room_type:"single",room_number:"",staff_member1_id:"",staff_member2_id:""}]}:$))},[f]),Ee=x.useCallback((_,A)=>{f($=>$.map((E,I)=>I===_?{...E,rooms:E.rooms.filter((oe,be)=>be!==A)}:E))},[f]),De=x.useCallback((_,A,$)=>{w(E=>({...E,logistics:{...E.logistics,transport:E.logistics.transport.map((I,oe)=>oe===_?{...I,[A]:$}:I)}}))},[w]),ke=x.useCallback(()=>{w(_=>({..._,logistics:{..._.logistics,transport:[..._.logistics.transport,{id:crypto.randomUUID(),transport_type:"trailer",driver:"",plate_number:"",notes:""}]}}))},[w]),We=x.useCallback(_=>{w(A=>({...A,logistics:{...A.logistics,transport:A.logistics.transport.filter(($,E)=>E!==_)}}))},[w]),Qe=x.useCallback(_=>{w(A=>({...A,logistics:{...A.logistics,transport:[...A.logistics.transport,..._]}}))},[w]);return{eventData:y,setEventData:w,selectedJobId:n,setSelectedJobId:p,travelArrangements:l,setTravelArrangements:h,accommodations:j,setAccommodations:f,isLoadingJobs:a,isLoadingHojaDeRuta:Y,isSaving:V,isSavingTravel:G,isSavingRooms:S,isSavingImages:J,jobs:r,hojaDeRuta:se,handleSaveAll:ce,autoPopulateFromJob:Me,autoPopulateBasicJobData:Z,refreshData:H,isInitialized:d,hasSavedData:u,hasBasicJobData:C,dataSource:P,isDirty:Le,handleContactChange:$e,addContact:qe,handleStaffChange:Be,addStaffMember:Ve,updateTravelArrangement:Ie,addTravelArrangement:He,removeTravelArrangement:ze,updateAccommodation:Oe,addAccommodation:Ge,removeAccommodation:Ue,updateRoom:Ke,addRoom:Je,removeRoom:Ee,updateTransport:De,addTransport:ke,removeTransport:We,importTransports:Qe,showAlert:c,setShowAlert:i,alertMessage:m,setAlertMessage:N,fetchError:z,lastSaveTime:U}},ya=()=>{const[s,t]=x.useState({venue:[]}),[r,a]=x.useState({venue:[]}),[c,i]=x.useState(null),[m,N]=x.useState(null),y=(p,d)=>{if(!d)return;const o=Array.from(d),g=[...s[p]||[],...o];t({...s,[p]:g});const u=o.map(v=>URL.createObjectURL(v));a(v=>({...v,[p]:[...v[p]||[],...u]}))},w=(p,d)=>{const o=[...s[p]],g=[...r[p]];URL.revokeObjectURL(g[d]),o.splice(d,1),g.splice(d,1),t({...s,[p]:o}),a({...r,[p]:g})},l=p=>{i(p);const d=URL.createObjectURL(p);N(d)};return{images:s,setImages:t,imagePreviews:r,setImagePreviews:a,venueMap:c,setVenueMap:i,venueMapPreview:m,setVenueMapPreview:N,handleImageUpload:y,removeImage:w,handleVenueMapUpload:l,handleVenueMapInputChange:p=>{p.target.files&&p.target.files[0]&&l(p.target.files[0])},handleVenueMapUrl:async p=>{try{const d=new Image;d.crossOrigin="Anonymous",d.onload=()=>{const o=document.createElement("canvas");o.width=d.width,o.height=d.height;const g=o.getContext("2d");g&&(g.drawImage(d,0,0),o.toBlob(u=>{if(u){const v=new File([u],"venue-map.jpg",{type:"image/jpeg"});l(v)}},"image/jpeg"))},d.onerror=o=>{},d.src=p}catch{}},appendVenuePreviews:p=>{!p||p.length===0||a(d=>{const o=new Set(d.venue),g=[];for(const u of p)o.has(u)||g.push(u);return g.length===0?d:{...d,venue:[...d.venue,...g]}})},clearVenueMap:()=>{m&&URL.revokeObjectURL(m),i(null),N(null)}}},_a=({eventData:s,setEventData:t,selectedJobId:r,setSelectedJobId:a,jobs:c,isLoadingJobs:i,jobDetails:m,onAutoPopulate:N,hideJobSelection:y=!1})=>{const w=l=>{t(h=>({...h,venue:{...h.venue,name:l.name,address:l.address,coordinates:l.coordinates?{lat:l.coordinates.lat,lng:l.coordinates.lng}:h.venue.coordinates}}))};return e.jsxs("div",{className:"space-y-6",children:[!y&&e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(re,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-primary"}),"SelecciÃ³n de Trabajo"]})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"job-select",children:"Trabajo Base"}),e.jsxs(he,{value:r,onValueChange:a,children:[e.jsx(pe,{className:"border-2",children:e.jsx(ge,{placeholder:"Seleccionar trabajo..."})}),e.jsx(xe,{children:c==null?void 0:c.map(l=>e.jsx(M,{value:l.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-4 h-4"}),l.title]})},l.id))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(W,{onClick:N,disabled:!r||!m,className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Auto-completar"]})})]}),m&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Fechas:"}),e.jsxs("p",{className:"text-blue-600",children:[new Date(m.start_time).toLocaleDateString()," -",new Date(m.end_time).toLocaleDateString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"UbicaciÃ³n:"}),e.jsx("p",{className:"text-blue-600",children:m.location||"No especificada"})]})]})})]})]})}),e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5 text-purple-600"}),"InformaciÃ³n del Evento"]})}),e.jsxs(ne,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"event-name",className:"text-sm font-medium",children:"Nombre del Evento *"}),e.jsx(Q,{id:"event-name",value:s.eventName,onChange:l=>t(h=>({...h,eventName:l.target.value})),placeholder:"Ej. Festival de MÃºsica 2024",className:"border-2 focus:border-purple-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"event-dates",className:"text-sm font-medium",children:"Fechas del Evento *"}),e.jsx(Q,{id:"event-dates",value:s.eventDates,onChange:l=>t(h=>({...h,eventDates:l.target.value})),placeholder:"Ej. 15-17 Junio 2024",className:"border-2 focus:border-purple-300"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"venue-name",className:"text-sm font-medium",children:"Nombre del Venue *"}),e.jsx(ps,{value:s.venue.name,onSelect:w,placeholder:"Ej. Palacio de Congresos",className:"border-2 focus:border-purple-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"venue-address",className:"text-sm font-medium",children:"DirecciÃ³n del Venue *"}),e.jsx(Q,{id:"venue-address",value:s.venue.address,onChange:l=>t(h=>({...h,venue:{...h.venue,address:l.target.value}})),placeholder:"Ej. Calle Mayor 123, Madrid",className:"border-2 focus:border-purple-300"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"auxiliary-needs",className:"text-sm font-medium",children:"Necesidades Auxiliares"}),e.jsx(ye,{id:"auxiliary-needs",value:s.auxiliaryNeeds,onChange:l=>t(h=>({...h,auxiliaryNeeds:l.target.value})),placeholder:"Especifica cualquier necesidad adicional para el evento...",className:"border-2 focus:border-purple-300 min-h-[100px]"})]})]})]})})]})},as=({address:s,coordinates:t,height:r="300px",onLocationSelect:a,showMarker:c=!0,interactive:i=!0,onStaticMapUrlChange:m})=>{const N=x.useRef(null),y=x.useRef(null),w=x.useRef(null),[l,h]=x.useState(!0),[j,f]=x.useState(null),[n,p]=x.useState(null);x.useEffect(()=>{(async()=>{try{const{data:g,error:u}=await Re.functions.invoke("get-google-maps-key");if(u){f("Failed to load Google Maps API key");return}g!=null&&g.apiKey?p(g.apiKey):f("Google Maps API key not found")}catch{f("Failed to fetch Google Maps API key")}})()},[]),x.useEffect(()=>{if(!n)return;(()=>{if(window.google){d();return}const g=document.createElement("script");g.src=`https://maps.googleapis.com/maps/api/js?key=${n}&libraries=places,geometry`,g.async=!0,g.defer=!0,window.initGoogleMaps=d,g.onload=d,g.onerror=()=>f("Failed to load Google Maps"),document.head.appendChild(g)})()},[n]),x.useEffect(()=>{y.current&&d()},[s,t]);const d=async()=>{if(!(!N.current||!window.google))try{h(!0);let o={lat:40.4168,lng:-3.7038};if(t)o=t;else if(s){const u=new window.google.maps.Geocoder;try{const v=await new Promise((C,k)=>{u.geocode({address:s},(P,q)=>{q==="OK"&&P[0]?C(P[0]):k(new Error(`Geocoding failed: ${q}`))})});o={lat:v.geometry.location.lat(),lng:v.geometry.location.lng()}}catch{}}if(m&&n){const u=`https://maps.googleapis.com/maps/api/staticmap?center=${o.lat},${o.lng}&zoom=15&size=600x300&maptype=roadmap&markers=color:red%7C${o.lat},${o.lng}&key=${n}`;m(u)}const g={center:o,zoom:15,mapTypeId:window.google.maps.MapTypeId.ROADMAP,disableDefaultUI:!i,zoomControl:i,scrollwheel:i,draggable:i,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1};y.current=new window.google.maps.Map(N.current,g),c&&(w.current=new window.google.maps.Marker({position:o,map:y.current,draggable:i&&!!a,title:s||"Venue Location"}),i&&a&&w.current.addListener("dragend",()=>{const u=w.current.getPosition(),v={lat:u.lat(),lng:u.lng()};new window.google.maps.Geocoder().geocode({location:v},(k,P)=>{P==="OK"&&k[0]?a(v,k[0].formatted_address):a(v,`${v.lat}, ${v.lng}`)})})),i&&a&&y.current.addListener("click",u=>{const v={lat:u.latLng.lat(),lng:u.latLng.lng()};w.current&&w.current.setPosition(v),new window.google.maps.Geocoder().geocode({location:v},(k,P)=>{P==="OK"&&k[0]?a(v,k[0].formatted_address):a(v,`${v.lat}, ${v.lng}`)})}),h(!1)}catch{f("Failed to initialize map"),h(!1)}};return j?e.jsx(re,{children:e.jsx(ne,{className:"flex items-center justify-center p-6",style:{height:r},children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j})]})})}):e.jsx(re,{children:e.jsxs(ne,{className:"p-0 relative",children:[e.jsx("div",{ref:N,style:{height:r,width:"100%"}}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading map..."})]})})]})})},Ds=({value:s,onChange:t,placeholder:r="Enter venue address",label:a="Address",className:c})=>{const i=x.useRef(null),m=x.useRef(null),[N,y]=x.useState(!1),[w,l]=x.useState(null);x.useEffect(()=>{(async()=>{try{const{data:f,error:n}=await Re.functions.invoke("get-google-maps-key");if(n)return;f!=null&&f.apiKey&&l(f.apiKey)}catch{}})()},[]),x.useEffect(()=>{if(!w||!i.current)return;const j=()=>{if(window.google)f();else{const p=document.createElement("script");p.src=`https://maps.googleapis.com/maps/api/js?key=${w}&libraries=places&loading=async`,p.async=!0,p.defer=!0,p.onload=f,document.head.appendChild(p)}},f=async()=>{if(!(!i.current||!window.google))try{const{PlaceAutocompleteElement:p}=await window.google.maps.importLibrary("places");m.current=new p,m.current.id="address-autocomplete",m.current.setAttribute("placeholder",r),i.current.parentNode&&i.current.parentNode.replaceChild(m.current,i.current),m.current.addEventListener("gmp-placeselect",async d=>{const o=d.target.place;if(!o.location)return;await o.fetchFields({fields:["displayName","formattedAddress","location"]});const g=o.location?{lat:o.location.lat(),lng:o.location.lng()}:void 0;t(o.formattedAddress||o.displayName,g)})}catch{n()}},n=()=>{!i.current||!window.google||(m.current=new window.google.maps.places.Autocomplete(i.current,{types:["establishment","geocode"],fields:["formatted_address","geometry","name"]}),m.current.addListener("place_changed",()=>{var d;const p=m.current.getPlace();if(p.formatted_address){const o=(d=p.geometry)!=null&&d.location?{lat:p.geometry.location.lat(),lng:p.geometry.location.lng()}:void 0;t(p.formatted_address,o)}}))};return j(),()=>{var p,d,o,g;m.current&&((g=(o=(d=(p=window.google)==null?void 0:p.maps)==null?void 0:d.event)==null?void 0:o.clearInstanceListeners)==null||g.call(o,m.current))}},[w,t,r]);const h=j=>{t(j.target.value)};return e.jsxs("div",{className:c,children:[a&&e.jsx(R,{htmlFor:"address-autocomplete",children:a}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{ref:i,id:"address-autocomplete",value:s,onChange:h,placeholder:r,className:"pr-8"}),e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:N?e.jsx(we,{className:"w-4 h-4 animate-spin text-muted-foreground"}):e.jsx(fe,{className:"w-4 h-4 text-muted-foreground"})})]})]})},Na=({eventData:s,setEventData:t,images:r,imagePreviews:a,onImageUpload:c,onRemoveImage:i,onVenueMapUpload:m,handleVenueMapUrl:N,appendVenuePreviews:y})=>{const[w,l]=x.useState(!1),[h,j]=x.useState(null);x.useRef(new Set),x.useEffect(()=>{s.venue.coordinates&&s.venue.address},[s.venue.coordinates,s.venue.address]),x.useEffect(()=>{h&&N(h)},[h,N]);const f=(d,o)=>{t(g=>({...g,venue:{...g.venue,coordinates:d,address:o||g.venue.address}}))},n=(d,o)=>{d.preventDefault(),l(!1);const g=d.dataTransfer.files;g.length>0&&c("venue",g)},p=(d,o)=>{const g=d.target.files;g&&c("venue",g)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5 text-green-600"}),"ImÃ¡genes del Venue"]})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${w?"border-green-400 bg-green-50":"border-gray-300 hover:border-green-400"}`,onDragOver:d=>{d.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:d=>n(d),children:[e.jsx(ns,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Subir ImÃ¡genes del Venue"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Arrastra las imÃ¡genes aquÃ­ o haz clic para seleccionar"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:d=>p(d),className:"hidden",id:"venue-images"}),e.jsx("label",{htmlFor:"venue-images",children:e.jsx(W,{variant:"outline",className:"gap-2",asChild:!0,children:e.jsxs("span",{children:[e.jsx(Ks,{className:"w-4 h-4"}),"Seleccionar ImÃ¡genes"]})})})]}),a.venue.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:e.jsx(je,{children:a.venue.map((d,o)=>e.jsxs(O.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"relative group rounded-lg overflow-hidden border-2 border-gray-200",children:[e.jsx("img",{src:d,alt:`Venue ${o+1}`,width:500,height:300,loading:"lazy",decoding:"async",className:"w-full h-32 object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx(W,{size:"sm",variant:"destructive",onClick:()=>i("venue",o),className:"rounded-full w-8 h-8 p-0",children:e.jsx(Ms,{className:"w-4 h-4"})})})]},o))})})]})]})}),e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-emerald-600"}),"UbicaciÃ³n del Venue"]}),e.jsxs(gs,{children:[e.jsx(Ls,{asChild:!0,children:e.jsxs(W,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Js,{className:"w-4 h-4"}),"Editar UbicaciÃ³n"]})}),e.jsxs(xs,{className:"max-w-2xl",children:[e.jsx(fs,{children:e.jsx(js,{children:"Configurar UbicaciÃ³n del Venue"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"venue-name",children:"Nombre del Venue"}),e.jsx(ps,{value:s.venue.name||"",onSelect:({name:d,address:o,coordinates:g})=>t(u=>({...u,venue:{...u.venue,name:d||u.venue.name,address:o||u.venue.address,coordinates:g||u.venue.coordinates}})),placeholder:"Buscar venue o lugar..."})]}),e.jsxs("div",{children:[e.jsx(R,{children:"DirecciÃ³n del Venue"}),e.jsx(Ds,{value:s.venue.address||"",onChange:(d,o)=>{t(g=>({...g,venue:{...g.venue,address:d,coordinates:o}}))},placeholder:"Buscar direcciÃ³n..."})]}),(s.venue.address||s.venue.coordinates)&&e.jsxs("div",{children:[e.jsx(R,{children:"Vista Previa del Mapa"}),e.jsx(as,{address:s.venue.address,coordinates:s.venue.coordinates,height:"250px",interactive:!0,showMarker:!0,onLocationSelect:f,onStaticMapUrlChange:j})]})]})]})]})]})}),e.jsx(ne,{children:s.venue.address||s.venue.coordinates?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fe,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:s.venue.name?`${s.venue.name} - UbicaciÃ³n confirmada`:"UbicaciÃ³n confirmada"})]}),e.jsx(as,{address:s.venue.address,coordinates:s.venue.coordinates,height:"300px",interactive:!1,showMarker:!0,onStaticMapUrlChange:j}),s.venue.address&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"DirecciÃ³n:"}),e.jsx("p",{className:"text-sm",children:s.venue.address}),s.venue.coordinates&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Coordenadas: ",s.venue.coordinates.lat.toFixed(6),", ",s.venue.coordinates.lng.toFixed(6)]})]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(fe,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay ubicaciÃ³n configurada"}),e.jsx("p",{className:"text-sm mb-4",children:'Complete el nombre del venue en la secciÃ³n "InformaciÃ³n del Evento" para ver el mapa aquÃ­ automÃ¡ticamente'}),e.jsx("p",{className:"text-xs text-blue-600",children:"âœ“ IntegraciÃ³n Google Maps habilitada"})]})})]})})]})},wa=({eventData:s,onContactChange:t,onAddContact:r})=>e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-purple-600"}),"Contactos del Evento"]}),e.jsxs(W,{onClick:r,size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AÃ±adir Contacto"]})]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-4",children:e.jsx(je,{children:s.contacts.map((a,c)=>e.jsx(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 border-2 border-gray-200 rounded-lg bg-gradient-to-r from-purple-50 to-transparent",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Nombre"]}),e.jsx(Q,{value:a.name,onChange:i=>t(c,"name",i.target.value),placeholder:"Nombre completo",className:"border-2 focus:border-purple-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),"Cargo"]}),e.jsx(Q,{value:a.role,onChange:i=>t(c,"role",i.target.value),placeholder:"Director, TÃ©cnico...",className:"border-2 focus:border-purple-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"TelÃ©fono"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{value:a.phone,onChange:i=>t(c,"phone",i.target.value),placeholder:"+34 xxx xxx xxx",className:"border-2 focus:border-purple-300"}),c>0&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>{},className:"px-3",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]})},c))})})})]})}),Ca=({value:s,onSelect:t,onChange:r,placeholder:a="Buscar por nombre...",className:c})=>{const[i,m]=x.useState(!1),[N,y]=x.useState([]),[w,l]=x.useState(!1),h=x.useRef(null),j=x.useRef(null),f=async o=>{if(!o||o.length<2){y([]);return}l(!0);try{const{data:g,error:u}=await Re.from("profiles").select("id, first_name, last_name, dni, department, role").or(`first_name.ilike.%${o}%,last_name.ilike.%${o}%,dni.ilike.%${o}%`).limit(10);if(u){y([]);return}y(g||[])}catch{}finally{l(!1)}};x.useEffect(()=>{const o=setTimeout(()=>{f(s)},300);return()=>clearTimeout(o)},[s]),x.useEffect(()=>{const o=g=>{j.current&&!j.current.contains(g.target)&&m(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const n=o=>{const g=o.target.value;r(g),m(!0)},p=o=>{const g=[o.first_name,o.last_name].filter(Boolean).join(" ");t({id:o.id,first_name:o.first_name,last_name:o.last_name,dni:o.dni,department:o.department,role:o.role,full_name:g}),m(!1),y([])},d=()=>{s.length>=2&&m(!0)};return e.jsxs("div",{ref:j,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Q,{ref:h,value:s,onChange:n,onFocus:d,placeholder:a,className:$s("pl-10 border-2 focus:border-orange-300",c)})]}),e.jsx(je,{children:i&&N.length>0&&e.jsx(O.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute z-50 w-full mt-1",children:e.jsxs(re,{className:"border-2 border-orange-200 shadow-lg max-h-60 overflow-y-auto",children:[w&&e.jsx("div",{className:"p-3 text-center text-sm text-gray-500",children:"Buscando..."}),!w&&N.map((o,g)=>{const u=[o.first_name,o.last_name].filter(Boolean).join(" ");return e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:g*.05},className:"p-3 hover:bg-orange-50 cursor-pointer border-b last:border-b-0 transition-colors",onClick:()=>p(o),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-4 h-4 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:u}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.dni&&e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:o.dni}),o.department&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:o.department}),o.role&&e.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:o.role})]})]})]})},o.id)})]})})})]})},Fa=({eventData:s,onStaffChange:t,onAddStaff:r,onProfileSelect:a})=>{const c=async(i,m)=>{const N=(m.first_name||"").toString().trim(),y=(m.last_name||"").toString().trim();N&&t(i,"name",N),y&&(t(i,"surname1",y),t(i,"surname2",""));let w=(m.dni||m.DNI||"").toString().trim();if(!w&&m.id)try{const{data:l,error:h}=await Re.from("profiles").select("dni, role, first_name, last_name").eq("id",m.id).maybeSingle();!h&&(l!=null&&l.dni)&&(w=l.dni)}catch{}w&&t(i,"dni",w),a&&a(i,m)};return e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-orange-600"}),"Personal del Evento"]}),e.jsxs(W,{onClick:r,size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AÃ±adir Personal"]})]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-4",children:e.jsx(je,{children:s.staff.map((i,m)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 border-2 border-gray-200 rounded-lg bg-gradient-to-r from-orange-50 to-transparent",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Nombre"]}),e.jsx(Ca,{value:i.name,onChange:N=>t(m,"name",N),onSelect:N=>c(m,N),placeholder:"Buscar por nombre...",className:"border-2 focus:border-orange-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"Apellidos"]}),e.jsx(Q,{value:i.surname1,onChange:N=>t(m,"surname1",N.target.value),placeholder:"Apellidos",className:"border-2 focus:border-orange-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4"}),"DNI"]}),e.jsx(Q,{value:i.dni,onChange:N=>t(m,"dni",N.target.value),placeholder:"DNI",className:"border-2 focus:border-orange-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),"PosiciÃ³n"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{value:i.position,onChange:N=>t(m,"position",N.target.value),placeholder:"TÃ©cnico, Jefe...",className:"border-2 focus:border-orange-300"}),m>0&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>{},className:"px-3",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]}),i.position&&e.jsx("div",{className:"mt-3 pt-3 border-t border-orange-200",children:e.jsx(_e,{variant:"outline",className:"bg-orange-100 text-orange-700 border-orange-300",children:i.position})})]},m))})})})]})})},Sa=({travelArrangements:s,onUpdate:t,onAdd:r,onRemove:a})=>{const c=l=>{switch(l){case"plane":return ls;case"train":return os;case"sleeper_bus":return ds;case"RV":return ve;case"own_means":return ve;default:return ve}},i=x.useCallback(l=>{if(!l)return"";try{const h=new Date(l);return isNaN(h.getTime())?"":qs(h,"Europe/Madrid","yyyy-MM-dd'T'HH:mm")}catch{return""}},[]),m=x.useCallback(l=>{if(l)try{return Bs(l,"Europe/Madrid").toISOString()}catch{return}},[]),N=x.useCallback((l,h)=>{const j=m(h);t(l,"pickup_time",j)},[t,m]),y=x.useCallback((l,h)=>{const j=m(h);t(l,"departure_time",j)},[t,m]),w=x.useCallback((l,h)=>{const j=m(h);t(l,"arrival_time",j)},[t,m]);return e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-cyan-600"}),"Transporte y Viajes"]}),e.jsxs(W,{onClick:r,size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AÃ±adir Viaje"]})]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-6",children:e.jsx(je,{children:s.map((l,h)=>{const j=c(l.transportation_type);return e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 border-2 border-gray-200 rounded-lg bg-gradient-to-r from-cyan-50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-cyan-600"}),e.jsxs("h4",{className:"font-medium",children:["Viaje ",h+1]})]}),h>0&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>a(h),className:"text-red-600 hover:text-red-700",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Tipo de Transporte"}),e.jsxs(he,{value:l.transportation_type,onValueChange:f=>t(h,"transportation_type",f),children:[e.jsx(pe,{className:"border-2 focus:border-cyan-300",children:e.jsx(ge,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"van",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Furgoneta"]})}),e.jsx(M,{value:"sleeper_bus",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4"}),"AutobÃºs Cama"]})}),e.jsx(M,{value:"train",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-4 h-4"}),"Tren"]})}),e.jsx(M,{value:"plane",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"AviÃ³n"]})}),e.jsx(M,{value:"RV",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Autocaravana"]})}),e.jsx(M,{value:"own_means",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Medios propios"]})})]})]})]}),l.transportation_type!=="own_means"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"DirecciÃ³n de Recogida"]}),e.jsx(Ds,{value:l.pickup_address||"",onChange:f=>t(h,"pickup_address",f),placeholder:"Buscar direcciÃ³n de recogida..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4"}),"Fecha y Hora de Recogida"]}),e.jsx(Q,{type:"datetime-local",value:i(l.pickup_time),onChange:f=>N(h,f.target.value),className:"border-2 focus:border-cyan-300"})]})]}),(l.transportation_type==="plane"||l.transportation_type==="train")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"NÃºmero de Vuelo/Tren"}),e.jsx(Q,{value:l.flight_train_number||"",onChange:f=>t(h,"flight_train_number",f.target.value),placeholder:"IB1234, AVE123...",className:"border-2 focus:border-cyan-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Fecha y Hora de Salida"}),e.jsx(Q,{type:"datetime-local",value:i(l.departure_time),onChange:f=>y(h,f.target.value),className:"border-2 focus:border-cyan-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Fecha y Hora de Llegada"}),e.jsx(Q,{type:"datetime-local",value:i(l.arrival_time),onChange:f=>w(h,f.target.value),className:"border-2 focus:border-cyan-300"})]})]}),(l.transportation_type==="van"||l.transportation_type==="sleeper_bus"||l.transportation_type==="RV")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Nombre del Conductor"]}),e.jsx(Q,{value:l.driver_name||"",onChange:f=>t(h,"driver_name",f.target.value),placeholder:"Nombre completo",className:"border-2 focus:border-cyan-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"TelÃ©fono del Conductor"]}),e.jsx(Q,{value:l.driver_phone||"",onChange:f=>t(h,"driver_phone",f.target.value),placeholder:"+34 600 000 000",className:"border-2 focus:border-cyan-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(pa,{className:"w-4 h-4"}),"MatrÃ­cula del VehÃ­culo"]}),e.jsx(Q,{value:l.plate_number||"",onChange:f=>t(h,"plate_number",f.target.value),placeholder:"1234-ABC",className:"border-2 focus:border-cyan-300"})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Notas del Viaje"}),e.jsx(ye,{value:l.notes||"",onChange:f=>t(h,"notes",f.target.value),placeholder:"InformaciÃ³n adicional sobre el viaje...",className:"border-2 focus:border-cyan-300"}),l.transportation_type==="own_means"&&e.jsx("p",{className:"text-xs text-gray-500",children:'Con "Medios propios" no es necesario completar direcciones, horarios ni datos de conductor.'})]})]},h)})})})})]})})},ka=({accommodations:s,eventData:t,onUpdateAccommodation:r,onUpdateRoom:a,onAddAccommodation:c,onRemoveAccommodation:i,onAddRoom:m,onRemoveRoom:N})=>{const[y,w]=x.useState({}),l=h=>{w(j=>({...j,[h]:!j[h]}))};return e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5 text-pink-600"}),"Alojamiento"]}),e.jsxs(W,{onClick:c,size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AÃ±adir Hotel"]})]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-6",children:e.jsx(je,{children:s.map((h,j)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6 border-2 border-gray-200 rounded-lg bg-gradient-to-r from-pink-50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-pink-600"}),e.jsxs("h3",{className:"text-lg font-semibold",children:["Hotel ",j+1]})]}),j>0&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>i(j),className:"text-red-600 hover:text-red-700",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Buscar Hotel"}),e.jsx(Os,{value:h.hotel_name,checkIn:h.check_in,checkOut:h.check_out,onChange:(f,n,p)=>{const d={hotel_name:f};n&&(d.address=n),p&&(d.coordinates=p),r(j,d)},onCheckInChange:f=>r(j,{check_in:f}),onCheckOutChange:f=>r(j,{check_out:f}),placeholder:"Buscar por nombre de hotel...",className:"border-2 focus:border-pink-300"})]}),h.address&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"DirecciÃ³n"}),e.jsx("p",{className:"text-sm p-3 border rounded-md bg-muted/50",children:h.address})]})]}),h.address&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs(W,{variant:"outline",size:"sm",onClick:()=>l(h.id),className:"gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),y[h.id]?"Ocultar Mapa":"Ver Mapa"]})}),e.jsx(je,{children:y[h.id]&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsx(as,{address:h.address,coordinates:h.coordinates,height:"300px",showMarker:!0,interactive:!0,onLocationSelect:(f,n)=>{r(j,{coordinates:f,address:n})}})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4 text-pink-600"}),"Habitaciones"]}),e.jsxs(W,{onClick:()=>m(j),size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AÃ±adir HabitaciÃ³n"]})]}),e.jsx(je,{children:h.rooms.map((f,n)=>e.jsxs(O.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:"p-4 border border-gray-200 rounded-lg bg-white/70",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h5",{className:"font-medium text-sm",children:["HabitaciÃ³n ",n+1]}),n>0&&e.jsx(W,{size:"sm",variant:"outline",onClick:()=>N(j,n),className:"text-red-600 hover:text-red-700 h-8 w-8 p-0",children:e.jsx(Ce,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Tipo de HabitaciÃ³n"}),e.jsxs(he,{value:f.room_type,onValueChange:p=>a(j,n,"room_type",p),children:[e.jsx(pe,{className:"border-2 focus:border-pink-300",children:e.jsx(ge,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"single",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Individual"]})}),e.jsx(M,{value:"double",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Doble"]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"NÃºmero de HabitaciÃ³n"}),e.jsx(Q,{value:f.room_number||"",onChange:p=>a(j,n,"room_number",p.target.value),placeholder:"101, 202...",className:"border-2 focus:border-pink-300"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Personal 1"}),e.jsxs(he,{value:f.staff_member1_id||"",onValueChange:p=>a(j,n,"staff_member1_id",p),children:[e.jsx(pe,{className:"border-2 focus:border-pink-300",children:e.jsx(ge,{placeholder:"Seleccionar personal"})}),e.jsx(xe,{children:t.staff.map((p,d)=>e.jsxs(M,{value:d.toString(),children:[p.name," ",p.surname1]},d))})]})]}),f.room_type==="double"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"Personal 2"}),e.jsxs(he,{value:f.staff_member2_id||"",onValueChange:p=>a(j,n,"staff_member2_id",p),children:[e.jsx(pe,{className:"border-2 focus:border-pink-300",children:e.jsx(ge,{placeholder:"Seleccionar personal"})}),e.jsx(xe,{children:t.staff.map((p,d)=>e.jsxs(M,{value:d.toString(),children:[p.name," ",p.surname1]},d))})]})]})]})]},n))})]})]},h.id))})})})]})})},Aa=({transport:s,onUpdateTransport:t,onAddTransport:r,onRemoveTransport:a,onImportTransports:c,jobId:i})=>{const{toast:m}=Ne(),[N,y]=x.useState(!1),w=Array.isArray(s)?s:[],l=["trailer","9m","8m","6m","4m","furgoneta"],h=n=>l.includes(n),j=n=>n?{pantoja:"pantoja",transluminaria:"transluminaria",transcamarena:"transcamarena",the_wild_tour:"wild tour",camionaje:"camionaje",sector_pro:"sector-pro",crespo:"crespo",montabi_dorado:"montabi_dorado",grupo_sese:"grupo_sese",nacex:"nacex",recogida_cliente:"recogida_cliente"}[n]||"other":void 0,f=async()=>{if(!i){m({title:"Error",description:"No hay un trabajo seleccionado",variant:"destructive"});return}y(!0);try{const{data:n,error:p}=await B.from("logistics_events").select("*").eq("job_id",i).order("event_date",{ascending:!0}).order("event_time",{ascending:!0});if(p)throw p;if(!n||n.length===0){m({title:"Sin datos",description:"No se encontraron eventos logÃ­sticos para este trabajo"});return}const d=n.map(o=>{const g=o.event_time?String(o.event_time).slice(0,5):"00:00",u=`${o.event_date}T${g}`,v=o.transport_type;return h(v),{id:crypto.randomUUID(),transport_type:h(v)?v:"trailer",license_plate:o.license_plate||void 0,company:j(o.transport_provider),date_time:u,driver_name:void 0,driver_phone:void 0,has_return:!1,return_date_time:void 0}});c(d),m({title:"ImportaciÃ³n exitosa",description:`Se importaron ${d.length} evento(s) logÃ­stico(s)`})}catch{m({title:"Error",description:"No se pudieron importar los eventos logÃ­sticos",variant:"destructive"})}finally{y(!1)}};return e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-5 h-5 text-indigo-600"}),"Transporte"]}),e.jsxs("div",{className:"flex gap-2",children:[i&&e.jsxs(W,{onClick:f,size:"sm",variant:"outline",className:"gap-2",disabled:N,children:[e.jsx(ks,{className:"w-4 h-4"}),N?"Importando...":"Importar desde LogÃ­stica"]}),e.jsxs(W,{onClick:r,size:"sm",variant:"outline",className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"AÃ±adir Transporte"]})]})]})}),e.jsx(ne,{children:e.jsx("div",{className:"space-y-6",children:e.jsx(je,{children:w.map((n,p)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6 border-2 border-gray-200 rounded-lg bg-gradient-to-r from-indigo-50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Transporte ",p+1]}),e.jsx(W,{size:"sm",variant:"outline",onClick:()=>a(p),className:"text-red-600 hover:text-red-700",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Tipo de Transporte"}),e.jsxs(he,{value:n.transport_type,onValueChange:d=>t(p,"transport_type",d),children:[e.jsx(pe,{children:e.jsx(ge,{placeholder:"Seleccionar tipo"})}),e.jsxs(xe,{children:[e.jsx(M,{value:"trailer",children:"Trailer"}),e.jsx(M,{value:"9m",children:"9m"}),e.jsx(M,{value:"8m",children:"8m"}),e.jsx(M,{value:"6m",children:"6m"}),e.jsx(M,{value:"4m",children:"4m"}),e.jsx(M,{value:"furgoneta",children:"Furgoneta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nombre del Conductor"}),e.jsx(Q,{value:n.driver_name||"",onChange:d=>t(p,"driver_name",d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"TelÃ©fono del Conductor"}),e.jsx(Q,{value:n.driver_phone||"",onChange:d=>t(p,"driver_phone",d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"MatrÃ­cula"}),e.jsx(Q,{value:n.license_plate||"",onChange:d=>t(p,"license_plate",d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"CompaÃ±Ã­a"}),e.jsxs(he,{value:n.company,onValueChange:d=>t(p,"company",d),children:[e.jsx(pe,{children:e.jsx(ge,{placeholder:"Seleccionar compaÃ±Ã­a"})}),e.jsxs(xe,{children:[e.jsx(M,{value:"pantoja",children:"Pantoja"}),e.jsx(M,{value:"transluminaria",children:"Transluminaria"}),e.jsx(M,{value:"transcamarena",children:"Transcamarena"}),e.jsx(M,{value:"wild tour",children:"Wild Tour"}),e.jsx(M,{value:"camionaje",children:"Camionaje"}),e.jsx(M,{value:"sector-pro",children:"Sector-Pro"}),e.jsx(M,{value:"crespo",children:"Crespo"}),e.jsx(M,{value:"montabi_dorado",children:"Montabi Dorado"}),e.jsx(M,{value:"grupo_sese",children:"Grupo Sese"}),e.jsx(M,{value:"nacex",children:"Nacex"}),e.jsx(M,{value:"recogida_cliente",children:"Recogida Cliente"}),e.jsx(M,{value:"other",children:"Otro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Fecha y Hora"}),e.jsx(Q,{type:"datetime-local",value:n.date_time||"",onChange:d=>t(p,"date_time",d.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(Ze,{id:`has_return_${n.id}`,checked:n.has_return||!1,onCheckedChange:d=>t(p,"has_return",d)}),e.jsx(R,{htmlFor:`has_return_${n.id}`,children:"Mismo camiÃ³n para la vuelta"})]}),n.has_return&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Fecha y Hora de Vuelta"}),e.jsx(Q,{type:"datetime-local",value:n.return_date_time||"",onChange:d=>t(p,"return_date_time",d.target.value)})]})]})]},n.id))})})})]})},Ea=({eventData:s,setEventData:t,onUpdateTransport:r,onAddTransport:a,onRemoveTransport:c,onImportTransports:i,jobId:m})=>e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsx(Aa,{transport:s.logistics.transport,onUpdateTransport:r,onAddTransport:a,onRemoveTransport:c,onImportTransports:i,jobId:m}),e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-indigo-600"}),"LogÃ­stica del Evento"]})}),e.jsxs(ne,{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4 text-indigo-600"}),"LogÃ­stica de Equipos"]}),e.jsx(ye,{value:s.logistics.equipmentLogistics,onChange:N=>t(y=>{const l={...y.logistics||{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},equipmentLogistics:N.target.value};return{...y,logistics:l}}),placeholder:"Instrucciones especiales para equipos...",className:"border-2 focus:border-indigo-300 min-h-[100px]"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Xs,{className:"w-4 h-4 text-red-600"}),"Detalles de Descarga"]}),e.jsx(ye,{value:s.logistics.unloadingDetails,onChange:N=>t(y=>{const l={...y.logistics||{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},unloadingDetails:N.target.value};return{...y,logistics:l}}),placeholder:"Horarios, ubicaciÃ³n, personal necesario para la descarga...",className:"border-2 focus:border-red-300 min-h-[120px]"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ys,{className:"w-4 h-4 text-green-600"}),"Detalles de Carga"]}),e.jsx(ye,{value:s.logistics.loadingDetails,onChange:N=>t(y=>{const l={...y.logistics||{transport:[],loadingDetails:"",unloadingDetails:"",equipmentLogistics:""},loadingDetails:N.target.value};return{...y,logistics:l}}),placeholder:"Horarios, ubicaciÃ³n, personal necesario para la carga...",className:"border-2 focus:border-green-300 min-h-[120px]"})]})]})]})]})]}),Da=({eventData:s,setEventData:t})=>{const r=x.useMemo(()=>s.programSchedule??[],[s.programSchedule]),a=x.useMemo(()=>s.programScheduleDays??[],[s.programScheduleDays]);return e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsx(Us,{value:a.length?a:[{label:"DÃ­a 1",rows:r}],onChange:c=>t(i=>{var m;return{...i,programScheduleDays:c,programSchedule:((m=c==null?void 0:c[0])==null?void 0:m.rows)||[]}}),dayTitle:"Programa",subtitle:s.eventName?`${s.eventName}${s.eventDates?" â€¢ "+s.eventDates:""}`:void 0}),e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-5 h-5 text-red-600"}),"Programa (Texto Libre)"]})}),e.jsx(ne,{children:e.jsx(ye,{value:s.schedule,onChange:c=>t(i=>({...i,schedule:c.target.value})),placeholder:"Texto libre del programa (opcional)",className:"border-2 focus:border-red-300 min-h-[140px] font-mono text-sm"})})]}),e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-yellow-600"}),"Requisitos de EnergÃ­a"]})}),e.jsx(ne,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-yellow-600"}),"Especificaciones ElÃ©ctricas"]}),e.jsx(ye,{value:s.powerRequirements,onChange:c=>t(i=>({...i,powerRequirements:c.target.value})),placeholder:`Detalla los requisitos elÃ©ctricos del evento...

Ejemplo:
- PA System: 32A TrifÃ¡sico
- IluminaciÃ³n: 63A TrifÃ¡sico
- Backline: 16A MonofÃ¡sico
- Catering: 16A MonofÃ¡sico

Total estimado: 127A`,className:"border-2 focus:border-yellow-300 min-h-[150px] font-mono text-sm"})]})})]})]})},us=({progress:s})=>{const t=()=>s<25?"Inicio":s<50?"En Progreso":s<75?"Avanzado":"Casi Completo";return e.jsxs("div",{className:"flex items-center gap-3 bg-muted/50 rounded-lg px-4 py-2 border-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O.div,{animate:{rotate:s===100?360:0},transition:{duration:.5},children:s===100?e.jsx(es,{className:"w-5 h-5 text-green-600"}):e.jsx(ea,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{value:s,className:"w-24 h-2"}),e.jsxs("span",{className:"text-xs font-mono text-muted-foreground min-w-[3rem]",children:[Math.round(s),"%"]})]})]})},Ta=({eventData:s,setEventData:t})=>{var l,h;const[r,a]=x.useState(!1),[c,i]=x.useState(null),[m,N]=x.useState(null),y=async()=>{if(!s.eventDates||!s.venue.address&&!s.venue.coordinates){i("Se requieren fechas del evento y ubicaciÃ³n del venue para obtener el clima");return}a(!0),i(null);try{const j=await sa(s.venue,s.eventDates);t(f=>({...f,weather:j||void 0})),N(new Date),j||i("No se pudieron obtener datos meteorolÃ³gicos para esta ubicaciÃ³n y fecha")}catch{i("Error al obtener datos meteorolÃ³gicos. Verifique la conexiÃ³n a internet.")}finally{a(!1)}};x.useEffect(()=>{s.eventDates&&(s.venue.address||s.venue.coordinates)&&!s.weather&&!r&&y()},[s.eventDates,s.venue.address,(l=s.venue.coordinates)==null?void 0:l.lat,(h=s.venue.coordinates)==null?void 0:h.lng]);const w=s.weather&&s.weather.length>0;return e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-4",children:e.jsxs(re,{className:"border-2 border-sky-200 bg-gradient-to-br from-sky-50 to-blue-50",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(le,{className:"text-lg font-semibold flex items-center gap-2 text-sky-700",children:[e.jsx(Xe,{className:"w-5 h-5"}),"PrevisiÃ³n MeteorolÃ³gica"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsxs(_e,{variant:"outline",className:"text-xs",children:["Actualizado: ",m.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]}),e.jsx(W,{onClick:y,disabled:r||!s.eventDates||!s.venue.address&&!s.venue.coordinates,variant:"outline",size:"sm",className:"text-sky-600 border-sky-300 hover:bg-sky-50",children:r?e.jsx(we,{className:"w-4 h-4 animate-spin"}):e.jsx(vs,{className:"w-4 h-4"})})]})]})}),e.jsxs(ne,{className:"space-y-4",children:[r&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(we,{className:"w-8 h-8 animate-spin mx-auto text-sky-600"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Obteniendo datos meteorolÃ³gicos..."})]})}),c&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(aa,{className:"w-4 h-4 text-amber-600"}),e.jsx("p",{className:"text-sm text-amber-700",children:c})]}),w&&!r&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-2",children:s.weather.map((j,f)=>{const p=new Date(j.date).toLocaleDateString("es-ES",{weekday:"long",month:"long",day:"numeric"});return e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:f*.1},className:"flex items-center justify-between p-3 bg-white rounded-lg border border-sky-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:j.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 capitalize",children:p}),e.jsx("p",{className:"text-sm text-gray-600",children:j.condition})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-semibold text-lg text-gray-900",children:[j.maxTemp,"Â°C"]}),e.jsxs("span",{className:"text-gray-500",children:["/ ",j.minTemp,"Â°C"]})]}),j.precipitationProbability>0&&e.jsxs("p",{className:"text-xs text-blue-600",children:["ðŸŒ§ï¸ ",j.precipitationProbability,"%"]})]})]},j.date)})}),e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Los datos meteorolÃ³gicos se actualizan automÃ¡ticamente y se incluirÃ¡n en el PDF generado. Fuente: Open-Meteo API"]})})]}),!w&&!r&&!c&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Xe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:!s.eventDates||!s.venue.address&&!s.venue.coordinates?"Complete las fechas del evento y el nombre del venue en la secciÃ³n 'InformaciÃ³n del Evento' para ver la previsiÃ³n meteorolÃ³gica automÃ¡ticamente":"Haga clic en actualizar para obtener la previsiÃ³n meteorolÃ³gica"})]})]})]})})};function Ra({eventData:s,onUpdateEventData:t,accommodations:r=[]}){var X,se,Y,z;const[a,c]=x.useState([]),[i,m]=x.useState(!1),[N,y]=x.useState("2000"),[w,l]=x.useState("all"),[h,j]=x.useState("all"),{toast:f}=Ne(),n=s.selectedRestaurants||[],p=((X=s.venue)==null?void 0:X.address)||"",d=(se=s.venue)!=null&&se.coordinates?{lat:s.venue.coordinates.lat,lng:s.venue.coordinates.lng}:typeof((Y=s.venue)==null?void 0:Y.latitude)=="number"&&typeof((z=s.venue)==null?void 0:z.longitude)=="number"?{lat:s.venue.latitude,lng:s.venue.longitude}:void 0,o=(r||[]).map((b,V)=>({key:`hotel-${V}`,label:b.hotel_name?`Hotel: ${b.hotel_name}`:`Hotel ${V+1}`,address:b.address||"",coords:b.coordinates?{lat:b.coordinates.lat,lng:b.coordinates.lng}:void 0,type:"hotel"})).filter(b=>b.address||b.coords),g=[...p||d?[{key:"venue",label:"Cerca del Venue",address:p,coords:d,type:"venue"}]:[],...o],[u,v]=x.useState(g.length?[g[0].key]:[]);x.useEffect(()=>{u.length>0&&C()},[u.join("|")]);const C=async()=>{if(u.length===0){f({title:"DirecciÃ³n requerida",description:"Selecciona al menos un origen (venue u hotel) para buscar restaurantes cercanos",variant:"destructive"});return}m(!0);try{const b=parseInt(N),V=[];for(const G of u){const S=g.find(H=>H.key===G);if(!S)continue;const J=(await ta.searchRestaurantsNearVenue(S.address||"",b,20,S.coords)).map(H=>({...H,id:`${H.googlePlaceId||H.id}::${G}`,originType:S.type,originLabel:S.type==="venue"?"Venue":S.label.replace(/^Hotel:\s*/,"Hotel ")}));V.push(...J)}const K=V.map(G=>({...G,isSelected:n.includes(G.id)}));c(K),V.length===0&&f({title:"Sin resultados",description:"No se encontraron restaurantes cerca del/los origen/es seleccionados"})}catch{f({title:"Error",description:"Error al buscar restaurantes. IntÃ©ntalo de nuevo.",variant:"destructive"})}finally{m(!1)}},k=b=>{const V=s.restaurants||[],K=n;let G,S;if(b.isSelected)G=V.filter(F=>F.id!==b.id),S=K.filter(F=>F!==b.id);else{const F={...b,isSelected:!0};G=[...V.filter(J=>J.id!==b.id),F],S=[...K.filter(J=>J!==b.id),b.id]}c(F=>F.map(J=>J.id===b.id?{...J,isSelected:!J.isSelected}:J)),t({...s,restaurants:G,selectedRestaurants:S})},P=a.filter(b=>!(w!=="all"&&b.priceLevel!==parseInt(w)||h!=="all"&&(!b.rating||b.rating<parseFloat(h)))),q=b=>b?"â‚¬".repeat(b):"N/A",U=a.filter(b=>b.isSelected).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ss,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Recomendaciones de Restaurantes"})]}),e.jsxs(re,{children:[e.jsx(ie,{children:e.jsx(le,{className:"text-sm",children:"ConfiguraciÃ³n de BÃºsqueda"})}),e.jsxs(ne,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar cerca de"}),e.jsxs("div",{className:"flex flex-col gap-2 border rounded-md p-3",children:[g.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Configura un venue u hotel con direcciÃ³n"}),g.map(b=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ze,{checked:u.includes(b.key),onCheckedChange:V=>{v(K=>V?Array.from(new Set([...K,b.key])):K.filter(G=>G!==b.key))}}),e.jsx("span",{children:b.label})]},b.key))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Radio de bÃºsqueda"}),e.jsxs(he,{value:N,onValueChange:y,children:[e.jsx(pe,{children:e.jsx(ge,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"1000",children:"1 km"}),e.jsx(M,{value:"2000",children:"2 km"}),e.jsx(M,{value:"5000",children:"5 km"}),e.jsx(M,{value:"10000",children:"10 km"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Precio"}),e.jsxs(he,{value:w,onValueChange:l,children:[e.jsx(pe,{children:e.jsx(ge,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"all",children:"Todos los precios"}),e.jsx(M,{value:"1",children:"â‚¬ (EconÃ³mico)"}),e.jsx(M,{value:"2",children:"â‚¬â‚¬ (Moderado)"}),e.jsx(M,{value:"3",children:"â‚¬â‚¬â‚¬ (Caro)"}),e.jsx(M,{value:"4",children:"â‚¬â‚¬â‚¬â‚¬ (Muy caro)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"ValoraciÃ³n mÃ­nima"}),e.jsxs(he,{value:h,onValueChange:j,children:[e.jsx(pe,{children:e.jsx(ge,{})}),e.jsxs(xe,{children:[e.jsx(M,{value:"all",children:"Cualquier valoraciÃ³n"}),e.jsx(M,{value:"3.0",children:"3+ â­"}),e.jsx(M,{value:"4.0",children:"4+ â­"}),e.jsx(M,{value:"4.5",children:"4.5+ â­"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{onClick:C,disabled:i||u.length===0,className:"flex items-center gap-2",children:[i?e.jsx(we,{className:"h-4 w-4 animate-spin"}):e.jsx(Cs,{className:"h-4 w-4"}),"Buscar restaurantes"]}),e.jsx(W,{variant:"outline",onClick:C,disabled:i,size:"icon",children:e.jsx(vs,{className:`h-4 w-4 ${i?"animate-spin":""}`})})]}),U>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[U," restaurante",U!==1?"s":""," seleccionado",U!==1?"s":""," para incluir en el PDF"]})]})]}),a.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",P.length," de ",a.length," restaurantes"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:P.map(b=>e.jsx(re,{className:`cursor-pointer transition-colors ${b.isSelected?"ring-2 ring-primary":""}`,children:e.jsxs(ne,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{checked:b.isSelected,onCheckedChange:()=>k(b)}),e.jsxs("div",{className:"flex items-center gap-2",children:[b.originLabel&&e.jsx(_e,{variant:"outline",className:"text-[10px] px-1 py-0",children:b.originLabel}),e.jsx("h3",{className:"font-medium text-sm",children:b.name})]})]}),b.rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ra,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-xs",children:b.rating.toFixed(1)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fe,{className:"h-3 w-3 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:b.address})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[b.priceLevel&&e.jsx("span",{className:"font-medium",children:q(b.priceLevel)}),b.distance&&e.jsx("span",{className:"text-muted-foreground",children:b.distance<1e3?`${b.distance}m`:`${(b.distance/1e3).toFixed(1)}km`})]}),b.cuisine&&b.cuisine.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:b.cuisine.slice(0,2).map(V=>e.jsx(_e,{variant:"secondary",className:"text-xs",children:V.replace(/_/g," ")},V))}),(b.phone||b.website)&&e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[b.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),e.jsx("span",{children:b.phone})]}),b.website&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Es,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:"Web"})]})]})]})]})},b.id))})]}),!i&&a.length===0&&u.length>0&&e.jsx(re,{children:e.jsxs(ne,{className:"p-8 text-center",children:[e.jsx(ss,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No hay restaurantes"}),e.jsx("p",{className:"text-muted-foreground",children:'Haz clic en "Buscar restaurantes" para encontrar opciones cerca de los orÃ­genes seleccionados'})]})}),u.length===0&&e.jsx(re,{children:e.jsxs(ne,{className:"p-8 text-center",children:[e.jsx(fe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"DirecciÃ³n requerida"}),e.jsx("p",{className:"text-muted-foreground",children:"Selecciona el venue y/o uno o mÃ¡s hoteles para buscar restaurantes cercanos"})]})})]})}const Pa=({showDialog:s,setShowDialog:t,onGeneratePDF:r,onGenerateXLS:a,isGenerating:c=!1})=>e.jsx(gs,{open:s,onOpenChange:t,children:e.jsxs(xs,{children:[e.jsx(fs,{children:e.jsx(js,{children:"Exportar Hoja de Ruta"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-semibold text-base",children:"Imprimir a PDF"}),e.jsxs(W,{onClick:()=>{r()},disabled:c,children:[e.jsx(oa,{className:"h-4 w-4 mr-2"}),"Documento Completo PDF"]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-semibold text-base",children:"Exportar a Excel"}),e.jsxs(W,{onClick:()=>{a()},disabled:c,children:[e.jsx(na,{className:"h-4 w-4 mr-2"}),"Hoja de Ruta Excel (Una pestaÃ±a por secciÃ³n)"]})]})]})]})});let ee;const D=s=>({font:{bold:s.bold||!1,sz:s.fontSize||11,color:s.textColor?{rgb:s.textColor}:void 0},fill:s.bgColor?{patternType:"solid",fgColor:{rgb:s.bgColor}}:void 0,alignment:{horizontal:s.alignment||"left",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}}),T=(s,t,r)=>{s[t]||(s[t]={t:"s",v:""}),s[t].s=r},Ma=s=>{const t=[["INFORMACIÃ“N DEL EVENTO"],[],["Campo","Valor"],["Nombre del Trabajo",s.jobTitle],["Nombre del Evento",s.eventData.eventName||""],["CÃ³digo del Evento",s.eventData.eventCode||""],["Tipo de Evento",s.eventData.eventType||""],["Cliente",s.eventData.clientName||""],["Fechas",s.eventData.eventDates||""],["Hora de Inicio",s.eventData.eventStartTime||""],["Hora de Fin",s.eventData.eventEndTime||""],["Hora de Montaje",s.eventData.setupTime||""],["Hora de Desmontaje",s.eventData.dismantleTime||""],["Asistentes Estimados",s.eventData.estimatedAttendees||""],["Estado",s.eventData.eventStatus||""]],r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:1}}),T(r,"A3",D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"})),T(r,"B3",D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}));for(let a=4;a<=t.length;a++)T(r,`A${a}`,D({bold:!0,bgColor:"ECF0F1"})),T(r,`B${a}`,D({}));return r["!cols"]=[{wch:25},{wch:50}],r},La=s=>{var a,c,i,m,N;const t=[["INFORMACIÃ“N DEL LUGAR"],[],["Campo","Valor"],["Nombre del Recinto",((a=s.eventData.venue)==null?void 0:a.name)||""],["DirecciÃ³n",((c=s.eventData.venue)==null?void 0:c.address)||""],["Tipo de Recinto",s.eventData.venueType||""],["Capacidad",s.eventData.venueCapacity||""],[],["CONTACTO DEL RECINTO"],[],["Nombre",((i=s.eventData.venueContact)==null?void 0:i.name)||""],["TelÃ©fono",((m=s.eventData.venueContact)==null?void 0:m.phone)||""],["Email",((N=s.eventData.venueContact)==null?void 0:N.email)||""]],r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),T(r,"A9",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:1}}),r["!merges"].push({s:{r:8,c:0},e:{r:8,c:1}}),T(r,"A3",D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"})),T(r,"B3",D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}));for(let y=4;y<=7;y++)T(r,`A${y}`,D({bold:!0,bgColor:"ECF0F1"})),T(r,`B${y}`,D({}));for(let y=11;y<=13;y++)T(r,`A${y}`,D({bold:!0,bgColor:"ECF0F1"})),T(r,`B${y}`,D({}));return r["!cols"]=[{wch:25},{wch:50}],r},$a=s=>{const t=[["CONTACTOS"],[],["Nombre","Rol","TelÃ©fono","Email"]];s.eventData.contacts&&s.eventData.contacts.length>0?s.eventData.contacts.forEach(a=>{t.push([a.name||"",a.role||"",a.phone||"",a.email||""])}):t.push(["No hay contactos registrados","","",""]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:3}}),["A3","B3","C3","D3"].forEach(a=>{T(r,a,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});for(let a=4;a<=t.length;a++){const c=a%2===0?"FFFFFF":"F8F9FA";["A","B","C","D"].forEach(i=>{T(r,`${i}${a}`,D({bgColor:c}))})}return r["!cols"]=[{wch:25},{wch:20},{wch:15},{wch:30}],r},qa=s=>{const t=[["PERSONAL"],[],["Nombre","Apellidos","DNI","PosiciÃ³n","Departamento","TelÃ©fono","Rol"]];s.eventData.staff&&s.eventData.staff.length>0?s.eventData.staff.forEach(a=>{const c=[a.surname1,a.surname2].filter(Boolean).join(" ");t.push([a.name||"",c,a.dni||"",a.position||"",a.department||"",a.phone||"",a.role||""])}):t.push(["No hay personal registrado","","","","","",""]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:6}}),["A3","B3","C3","D3","E3","F3","G3"].forEach(a=>{T(r,a,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});for(let a=4;a<=t.length;a++){const c=a%2===0?"FFFFFF":"F8F9FA";["A","B","C","D","E","F","G"].forEach(i=>{T(r,`${i}${a}`,D({bgColor:c}))})}return r["!cols"]=[{wch:15},{wch:20},{wch:12},{wch:20},{wch:15},{wch:15},{wch:15}],r},Ba=s=>{const t=[["VIAJES"],[],["Tipo de Transporte","DirecciÃ³n Recogida","Hora Recogida","Hora Salida","Hora Llegada","NÃºm. Vuelo/Tren","CompaÃ±Ã­a","Notas"]];s.travelArrangements&&s.travelArrangements.length>0?s.travelArrangements.forEach(a=>{const c=i=>{if(!i)return"";try{return bs(new Date(i),"dd/MM/yyyy HH:mm",{locale:la})}catch{return i}};t.push([a.transportation_type||"",a.pickup_address||"",c(a.pickup_time),c(a.departure_time),c(a.arrival_time),a.flight_train_number||"",a.company||"",a.notes||""])}):t.push(["No hay viajes registrados","","","","","","",""]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:7}}),["A3","B3","C3","D3","E3","F3","G3","H3"].forEach(a=>{T(r,a,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});for(let a=4;a<=t.length;a++){const c=a%2===0?"FFFFFF":"F8F9FA";["A","B","C","D","E","F","G","H"].forEach(i=>{T(r,`${i}${a}`,D({bgColor:c}))})}return r["!cols"]=[{wch:18},{wch:25},{wch:18},{wch:18},{wch:18},{wch:15},{wch:20},{wch:30}],r},Va=s=>{var c;const t=[["ALOJAMIENTO"],[]];s.accommodations&&s.accommodations.length>0?s.accommodations.forEach((i,m)=>{m>0&&t.push([]),t.push([`HOTEL ${m+1}`,""]),t.push(["Hotel",i.hotel_name||""]),t.push(["DirecciÃ³n",i.address||""]),t.push(["Check-in",i.check_in||""]),t.push(["Check-out",i.check_out||""]),t.push([]),t.push(["Tipo de HabitaciÃ³n","NÃºmero","Persona 1","Persona 2"]),i.rooms&&i.rooms.length>0?i.rooms.forEach(N=>{t.push([N.room_type||"",N.room_number||"",N.staff_member1_id||"",N.staff_member2_id||""])}):t.push(["No hay habitaciones asignadas","","",""])}):t.push(["No hay alojamientos registrados"]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:3}});let a=3;return(c=s.accommodations)==null||c.forEach(()=>{T(r,`A${a}`,D({bold:!0,bgColor:"3498DB",textColor:"FFFFFF"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:a-1,c:0},e:{r:a-1,c:1}}),a++;for(let m=0;m<4;m++)T(r,`A${a}`,D({bold:!0,bgColor:"ECF0F1"})),T(r,`B${a}`,D({})),a++;a++,["A","B","C","D"].forEach(m=>{T(r,`${m}${a}`,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))}),a++;const i=5;for(let m=0;m<i;m++){const N=m%2===0?"FFFFFF":"F8F9FA";["A","B","C","D"].forEach(y=>{T(r,`${y}${a}`,D({bgColor:N}))}),a++}a++}),r["!cols"]=[{wch:20},{wch:20},{wch:25},{wch:25}],r},Ia=s=>{var m,N,y,w;const t=((m=s.eventData.logistics)==null?void 0:m.transport)||[],r=[["LOGÃSTICA Y TRANSPORTE"],[],["Tipo de Transporte","Conductor","TelÃ©fono","MatrÃ­cula","CompaÃ±Ã­a","Fecha/Hora","Â¿Retorno?","Fecha/Hora Retorno"]];t.length>0?t.forEach(l=>{const h={trailer:"TrÃ¡iler","9m":"CamiÃ³n 9m","8m":"CamiÃ³n 8m","6m":"CamiÃ³n 6m","4m":"CamiÃ³n 4m",furgoneta:"Furgoneta"},j={pantoja:"Pantoja",transluminaria:"Transluminaria",transcamarena:"Transcamarena","wild tour":"Wild Tour",camionaje:"Camionaje","sector-pro":"Sector Pro",crespo:"Crespo",montabi_dorado:"Montabi Dorado",grupo_sese:"Grupo SesÃ©",nacex:"Nacex",recogida_cliente:"Recogida Cliente",other:"Otro"};r.push([h[l.transport_type]||l.transport_type,l.driver_name||"",l.driver_phone||"",l.license_plate||"",l.company?j[l.company]||l.company:"",l.date_time||"",l.has_return?"SÃ­":"No",l.return_date_time||""])}):r.push(["No hay transporte registrado","","","","","","",""]),r.push([]),r.push(["DETALLES DE LOGÃSTICA"]),r.push([]),r.push(["Detalles de Carga",((N=s.eventData.logistics)==null?void 0:N.loadingDetails)||"No especificado"]),r.push(["Detalles de Descarga",((y=s.eventData.logistics)==null?void 0:y.unloadingDetails)||"No especificado"]),r.push(["LogÃ­stica de Equipamiento",((w=s.eventData.logistics)==null?void 0:w.equipmentLogistics)||"No especificado"]);const a=ee.utils.aoa_to_sheet(r);T(a,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),a["!merges"]||(a["!merges"]=[]),a["!merges"].push({s:{r:0,c:0},e:{r:0,c:7}}),["A3","B3","C3","D3","E3","F3","G3","H3"].forEach(l=>{T(a,l,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});const c=4+t.length;for(let l=4;l<=c;l++){const h=l%2===0?"FFFFFF":"F8F9FA";["A","B","C","D","E","F","G","H"].forEach(j=>{T(a,`${j}${l}`,D({bgColor:h}))})}const i=c+2;T(a,`A${i}`,D({bold:!0,fontSize:12,bgColor:"3498DB",textColor:"FFFFFF",alignment:"center"})),a["!merges"].push({s:{r:i-1,c:0},e:{r:i-1,c:7}});for(let l=0;l<3;l++){const h=i+2+l;T(a,`A${h}`,D({bold:!0,bgColor:"ECF0F1"})),T(a,`B${h}`,D({})),a["!merges"].push({s:{r:h-1,c:1},e:{r:h-1,c:7}})}return a["!cols"]=[{wch:18},{wch:20},{wch:15},{wch:12},{wch:20},{wch:18},{wch:10},{wch:18}],a},Ha=s=>{const t=[["PROGRAMA / HORARIO"],[]];s.eventData.programScheduleDays&&s.eventData.programScheduleDays.length>0?s.eventData.programScheduleDays.forEach((c,i)=>{i>0&&t.push([]),t.push([c.label||`DÃ­a ${i+1}`,c.date||""]),t.push(["Hora","Actividad","Departamento","Notas"]),c.rows&&c.rows.length>0?c.rows.forEach(m=>{t.push([m.time||"",m.item||"",m.dept||"",m.notes||""])}):t.push(["No hay actividades programadas","","",""])}):s.eventData.programSchedule&&s.eventData.programSchedule.length>0?(t.push(["Hora","Actividad","Departamento","Notas"]),s.eventData.programSchedule.forEach(c=>{t.push([c.time||"",c.item||"",c.dept||"",c.notes||""])})):s.eventData.schedule?(t.push(["Programa"]),t.push([s.eventData.schedule])):t.push(["No hay programa registrado"]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:3}});let a=3;if(s.eventData.programScheduleDays&&s.eventData.programScheduleDays.length>0)s.eventData.programScheduleDays.forEach(c=>{var m;T(r,`A${a}`,D({bold:!0,bgColor:"3498DB",textColor:"FFFFFF"})),T(r,`B${a}`,D({bold:!0,bgColor:"3498DB",textColor:"FFFFFF"})),r["!merges"].push({s:{r:a-1,c:0},e:{r:a-1,c:1}}),a++,["A","B","C","D"].forEach(N=>{T(r,`${N}${a}`,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))}),a++;const i=((m=c.rows)==null?void 0:m.length)||1;for(let N=0;N<i;N++){const y=N%2===0?"FFFFFF":"F8F9FA";["A","B","C","D"].forEach(w=>{T(r,`${w}${a}`,D({bgColor:y}))}),a++}a++});else if(s.eventData.programSchedule){["A3","B3","C3","D3"].forEach(c=>{T(r,c,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});for(let c=4;c<=3+s.eventData.programSchedule.length;c++){const i=c%2===0?"FFFFFF":"F8F9FA";["A","B","C","D"].forEach(m=>{T(r,`${m}${c}`,D({bgColor:i}))})}}return r["!cols"]=[{wch:12},{wch:40},{wch:15},{wch:30}],r},za=s=>{const t=[["PREVISIÃ“N METEOROLÃ“GICA"],[],["Fecha","CondiciÃ³n","Temp. MÃ¡x. (Â°C)","Temp. MÃ­n. (Â°C)","Prob. PrecipitaciÃ³n (%)"]];s.eventData.weather&&s.eventData.weather.length>0?s.eventData.weather.forEach(a=>{t.push([a.date||"",a.condition||"",a.maxTemp||"",a.minTemp||"",a.precipitationProbability||""])}):t.push(["No hay datos meteorolÃ³gicos disponibles","","","",""]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:4}}),["A3","B3","C3","D3","E3"].forEach(a=>{T(r,a,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});for(let a=4;a<=t.length;a++){const c=a%2===0?"FFFFFF":"F8F9FA";["A","B","C","D","E"].forEach(i=>{T(r,`${i}${a}`,D({bgColor:c}))})}return r["!cols"]=[{wch:15},{wch:25},{wch:15},{wch:15},{wch:20}],r},Oa=s=>{const t=[["RESTAURANTES"],[],["Nombre","DirecciÃ³n","Tipo de Cocina","ValoraciÃ³n","TelÃ©fono","Sitio Web"]];if(s.eventData.restaurants&&s.eventData.restaurants.length>0){const a=s.eventData.restaurants.filter(i=>{var m;return(m=s.eventData.selectedRestaurants)==null?void 0:m.includes(i.id)});(a.length>0?a:s.eventData.restaurants).forEach(i=>{var m;t.push([i.name||"",i.address||"",((m=i.cuisine)==null?void 0:m.join(", "))||"",i.rating?`${i.rating}/5`:"",i.phone||"",i.website||""])})}else t.push(["No hay restaurantes registrados","","","","",""]);const r=ee.utils.aoa_to_sheet(t);T(r,"A1",D({bold:!0,fontSize:14,bgColor:"2980B9",textColor:"FFFFFF",alignment:"center"})),r["!merges"]||(r["!merges"]=[]),r["!merges"].push({s:{r:0,c:0},e:{r:0,c:5}}),["A3","B3","C3","D3","E3","F3"].forEach(a=>{T(r,a,D({bold:!0,bgColor:"34495E",textColor:"FFFFFF"}))});for(let a=4;a<=t.length;a++){const c=a%2===0?"FFFFFF":"F8F9FA";["A","B","C","D","E","F"].forEach(i=>{T(r,`${i}${a}`,D({bgColor:c}))})}return r["!cols"]=[{wch:30},{wch:35},{wch:20},{wch:12},{wch:15},{wch:30}],r},Ga=async s=>{ee??(ee=await ia());const t=ee.utils.book_new(),r=Ma(s),a=La(s),c=$a(s),i=qa(s),m=Ba(s),N=Va(s),y=Ia(s),w=Ha(s),l=za(s),h=Oa(s);ee.utils.book_append_sheet(t,r,"Evento"),ee.utils.book_append_sheet(t,a,"Recinto"),ee.utils.book_append_sheet(t,c,"Contactos"),ee.utils.book_append_sheet(t,i,"Personal"),ee.utils.book_append_sheet(t,m,"Viajes"),ee.utils.book_append_sheet(t,N,"Alojamiento"),ee.utils.book_append_sheet(t,y,"LogÃ­stica"),ee.utils.book_append_sheet(t,w,"Programa"),ee.utils.book_append_sheet(t,l,"MeteorologÃ­a"),ee.utils.book_append_sheet(t,h,"Restaurantes");const j=bs(new Date,"yyyy-MM-dd"),n=`hoja_de_ruta_${s.jobTitle.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${j}.xlsx`;ee.writeFile(t,n,{cellStyles:!0})},hs=({jobId:s})=>{const{toast:t}=Ne(),[r,a]=x.useState("event"),[c,i]=x.useState(0),[m,N]=x.useState(!1),[y,w]=x.useState(!1),{images:l,imagePreviews:h,venueMapPreview:j,handleImageUpload:f,removeImage:n,handleVenueMapInputChange:p,handleVenueMapUrl:d,appendVenuePreviews:o}=ya(),g=Vs.useMemo(()=>{var A;const _=[];return(A=h.venue)==null||A.forEach($=>{_.push({image_path:$,image_type:"venue"})}),j&&_.push({image_path:j,image_type:"venue_map"}),_},[h.venue,j]),{eventData:u,setEventData:v,selectedJobId:C,setSelectedJobId:k,travelArrangements:P,accommodations:q,setAccommodations:U,isLoadingJobs:X,isLoadingHojaDeRuta:se,isSaving:Y,jobs:z,hojaDeRuta:b,handleSaveAll:V,isInitialized:K,hasSavedData:G,hasBasicJobData:S,isDirty:F,autoPopulateFromJob:J,handleContactChange:H,addContact:de,handleStaffChange:me,addStaffMember:ae,updateTravelArrangement:te,addTravelArrangement:L,removeTravelArrangement:Z,addAccommodation:ce,removeAccommodation:Me,updateRoom:Le,addRoom:$e,removeRoom:qe,updateTransport:Be,addTransport:Ve,removeTransport:Ie,importTransports:He}=ba(g);x.useEffect(()=>{s&&C!==s&&k(s)},[s,C,k]),x.useEffect(()=>{(()=>{let A=0;const $=10;u.eventName&&u.eventDates&&A++,u.venue.name&&u.venue.address&&A++,u.weather&&u.weather.length>0&&A++,u.contacts.some(E=>E.name&&E.phone)&&A++,u.staff.some(E=>E.name&&E.position)&&A++,P.some(E=>E.transportation_type)&&A++,q.some(E=>E.hotel_name||E.rooms.some(I=>I.room_type))&&A++,(u.logistics.transport||u.logistics.loadingDetails)&&A++,u.schedule&&A++,u.restaurants&&u.restaurants.some(E=>E.isSelected)&&A++,i(A/$*100)})()},[u,P,q]);const ze=async()=>{if(!C){t({title:"Error",description:"Por favor, seleccione un trabajo antes de generar el documento.",variant:"destructive"});return}N(!0);try{(F||G)&&await V();const{generatePDF:_}=await Rs(async()=>{const{generatePDF:I}=await import("./index-BI_PM-xL.js");return{generatePDF:I}},__vite__mapDeps([0,1,2,3,4,5,6])),A={...u,metadata:b?{id:b.id,document_version:b.document_version||1,status:b.status||"draft",created_at:b.created_at||new Date().toISOString(),updated_at:b.updated_at||new Date().toISOString(),last_modified:b.last_modified||new Date().toISOString()}:void 0},$=z==null?void 0:z.find(I=>I.id===C),E=q.flatMap(I=>I.rooms);await _(A,P,E,h,j,C,($==null?void 0:$.title)||"",($==null?void 0:$.start_time)||void 0,t,q),t({title:"âœ… Documento generado",description:"La hoja de ruta ha sido generada correctamente."})}catch{t({title:"âŒ Error",description:"Hubo un problema al generar el documento.",variant:"destructive"})}finally{N(!1)}},Oe=async()=>{if(!C){t({title:"Error",description:"Por favor, seleccione un trabajo antes de exportar.",variant:"destructive"});return}try{const _=z==null?void 0:z.find(A=>A.id===C);await Ga({eventData:u,travelArrangements:P,accommodations:q,jobTitle:(_==null?void 0:_.title)||"",jobDate:(_==null?void 0:_.start_time)||void 0}),t({title:"âœ… Exportado correctamente",description:"La hoja de ruta ha sido exportada a Excel."}),w(!1)}catch{t({title:"âŒ Error",description:"Hubo un problema al exportar a Excel.",variant:"destructive"})}},Ge=async()=>{if(!C){t({title:"Error",description:"No hay trabajo seleccionado para cargar datos.",variant:"destructive"});return}try{const _=await J();_&&Object.keys(_).length>0&&v(A=>({...A,..._}))}catch{t({title:"âŒ Error",description:"No se pudieron cargar los datos del trabajo.",variant:"destructive"})}},Ue=async()=>{if(!C){t({title:"Error",description:"Por favor, seleccione un trabajo antes de guardar.",variant:"destructive"});return}try{await V()}catch{}},Ke=()=>{switch((b==null?void 0:b.status)||"draft"){case"draft":return{icon:Ss,color:"bg-yellow-500",text:"Borrador"};case"review":return{icon:ma,color:"bg-blue-500",text:"En RevisiÃ³n"};case"approved":return{icon:es,color:"bg-green-500",text:"Aprobado"};case"final":return{icon:es,color:"bg-green-600",text:"Final"};default:return{icon:cs,color:"bg-gray-500",text:"Sin Estado"}}},Je=()=>G?{icon:ha,color:"bg-green-100 text-green-800 border-green-200",text:"Datos Guardados"}:S?{icon:ua,color:"bg-blue-100 text-blue-800 border-blue-200",text:"Datos BÃ¡sicos"}:{icon:cs,color:"bg-gray-100 text-gray-800 border-gray-200",text:"Sin Datos"},Ee=[{id:"event",label:"Evento",icon:_s,color:"text-blue-600"},{id:"venue",label:"Venue",icon:fe,color:"text-green-600"},{id:"weather",label:"Clima",icon:Xe,color:"text-sky-600"},{id:"contacts",label:"Contactos",icon:Ae,color:"text-purple-600"},{id:"staff",label:"Personal",icon:Fs,color:"text-orange-600"},{id:"travel",label:"Viajes",icon:ve,color:"text-cyan-600"},{id:"accommodation",label:"Alojamiento",icon:ys,color:"text-pink-600"},{id:"logistics",label:"LogÃ­stica",icon:Pe,color:"text-indigo-600"},{id:"schedule",label:"Programa",icon:As,color:"text-red-600"},{id:"restaurants",label:"Restaurantes",icon:ss,color:"text-emerald-600"}];if(se)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(O.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-gradient-to-br from-primary to-primary/60 rounded-full flex items-center justify-center",children:e.jsx(Ns,{className:"w-8 h-8 text-white animate-pulse"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"Preparando el espacio de trabajo..."}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando datos de la hoja de ruta"})]})});const De=Ke(),ke=Je(),We=De.icon,Qe=ke.icon;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20",children:[e.jsx(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"sticky top-0 z-50 bg-background/95 backdrop-blur-lg border-b border-border/40",children:e.jsxs("div",{className:"max-w-screen-2xl mx-auto px-4 md:px-6 py-3 md:py-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-primary/60 rounded-xl flex items-center justify-center",children:e.jsx(ca,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent leading-tight",children:"Hoja de Ruta"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Sistema integral de gestiÃ³n de eventos"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[b&&e.jsxs(_e,{variant:"outline",className:"flex items-center gap-1 border-2",children:[e.jsx(We,{className:"w-3 h-3"}),De.text]}),e.jsxs(_e,{variant:"outline",className:ke.color,children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),ke.text]}),F&&e.jsx(_e,{variant:"outline",className:"bg-orange-100 text-orange-800 border-orange-200",children:"ðŸ’¾ Cambios sin guardar"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(us,{progress:c})}),e.jsx(W,{onClick:Ue,disabled:!C||!K||Y,variant:"outline",size:"sm","aria-label":"Guardar hoja de ruta",className:"h-11 min-w-[44px] border-2 border-green-500 text-green-600 hover:bg-green-50",children:Y?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Guardar"})]})}),e.jsxs(W,{onClick:()=>w(!0),disabled:!C,"aria-label":"Exportar",className:"h-11 min-w-[44px] bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70",children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar"})]})]})]}),e.jsxs("div",{className:"mt-2 md:mt-3 text-[11px] md:text-xs text-muted-foreground flex items-center gap-3 md:gap-4 overflow-x-auto whitespace-nowrap [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[!C&&e.jsx("span",{className:"text-amber-600 font-medium",children:"âš ï¸ Selecciona un trabajo para comenzar"}),C&&!K&&e.jsx("span",{className:"text-blue-600 font-medium",children:"â³ Inicializando..."}),C&&K&&G&&e.jsx("span",{className:"text-green-600 font-medium",children:"âœ… Datos guardados cargados"}),C&&K&&!G&&S&&e.jsx("span",{className:"text-blue-600 font-medium",children:"ðŸ“‹ Datos bÃ¡sicos cargados"}),C&&K&&u.staff.some(_=>_.name||_.position)&&e.jsxs("span",{className:"text-purple-600 font-medium",children:["ðŸ‘¥ Personal: ",u.staff.filter(_=>_.name||_.position).length," asignado(s)"]})]})]})}),e.jsx("div",{className:"max-w-screen-2xl mx-auto px-4 md:px-6 py-4 md:py-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6",children:[e.jsx("div",{className:"hidden md:block md:col-span-3",children:e.jsx("div",{className:"sticky top-24 space-y-4",children:e.jsxs(re,{className:"border-2",children:[e.jsx(ie,{className:"pb-3",children:e.jsxs(le,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"NavegaciÃ³n RÃ¡pida"]})}),e.jsx(ne,{className:"space-y-2",children:Ee.map(_=>{const A=_.icon;return e.jsxs(W,{variant:r===_.id?"default":"ghost",size:"sm",onClick:()=>a(_.id),className:`w-full justify-start ${r===_.id?"bg-primary text-primary-foreground":""}`,children:[e.jsx(A,{className:`w-4 h-4 mr-2 ${_.color}`}),_.label]},_.id)})})]})})}),e.jsx("div",{className:"md:col-span-9",children:e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("div",{className:"md:hidden -mx-4 px-4 mb-3 sticky top-[68px] z-40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80 border-b border-border/40",children:[e.jsx("nav",{"aria-label":"Secciones de Hoja de Ruta",role:"tablist",className:"flex items-center gap-2.5 py-2 overflow-x-auto whitespace-nowrap [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:Ee.map(_=>{const A=_.icon,$=r===_.id,E=$?"text-primary-foreground":"text-foreground/70";return e.jsxs("button",{role:"tab","aria-selected":$,"aria-controls":`panel-${_.id}`,onClick:()=>a(_.id),className:`shrink-0 inline-flex items-center h-9 px-3 rounded-full border text-[13px] leading-none min-w-[44px] transition-colors ${$?"bg-primary text-primary-foreground border-primary shadow-sm":"bg-muted/60 text-foreground border-border/60 hover:bg-muted"}`,children:[e.jsx(A,{className:`w-4 h-4 mr-1.5 ${E}`}),_.label]},_.id)})}),e.jsx("div",{className:"py-2",children:e.jsx(us,{progress:c})})]}),e.jsx(Is,{value:r,onValueChange:a,className:"space-y-6",children:e.jsx(je,{mode:"wait",children:e.jsxs(O.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:[e.jsx(ue,{value:"event",className:"mt-0",id:"panel-event",role:"tabpanel",children:e.jsx(_a,{eventData:u,setEventData:v,selectedJobId:C,setSelectedJobId:k,jobs:z,isLoadingJobs:X,jobDetails:null,onAutoPopulate:Ge,hideJobSelection:!!s})}),e.jsx(ue,{value:"venue",className:"mt-0",id:"panel-venue",role:"tabpanel",children:e.jsx(Na,{eventData:u,setEventData:v,images:l,imagePreviews:h,onImageUpload:f,onRemoveImage:n,onVenueMapUpload:_=>{p({target:{files:[_]}})},handleVenueMapUrl:d,appendVenuePreviews:o})}),e.jsx(ue,{value:"weather",className:"mt-0",id:"panel-weather",role:"tabpanel",children:e.jsx(Ta,{eventData:u,setEventData:v})}),e.jsx(ue,{value:"contacts",className:"mt-0",id:"panel-contacts",role:"tabpanel",children:e.jsx(wa,{eventData:u,onContactChange:H,onAddContact:de})}),e.jsx(ue,{value:"staff",className:"mt-0",id:"panel-staff",role:"tabpanel",children:e.jsx(Fa,{eventData:u,onStaffChange:me,onAddStaff:ae})}),e.jsx(ue,{value:"travel",className:"mt-0",id:"panel-travel",role:"tabpanel",children:e.jsx(Sa,{travelArrangements:P,onUpdate:te,onAdd:L,onRemove:Z})}),e.jsx(ue,{value:"accommodation",className:"mt-0",id:"panel-accommodation",role:"tabpanel",children:e.jsx(ka,{accommodations:q,eventData:u,onUpdateAccommodation:(_,A)=>{U($=>$.map((E,I)=>I===_?{...E,...A}:E))},onUpdateRoom:Le,onAddAccommodation:ce,onRemoveAccommodation:Me,onAddRoom:$e,onRemoveRoom:qe})}),e.jsx(ue,{value:"logistics",className:"mt-0",id:"panel-logistics",role:"tabpanel",children:e.jsx(Ea,{eventData:u,setEventData:v,onUpdateTransport:Be,onAddTransport:Ve,onRemoveTransport:Ie,onImportTransports:He,jobId:s||C})}),e.jsx(ue,{value:"schedule",className:"mt-0",id:"panel-schedule",role:"tabpanel",children:e.jsx(Da,{eventData:u,setEventData:v})}),e.jsx(ue,{value:"restaurants",className:"mt-0",id:"panel-restaurants",role:"tabpanel",children:e.jsx(Ra,{eventData:u,onUpdateEventData:v,accommodations:q})})]},r)})})]})})]})}),e.jsx(Pa,{showDialog:y,setShowDialog:w,onGeneratePDF:ze,onGenerateXLS:Oe,isGenerating:m})]})},Bt=Object.freeze(Object.defineProperty({__proto__:null,ModernHojaDeRuta:hs,default:hs},Symbol.toStringTag,{value:"Module"}));export{ha as D,hs as M,Bt as a};
