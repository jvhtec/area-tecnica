import{d as Z,r as e,u as _,f as U,e as W,i as S,s as X,j as t,H as b,B as n,E as $}from"./index-NZ6jJLfQ.js";import{u as G}from"./useOptimizedJobs-BQ4L7-2d.js";import{J as Y}from"./folders-Scoqgw4s.js";import{E as tt}from"./EditJobDialog-DRKRzgWP.js";import{D as ot,L as et}from"./DepartmentMobileHub-CFFDzrQc.js";import{u as it}from"./useTabVisibility-TU5j192j.js";import{CalendarSection as rt}from"./CalendarSection-DRcHiGMy.js";import{TodaySchedule as st}from"./TodaySchedule-xMAV31Nm.js";import{S as T}from"./FlexFolderPicker-DHVHrWa7.js";import{Z as O}from"./zap-QKspq41J.js";import{F as A}from"./file-B1WzkXfC.js";import{V as mt}from"./video-BcyQPYgx.js";import{P as at}from"./plus-C3JQqq7t.js";import{s as nt}from"./subDays-D4REtaCB.js";import{s as pt,a as lt}from"./startOfMonth-B5dVCv8B.js";import{e as dt}from"./endOfMonth-Byhxb84j.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./useQuery-kdg2pmgf.js";import"./useSubscription-C3wu6ko-.js";import"./alert-dialog-CtyYUxwH.js";import"./useJobAssignmentsRealtime-7FZn5naq.js";import"./useRealtimeQuery-DRd58t-I.js";import"./useTableSubscription-Cu79jct8.js";import"./technicianAvailability-gbYgVBKV.js";import"./useJobRequiredRoles-Bz0ibKHS.js";import"./useMutation-DluhVBs1.js";import"./roleCategory-BtQgWHfO.js";import"./external-link-QJoXZ6ES.js";import"./api-C9EDenHJ.js";import"./config-DVV3VxR4.js";import"./constants-DoXhG9KB.js";import"./dryhireFolderService-Bb-tDpoa.js";import"./checkbox-BsRNEGV1.js";import"./dropdown-menu-Dn1SMjj1.js";import"./index-D9TsP8oP.js";import"./index-hC3MxXep.js";import"./chevron-right-Bn7Eu0F7.js";import"./circle-CWxDyDxx.js";import"./popover-Dl-b1R8L.js";import"./calendar--BDVgnXu.js";import"./isSameDay-m1OvdnsV.js";import"./isSameMonth-BQ4F6s8O.js";import"./addMonths-j-Bb577B.js";import"./differenceInCalendarMonths-6exvViir.js";import"./endOfWeek-BYLwoWuZ.js";import"./chevron-left-rq2ui83a.js";import"./badge-vNTKF5RD.js";import"./isWithinInterval-CV3kanO0.js";import"./filter-D0HnK7Nz.js";import"./calendar-_Cj_Sgy-.js";import"./ellipsis-vertical-zRAfIP3L.js";import"./square-pen-BMpSgZGa.js";import"./clock-BXPvTWvY.js";import"./users-DMnpVLUq.js";import"./truck-Br5sduv3.js";import"./isToday-BbpdYtC3.js";import"./constructNow-u0VlpghF.js";import"./DateTypeContextMenu-D-zx4rHd.js";import"./context-menu-DYP7Nyzl.js";import"./flexUuidService-C9yZjzP-.js";import"./plane-NSG-_bNT.js";import"./wrench-DzMvZxmF.js";import"./star-icpn3ybK.js";import"./mic-l4q2dREA.js";import"./moon-Bp9lP4EQ.js";import"./VideoTaskDialog-jFo9WRqF.js";import"./useWeatherData-d0TEdKFc.js";import"./weatherApi-BatwQpQy.js";import"./icon-D8sTZPYx.js";import"./progress-C8XsV-Me.js";import"./table-DnQAmABX.js";import"./lazyXlsx-BrFBF17_.js";import"./download-C1rVE0-J.js";import"./upload-DF4rjO7T.js";import"./optimisticJobDeletionService-Bq-53fU4.js";import"./folderNameSanitizer-DNdk00QU.js";import"./JobDetailsDialog-Cah6wZTf.js";import"./tabs-BdaywI_b.js";import"./useTourRateSubscriptions-Dd0aSU9f.js";import"./JobExtrasEditor-gQe73Sd8.js";import"./separator-E-JdTFOv.js";import"./ratesQueryKeys-DgMsgg6U.js";import"./euro-DgRTeGAz.js";import"./minus-InO4I9Ks.js";import"./circle-alert-LZYNzZ7F.js";import"./useJobRatesApproval-DsfA8V9C.js";import"./switch-DUBpZhIC.js";import"./alert-BqA-5jRM.js";import"./JobPayoutTotalsPanel-BSlgp62i.js";import"./useJobPayoutTotals-CXAavZS-.js";import"./useManagerJobQuotes-BrI1iNRY.js";import"./tourRateMath-BOmIkfWO.js";import"./logoUtils-D2o1jUVg.js";import"./logo-url-cache-eY6nfvu7.js";import"./lazyPdf-xVUlxKNu.js";import"./es-CSiFCUGj.js";import"./pen-D_H3YLSb.js";import"./file-down-Buu6FgvW.js";import"./send-Uvkx0r_O.js";import"./circle-check-big-CilmNGCn.js";import"./triangle-alert-D6qN0F8g.js";import"./JobExtrasManagement-CpH8R_KL.js";import"./receipt-CWKVL4Rh.js";import"./circle-check-C0N48OpO.js";import"./circle-x-DDzV-xk_.js";import"./file-text-igU140SQ.js";import"./eye-BE_DouVP.js";import"./pdfMerge-DXtLP7Xx.js";import"./pdf-libs-BqoGqu1a.js";import"./timesheet-pdf-82e1LStH.js";import"./avatar-QSp4LpEt.js";import"./places-restaurant-service-CakuSyx6.js";import"./utensils-crossed-CZeagqP3.js";import"./phone-BlFwiuho.js";import"./folder-plus-DTUhlRcm.js";import"./hard-drive-DZn0Cm3i.js";import"./printer-De77t3j8.js";import"./useMobileRealtimeSubscriptions-CkyUxSWV.js";import"./target-kNjpphh3.js";import"./lightbulb-BU2ctenD.js";import"./music-2-DRJ2zGwb.js";import"./eachDayOfInterval-CPmiA2bk.js";import"./endOfYear-D08D-xBX.js";import"./endOfQuarter-BH4-YKz9.js";import"./JobCardNew-ZLL_Hd_i.js";import"./ModernHojaDeRuta-DrMmS05m.js";import"./useJobSelection-B9iLNF5-.js";import"./MultiDayScheduleBuilder-DmGkt0fN.js";import"./building-BdT03Y2e.js";import"./arrow-up-BTt-lBKB.js";import"./copy-Dez5r9kU.js";import"./calendar-days-DcwEz6pd.js";import"./building-2-nIk8XRuA.js";import"./sparkles-BZkmCd_8.js";import"./image--Pql38nK.js";import"./settings-egXcSQW9.js";import"./user-E3OATBQk.js";import"./briefcase-BrpPecAy.js";import"./search-D-OiWg8h.js";import"./id-card-oCs3SPbN.js";import"./car-vrO_NvCk.js";import"./package-Oxfj-CNq.js";import"./activity-BNQuCEmB.js";import"./save-z_re-Mcq.js";import"./LogisticsEventDialog-WK7mGk6y.js";import"./transportOptions-CtHnG2xX.js";import"./transportProviders-CPS1W6Xy.js";import"./TaskManagerDialog-WHCTXr5s.js";import"./taskCompletion-NTcmWFA_.js";import"./TechnicianIncidentReportDialog-Bb0qWmts.js";import"./index-vfKqQWY5.js";import"./logo-service-SlbhM6-i.js";import"./jobDocumentsUpload-BaycvzFe.js";import"./clipboard-list-wtFE30Ps.js";import"./useFlexUuid-C0fmwl_8.js";import"./command-D3uMBT-Z.js";import"./message-circle-Bh9rUoQO.js";import"./info-CpCfiYD2.js";import"./userName-BCcvOtN-.js";import"./scroll-area-BHjMXddA.js";const bi=()=>{const h=Z(),[g,p]=e.useState(!1),[I,f]=e.useState(void 0),[j,l]=e.useState(!1),[x,C]=e.useState(!1),[D,y]=e.useState(null),[v,w]=e.useState(null),[r,N]=e.useState(new Date),m="video",{userRole:d}=_(),L=e.useMemo(()=>[{label:"Pesos",to:"/video-pesos-tool",icon:T},{label:"Consumos",to:"/video-consumos-tool",icon:O},{label:"Memoria técnica",to:"/video-memoria-tecnica",icon:A}],[]),k=U(),{toast:c}=W();it(["optimized-jobs"]);const J=r??new Date,P=nt(pt(J),7),R=lt(dt(J),14),{data:u,isLoading:ct}=G(m,P,R);e.useEffect(()=>{const o=i=>{const s=document.activeElement;if(!!s&&(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable))return;i.key.toLowerCase()==="n"&&(i.metaKey||i.ctrlKey)&&(i.preventDefault(),f(void 0),p(!0))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[]);const a=e.useMemo(()=>u?u.filter(o=>{var s;return(s=o.job_departments)==null?void 0:s.some(M=>M.department===m)}):[],[u,m]),V=e.useMemo(()=>{if(!r)return[];const o=S(r,"yyyy-MM-dd");return a.filter(i=>S(new Date(i.start_time),"yyyy-MM-dd")===o)},[r,a]),z=e.useCallback(()=>{},[]),q=e.useCallback(o=>{y(o),l(!0)},[]),F=e.useCallback(o=>{w(o),C(!0)},[]),H=e.useCallback(async o=>{if(window.confirm("Are you sure you want to delete this job?"))try{const{error:i}=await X.from("jobs").delete().eq("id",o);if(i)throw i;c({title:"Job deleted",description:"The job has been successfully deleted."}),await k.invalidateQueries({queryKey:["optimized-jobs"]})}catch(i){c({title:"Error deleting job",description:i.message,variant:"destructive"})}},[k,c]),K=e.useCallback(()=>{l(!1)},[]),B=e.useCallback(()=>{},[]),Q=e.useCallback(o=>{C(o),o||w(null)},[]),E=e.useCallback(o=>{f(o),p(!0)},[]);return t.jsxs("div",{className:"min-h-screen bg-background text-foreground p-4 md:p-8",children:[t.jsxs("div",{className:"mx-auto w-full max-w-full space-y-6",children:[h&&t.jsx(ot,{department:m,title:"Departamento de vídeo",icon:mt,tools:L,jobs:a,date:r??new Date,onDateSelect:o=>N(o)}),!h&&t.jsxs(t.Fragment,{children:[t.jsx(et,{onCreateJob:E,department:"Video",canCreate:d?["admin","management"].includes(d):!0}),t.jsx("div",{className:"bg-card border border-border rounded-xl p-3 sm:p-4 shadow-sm",children:t.jsxs("div",{className:"flex flex-wrap gap-3 sm:gap-4 items-center justify-end",children:[t.jsx(b,{to:"/video-pesos-tool",children:t.jsxs(n,{variant:"outline",className:"gap-2",children:[t.jsx(T,{className:"h-4 w-4"}),"Weight Calculator"]})}),t.jsx(b,{to:"/video-consumos-tool",children:t.jsxs(n,{variant:"outline",className:"gap-2",children:[t.jsx(O,{className:"h-4 w-4"}),"Power Calculator"]})}),t.jsx(b,{to:"/video-memoria-tecnica",children:t.jsxs(n,{variant:"outline",className:"gap-2",children:[t.jsx(A,{className:"h-4 w-4"}),"Memoria Técnica"]})})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-6",children:[t.jsx("div",{className:"xl:col-span-8 2xl:col-span-9",children:t.jsx("div",{className:"bg-card rounded-xl border border-border shadow-sm",children:t.jsx(rt,{date:r,onDateSelect:N,jobs:a,department:m,onDateTypeChange:z})})}),t.jsx("div",{className:"xl:col-span-4 2xl:col-span-3 hidden md:block",children:t.jsx("div",{className:"bg-card rounded-xl border border-border shadow-sm",children:t.jsx(st,{jobs:V,onEditClick:F,onDeleteClick:H,onJobClick:q,userRole:d,selectedDate:r,detailsOnlyMode:!0,viewMode:"sidebar"})})})]})]}),g?t.jsx($,{open:g,onOpenChange:p,currentDepartment:m,initialDate:r,initialJobType:I,onCreated:o=>{y(o.id),l(!0)}}):null,D&&j?t.jsx(Y,{isOpen:j,onClose:K,onAssignmentChange:B,jobId:D,department:m}):null,v&&x?t.jsx(tt,{open:x,onOpenChange:Q,job:v}):null,t.jsx(n,{className:"sm:hidden fixed bottom-6 right-6 rounded-full h-12 w-12 p-0 shadow-lg",onClick:()=>E(void 0),children:t.jsx(at,{className:"h-6 w-6"})})]})};export{bi as default};
