import{d as de,r as p,y as _,z as y,j as e,Q as a,B as h,U as q,i as A,C as U,V as oe,aB as R,s as g}from"./index-NZ6jJLfQ.js";import{D as me,a as xe,b as pe,c as V}from"./dropdown-menu-Dn1SMjj1.js";import{P as w,a as M,b as C}from"./popover-Dl-b1R8L.js";import{C as he}from"./calendar--BDVgnXu.js";import{B as Q}from"./badge-vNTKF5RD.js";import{M as ue}from"./message-square-a2K2ewo9.js";import{M as fe}from"./mail-1T3Omkp6.js";import{F as W}from"./filter-D0HnK7Nz.js";import{C as ge}from"./chevron-left-rq2ui83a.js";import{C as be}from"./chevron-right-Bn7Eu0F7.js";import{C as je}from"./calendar-_Cj_Sgy-.js";import{E as Ne}from"./ellipsis-vertical-zRAfIP3L.js";import{S as ve}from"./square-pen-BMpSgZGa.js";import{i as $}from"./isWithinInterval-CV3kanO0.js";import{i as _e}from"./isToday-BbpdYtC3.js";import{s as ye}from"./subDays-D4REtaCB.js";import{a as we}from"./startOfMonth-B5dVCv8B.js";import"./vite-preload-helper-ckwbz45p.js";import"./commonjs-helpers-Cpj98o6Y.js";import"./index-D9TsP8oP.js";import"./index-hC3MxXep.js";import"./circle-CWxDyDxx.js";import"./isSameDay-m1OvdnsV.js";import"./isSameMonth-BQ4F6s8O.js";import"./addMonths-j-Bb577B.js";import"./differenceInCalendarMonths-6exvViir.js";import"./endOfWeek-BYLwoWuZ.js";import"./endOfMonth-Byhxb84j.js";import"./constructNow-u0VlpghF.js";const t={bg:"bg-background",card:"bg-card border-border shadow-sm",textMain:"text-foreground",textMuted:"text-muted-foreground",divider:"border-border",toolBg:"bg-card border-border shadow-sm",hover:"hover:bg-accent"},es=({jobs:m,date:G,onDateSelect:f,userRole:S,onEditClick:K,onDeleteClick:X,onJobClick:Y,onMessagesClick:b,onEmailClick:j})=>{const Z=de(),x=G??new Date,[ee,D]=p.useState(!1),[c,T]=p.useState([]),[d,z]=p.useState([]),[se,te]=p.useState(!1),[ae,re]=p.useState(!1),k=S?["admin","management"].includes(S):!1;p.useEffect(()=>{(async()=>{var r;try{const{data:{session:n}}=await g.auth.getSession();if(!((r=n==null?void 0:n.user)!=null&&r.id))return;const{data:i,error:o}=await g.from("profiles").select("selected_job_types, selected_job_statuses").eq("id",n.user.id).single();if(o)return;i!=null&&i.selected_job_types&&T(i.selected_job_types),i!=null&&i.selected_job_statuses&&z(i.selected_job_statuses)}catch{}})()},[]);const E=async(s,r)=>{var n;try{const{data:{session:i}}=await g.auth.getSession();if(!((n=i==null?void 0:i.user)!=null&&n.id))return;const o=r!==void 0?{selected_job_types:s,selected_job_statuses:r}:{selected_job_types:s},{error:u}=await g.from("profiles").update(o).eq("id",i.user.id)}catch{}},ne=s=>{const r=c.includes(s)?c.filter(n=>n!==s):[...c,s];T(r),E(r,d)},ie=s=>{const r=d.includes(s)?d.filter(n=>n!==s):[...d,s];z(r),E(c,r)},N=p.useMemo(()=>{if(!m)return[];const s=m.filter(r=>r.job_type!=="tour").map(r=>r.job_type).filter(Boolean);return Array.from(new Set(s))},[m]),v=p.useMemo(()=>{if(!m)return[];const s=m.filter(r=>r.job_type!=="tour").map(r=>r.status).filter(Boolean);return Array.from(new Set(s))},[m]),O=p.useMemo(()=>{if(!m)return[];const s=_(x),r=y(x);return m.filter(n=>{if(n.job_type==="tour")return!1;const i=new Date(n.start_time),o=new Date(n.end_time);return!(!($(s,{start:_(i),end:y(o)})||$(r,{start:_(i),end:y(o)}))||c.length>0&&!c.includes(n.job_type)||d.length>0&&!d.includes(n.status))}).sort((n,i)=>new Date(n.start_time).getTime()-new Date(i.start_time).getTime())},[m,x,c,d]),le=()=>f(ye(x,1)),ce=()=>f(we(x,1)),B=()=>f(new Date);return Z?e.jsx("div",{className:a("min-h-screen",t.bg,"font-sans pb-24"),children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 text-blue-500 text-xs font-semibold uppercase tracking-[0.08em]",children:e.jsx("span",{children:"Dashboard"})}),e.jsx("h2",{className:a("text-2xl font-bold",t.textMain),children:"Agenda"})]}),k&&(b||j)&&e.jsxs("div",{children:[e.jsx("h3",{className:a("text-xs font-bold uppercase tracking-wider mb-3",t.textMuted),children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3",children:[b&&e.jsxs("button",{onClick:b,className:a("flex flex-col items-center justify-center p-3 rounded-xl border flex-1 h-[80px] transition-all",t.toolBg,"hover:border-blue-500 hover:scale-105 active:scale-95"),children:[e.jsx(ue,{size:24,className:"mb-2 text-blue-500"}),e.jsx("span",{className:a("text-[10px] font-bold text-center leading-tight",t.textMain),children:"Mensajes"})]}),j&&e.jsxs("button",{onClick:j,className:a("flex flex-col items-center justify-center p-3 rounded-xl border flex-1 h-[80px] transition-all",t.toolBg,"hover:border-blue-500 hover:scale-105 active:scale-95"),children:[e.jsx(fe,{size:24,className:"mb-2 text-emerald-500"}),e.jsx("span",{className:a("text-[10px] font-bold text-center leading-tight",t.textMain),children:"Email"})]})]})]}),(N.length>0||v.length>0)&&e.jsxs("div",{className:"flex gap-2",children:[N.length>0&&e.jsxs(w,{open:se,onOpenChange:te,children:[e.jsx(M,{asChild:!0,children:e.jsxs(h,{variant:"outline",size:"sm",className:a("flex-1",t.card),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:t.textMain,children:"Type"}),c.length>0&&e.jsx(Q,{variant:"secondary",className:"ml-2 h-5 min-w-5 px-1",children:c.length})]})}),e.jsx(C,{className:a("w-56 p-2",t.card),align:"start",children:e.jsx("div",{className:"space-y-1",children:N.map(s=>e.jsxs("button",{onClick:()=>ne(s),className:a("w-full flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors",t.hover,t.textMain),children:[e.jsx("div",{className:a("w-4 h-4 border rounded flex items-center justify-center",c.includes(s)?"bg-blue-500 border-blue-500":"border-muted"),children:c.includes(s)&&e.jsx(q,{className:"h-3 w-3 text-white"})}),e.jsx("span",{className:"capitalize",children:s})]},s))})})]}),v.length>0&&e.jsxs(w,{open:ae,onOpenChange:re,children:[e.jsx(M,{asChild:!0,children:e.jsxs(h,{variant:"outline",size:"sm",className:a("flex-1",t.card),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:t.textMain,children:"Status"}),d.length>0&&e.jsx(Q,{variant:"secondary",className:"ml-2 h-5 min-w-5 px-1",children:d.length})]})}),e.jsx(C,{className:a("w-56 p-2",t.card),align:"start",children:e.jsx("div",{className:"space-y-1",children:v.map(s=>e.jsxs("button",{onClick:()=>ie(s),className:a("w-full flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors",t.hover,t.textMain),children:[e.jsx("div",{className:a("w-4 h-4 border rounded flex items-center justify-center",d.includes(s)?"bg-blue-500 border-blue-500":"border-muted"),children:d.includes(s)&&e.jsx(q,{className:"h-3 w-3 text-white"})}),e.jsx("span",{children:s})]},s))})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:le,className:a("p-1 rounded",t.hover,t.textMain),children:e.jsx(ge,{size:20})}),e.jsxs("div",{className:"text-center cursor-pointer",onClick:B,children:[e.jsx("div",{className:a("text-lg font-bold",t.textMain),children:_e(x)?"Today":A(x,"MMM d")}),e.jsx("div",{className:a("text-xs",t.textMuted),children:A(x,"EEE")})]}),e.jsx("button",{onClick:ce,className:a("p-1 rounded",t.hover,t.textMain),children:e.jsx(be,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",className:a("rounded-lg px-3",t.card,t.textMain),onClick:B,children:"Today"}),e.jsxs(w,{open:ee,onOpenChange:D,children:[e.jsx(M,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",className:a("rounded-lg",t.card),children:e.jsx(je,{className:a("h-4 w-4",t.textMain)})})}),e.jsx(C,{className:a("p-0 w-auto",t.card),align:"end",sideOffset:8,children:e.jsx(he,{mode:"single",selected:x,onSelect:s=>{s&&(f(s),D(!1))},initialFocus:!0})})]})]})]}),e.jsx("div",{className:"space-y-3",children:O.length===0?e.jsx(U,{className:a("p-6 rounded-2xl",t.card),children:e.jsx("div",{className:a("text-sm text-center",t.textMuted),children:"No hay trabajos programados para esta fecha"})}):O.map(s=>{var J,P,I,F,L,H;const r=s.color||"#3b82f6",n=s.timezone||"Europe/Madrid",i=((J=s.job_assignments)==null?void 0:J.length)||0;let o=0;if((P=s.sound_job_personnel)!=null&&P[0]){const l=s.sound_job_personnel[0];o+=(l.foh_engineers||0)+(l.mon_engineers||0)+(l.pa_techs||0)+(l.rf_techs||0)}if((I=s.lights_job_personnel)!=null&&I[0]){const l=s.lights_job_personnel[0];o+=(l.lighting_designers||0)+(l.lighting_techs||0)+(l.spot_ops||0)+(l.riggers||0)}if((F=s.video_job_personnel)!=null&&F[0]){const l=s.video_job_personnel[0];o+=(l.video_directors||0)+(l.camera_ops||0)+(l.playback_techs||0)+(l.video_techs||0)}const u=((L=s.job_departments)==null?void 0:L.map(l=>l.department))||[];return e.jsxs(U,{className:a("p-4 rounded-xl border-l-4 transition-all",t.card),style:{borderLeftColor:r},children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:a("font-bold text-lg",t.textMain),children:s.title}),e.jsx("div",{className:a("text-xs mt-1",t.textMuted),children:((H=s.location_data)==null?void 0:H.name)||"Sin ubicaciÃ³n"}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:u.map(l=>e.jsx("span",{className:a("px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-muted",t.textMuted),children:l},l))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status&&e.jsx("span",{className:a("px-2 py-0.5 rounded text-[10px] font-bold uppercase",s.status.toLowerCase()==="confirmado"?"bg-cyan-500/10 text-cyan-500":s.status.toLowerCase()==="tentativa"?"bg-blue-500/10 text-blue-500":s.status.toLowerCase()==="completado"?"bg-purple-500/10 text-purple-500":s.status.toLowerCase()==="cancelado"?"bg-red-500/10 text-red-500":"bg-slate-500/10 text-slate-500"),children:s.status}),k&&e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ne,{size:16,className:t.textMuted})})}),e.jsxs(pe,{align:"end",className:a("min-w-[140px]",t.card,t.textMain),children:[e.jsxs(V,{onClick:()=>K(s),children:[e.jsx(ve,{size:14,className:"mr-2"}),"Edit"]}),e.jsxs(V,{onClick:()=>X(s.id),className:"text-red-600",children:[e.jsx(oe,{size:14,className:"mr-2"}),"Delete"]})]})]})]})]}),e.jsxs("div",{className:a("flex items-center gap-4 text-xs mt-3 pb-3 border-b border-dashed",t.textMuted,t.divider),children:[e.jsxs("div",{children:[R(s.start_time,"HH:mm",n)," - ",R(s.end_time,"HH:mm",n)]}),e.jsxs("div",{children:[i,"/",o||i," Crew"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(h,{className:"w-full",variant:"default",onClick:()=>Y(s.id),children:"Ver Detalles"})})]},s.id)})})]})}):null};export{es as DashboardMobileHub};
