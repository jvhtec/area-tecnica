import{j as e,T as we,J as ye,K as Ce,B as x,O as Me,P as _e,d as ke,c as Te,r as o,y as k,z as T,Q as a,C as S,U as K,i as N,M as Se,V as De,s as v}from"./index-NZ6jJLfQ.js";import{D as V,a as ee,b as se,c as p}from"./dropdown-menu-Dn1SMjj1.js";import{P as te}from"./plus-C3JQqq7t.js";import{P as D,a as z,b as P}from"./popover-Dl-b1R8L.js";import{C as ze}from"./calendar--BDVgnXu.js";import{B as R}from"./badge-vNTKF5RD.js";import{i as G}from"./isWithinInterval-CV3kanO0.js";import{C as X}from"./chevron-right-Bn7Eu0F7.js";import{F as Y}from"./filter-D0HnK7Nz.js";import{C as Pe}from"./chevron-left-rq2ui83a.js";import{C as Oe}from"./calendar-_Cj_Sgy-.js";import{E as Ee}from"./ellipsis-vertical-zRAfIP3L.js";import{S as Ie}from"./square-pen-BMpSgZGa.js";import{C as Be}from"./clock-BXPvTWvY.js";import{U as Fe}from"./users-DMnpVLUq.js";import{T as He}from"./truck-Br5sduv3.js";import{i as Le}from"./isToday-BbpdYtC3.js";import{s as Ue}from"./subDays-D4REtaCB.js";import{a as qe}from"./startOfMonth-B5dVCv8B.js";const ds=({onCreateJob:i,department:j="Lights",canCreate:f=!0})=>e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Departmento de ",j]}),e.jsx("div",{className:"flex w-full sm:w-auto flex-wrap gap-2 sm:justify-end",children:e.jsxs("div",{className:"flex w-full sm:w-auto flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(we,{children:e.jsxs(ye,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(x,{onClick:()=>i(),className:"w-full sm:w-auto gap-2 sm:rounded-r-none","aria-label":"Create job",disabled:!f,children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Job"})]})}),e.jsx(Me,{children:f?`Create ${j} job`:"Insufficient permissions"})]})}),e.jsxs(V,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(x,{variant:"outline",className:"w-full sm:w-auto px-2 sm:rounded-l-none",disabled:!f,"aria-label":"Choose preset",children:e.jsx(_e,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsx(p,{onClick:()=>i("single"),children:"Single"}),e.jsx(p,{onClick:()=>i("tour"),children:"Tour"}),e.jsx(p,{onClick:()=>i("festival"),children:"Festival"}),e.jsx(p,{onClick:()=>i("dryhire"),children:"Dry Hire"}),e.jsx(p,{onClick:()=>i("tourdate"),children:"Tour Date"})]})]})]})})]}),Z={dark:{bg:"bg-[#05070a]",card:"bg-[#0f1219] border-[#1f232e]",textMain:"text-white",textMuted:"text-[#94a3b8]",divider:"border-[#1f232e]",toolBg:"bg-[#151820] border-[#2a2e3b]",accent:"bg-blue-600 text-white",hover:"hover:bg-[#151820]"},light:{bg:"bg-[#f8fafc]",card:"bg-white border-slate-200 shadow-sm",textMain:"text-slate-900",textMuted:"text-slate-500",divider:"border-slate-100",toolBg:"bg-white border-slate-200 shadow-sm",accent:"bg-blue-600 text-white",hover:"hover:bg-slate-50"}},os=({department:i,title:j,icon:f,tools:ae,jobs:m,date:re,onDateSelect:g,canCreateJob:ne=!1,onCreateJob:O,userRole:E,onEditJob:I,onDeleteJob:B,onJobClick:w,onViewDetails:y,onManageAssignments:F,staffData:C,onStaffClick:le})=>{const ie=ke(),ce=Te(),[de,Je]=o.useState(!0),[c,H]=o.useState([]),[d,L]=o.useState([]),[oe,xe]=o.useState(!1),[me,he]=o.useState(!1),h=re,t=de?Z.dark:Z.light,ue=E?["admin","management"].includes(E):!1;o.useEffect(()=>{(async()=>{var r;try{const{data:{session:n}}=await v.auth.getSession();if(!((r=n==null?void 0:n.user)!=null&&r.id))return;const{data:l,error:u}=await v.from("profiles").select("selected_job_types, selected_job_statuses").eq("id",n.user.id).single();if(u)return;l!=null&&l.selected_job_types&&H(l.selected_job_types),l!=null&&l.selected_job_statuses&&L(l.selected_job_statuses)}catch{}})()},[]);const U=async(s,r)=>{var n;try{const{data:{session:l}}=await v.auth.getSession();if(!((n=l==null?void 0:l.user)!=null&&n.id))return;const u=r!==void 0?{selected_job_types:s,selected_job_statuses:r}:{selected_job_types:s},{error:b}=await v.from("profiles").update(u).eq("id",l.user.id)}catch{}},pe=s=>{const r=c.includes(s)?c.filter(n=>n!==s):[...c,s];H(r),U(r,d)},fe=s=>{const r=d.includes(s)?d.filter(n=>n!==s):[...d,s];L(r),U(c,r)},q=o.useMemo(()=>m?m.filter(s=>{var n;return!(s.job_type==="tour"||!((n=s.job_departments)==null?void 0:n.some(l=>l.department===i))||c.length>0&&!c.includes(s.job_type)||d.length>0&&!d.includes(s.status))}).sort((s,r)=>new Date(s.start_time).getTime()-new Date(r.start_time).getTime()):[],[m,i,c,d]),M=o.useMemo(()=>{if(!m)return[];const s=m.filter(r=>{var n;return r.job_type!=="tour"&&((n=r.job_departments)==null?void 0:n.some(l=>l.department===i))}).map(r=>r.job_type).filter(Boolean);return Array.from(new Set(s))},[m,i]),_=o.useMemo(()=>{if(!m)return[];const s=m.filter(r=>{var n;return r.job_type!=="tour"&&((n=r.job_departments)==null?void 0:n.some(l=>l.department===i))}).map(r=>r.status).filter(Boolean);return Array.from(new Set(s))},[m,i]),J=o.useMemo(()=>{const s=k(h),r=T(h);return q.filter(n=>{const l=new Date(n.start_time),u=new Date(n.end_time);return G(s,{start:k(l),end:T(u)})||G(r,{start:k(l),end:T(u)})})},[q,h]),je=()=>g(Ue(h,1)),ge=()=>g(qe(h,1)),A=()=>g(new Date),[be,Q]=o.useState(!1);return ie?e.jsx("div",{className:a("min-h-screen",t.bg,"font-sans p-1 transition-colors duration-300"),children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-500 text-xs font-semibold uppercase tracking-[0.08em]",children:[e.jsx(f,{className:"h-5 w-5"}),e.jsx("span",{children:"Department"})]}),e.jsx("h2",{className:a("text-2xl font-bold",t.textMain),children:j})]}),e.jsxs("div",{children:[e.jsx("h3",{className:a("text-xs font-bold uppercase tracking-wider mb-3",t.textMuted),children:"Quick Tools"}),e.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:ae.map((s,r)=>e.jsxs("button",{onClick:s.onClick||(s.to?()=>ce(s.to):void 0),className:a("flex flex-col items-center justify-center p-3 rounded-xl border min-w-[80px] h-[80px] flex-shrink-0 transition-all",t.toolBg,"hover:border-blue-500 hover:scale-105 active:scale-95"),children:[e.jsx(s.icon,{size:24,className:a("mb-2",s.color||"text-blue-500")}),e.jsx("span",{className:a("text-[10px] font-bold text-center leading-tight",t.textMain),children:s.label})]},r))})]}),C&&e.jsxs(S,{className:a("p-4 rounded-xl border flex items-center justify-between cursor-pointer",t.card,t.hover),onClick:le,children:[e.jsxs("div",{children:[e.jsx("div",{className:a("text-xs font-bold uppercase tracking-wider mb-1",t.textMuted),children:"Staff Availability"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),e.jsxs("span",{className:a("text-sm font-bold",t.textMain),children:[C.warehouse," Warehouse"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsxs("span",{className:a("text-sm font-bold",t.textMain),children:[C.onJob," On Job"]})]})]})]}),e.jsx(X,{size:20,className:t.textMuted})]}),(M.length>0||_.length>0)&&e.jsxs("div",{className:"flex gap-2",children:[M.length>0&&e.jsxs(D,{open:oe,onOpenChange:xe,children:[e.jsx(z,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"sm",className:a("flex-1",t.card),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:t.textMain,children:"Type"}),c.length>0&&e.jsx(R,{variant:"secondary",className:"ml-2 h-5 min-w-5 px-1",children:c.length})]})}),e.jsx(P,{className:a("w-56 p-2",t.card),align:"start",children:e.jsx("div",{className:"space-y-1",children:M.map(s=>e.jsxs("button",{onClick:()=>pe(s),className:a("w-full flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors",t.hover,t.textMain),children:[e.jsx("div",{className:a("w-4 h-4 border rounded flex items-center justify-center",c.includes(s)?"bg-blue-500 border-blue-500":"border-muted"),children:c.includes(s)&&e.jsx(K,{className:"h-3 w-3 text-white"})}),e.jsx("span",{className:"capitalize",children:s})]},s))})})]}),_.length>0&&e.jsxs(D,{open:me,onOpenChange:he,children:[e.jsx(z,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"sm",className:a("flex-1",t.card),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:t.textMain,children:"Status"}),d.length>0&&e.jsx(R,{variant:"secondary",className:"ml-2 h-5 min-w-5 px-1",children:d.length})]})}),e.jsx(P,{className:a("w-56 p-2",t.card),align:"start",children:e.jsx("div",{className:"space-y-1",children:_.map(s=>e.jsxs("button",{onClick:()=>fe(s),className:a("w-full flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors",t.hover,t.textMain),children:[e.jsx("div",{className:a("w-4 h-4 border rounded flex items-center justify-center",d.includes(s)?"bg-blue-500 border-blue-500":"border-muted"),children:d.includes(s)&&e.jsx(K,{className:"h-3 w-3 text-white"})}),e.jsx("span",{children:s})]},s))})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:je,className:a("p-1 rounded hover:bg-white/10",t.textMain),children:e.jsx(Pe,{size:20})}),e.jsxs("div",{className:"text-center cursor-pointer",onClick:A,children:[e.jsx("div",{className:a("text-lg font-bold",t.textMain),children:Le(h)?"Today":N(h,"MMM d")}),e.jsx("div",{className:a("text-xs",t.textMuted),children:N(h,"EEE")})]}),e.jsx("button",{onClick:ge,className:a("p-1 rounded hover:bg-white/10",t.textMain),children:e.jsx(X,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",className:a("rounded-lg px-3",t.card,t.textMain),onClick:A,children:"Today"}),e.jsxs(D,{open:be,onOpenChange:Q,children:[e.jsx(z,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",className:a("rounded-lg",t.card),children:e.jsx(Oe,{className:a("h-4 w-4",t.textMain)})})}),e.jsx(P,{className:a("p-0 w-auto",t.card),align:"end",sideOffset:8,children:e.jsx(ze,{mode:"single",selected:h,onSelect:s=>{s&&(g(s),Q(!1))},initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[ne&&O&&e.jsxs(x,{onClick:O,className:a("w-full rounded-xl text-base font-semibold",t.accent),children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"Create New Job"]}),J.length===0?e.jsx(S,{className:a("p-4 rounded-2xl",t.card),children:e.jsx("div",{className:a("text-sm text-center",t.textMuted),children:"No jobs scheduled for this date."})}):J.map(s=>{var b,W,$;const r=((b=s.job_assignments)==null?void 0:b.length)??s.assignments_count??s.crew_size??0,n=((W=s.logistics_events)==null?void 0:W.length)??s.trucks_count??0,l=s.status==="production",u=s.color||(l?"#10b981":"#3b82f6");return e.jsxs(S,{className:a("p-3 rounded-xl border-l-4 transition-all",t.card),style:{borderLeftColor:u},children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:a("font-bold text-lg",t.textMain),children:s.title}),e.jsxs("div",{className:a("text-xs flex items-center gap-1 mt-0.5",t.textMuted),children:[e.jsx(Se,{size:12}),(($=s.location)==null?void 0:$.name)||"Sin ubicaciÃ³n"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const Ne=(s.status||"").toLowerCase(),ve={tentativa:"bg-blue-500/10 text-blue-500",confirmado:"bg-cyan-500/10 text-cyan-500",completado:"bg-purple-500/10 text-purple-500",cancelado:"bg-red-500/10 text-red-500"}[Ne]||"bg-slate-500/10 text-slate-500";return e.jsx("span",{className:a("px-2 py-0.5 rounded text-[10px] font-bold uppercase",ve),children:s.status||"Sin estado"})})(),ue&&I&&B&&e.jsxs(V,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ee,{size:16,className:t.textMuted})})}),e.jsxs(se,{align:"end",className:a("min-w-[140px]",t.card,t.textMain),children:[e.jsxs(p,{onClick:()=>I(s),children:[e.jsx(Ie,{size:14,className:"mr-2"}),"Edit"]}),e.jsxs(p,{onClick:()=>B(s.id),className:"text-red-600",children:[e.jsx(De,{size:14,className:"mr-2"}),"Delete"]})]})]})]})]}),e.jsxs("div",{className:a("flex items-center gap-4 text-xs mt-3 pb-3 border-b border-dashed",t.textMuted,t.divider),children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Be,{size:14}),N(new Date(s.start_time),"HH:mm")," - ",N(new Date(s.end_time),"HH:mm")]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Fe,{size:14}),r," Techs"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(He,{size:14}),n," Trucks"]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(x,{variant:"outline",className:"flex-1",onClick:()=>y==null?void 0:y(s),children:"View Details"}),e.jsx(x,{className:a("flex-1",t.accent),onClick:()=>{if(F){F(s);return}w==null||w(s.id)},children:"Manage"})]})]},s.id)})]})]})}):null};export{os as D,ds as L};
