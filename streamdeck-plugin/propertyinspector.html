<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Area Técnica - Execute Shortcut</title>
  <link rel="stylesheet" href="sdpi.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 16px;
      background: #2d2d2d;
      color: #d4d4d4;
    }
    .sdpi-item {
      margin-bottom: 16px;
    }
    .sdpi-item-label {
      display: block;
      margin-bottom: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    select, input {
      width: 100%;
      padding: 8px;
      border: 1px solid #464646;
      border-radius: 4px;
      background: #3c3c3c;
      color: #d4d4d4;
      font-size: 13px;
    }
    select:focus, input:focus {
      outline: none;
      border-color: #0e639c;
    }
    .info {
      font-size: 11px;
      color: #858585;
      margin-top: 4px;
    }
    .shortcut-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .shortcut-option {
      padding: 2px 0;
    }
  </style>
</head>
<body>
  <div class="sdpi-wrapper">
    <div class="sdpi-item">
      <label class="sdpi-item-label">Shortcut ID</label>
      <select id="shortcutId" class="shortcut-list">
        <optgroup label="Navigation">
          <option value="nav-dashboard">Panel Principal (Dashboard)</option>
          <option value="nav-sound">Sonido</option>
          <option value="nav-lights">Luces</option>
          <option value="nav-video">Video</option>
          <option value="nav-logistics">Logística</option>
          <option value="nav-tours">Tours</option>
          <option value="nav-festivals">Festivales</option>
          <option value="nav-personal">Personal</option>
          <option value="nav-project-management">Gestión de Proyectos</option>
          <option value="nav-job-assignment-matrix">Matriz de Asignaciones</option>
          <option value="nav-rates">Tarifas</option>
          <option value="nav-expenses">Gastos</option>
          <option value="nav-timesheets">Hojas de Tiempo</option>
          <option value="nav-hoja-de-ruta">Hoja de Ruta</option>
          <option value="nav-profile">Perfil</option>
          <option value="nav-settings">Configuración</option>
        </optgroup>
        <optgroup label="Job Card Actions (Requires Selection)">
          <option value="job-view-details">Ver Detalles</option>
          <option value="job-edit">Editar Trabajo</option>
          <option value="job-assign">Asignar Técnicos</option>
          <option value="job-refresh">Refrescar Datos</option>
          <option value="job-sync-flex">Sincronizar con Flex</option>
          <option value="job-timesheets">Gestionar Hojas de Tiempo</option>
          <option value="job-pesos-calculator">Calculadora de Pesos</option>
          <option value="job-consumos-calculator">Calculadora de Consumos</option>
          <option value="job-tasks">Abrir Tareas</option>
          <option value="job-transport">Solicitar Transporte</option>
          <option value="job-whatsapp-group">Crear Grupo WhatsApp</option>
          <option value="job-create-flex-folders">Crear Carpetas Flex</option>
          <option value="job-add-flex-folders">Añadir Carpetas Flex</option>
          <option value="job-create-local-folders">Crear Carpetas Locales</option>
          <option value="job-open-in-flex">Abrir en Flex</option>
          <option value="job-upload-document">Subir Documento</option>
          <option value="job-archive-to-flex">Archivar a Flex</option>
          <option value="job-delete">Eliminar Trabajo</option>
          <option value="job-manage-festival">Gestionar Festival</option>
        </optgroup>
      </select>
      <div class="info">Select the shortcut to execute when this button is pressed</div>
    </div>

    <div class="sdpi-item">
      <label class="sdpi-item-label">Button Label (optional)</label>
      <input type="text" id="shortcutLabel" placeholder="Label to show on button" />
      <div class="info">Leave empty to use default shortcut name</div>
    </div>
  </div>

  <script src="common.js"></script>
  <script>
    let websocket = null;
    let uuid = null;
    let actionInfo = {};
    let settings = {};

    function connectElgatoStreamDeckSocket(inPort, inUUID, inRegisterEvent, inInfo, inActionInfo) {
      uuid = inUUID;
      actionInfo = JSON.parse(inActionInfo);
      settings = actionInfo.payload.settings;

      websocket = new WebSocket('ws://127.0.0.1:' + inPort);

      websocket.onopen = function () {
        const json = { event: inRegisterEvent, uuid: uuid };
        websocket.send(JSON.stringify(json));

        // Load settings
        document.getElementById('shortcutId').value = settings.shortcutId || '';
        document.getElementById('shortcutLabel').value = settings.shortcutLabel || '';
      };

      // Listen for changes
      document.getElementById('shortcutId').addEventListener('change', function (e) {
        settings.shortcutId = e.target.value;
        saveSettings();
      });

      document.getElementById('shortcutLabel').addEventListener('input', function (e) {
        settings.shortcutLabel = e.target.value;
        saveSettings();
      });
    }

    function saveSettings() {
      if (websocket && websocket.readyState === 1) {
        const json = {
          event: 'setSettings',
          context: uuid,
          payload: settings
        };
        websocket.send(JSON.stringify(json));
      }
    }
  </script>
</body>
</html>
